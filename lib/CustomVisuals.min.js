!function(e){function t(a){if(i[a])return i[a].exports;var r=i[a]={exports:{},id:a,loaded:!1};return e[a].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){e.exports=i(13)},,,,,,,,,,,,,function(e,t,i){function a(e){return e.keys().map(e)}window.jsCommon,window.powerbi,window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;window.jsCommon=window.jsCommon||{},window.powerbi=window.powerbi||{},window.debug=window.debug||{},window.InJs=window.InJs||{},a(i(14)),i(36),i(37),i(38),i(39),i(40),i(41),i(42),i(43),i(44),i(45),i(46),i(47),i(48),i(49),i(50),i(51),i(52),i(53),i(54),i(55),i(56)},function(e,t,i){function a(e){return i(r(e))}function r(e){return s[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var s={"./styles/styles.less":15,"./visuals/asterPlot/visual/styles/asterPlot.less":17,"./visuals/bulletChart/visual/styles/bulletChart.less":18,"./visuals/chicletSlicer/visual/styles/chicletSlicer.less":19,"./visuals/chordChart/visual/styles/chordChart.less":20,"./visuals/dotPlot/visual/styles/dotPlot.less":21,"./visuals/enhancedScatterChart/visual/styles/enhancedScatterChart.less":22,"./visuals/forceGraph/visual/styles/forceGraph.less":23,"./visuals/gantt/visual/styles/gantt.less":24,"./visuals/globeMap/visual/styles/globeMap.less":25,"./visuals/histogram/visual/styles/histogram.less":26,"./visuals/lineDotChart/visual/styles/lineDotChart.less":27,"./visuals/mekkoChart/visual/styles/mekkoChart.less":28,"./visuals/radarChart/visual/styles/radarChart.less":29,"./visuals/sankeyDiagram/visual/styles/sankeyDiagram.less":30,"./visuals/streamGraph/visual/styles/streamGraph.less":31,"./visuals/sunburst/visual/styles/sunburst.less":32,"./visuals/timeline/visual/styles/timeline.less":33,"./visuals/tornadoChart/visual/styles/tornadoChart.less":34,"./visuals/wordCloud/visual/styles/wordCloud.less":35};a.keys=function(){return Object.keys(s)},a.resolve=r,e.exports=a,a.id=14},function(e,t){},,function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=a.CssConstants.createClassAndSelector,s=a.PixelConverter,o=e.visuals.valueFormatter,l="asterPlot",n="legend",c=1,h={solid:{color:"#333"}},u=8,d=.9,p=.9,g=17,m=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.selection=e.selection,this.highlightedSelection=e.highlightedSelection,this.clearCatcher=e.clearCatcher,this.interactivityService=e.interactivityService,this.selection.on("click",function(e,i){t.handleSelection(e.data,d3.event.ctrlKey)}),this.highlightedSelection&&this.highlightedSelection.on("click",function(e,i){t.handleSelection(e.data,d3.event.ctrlKey)}),this.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var i=this.interactivityService.hasSelection();this.selection.style("fill-opacity",function(a){return t.ColumnUtil.getFillOpacity(a.data.selected,a.data.highlight,!a.data.highlight&&e,!a.data.selected&&i)})},e}(),y=function(){function e(e){this.message=e}return Object.defineProperty(e.prototype,"code",{get:function(){return"AsterPlotWarning"},enumerable:!0,configurable:!0}),e.prototype.getMessages=function(e){return{message:this.message,title:e.get(""),detail:e.get("")}},e}();i.AsterPlotWarning=y;var f=function(){function i(){this.margin={top:10,right:10,bottom:15,left:10}}return i.prototype.getDefaultAsterData=function(){return{dataPoints:[],highlightedDataPoints:[],legendData:{dataPoints:[],title:null,fontSize:u,labelColor:t.LegendData.DefaultLegendLabelFillColor},legendSettings:{show:!1,position:"Top",showTitle:!0,labelColor:t.LegendData.DefaultLegendLabelFillColor,titleText:"",fontSize:u},valueFormatter:null,labelSettings:{show:!1,displayUnits:0,precision:t.dataLabelUtils.defaultLabelPrecision,labelColor:t.dataLabelUtils.defaultLabelColor,fontSize:t.dataLabelUtils.DefaultFontSizeInPt},showOuterLine:!1,outerLineThickness:c}},i.prototype.converter=function(a,r){var l=this.getDefaultAsterData();if(!this.dataViewContainsCategory(a)||1!==a.categorical.categories.length)return l;var n=a.categorical,h=n.categories[0],u=h.source,d=h.values,p=n.values,g=h.objects,m=new t.ColorHelper(r,i.Properties.dataPoint.fill),y=this.hasHighlights=!!(p&&p.length>0&&p[0].highlights);if(a.metadata||a.metadata.objects){var f=a.metadata.objects;l.labelSettings=this.getLabelSettings(f,l.labelSettings),this.updateLegendSettings(f,u,l.legendSettings),l.showOuterLine=e.DataViewObjects.getValue(f,i.Properties.outerLine.show,l.showOuterLine),l.outerLineThickness=e.DataViewObjects.getValue(f,i.Properties.outerLine.thickness,c)}var v=l.labelSettings;if(!d||d.length<1||!p||p.length<1)return l;for(var x=i.Properties.general.formatString,b=Math.max(d3.min(p[0].values)),S=Math.min(0,d3.min(p[0].values)),w=o.create({format:o.getFormatString(p[0].source,x),precision:v.precision,value:0===v.displayUnits&&null!=b?b:v.displayUnits}),C=t.valueFormatter.getFormatString(u,x),D=s.fromPoint(v.fontSize),P=0;P<d.length;P++){var A=t.valueFormatter.format(d[P],C),N=p[0].values[P],V=t.TooltipBuilder.createTooltipInfo(x,n,A,N,null,null,0);if(p.length>1){var T=t.TooltipBuilder.createTooltipInfo(x,n,A,p[1].values[P],null,null,1)[1];T&&V.push(T),N+=p[1].values[P]}var L=h.identity[P],M=m.getColorForMeasure(g&&g[P],L.key),k=t.SelectionId.createWithId(L),j=Math.max(0,p.length>1?p[1].values[P]:1);if(l.dataPoints.push({sliceHeight:p[0].values[P]-S,sliceWidth:j,label:w.format(N),color:M,identity:k,selected:!1,tooltipInfo:V,labelFontSize:D,highlight:!1}),l.legendSettings.show&&l.legendData.dataPoints.push({label:d[P],color:M,icon:t.LegendIcon.Box,selected:!1,identity:k}),y){var O=t.SelectionId.createWithHighlight(k),I=null!=p[0].highlights[P];if(N=I?p[0].highlights[P]:0,V=t.TooltipBuilder.createTooltipInfo(x,n,A,N,null,null,0),p.length>1){var T=t.TooltipBuilder.createTooltipInfo(x,n,A,p[1].highlights[P],null,null,1)[1];T&&V.push(T),N+=null!==p[1].highlights[P]?p[1].highlights[P]:0}l.highlightedDataPoints.push({sliceHeight:I?p[0].highlights[P]-S:null,sliceWidth:Math.max(0,p.length>1&&null!==p[1].highlights[P]?p[1].highlights[P]:j),label:w.format(N),color:M,identity:O,selected:!1,tooltipInfo:V,labelFontSize:D,highlight:!0})}}return l},i.prototype.dataViewContainsCategory=function(e){return e&&e.categorical&&e.categorical.values&&e.categorical.categories&&e.categorical.categories[0]},i.prototype.getLabelSettings=function(a,r){var s=i.Properties,o=e.DataViewObjects.getValue(a,s.labels.labelPrecision,r.precision);r.precision=void 0===o?o:Math.min(o,g),r.show=e.DataViewObjects.getValue(a,s.labels.show,r.show),r.fontSize=e.DataViewObjects.getValue(a,s.labels.fontSize,r.fontSize),r.displayUnits=e.DataViewObjects.getValue(a,s.labels.labelDisplayUnits,r.displayUnits);var l=new t.ColorHelper(this.colors,s.labels.color,r.labelColor);return r.labelColor=l.getColorForMeasure(a,""),r},i.prototype.updateLegendSettings=function(t,a,r){var s=i.Properties.legend;r.show=e.DataViewObjects.getValue(t,s.show,r.show),r.position=e.DataViewObjects.getValue(t,s.position,r.position),r.showTitle=e.DataViewObjects.getValue(t,s.showTitle,r.showTitle);var o=e.DataViewObjects.getValue(t,s.titleText,"");r.titleText=_.isEmpty(o)&&a?a.displayName:o,r.labelColor=e.DataViewObjects.getFillColor(t,s.labelColor,r.labelColor),r.fontSize=e.DataViewObjects.getValue(t,s.fontSize,r.fontSize)},i.prototype.init=function(e){this.hostService=e.host;var i=e.element,a=this.svg=d3.select(i.get(0)).append("svg").classed(l,!0).style("position","absolute");this.colors=e.style.colorPalette.dataColors,this.mainGroupElement=a.append("g"),this.mainLabelsElement=a.append("g"),this.behavior=new m,this.clearCatcher=t.appendClearCatcher(this.mainGroupElement);var r=e.interactivity;this.interactivityService=t.createInteractivityService(this.hostService),this.legend=t.createLegend(i,r&&r.isInteractiveLegend,this.interactivityService,!0)},i.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){var a=e.suppressAnimations?0:t.AnimatorCommon.MinervaAnimationDuration;this.currentViewport={height:Math.max(0,e.viewport.height),width:Math.max(0,e.viewport.width)};var r=this.dataView=e.dataViews[0],s=this.data=this.converter(r,this.colors);if(!s||!s.dataPoints||0===s.dataPoints.length)return void this.clearData();this.interactivityService&&(this.interactivityService.applySelectionStateToData(s.dataPoints),this.interactivityService.applySelectionStateToData(s.highlightedDataPoints)),this.renderLegend(s),this.updateViewPortAccordingToLegend(),this.svg.attr({height:Math.max(0,this.currentViewport.height),width:Math.max(0,this.currentViewport.width)});var o=this.margin,l=(this.currentViewport.width-o.left)/2,n=(this.currentViewport.height-o.top)/2;this.mainGroupElement.attr("transform",t.SVGUtil.translate(l,n)),this.mainLabelsElement.attr("transform",t.SVGUtil.translate(l,n)),this.clearCatcher.attr("transform",t.SVGUtil.translate(-l,-n)),this.mainGroupElement.selectAll(i.AsterSlice.selector).remove(),this.mainGroupElement.selectAll(i.AsterHighlightedSlice.selector).remove(),t.dataLabelUtils.cleanDataLabels(this.mainLabelsElement,!0);var c=s.dataPoints;if(c&&0!==c.length){var h,u=this.renderArcsAndLabels(c,a,s.labelSettings);this.hasHighlights&&(h=this.renderArcsAndLabels(s.highlightedDataPoints,a,s.labelSettings,!0));var d=this.interactivityService;if(d){var p={selection:u,highlightedSelection:h,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService};d.bind(s.dataPoints.concat(s.highlightedDataPoints),this.behavior,p)}}}},i.prototype.renderArcsAndLabels=function(e,a,r,s){void 0===s&&(s=!1);var o=this.margin,l=this.currentViewport.width-o.left-o.right,n=this.currentViewport.height-o.top-o.bottom,c=Math.min(l,n)/2,h=.3*(r.show?c*d:c),u=d3.max(e,function(e){return e.sliceHeight}),p=d3.sum(e,function(e){return e.sliceWidth}),g=this.interactivityService&&this.interactivityService.hasSelection(),m=this.hasHighlights,y=d3.layout.pie().sort(null).value(function(e){return(e&&!isNaN(e.sliceWidth)?e.sliceWidth:0)/p}),f=d3.svg.arc().innerRadius(h).outerRadius(function(e){var t=(c-h)*(e&&e.data&&!isNaN(e.data.sliceHeight)?e.data.sliceHeight:1)/u,i=h+(r.show?t*d:t);return Math.max(i,h)}),v=y(e),x=s?i.AsterHighlightedSlice:i.AsterSlice,b=this.mainGroupElement.selectAll(x.selector).data(v,function(e,t){return e.data?e.data.identity.getKey():t});if(b.enter().append("path").attr("stroke","#333").classed(x["class"],!0),b.attr("fill",function(e){return e.data.color}).style("fill-opacity",function(e){return t.ColumnUtil.getFillOpacity(e.data.selected,e.data.highlight,g,m)}).transition().duration(a).attrTween("d",function(e){if(!this.oldData)return this.oldData=e,function(){return f(e)};var t=d3.interpolate(this.oldData,e);return this.oldData=t(0),function(e){return f(t(e))}}),b.exit().remove(),t.TooltipManager.addTooltip(b,function(e){return e.data.data.tooltipInfo}),r.show&&(!m||m&&s)){var S=function(e){var t=c*(e&&!isNaN(e.sliceHeight)?e.sliceHeight:1)/u+h;return Math.max(t,h)},w=d3.svg.arc().innerRadius(function(e){return S(e.data)}).outerRadius(function(e){return S(e.data)}),C=function(e){var t=(c-h)*(e&&!isNaN(e.sliceHeight)?e.sliceHeight:1)/u;return t=h+t*d,Math.max(t,h)},D=d3.svg.arc().innerRadius(function(e){return C(e.data)}).outerRadius(function(e){return C(e.data)}),P=this.getLabelLayout(r,w,this.currentViewport);this.drawLabels(v,this.mainLabelsElement,P,this.currentViewport,D,w)}else t.dataLabelUtils.cleanDataLabels(this.mainLabelsElement,!0);return s||(this.drawCenterText(h),this.drawOuterLine(h,c,v)),b},i.prototype.getLabelLayout=function(i,a,r){var o=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2},l={fontFamily:t.dataLabelUtils.StandardFontFamily,fontSize:s.fromPoint(i.fontSize),text:""},n=function(t){var i=a.centroid(t);l.text=t.data.label;var s=e.TextMeasurementService.measureSvgTextWidth(l),o=r.width/2-Math.abs(i[0]),n=e.TextMeasurementService.estimateSvgTextHeight(l),c=r.height/2-Math.abs(i[1]);return t.isLabelHasConflict=s>o||n>c,t.isLabelHasConflict};return{labelText:function(t){l.text=t.data.label;var i=a.centroid(t),s=n(t)?i[0]*p:i[0],o=r.width/2-Math.abs(s);return e.TextMeasurementService.getTailoredTextOrDefault(l,o)},labelLayout:{x:function(e){var t=a.centroid(e);l.text=e.data.label;var i=e.isLabelHasConflict?t[0]*p:t[0];return i},y:function(e){var t=a.centroid(e),i=e.isLabelHasConflict?t[1]*p:t[1];return i}},filter:function(e){return null!=e&&!_.isEmpty(e.data.label)},style:{fill:i.labelColor,"font-size":l.fontSize,"text-anchor":function(e){return o(e)<Math.PI?"start":"end"}}}},i.prototype.drawLabels=function(a,r,s,o,l,n){var c=this,h=new e.DataLabelManager,u=h.hideCollidedLabels(o,a,s,!0);if(0===u.length)return void t.dataLabelUtils.cleanDataLabels(r,!0);r.select(i.labelGraphicsContextClass.selector).empty()&&r.append("g").classed(i.labelGraphicsContextClass["class"],!0);var d=r.select(i.labelGraphicsContextClass.selector).selectAll(".data-labels").data(u,function(e){return e.data.identity.getKey()});if(d.enter().append("text").classed("data-labels",!0),d){d.attr({x:function(e){return e.labelX},y:function(e){return e.labelY},dy:".35em"}).text(function(e){return e.labeltext}).style(s.style),d.exit().remove(),r.select(i.linesGraphicsContextClass.selector).empty()&&r.append("g").classed(i.linesGraphicsContextClass["class"],!0),u=_.filter(u,function(e){return null!==e.data.sliceHeight&&0!==e.data.sliceHeight});var p=r.select(i.linesGraphicsContextClass.selector).selectAll("polyline").data(u,function(e){return e.data.identity.getKey()}),g=4,m=1.02,y=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2};p.enter().append("polyline").classed("line-label",!0),p.attr("points",function(e){var t=[e.labelX,e.labelY];t[0]=t[0]+(y(e)<Math.PI?-1:1)*g;var i=l.centroid(e);return i[0]*=m,i[1]*=m,[i,t]}).style({opacity:.5,"fill-opacity":0,stroke:function(e){return c.data.labelSettings.labelColor}}),p.exit().remove()}},i.prototype.renderLegend=function(i){if(i&&i.legendData){var a=i.legendData,r=this.dataView&&this.dataView.metadata?this.dataView.metadata.objects:null,s=e.DataViewObjects.getObject(r,n,{});if(s){var o=i.legendSettings;s.titleText=o.titleText,t.LegendData.update(a,s),this.legend.changeOrientation(t.LegendPosition[o.position])}this.legend.drawLegend(a,_.clone(this.currentViewport)),t.Legend.positionChartArea(this.svg,this.legend)}},i.prototype.updateViewPortAccordingToLegend=function(){var e=this.data.legendSettings;if(e&&e.show){var i=this.legend.getMargins(),a=t.LegendPosition[e.position];switch(a){case t.LegendPosition.Top:case t.LegendPosition.TopCenter:case t.LegendPosition.Bottom:case t.LegendPosition.BottomCenter:this.currentViewport.height-=i.height;break;case t.LegendPosition.Left:case t.LegendPosition.LeftCenter:case t.LegendPosition.Right:case t.LegendPosition.RightCenter:this.currentViewport.width-=i.width}}},i.prototype.drawOuterLine=function(e,t,a){var r=this.mainGroupElement,s=d3.svg.arc().innerRadius(e).outerRadius(t);if(this.data.showOuterLine){var o=this.data.outerLineThickness+"px",l=r.selectAll(i.OuterLine.selector).data(a);l.enter().append("path"),l.attr("fill","none").attr({stroke:"#333","stroke-width":o,d:s}).style("opacity",1).classed(i.OuterLine["class"],!0),l.exit().remove()}else r.selectAll(i.OuterLine.selector).remove()},i.prototype.getCenterText=function(e){if(e&&e.metadata&&e.metadata.columns&&e.categorical&&e.categorical.values)for(var t=0,i=e.metadata.columns;t<i.length;t++){var a=i[t];if(!a.isMeasure)return a.displayName}return""},i.prototype.drawCenterText=function(a){var r=this.getCenterText(this.dataView);if(_.isEmpty(r))return void this.mainGroupElement.select(i.CenterLabelClass.selector).remove();var o={fontFamily:t.dataLabelUtils.StandardFontFamily,fontWeight:"bold",fontSize:s.toString(a*i.CenterTextFontHeightCoefficient),text:r};this.mainGroupElement.select(i.CenterLabelClass.selector).empty()&&(this.centerText=this.mainGroupElement.append("text").classed(i.CenterLabelClass["class"],!0)),this.centerText.style({"line-height":1,"font-weight":o.fontWeight,"font-size":o.fontSize,fill:this.getLabelFill(this.dataView).solid.color}).attr({dy:"0.35em","text-anchor":"middle"}).text(e.TextMeasurementService.getTailoredTextOrDefault(o,a*i.CenterTextFontWidthCoefficient))},i.prototype.getLabelFill=function(t){return this.dataViewContainsObjects(t)?e.DataViewObjects.getValue(t.metadata.objects,i.Properties.label.fill,h):h},i.prototype.dataViewContainsObjects=function(e){return e&&e.metadata&&e.metadata.objects},i.prototype.enumerateLegend=function(e){var t=this.data.legendSettings,i={selector:null,objectName:n,displayName:"Legend",properties:{show:t.show,position:t.position,showTitle:t.showTitle,titleText:t.titleText,labelColor:t.labelColor,fontSize:t.fontSize}};e.push(i)},i.prototype.clearData=function(){this.mainGroupElement.selectAll("path").remove(),t.dataLabelUtils.cleanDataLabels(this.mainLabelsElement,!0),this.legend.drawLegend({dataPoints:[]},this.currentViewport)},i.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},i.prototype.enumerateLabels=function(e){var t=this.data.labelSettings,i={objectName:"labels",displayName:"Labels",selector:null,properties:{show:t.show,fontSize:t.fontSize,labelPrecision:t.precision,labelDisplayUnits:t.displayUnits,color:t.labelColor}};e.push(i)},i.prototype.enumerateObjectInstances=function(e){var t=[];if(!this.dataViewContainsCategory(this.dataView))return t;switch(e.objectName){case n:this.data&&this.enumerateLegend(t);break;case"label":var i={objectName:"label",displayName:"Label",selector:null,properties:{fill:this.getLabelFill(this.dataView)}};t.push(i);break;case"labels":this.enumerateLabels(t);break;case"outerLine":var a={objectName:"outerLine",displayName:"Outer Line",selector:null,properties:{show:this.data.showOuterLine,thickness:this.data.outerLineThickness}};t.push(a)}return t},i.capabilities={dataRoles:[{displayName:"Category",name:"Category",kind:e.VisualDataRoleKind.Grouping},{displayName:"Y Axis",name:"Y",kind:e.VisualDataRoleKind.Measure}],dataViewMappings:[{conditions:[{Category:{max:1},Y:{max:2}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{select:[{bind:{to:"Y"}}]}}}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},legend:{displayName:"Legend",description:"Display legend options",properties:{show:{displayName:"Show",type:{bool:!0}},position:{displayName:"Position",description:"Select the location for the legend",type:{enumeration:t.legendPosition.type}},showTitle:{displayName:"Title",description:"Display a title for legend symbols",type:{bool:!0}},titleText:{displayName:"Legend Name",description:"Title text",type:{text:!0},suppressFormatPainterCopy:!0},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},label:{displayName:"Center Label",properties:{fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}}}},labels:{displayName:"Detail Labels",properties:{show:{type:{bool:!0}},color:{displayName:"Color",type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}},labelPrecision:{displayName:"Decimal Places",placeHolderText:"Auto",type:{numeric:!0}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},outerLine:{displayName:"Outer line",properties:{show:{displayName:"Show",type:{bool:!0}},thickness:{displayName:"Thickness",type:{numeric:!0}}}}},supportsHighlight:!0},i.Properties={general:{formatString:{objectName:"general",propertyName:"formatString"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}},legend:{show:{objectName:n,propertyName:"show"},position:{objectName:n,propertyName:"position"},showTitle:{objectName:n,propertyName:"showTitle"},titleText:{objectName:n,propertyName:"titleText"},labelColor:{objectName:n,propertyName:"labelColor"},fontSize:{objectName:n,propertyName:"fontSize"}},label:{fill:{objectName:"label",propertyName:"fill"}},labels:{show:{objectName:"labels",propertyName:"show"},color:{objectName:"labels",propertyName:"color"},labelDisplayUnits:{objectName:"labels",propertyName:"labelDisplayUnits"},labelPrecision:{objectName:"labels",propertyName:"labelPrecision"},fontSize:{objectName:"labels",propertyName:"fontSize"}},outerLine:{show:{objectName:"outerLine",propertyName:"show"},thickness:{objectName:"outerLine",propertyName:"thickness"}}},i.AsterSlice=r("asterSlice"),i.AsterHighlightedSlice=r("asterHighlightedSlice"),i.OuterLine=r("outerLine"),i.labelGraphicsContextClass=r("labels"),i.linesGraphicsContextClass=r("lines"),i.CenterLabelClass=r("centerLabel"),i.CenterTextFontHeightCoefficient=.4,i.CenterTextFontWidthCoefficient=1.9,i}();i.AsterPlot=f}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){function r(){return new n}var s=a.PixelConverter,o=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.columns=e.columns,this.clearCatcher=e.clearCatcher,this.interactivityService=e.interactivityService,this.columns.on("click",function(e,i){t.handleSelection(e,d3.event.ctrlKey)}),this.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var i=this.interactivityService.hasSelection();this.columns.style("fill-opacity",function(a){return t.ColumnUtil.getFillOpacity(a.selected,a.highlight,!a.highlight&&e,!a.selected&&i)})},e}(),l=function(){function e(e,t,i,a,r){this.scrollYBrush=d3.svg.brush(),this.getRoot=e,this.getViewport=t,this.isScrollable=r,this.getPrefferedHeight=a}return Object.defineProperty(e.prototype,"scrollViewport",{get:function(){return{height:this.viewport.height,width:this.viewport.width-(this.isYScrollBarVisible&&this.isScrollable?c.ScrollBarWidth:0)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this.getViewport()},enumerable:!0,configurable:!0}),e.prototype.renderY=function(e,t){var i=this;if(this.isYScrollBarVisible=this.isScrollable&&this.getPrefferedHeight()>this.viewport.height&&this.viewport.height>0&&this.viewport.width>0,this.brushGraphicsContextY=this.createOrRemoveScrollbar(this.isYScrollBarVisible,this.brushGraphicsContextY,"y brush"),!this.isYScrollBarVisible)return void t.call(this,jQuery.extend(!0,{},e),0,1);var a=this.viewport.height,r=this.getExtentData(this.getPrefferedHeight(),a),s=function(s){void 0===s&&(s=0);var o=i.scrollYBrush.extent();if(0!==s){var l=(o[1]-o[0])/2;if(o[0]+=s>0?l:-l,o[1]+=s>0?l:-l,o[0]<0){var n=0-o[0];o[0]+=n,o[1]+=n}if(o[1]>a){var n=o[1]-a;o[0]-=n,o[1]-=n}i.scrollYBrush.extent(o),i.brushGraphicsContextY.select(".extent").attr("y",o[0])}var c=r.toScrollPosition(o,a);t.call(i,jQuery.extend(!0,{},e),c[0],c[1]),i.setScrollBarSize(i.brushGraphicsContextY,r.value[1],!0)},o=d3.scale.ordinal().rangeBands([0,a]);this.scrollYBrush.y(o).extent(r.value),this.renderScrollbar(this.scrollYBrush,this.brushGraphicsContextY,this.viewport.width,s),s()},e.prototype.createOrRemoveScrollbar=function(e,t,i){return e&&this.isScrollable?t||this.root.append("g").classed(i,!0):t?void t.remove():void 0},e.prototype.renderScrollbar=function(e,i,a,r){var s=this;e.on("brush",function(){return window.requestAnimationFrame(function(){return r(0)})}),this.root.on("wheel",function(){if(s.isYScrollBarVisible){var e=d3.event;r(e.deltaY)}}),i.attr({transform:t.SVGUtil.translate(a,0),"drag-resize-disabled":"true"}),i.call(e),i.selectAll(".resize").remove(),i.select(".background").remove(),i.selectAll(".extent").style({"fill-opacity":.125,cursor:"default"})},e.prototype.setScrollBarSize=function(e,t,i){e.selectAll("rect").attr(i?"width":"height",c.ScrollBarWidth),e.selectAll("rect").attr(i?"height":"width",t)},e.prototype.getExtentData=function(t,i){var a=i*i/t,r=e.ScrollBarMinLength<=a?1:a/e.ScrollBarMinLength;a=Math.max(a,e.ScrollBarMinLength);var s=function(e,t){var i=e[1]-e[0],a=e[0]/(t-i);i*=r;var s=a*(t-i),o=s+i;return[s/t,o/t]};return{value:[0,a],toScrollPosition:s}},e.prototype.clearData=function(){this.brushGraphicsContextY&&this.brushGraphicsContextY.selectAll("*").remove()},e.ScrollBarMinLength=15,e}(),n=function(){function e(){}return Object.defineProperty(e.prototype,"code",{get:function(){return"TornadoChartWarning"},enumerable:!0,configurable:!0}),e.prototype.getMessages=function(e){var t,i="This visual requires two distinct values to be returned for the Legend field.",a="",r="";return t={message:i,title:e.get(a),detail:e.get(r)}},e}();i.TornadoChartWarning=n,i.getTornadoChartWarning=r;var c=function(){function i(e){this.textOptions={},this.columnPadding=5,this.leftLabelMargin=4,this.InnerTextHeightDelta=2,this.margin={top:10,right:5,bottom:10,left:10},this.heightColumn=0,e&&(this.svg=e.svg||this.svg,this.margin=e.margin||this.margin,this.columnPadding=e.columnPadding||this.columnPadding,this.animator=e.animator)}return i.getProperties=function(e){var t={};for(var i in e.objects){t[i]={};for(var a in e.objects[i].properties)t[i][a]={objectName:i,propertyName:a}}return t},i.converter=function(a,r,o){if(!(a&&a.categorical&&a.categorical.categories&&a.categorical.categories[0]&&a.categorical.categories[0].source&&a.categorical.values&&a.categorical.values[0]))return null;var l=a.categorical,n=l.categories||[],c=l.values,h=n[0],u=i.Properties.general.formatString,d=d3.max(c[0].values),p=i.parseSettings(a.metadata.objects,d,o),g=!!c.source,m=!!(c.length>0&&c[0].highlights),y=e.TextMeasurementService.estimateSvgTextHeight({fontFamily:t.dataLabelUtils.StandardFontFamily,fontSize:s.fromPoint(p.labelSettings.fontSize)}),f=[],v=[],x=[],b=t.valueFormatter.getFormatString(h.source,u),S=h.values.map(function(e){var a=t.valueFormatter.format(e,b);return i.getTextData(a,r,!0)}),w=c.grouped?c.grouped():null,C=Math.min(d3.min(c[0].values),0);c.length===i.MaxSeries&&(C=d3.min([C,d3.min(c[1].values)]),d=d3.max([d,d3.max(c[1].values)]));for(var D=0;D<c.length;D++){var P=w&&w.length>D&&w[D].values?w[D]:null,A=i.parseSeries(c,D,g,P,o);f.push(A);for(var N=c[D],V=N.source.queryName,T=0;T<h.values.length;T++){var L,M=null==N.values[T]||isNaN(N.values[T])?0:N.values[T],k=t.SelectionIdBuilder.builder().withCategory(h,T).withSeries(c,P).withMeasure(V).createSelectionId(),j=S[T].text;L=t.TooltipBuilder.createTooltipInfo(u,l,j,M,null,null,D,T,null);var O=A.categoryAxisEnd?Math.min(A.categoryAxisEnd,d):d,I=a.categorical.values[D].source.format;if(v.push({value:M,minValue:C,maxValue:O,formatString:I,color:A.fill,selected:!1,identity:k,tooltipData:L,categoryIndex:T}),m){var F=t.SelectionId.createWithHighlight(k),G=N.highlights[T],z=null!=G?G:0;L=t.TooltipBuilder.createTooltipInfo(u,l,j,M,null,null,D,T,z),x.push({value:z,minValue:C,maxValue:O,formatString:I,color:A.fill,selected:!1,identity:F,tooltipData:L,categoryIndex:T,highlight:!0})}}}return{categories:S,series:f,settings:p,legend:i.getLegendData(f,g),dataPoints:v,highlightedDataPoints:x,maxLabelsWidth:_.max(S.map(function(e){return e.width})),hasDynamicSeries:g,hasHighlights:m,labelHeight:y,legendObjectProperties:e.DataViewObjects.getObject(a.metadata.objects,"legend",{})}},i.parseSeries=function(e,a,r,s,o){var l,n,c=e?e[a]:null,h=c?c.source:null,u=s?s.identity:null,d=h?h.queryName:null,p=u?t.SelectionId.createWithId(u):t.SelectionIdBuilder.builder().withSeries(e,s).withMeasure(d).createSelectionId(),g=h?h.groupName?h.groupName:h.displayName:null;r&&s?(n=s.objects?s.objects.categoryAxis:null,l=s.objects):h&&(l=h.objects,n=l?l.categoryAxis:null);var m=i.getColor(i.Properties.dataPoint.fill,["purple","teal"][a],l,o),y=n?n.end:null;return{fill:m,name:g,selectionId:p,categoryAxisEnd:y}},i.getColor=function(e,i,a,r){var s=new t.ColorHelper(r,e,i);return s.getColorForMeasure(a,"")},i.getTextData=function(t,i,a,r,o){void 0===a&&(a=!1),void 0===r&&(r=!1);var l,n,c=0,h=0;return t=t||"",l=o?s.fromPoint(o):""+i.fontSize+i.sizeUnit,n={text:t,fontFamily:i.fontFamily,fontSize:l},a&&(c=e.TextMeasurementService.measureSvgTextWidth(n)),r&&(h=e.TextMeasurementService.estimateSvgTextHeight(n)),{text:t,width:c,height:h,textProperties:n}},Object.defineProperty(i.prototype,"allLabelsWidth",{get:function(){return(this.dataView.settings.showCategories?Math.min(this.dataView.maxLabelsWidth,this.scrolling.scrollViewport.width/2):3)+i.CategoryLabelMargin},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"allColumnsWidth",{get:function(){return this.scrolling.scrollViewport.width-this.allLabelsWidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"columnWidth",{get:function(){return this.dataView.series.length===i.MaxSeries?this.allColumnsWidth/2:this.allColumnsWidth},enumerable:!0,configurable:!0}),i.prototype.init=function(e){var a,r=this,s=e.style;this.hostService=e.host;var n=e.element;this.colors=s.colorPalette.dataColors;var c=e.interactivity;this.interactivityService=t.createInteractivityService(this.hostService);var h;this.svg?this.root=h=this.svg:this.root=h=d3.select(n.get(0)).append("svg"),h.classed(i.ClassName,!0).style("position","absolute"),a=h.style("font-size"),this.textOptions.sizeUnit=a.slice(a.length-2),this.textOptions.fontSize=Number(a.slice(0,a.length-2)),this.textOptions.fontFamily=h.style("font-family"),this.viewport=e.viewport,this.scrolling=new l(function(){return h},function(){return r.viewport},function(){return r.margin},function(){return r.dataView.categories.length*i.CategoryMinHeight},!0);var u=this.main=h.append("g");this.clearCatcher=t.appendClearCatcher(u),this.columns=u.append("g").classed(i.Columns["class"],!0),this.axes=u.append("g").classed(i.Axes["class"],!0),this.labels=u.append("g").classed(i.Labels["class"],!0),this.categories=u.append("g").classed(i.Categories["class"],!0),this.behavior=new o,this.legend=t.createLegend(n,c&&c.isInteractiveLegend,this.interactivityService,!0)},i.prototype.update=function(e){if(e&&e.dataViews&&e.dataViews[0]){if(this.viewport={height:Math.max(0,e.viewport.height-this.margin.top-this.margin.bottom),width:Math.max(0,e.viewport.width-this.margin.left-this.margin.right)},this.animator?this.durationAnimations=t.AnimatorCommon.GetAnimationDuration(this.animator,e.suppressAnimations):this.durationAnimations=e.suppressAnimations?0:250,this.dataView=i.converter(this.validateDataView(e.dataViews[0]),this.textOptions,this.colors),!this.dataView||this.scrolling.scrollViewport.height<i.CategoryMinHeight)return void this.clearData();this.dataView&&this.interactivityService&&(this.interactivityService.applySelectionStateToData(this.dataView.dataPoints),this.interactivityService.applySelectionStateToData(this.dataView.highlightedDataPoints)),this.render()}},i.prototype.validateDataView=function(e){return e&&e.categorical&&e.categorical.values?e.categorical.values.length>i.MaxSeries?(this.hostService.setWarnings([r()]),null):e:null},i.prototype.updateElements=function(){var e=t.SVGUtil.translate(this.allLabelsWidth,0);this.root.attr({height:this.viewport.height+this.margin.top+this.margin.bottom,width:this.viewport.width+this.margin.left+this.margin.right}),this.columns.attr("transform",e),this.labels.attr("transform",e),this.axes.attr("transform",e)},i.parseSettings=function(a,r,s){var o=i.getPrecision(a),l=e.DataViewObjects.getValue(a,i.Properties.labels.labelDisplayUnits,i.DefaultTornadoChartSettings.labelSettings.displayUnits),n=i.DefaultTornadoChartSettings.labelSettings,c=function(e){
return t.valueFormatter.create({format:e,precision:o,value:0===l&&null!=r?r:l})};return{labelOutsideFillColor:i.getColor(i.Properties.labels.outsideFill,i.DefaultTornadoChartSettings.labelOutsideFillColor,a,s),labelSettings:{show:e.DataViewObjects.getValue(a,i.Properties.labels.show,n.show),precision:o,fontSize:e.DataViewObjects.getValue(a,i.Properties.labels.fontSize,n.fontSize),displayUnits:l,labelColor:i.getColor(i.Properties.labels.insideFill,n.labelColor,a,s)},showCategories:e.DataViewObjects.getValue(a,i.Properties.categories.show,i.DefaultTornadoChartSettings.showCategories),showLegend:e.DataViewObjects.getValue(a,i.Properties.legend.show,i.DefaultTornadoChartSettings.showLegend),legendFontSize:e.DataViewObjects.getValue(a,i.Properties.legend.fontSize,i.DefaultTornadoChartSettings.legendFontSize),legendColor:i.getColor(i.Properties.legend.labelColor,i.DefaultTornadoChartSettings.legendColor,a,s),categoriesFillColor:i.getColor(i.Properties.categories.fill,i.DefaultTornadoChartSettings.categoriesFillColor,a,s),getLabelValueFormatter:c}},i.getPrecision=function(t){var a=e.DataViewObjects.getValue(t,i.Properties.labels.labelPrecision,i.DefaultTornadoChartSettings.labelSettings.precision);return Math.min(Math.max(0,a),i.MaxPrecision)},i.getLegendData=function(e,i){var a=[];return i&&(a=e.map(function(e){return{label:e.name,color:e.fill,icon:t.LegendIcon.Box,selected:!1,identity:e.selectionId}})),{dataPoints:a}},i.prototype.render=function(){this.updateElements(),this.renderLegend(),this.scrolling.renderY(this.dataView,this.renderWithScrolling.bind(this))},i.prototype.clearData=function(){this.columns.selectAll("*").remove(),this.axes.selectAll("*").remove(),this.labels.selectAll("*").remove(),this.categories.selectAll("*").remove(),this.legend.drawLegend({dataPoints:[]},this.viewport),this.scrolling.clearData()},i.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},i.prototype.renderWithScrolling=function(e,t,a){if(this.dataView&&this.dataView.settings){var r=e.categories.length,s=t*r,o=a*r,l=Math.floor(s),n=Math.floor(o),c=Math.floor(this.scrolling.scrollViewport.height/i.CategoryMinHeight);1>a-t&&n-l>c&&(s-l>o-n?l++:o--),this.interactivityService&&(this.interactivityService.applySelectionStateToData(e.dataPoints),this.interactivityService.applySelectionStateToData(e.highlightedDataPoints)),e.categories=e.categories.slice(l,n),e.dataPoints=_.filter(e.dataPoints,function(e){return e.categoryIndex>=l&&e.categoryIndex<n}),e.highlightedDataPoints=_.filter(e.highlightedDataPoints,function(e){return e.categoryIndex>=l&&e.categoryIndex<n}),this.dataView=e,this.computeHeightColumn(),this.renderMiddleSection(),this.renderAxes(),this.renderCategories()}},i.prototype.updateViewport=function(){var e,i=this.legend.getMargins();switch(e=t.LegendPosition[this.dataView.legendObjectProperties[t.legendProps.position]]){case t.LegendPosition.Top:case t.LegendPosition.TopCenter:case t.LegendPosition.Bottom:case t.LegendPosition.BottomCenter:this.viewport.height-=i.height;break;case t.LegendPosition.Left:case t.LegendPosition.LeftCenter:case t.LegendPosition.Right:case t.LegendPosition.RightCenter:this.viewport.width-=i.width}},i.prototype.computeHeightColumn=function(){var e=this.dataView.categories.length;this.heightColumn=(this.scrolling.scrollViewport.height-(e-1)*this.columnPadding)/e},i.prototype.renderMiddleSection=function(){var e=this.dataView;this.calculateDataPoints(e.dataPoints),this.calculateDataPoints(e.highlightedDataPoints);var t=e.dataPoints.concat(e.highlightedDataPoints);this.renderColumns(t,2===e.series.length),this.renderLabels(this.dataView.hasHighlights?e.highlightedDataPoints:e.dataPoints,e.settings.labelSettings)},i.prototype.calculateDataPoints=function(e){for(var t=this.dataView.categories.length,a=this.dataView.settings,r=Math.max(this.heightColumn,0),s=r/2,o=r*i.HighlightedShapeFactor/2,l=this.dataView.series.length===i.MaxSeries,n=0;n<e.length;n++){var c=e[n],h=t>n&&l,u=n>t-1,d=this.getColumnWidth(c.value,c.minValue,c.maxValue,this.columnWidth),p=(this.columnWidth-d)*Number(h)+this.columnWidth*Number(u);p=Math.max(p,0);var g=this.dataView.hasHighlights&&c.highlight,m=g?r*(1-i.HighlightedShapeFactor)/2:0,y=(r+this.columnPadding)*(n%t)+m,f=this.getLabelData(c.value,p,d,h,c.formatString,a);c.dx=p,c.dy=y,c.px=d/2,c.py=g?o:s,c.angle=h?180:0,c.width=d,c.height=g?r*i.HighlightedShapeFactor:r,c.label=f}},i.prototype.renderColumns=function(e,a){var r=this;void 0===a&&(a=!1);var s=this.interactivityService&&this.interactivityService.hasSelection(),o=this.columns.selectAll(i.Column.selector).data(e);o.enter().append("svg:rect").classed(i.Column["class"],!0),o.style("fill",function(e){return e.color}).style("fill-opacity",function(e){return t.ColumnUtil.getFillOpacity(e.selected,e.highlight,s,r.dataView.hasHighlights)}).attr("transform",function(e){return t.SVGUtil.translateAndRotate(e.dx,e.dy,e.px,e.py,e.angle)}).attr("height",function(e){return e.height}).attr("width",function(e){return e.width}),o.exit().remove();var l=this.interactivityService;if(l){l.applySelectionStateToData(e);var n={columns:o,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService};l.bind(e,this.behavior,n)}this.renderTooltip(o)},i.prototype.renderTooltip=function(e){t.TooltipManager.addTooltip(e,function(e){return e.data.tooltipData})},i.prototype.getColumnWidth=function(e,t,i,a){if(t===i)return a;var r=a*(e-t)/(i-t);return Math.max(0,Math.min(a,r))},i.prototype.getLabelData=function(a,r,o,l,n,c){var h,u=c?c:this.dataView.settings,d=u.labelSettings,p=d.fontSize,g=d.labelColor,m=l?r-this.leftLabelMargin:this.allColumnsWidth-(r+o+this.leftLabelMargin),y=Math.max(m,o-this.leftLabelMargin),f={fontFamily:t.dataLabelUtils.StandardFontFamily,fontSize:s.fromPoint(p),text:u.getLabelValueFormatter(n).format(a)},v=e.TextMeasurementService.getTailoredTextOrDefault(f,y),x=i.getTextData(v,this.textOptions,!0,!1,p);return o>x.width+i.LabelPadding?h=r+o/2-x.width/2:(h=l?r-this.leftLabelMargin-x.width:r+o+this.leftLabelMargin,g=u.labelOutsideFillColor),{dx:h,source:a,value:v,color:g}},i.prototype.renderAxes=function(){var e,t,a=this.main.select(i.Axes.selector).selectAll(i.Axis.selector);return this.dataView.series.length!==i.MaxSeries?void a.remove():(e=this.generateAxesData(),t=a.data(e),t.enter().append("svg:line").classed(i.Axis["class"],!0),t.attr("x1",function(e){return e.x1}).attr("y1",function(e){return e.y1}).attr("x2",function(e){return e.x2}).attr("y2",function(e){return e.y2}),void t.exit().remove())},i.prototype.generateAxesData=function(){var e,t,i;return e=this.allColumnsWidth/2,t=0,i=this.scrolling.scrollViewport.height,[{x1:e,y1:t,x2:e,y2:i}]},i.prototype.renderLabels=function(e,a){var r,o=this,l=this.main.select(i.Labels.selector).selectAll(i.Label.selector).data(_.filter(e,function(e){return e.label.dx>=0}));if(!a.show||this.dataView.labelHeight>=this.heightColumn)return void this.labels.selectAll("*").remove();var n=s.fromPoint(a.fontSize),c=this.heightColumn/2+this.dataView.labelHeight/2-this.InnerTextHeightDelta,h=this.dataView.categories.length;r=l.enter().append("g"),r.append("svg:title").classed(i.LabelTitle["class"],!0),r.append("svg:text").attr("dy",t.dataLabelUtils.DefaultDy).classed(i.LabelText["class"],!0),l.attr("pointer-events","none").classed(i.Label["class"],!0),l.select(i.LabelTitle.selector).text(function(e){return e.label.source}),l.attr("transform",function(e,i){var a=(o.heightColumn+o.columnPadding)*(i%h);return t.SVGUtil.translate(e.label.dx,a+c)}),l.select(i.LabelText.selector).attr("fill",function(e){return e.label.color}).attr("font-size",function(e){return n}).text(function(e){return e.label.value}),l.exit().remove()},i.prototype.renderCategories=function(){var a,r,s=this,o=this.dataView.settings,l=o.categoriesFillColor,n=this.main.select(i.Categories.selector).selectAll(i.Category.selector);return o.showCategories?(r=n.data(this.dataView.categories),a=r.enter().append("g"),a.append("svg:title").classed(i.CategoryTitle["class"],!0),a.append("svg:text").classed(i.CategoryText["class"],!0),r.attr("transform",function(e,a){var r=(s.heightColumn+s.columnPadding)*a+s.heightColumn/2,o=i.getTextData(e,s.textOptions,!1,!0);return r=r+o.height/2-s.InnerTextHeightDelta,t.SVGUtil.translate(0,r)}).classed(i.Category["class"],!0),r.select(i.CategoryTitle.selector).text(function(e){return e.text}),r.select(i.CategoryText.selector).attr("fill",l).text(function(t){return s.dataView.settings.showCategories?e.TextMeasurementService.getTailoredTextOrDefault(i.getTextData(t.text,s.textOptions).textProperties,s.allLabelsWidth):""}),void r.exit().remove()):void n.remove()},i.prototype.renderLegend=function(){var e=this.dataView.legend;if(e){var i=this.dataView.settings,a={title:e.title,dataPoints:e.dataPoints,fontSize:i.legendFontSize,labelColor:i.legendColor};if(this.dataView.legendObjectProperties){var r;t.LegendData.update(a,this.dataView.legendObjectProperties),r=this.dataView.legendObjectProperties[t.legendProps.position],r&&this.legend.changeOrientation(t.LegendPosition[r])}var s={height:this.viewport.height+this.margin.top+this.margin.bottom,width:this.viewport.width+this.margin.left+this.margin.right};this.legend.drawLegend(a,s),t.Legend.positionChartArea(this.root,this.legend),a.dataPoints.length>0&&i.showLegend&&this.updateViewport()}},i.prototype.enumerateObjectInstances=function(i){var a,r=new t.ObjectEnumerationBuilder;if(!this.dataView||!this.dataView.settings)return[];switch(a=this.dataView.settings,i.objectName){case"dataPoint":this.enumerateDataPoint(r);break;case"categoryAxis":this.enumerateCategoryAxis(r);break;case"labels":var s=a.labelSettings,o={objectName:"labels",displayName:"Labels",selector:null,properties:{show:s.show,fontSize:s.fontSize,labelPrecision:s.precision,labelDisplayUnits:s.displayUnits,insideFill:s.labelColor,outsideFill:a.labelOutsideFillColor}};r.pushInstance(o);break;case"legend":if(!this.dataView.hasDynamicSeries)return;var l,n=!0,c="";n=e.DataViewObject.getValue(this.dataView.legendObjectProperties,t.legendProps.showTitle,n),c=e.DataViewObject.getValue(this.dataView.legendObjectProperties,t.legendProps.titleText,c),l={objectName:"legend",displayName:"Legend",selector:null,properties:{show:a.showLegend,position:t.LegendPosition[this.legend.getOrientation()],showTitle:n,titleText:c,fontSize:a.legendFontSize,labelColor:a.legendColor}},r.pushInstance(l);break;case"categories":var h={objectName:"categories",displayName:"Categories",selector:null,properties:{show:a.showCategories,fill:a.categoriesFillColor}};r.pushInstance(h)}return r.complete()},i.prototype.enumerateDataPoint=function(e){if(this.dataView&&this.dataView.series)for(var i=this.dataView.series,a=0,r=i.length;r>a;a++)e.pushInstance({objectName:"dataPoint",displayName:i[a].name,selector:t.ColorHelper.normalizeSelector(i[a].selectionId.getSelector(),!1),properties:{fill:{solid:{color:i[a].fill}}}})},i.prototype.enumerateCategoryAxis=function(e){if(this.dataView&&this.dataView.series)for(var t=this.dataView.series,i=0,a=t.length;a>i;i++)e.pushInstance({objectName:"categoryAxis",displayName:t[i].name,selector:t[i].selectionId?t[i].selectionId.getSelector():null,properties:{end:t[i].categoryAxisEnd}})},i.prototype.destroy=function(){this.root=null},i.ClassName="tornado-chart",i.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Group")},{name:"Series",kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Legend")},{name:"Values",kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Values")}],dataViewMappings:[{conditions:[{Category:{max:1},Values:{min:0,max:1},Series:{min:0,max:1}},{Category:{max:1},Values:{min:2,max:2},Series:{max:0}}],categorical:{categories:{"for":{"in":"Category"}},values:{group:{by:"Series",select:[{"for":{"in":"Values"}}],dataReductionAlgorithm:{top:{}}}}}}],objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}}}},dataPoint:{displayName:"Data Colors",properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}},categoryAxis:{displayName:"X-Axis",properties:{end:{displayName:"End",type:{numeric:!0},suppressFormatPainterCopy:!0}}},labels:{displayName:"Data Labels",properties:{show:{displayName:"Show",type:{bool:!0}},labelPrecision:{displayName:"Decimal Places",placeHolderText:"Auto",type:{numeric:!0}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}},labelDisplayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}},insideFill:{displayName:"Inside fill",type:{fill:{solid:{color:!0}}}},outsideFill:{displayName:"Outside fill",type:{fill:{solid:{color:!0}}}}}},legend:{displayName:"Legend",properties:{show:{displayName:"Show",type:{bool:!0}},position:{displayName:"Position",description:e.data.createDisplayNameGetter("Visual_LegendPositionDescription"),type:{enumeration:t.legendPosition.type}},showTitle:{displayName:"Title",description:e.data.createDisplayNameGetter("Visual_LegendShowTitleDescription"),type:{bool:!0}},titleText:{displayName:"Legend Name",description:e.data.createDisplayNameGetter("Visual_LegendNameDescription"),type:{text:!0}},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"TextSize",type:{formatting:{fontSize:!0}}}}},categories:{displayName:"Group",properties:{show:{displayName:"Show",type:{bool:!0}},fill:{displayName:"Color",type:{fill:{solid:{color:!0}}}}}}},supportsHighlight:!0},i.Properties=i.getProperties(i.capabilities),i.Columns={"class":"columns",selector:".columns"},i.Column={"class":"column",selector:".column"},i.Axes={"class":"axes",selector:".axes"},i.Axis={"class":"axis",selector:".axis"},i.Labels={"class":"labels",selector:".labels"},i.Label={"class":"label",selector:".label"},i.LabelTitle={"class":"label-title",selector:".label-title"},i.LabelText={"class":"label-text",selector:".label-text"},i.Categories={"class":"categories",selector:".categories"},i.Category={"class":"category",selector:".category"},i.CategoryTitle={"class":"category-title",selector:".category-title"},i.CategoryText={"class":"category-text",selector:".category-text"},i.MaxSeries=2,i.MaxPrecision=17,i.LabelPadding=2.5,i.CategoryMinHeight=25,i.DefaultFontSize=9,i.DefaultLegendFontSize=8,i.HighlightedShapeFactor=.5,i.CategoryLabelMargin=10,i.ScrollBarWidth=22,i.DefaultTornadoChartSettings={labelOutsideFillColor:t.dataLabelUtils.defaultLabelColor,labelSettings:{show:!0,precision:null,fontSize:i.DefaultFontSize,displayUnits:0,labelColor:t.dataLabelUtils.defaultInsideLabelColor},showCategories:!0,showLegend:!0,legendFontSize:i.DefaultLegendFontSize,legendColor:t.LegendData.DefaultLegendLabelFillColor,categoriesFillColor:"#777"},i}();i.TornadoChart=c}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){function r(e,i,r,s,o,l,n,c,h,u,d,p,g,m,y){var f=35,v=o.x,x=o.y1,b=o.y2,S=v.values,w=x.values,C=0,D=0,P=0,A=0,N=0,V=v.categoryThickness?v.categoryThickness/2:0,T=t.AxisHelper.isOrdinalScale(v.scale),L=0;if(void 0!==v.outerPadding?L=v.outerPadding:void 0!==v.xLabelMaxWidth&&(L=Math.max(0,(e.width-v.xLabelMaxWidth*S.length)/2)),0!==t.AxisHelper.getRecommendedNumberOfTicksForXAxis(e.width)||0!==t.AxisHelper.getRecommendedNumberOfTicksForYAxis(e.height)){var M;if(M=d?t.AxisHelper.LabelLayoutStrategy.DefaultRotationWithScrollbar:t.AxisHelper.LabelLayoutStrategy.DefaultRotation,m)for(var k=0,j=w.length;j>k;k++)c.text=w[k],P=Math.max(P,r(c));if(b&&y)for(var O=b.values,k=0,j=O.length;j>k;k++)h.text=O[k],A=Math.max(A,r(h));var I=s(n),F=Math.floor(l/I),G=v.scale,z=G.domain();if(g&&S.length>0){for(var k=0,j=S.length;j>k;k++){var R;n.text=S[k];var B=r(n);if(v.willLabelsWordBreak){var H=a.WordBreaker.splitByWidth(n.text,n,r,v.xLabelMaxWidth,F);R=H.length*I,B=v.xLabelMaxWidth}else!v.willLabelsFit&&T?(R=B*M.sine,B*=M.cosine):R=I;if(0===k){if(T)C=v.willLabelsFit?B/2-V-L:B-V-L,C=Math.max(C,0);else if(z.length>1){var U=G(z[0]);C=B/2-U,C=Math.max(C,0)}}else if(k===j-1)if(T)(v.willLabelsFit||v.willLabelsWordBreak)&&(D=B/2-V-L,D=Math.max(D,0));else if(z.length>1){var U=G(z[1]);D=B/2-(e.width-U),D=Math.max(D,0)}N=Math.max(N,R)}C=u?Math.min(C,f):0,D=u?Math.min(D,f):0}}var W=0,E=0,_=Math.min(Math.ceil(N),l);return p?(E=Math.min(Math.max(C,A),i),W=Math.min(Math.max(D,P),i)):(E=Math.min(Math.max(C,P),i),W=Math.min(Math.max(D,A),i)),{xMax:Math.ceil(_),yLeft:Math.ceil(E),yRight:Math.ceil(W)}}function s(e,t,i){return i>1?e&&e.length>t?[e[t]]:[]:e}function o(e,t,i){return 0===e&&!!t&&!!t.showAxisTitle||1===e&&!i&&!!t&&!!t.secShowAxisTitle}function l(e,i,a,r,s,l,n){var c={viewport:i,margin:a,forcedXDomain:[r?r.start:null,r?r.end:null],forceMerge:s&&s.secShow===!1,showCategoryAxisLabel:!1,showValueAxisLabel:!1,categoryAxisScaleType:r&&null!=r.axisScale?r.axisScale:t.axisScale.linear,valueAxisScaleType:s&&null!=s.axisScale?s.axisScale:t.axisScale.linear,trimOrdinalDataOnOverflow:!1},h=!1;s&&(c.forcedYDomain=t.AxisHelper.applyCustomizedDomain([s.start,s.end],c.forcedYDomain));for(var u,d=0,p=e.length;p>d;d++){var g=e[d];c.showCategoryAxisLabel=!!r&&!!r.showAxisTitle,c.showValueAxisLabel=o(d,s,h);var m=g.calculateAxesProperties(c);0===d&&(u={x:m[0],y1:m[1]}),u.x.willLabelsFit=!1,u.x.willLabelsWordBreak=!1}return u}function n(e,i,a,r,s){void 0===s&&(s=!0);var o=[],l={isScrollable:s,animator:r,interactivityService:a};return o.push(c(t.ColumnChartType.hundredPercentStackedColumn,l)),o}function c(e,t){var i={animator:t.animator,interactivityService:t.interactivityService,isScrollable:t.isScrollable,chartType:e};return new b(i)}var h=a.CssConstants.createClassAndSelector,u=e.visuals.NewDataLabelUtils,d=function(){function e(e,t){this.data=e,this.isScalar=t}return e.prototype.lookupXValue=function(e,i){var a=t.AxisHelper.isDateTime(i);if(a&&this.isScalar)return new Date(e);var r=this.data;if(i.text)return r.categories[e];var s=r.series[0];if(s){var o=s.data;if(o){this.data.hasHighlights&&(e=2*e);var l=o[e];if(l)return a?new Date(l.categoryValue):l.categoryValue}}return e},e}();i.MekkoDataWrapper=d;var p=function(){function i(){}return i.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight,this.viewportWidth=e.viewportWidth},i.prototype.setData=function(e){this.data=e},i.createFormatter=function(e,i,a,r,s,o,l,n,c){void 0===c&&(c=!1);var h;if(a.dateTime)if(r){var u=new Date(e[0]),d=new Date(e[1]);1===o&&(u=d=new Date(i[0])),h=t.valueFormatter.create({format:s,value:u,value2:d,tickCount:o})}else{var p=n(0,a),g=n(e.length-1,a);h=t.valueFormatter.create({format:s,value:p,value2:g,tickCount:o})}else if(c&&r&&l.length>1){var m=l[1]-l[0],y=0;h=t.valueFormatter.create({format:s,value:m,value2:y,allowFormatBeautification:!0})}else h=t.valueFormatter.createDefaultFormatter(s,!0);return h},i.formatAxisTickValues=function(e,t,i,a,r,s){var o=[];return i?!s||a.numeric&&r?(e.tickFormat(function(e){return i.format(e)}),o=t.map(function(e){return i.format(e)})):(e.tickFormat(function(e){return i.format(s(e,a))}),o=t.map(function(e){return i.format(s(e,a))})):o=t.map(function(e){return s(e,a)}),o},i.prototype.createAxis=function(e){var a=e.pixelSpan,r=e.dataDomain,s=e.metaDataColumn,o=e.formatStringProp,l=e.outerPadding||0,n=!!e.isCategoryAxis,c=!!e.isScalar,h=!!e.isVertical,u=!!e.useTickIntervalForDisplayUnits,d=e.getValueFn,p=e.categoryThickness,m=t.valueFormatter.getFormatString(s,o),y=t.AxisHelper.getCategoryValueType(s,c),f=t.AxisHelper.isLogScalePossible(r,y),v=d3.scale.linear(),x=[0,1],S=r.length||1,w=b.getBorderWidth(e.borderSettings),C=a-w*(S-1);C<g.MinOrdinalRectThickness&&(C=g.MinOrdinalRectThickness),v.domain(x).range([0,C]);var D=r,P=i.createFormatter(x,r,y,c,m,S,D,d,u),A=d3.svg.axis().scale(v).tickSize(6,0).orient(h?"left":"bottom").ticks(S).tickValues(r),N=[];s&&(N=i.formatAxisTickValues(A,D,P,y,c,d));var V;if(!c&&p)V=Math.max(1,p-2*t.CartesianChart.TickLabelPadding);else{var T=D.length>1?D.length+1:D.length;V=T>1?a/T:a,V=Math.max(1,V-2*t.CartesianChart.TickLabelPadding)}return{scale:v,axis:A,formatter:P,values:N,axisType:y,axisLabel:null,isCategoryAxis:n,xLabelMaxWidth:V,categoryThickness:p,outerPadding:l,usingDefaultDomain:!1,isLogScaleAllowed:f}},i.prototype.getCategoryAxis=function(e,i,a,r,s,o,l){var n=a.categoryThickness,c=a.isScalar,h=a.outerPaddingRatio,u=new d(e,c),p=[];if(e.series&&e.series.length>0&&e.series[0].data&&e.series[0].data.length>0){var g=e.series[0].data.map(function(e){return e.originalPosition+e.value/2});p=g.filter(function(e,t){return g.indexOf(e)===t})}var m=this.createAxis({pixelSpan:i,dataDomain:p,metaDataColumn:e.categoryMetadata,formatStringProp:t.columnChartProps.general.formatString,outerPadding:n*h,isCategoryAxis:!0,isScalar:c,isVertical:r,categoryThickness:n,useTickIntervalForDisplayUnits:!0,getValueFn:function(e,t){var i=p.indexOf(e),a=u.lookupXValue(i,t);return a},scaleType:l,borderSettings:e.borderSettings});return a.categoryThickness=m.categoryThickness,m},i.prototype.setXScale=function(e,t,i,a){var r,s,o=this.width;i&&2===i.length&&(r=i[0],s=i[1]);var l=this.xProps=this.getCategoryAxis(this.data,o,this.categoryLayout,!1,r,s,a);return l},i.prototype.setYScale=function(e,i,a,r){var s=this.viewportHeight,o=t.StackedUtil.calcValueDomain(this.data.series,e),l=[o.min,o.max],n=t.AxisHelper.combineDomain(a,l),c=t.AxisHelper.scaleShouldClamp(n,l),h=this.data.valuesMetadata[0],u=e?this.graphicsContext.hostService.getLocalizedString("Percentage"):t.valueFormatter.getFormatString(h,t.columnChartProps.general.formatString),d={pixelSpan:s,dataDomain:n,metaDataColumn:h,formatString:u,outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:i,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:r,axisDisplayUnits:0,axisPrecision:0,is100Pct:e,shouldClamp:c,formatStringProp:void 0};return this.yProps=t.AxisHelper.createAxis(d),this.yProps},i.prototype.drawColumns=function(e){var a=this.data;this.columnsCenters=null;var r,s,o={columnWidth:0,xScale:this.xProps.scale,yScale:this.yProps.scale,isScalar:this.categoryLayout.isScalar,margin:this.margin},l=this.layout=i.getLayout(a,o),n=this.createMekkoLabelDataPoints(),c=t.ColumnUtil.drawSeries(a,this.graphicsContext.mainGraphicsContext,o);return this.animator&&e&&(r=this.animator.animate({viewModel:a,series:c,layout:l,itemCS:i.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}}),s=r.shapes),this.animator&&e&&!r.failed||(s=i.drawDefaultShapes(a,c,l,i.classes.item,!this.animator,this.interactivityService&&this.interactivityService.hasSelection())),t.ColumnUtil.applyInteractivity(s,this.graphicsContext.onDragStart),{shapesSelection:s,viewport:{height:this.height,width:this.width},axisOptions:o,labelDataPoints:n}},i.drawDefaultShapes=function(e,i,a,r,s,o){var l="rect";s=!1;var n;n=s?function(e){var t=_.filter(e.data,function(e){return!!e.value});return t}:function(e){return e.data};var c=i.selectAll(r.selector),h=c.data(n,function(e){return e.key});h.enter().append(l).attr("class",function(e){return r["class"].concat(e.highlight?" highlight":"")}),h.style("fill",function(e){return e.color}).style("fill-opacity",function(i){return t.ColumnUtil.getFillOpacity(i.selected,i.highlight,o,e.hasHighlights)}).attr(a.shapeLayout),h.exit().remove();var u=i.selectAll(b.BorderClass.selector),d=u.data(n,function(e){return e.key}),p=b.getBorderColor(e.borderSettings);return d.enter().append(l).classed(b.BorderClass["class"],!0),d.style("fill",function(e){return p}).style("fill-opacity",function(i){return e.hasHighlights?t.ColumnUtil.DimmedOpacity:t.ColumnUtil.DefaultOpacity}).attr(a.shapeBorder),d.exit().remove(),h},i.prototype.selectColumn=function(e,a){t.ColumnUtil.setChosenColumnOpacity(this.graphicsContext.mainGraphicsContext,i.classes.item.selector,e,a),this.moveHandle(e)},i.prototype.getClosestColumnIndex=function(e,i){return t.ColumnUtil.getClosestColumnIndex(e,this.getColumnsCenters())},i.prototype.getColumnsCenters=function(){var e=this;if(!this.columnsCenters){var i=this.categoryLayout.categoryThickness*(1-t.CartesianChart.InnerPaddingRatio);if(this.data.series.length>0){var a=0;this.categoryLayout.isScalar||(a=i/2);var r=this.data.series[0];r&&r.data&&(this.columnsCenters=r.data.map(function(t){return e.xProps.scale(e.categoryLayout.isScalar?t.categoryValue:t.categoryIndex)+a}))}}return this.columnsCenters},i.prototype.moveHandle=function(e){var t=this.getColumnsCenters(),i=t[e];if(this.columnSelectionLineHandle){var a=this.columnSelectionLineHandle;a.select("line").attr({x1:i,x2:i}),a.select("circle").attr({cx:i})}else{var a=this.columnSelectionLineHandle=this.graphicsContext.mainGraphicsContext.append("g");a.append("line").classed("interactive-hover-line",!0).attr({x1:i,x2:i,y1:0,y2:this.height}),a.append("circle").attr({cx:i,cy:this.height,r:"6px"}).classed("drag-handle",!0)}},i.getLayout=function(e,i){var a=i.xScale,r=i.yScale,s=r(0),o=a(0),l=b.getBorderWidth(e.borderSettings),n=function(e){var i=t.AxisHelper.diffScaled(a,e.value,0);return i},c=function(e){var i=o+t.AxisHelper.diffScaled(a,e.originalPosition,0)+l*e.categoryIndex;return i},h=function(e){var i=o+t.AxisHelper.diffScaled(a,e.originalPosition,0)+t.AxisHelper.diffScaled(a,e.value,0)+l*e.categoryIndex;return i};return{shapeLayout:{width:n,x:c,y:function(e){return s+t.AxisHelper.diffScaled(r,e.position,0)},height:function(e){return t.StackedUtil.getSize(r,e.valueAbsolute)}},shapeBorder:{width:function(e){return l},x:h,y:function(e){return s+t.AxisHelper.diffScaled(r,e.position,0)},height:function(e){return t.StackedUtil.getSize(r,e.valueAbsolute)}},shapeLayoutWithoutHighlights:{width:n,x:c,y:function(e){return s+t.AxisHelper.diffScaled(r,e.position,0)},height:function(e){return t.StackedUtil.getSize(r,e.originalValueAbsolute)}},zeroShapeLayout:{width:n,x:c,y:function(e){return s+t.AxisHelper.diffScaled(r,e.position,0)+t.StackedUtil.getSize(r,e.valueAbsolute)},height:function(e){return 0}},shapeXAxis:{width:n,x:c,y:function(e){return s+t.AxisHelper.diffScaled(r,e.position,0)},height:function(e){return t.StackedUtil.getSize(r,e.valueAbsolute)}}}},i.prototype.createMekkoLabelDataPoints=function(){for(var t=[],a=this.data,r=a.series,s=u.createColumnFormatterCacheManager(),o=this.layout.shapeLayout,l=0,n=r.length;n>l;l++){var c=r[l],h=c.labelSettings?c.labelSettings:a.labelSettings;if(h.show&&c.data)for(var d=u.getDisplayUnitValueFromAxisFormatter(this.yProps.formatter,h),p=0;p<c.data.length;p++){var g=c.data[p];if((!a.hasHighlights||g.highlight)&&null!=g.value){var m={left:o.x(g),top:o.y(g),width:o.width(g),height:o.height(g)},y=null,f=g.valueOriginal;h.displayUnits||(y=u.hundredPercentFormat,f=g.valueAbsolute);var v=s.getOrCreate(y,h,d),x=u.getLabelFormattedText(v.format(f)),b={text:x,fontFamily:u.LabelTextProperties.fontFamily,fontSize:u.LabelTextProperties.fontSize,fontWeight:u.LabelTextProperties.fontWeight},S=e.TextMeasurementService.measureSvgTextWidth(b),w=e.TextMeasurementService.estimateSvgTextHeight(b);t.push({isPreferred:!0,text:x,textSize:{width:S,height:w},outsideFill:h.labelColor?h.labelColor:u.defaultLabelColor,insideFill:h.labelColor?h.labelColor:u.defaultInsideLabelColor,isParentRect:!0,parentShape:{rect:m,orientation:1,validPositions:i.validLabelPositions},identity:g.identity,parentType:1})}}}return t},i.classes={item:h("column"),highlightItem:h("highlightColumn")},i.validLabelPositions=[1],i}();i.MekkoColumnChartStrategy=p;var g=function(){function i(e){this.isScrollable=!1,e?(this.type=e.chartType,e.isScrollable&&(this.isScrollable=e.isScrollable),this.animator=e.animator,e.cartesianSmallViewPortProperties&&(this.cartesianSmallViewPortProperties=e.cartesianSmallViewPortProperties),e.behavior&&(this.behavior=e.behavior)):this.behavior=new w([new t.ColumnChartWebBehavior])}return i.getTextProperties=function(e){return void 0===e&&(e=i.FontSize),{fontFamily:"wf_segoe-ui_normal",fontSize:a.PixelConverter.toString(e)}},i.prototype.init=function(e){this.visualInitOptions=e,this.layers=[];var a=this.element=e.element,r=this.currentViewport=e.viewport;this.hostServices=e.host,this.brush=d3.svg.brush(),a.addClass(i.ClassName),this.margin={top:1,right:1,bottom:1,left:1},this.yAxisOrientation=t.yAxisPosition.left,this.adjustMargins(r),this.sharedColorPalette=new t.SharedColorPalette(e.style.colorPalette.dataColors);var s=!0,o=!0,l=this.svg=d3.select(a.get(0)).append("svg");l.style("position","absolute");var n=this.axisGraphicsContext=l.append("g").classed(i.AxisGraphicsContextClassName,!0);this.svgScrollable=l.append("svg").classed("svgScrollable",!0).style("overflow","hidden");var c=this.axisGraphicsContextScrollable=this.svgScrollable.append("g").classed(i.AxisGraphicsContextClassName,!0);this.labelGraphicsContextScrollable=this.svgScrollable.append("g").classed(u.labelGraphicsContextClass["class"],!0),this.behavior&&(this.clearCatcher=t.appendClearCatcher(this.axisGraphicsContextScrollable));var h=s?c:n;this.xAxisGraphicsContext=s?n.append("g").attr("class","x axis"):c.append("g").attr("class","x axis"),this.y1AxisGraphicsContext=h.append("g").attr("class","y axis"),this.y2AxisGraphicsContext=h.append("g").attr("class","y axis"),this.xAxisGraphicsContext.classed("showLinesOnAxis",s),this.y1AxisGraphicsContext.classed("showLinesOnAxis",o),this.y2AxisGraphicsContext.classed("showLinesOnAxis",o),this.xAxisGraphicsContext.classed("hideLinesOnAxis",!s),this.y1AxisGraphicsContext.classed("hideLinesOnAxis",!o),this.y2AxisGraphicsContext.classed("hideLinesOnAxis",!o),this.behavior&&(this.interactivityService=t.createInteractivityService(this.hostServices)),this.legend=t.createLegend(a,e.interactivity&&e.interactivity.isInteractiveLegend,this.interactivityService,!0)},i.prototype.renderAxesLabels=function(a){this.axisGraphicsContext.selectAll(".xAxisLabel").remove(),this.axisGraphicsContext.selectAll(".yAxisLabel").remove();var r=this.margin,s=a.viewport.width-(r.left+r.right),o=a.viewport.height,l=i.FontSize,n=l,c=this.yAxisOrientation===t.yAxisPosition.right;if(!a.hideXAxisTitle){var h=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(a.axisLabels.x).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"xAxisLabel",transform:t.SVGUtil.translate(s/2,o-n)})})});h.style("fill",a.xLabelColor?a.xLabelColor.solid.color:null),h.call(t.AxisHelper.LabelLayoutStrategy.clip,s,e.TextMeasurementService.svgEllipsis)}if(!a.hideYAxisTitle){var u=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(a.axisLabels.y).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"yAxisLabel",transform:"rotate(-90)",y:c?s+r.right-l:-r.left,x:-((o-r.top-a.legendMargin)/2),dy:"1em"})})});u.style("fill",a.yLabelColor?a.yLabelColor.solid.color:null),u.call(t.AxisHelper.LabelLayoutStrategy.clip,o-(r.bottom+r.top),e.TextMeasurementService.svgEllipsis)}if(!a.hideY2AxisTitle&&a.axisLabels.y2){var d=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(a.axisLabels.y2).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"yAxisLabel",transform:"rotate(-90)",y:c?-r.left:s+r.right-l,x:-((o-r.top-a.legendMargin)/2),dy:"1em"})})});d.style("fill",a.y2LabelColor?a.y2LabelColor.solid.color:null),d.call(t.AxisHelper.LabelLayoutStrategy.clip,o-(r.bottom+r.top),e.TextMeasurementService.svgEllipsis)}},i.prototype.adjustMargins=function(e){
var i=this.margin,a=e.width-(i.left+i.right),r=e.height-(i.top+i.bottom),s=this.element.find(".x.axis");0===t.AxisHelper.getRecommendedNumberOfTicksForXAxis(a)&&0===t.AxisHelper.getRecommendedNumberOfTicksForYAxis(r)?(this.margin={top:0,right:0,bottom:0,left:0},s.hide()):s.show()},i.prototype.translateAxes=function(e){this.adjustMargins(e);var a=this.margin,r=e.width-(a.left+a.right),s=e.height-(a.top+a.bottom),o=this.yAxisOrientation===t.yAxisPosition.right;this.xAxisGraphicsContext.attr("transform",t.SVGUtil.translate(0,s)),this.y1AxisGraphicsContext.attr("transform",t.SVGUtil.translate(o?r:0,0)),this.y2AxisGraphicsContext.attr("transform",t.SVGUtil.translate(o?0:r,0)),this.svg.attr({width:e.width,height:e.height}),this.svg.style("top",this.legend.isVisible()?this.legend.getMargins().height+"px":0),this.svgScrollable.attr({width:e.width,height:e.height}),this.svgScrollable.attr({x:0}),this.axisGraphicsContext.attr("transform",t.SVGUtil.translate(a.left,a.top)),this.axisGraphicsContextScrollable.attr("transform",t.SVGUtil.translate(a.left,a.top)),this.labelGraphicsContextScrollable.attr("transform",t.SVGUtil.translate(a.left,a.top)),this.isXScrollBarVisible?(this.svgScrollable.attr({x:this.margin.left}),this.axisGraphicsContextScrollable.attr("transform",t.SVGUtil.translate(0,a.top)),this.labelGraphicsContextScrollable.attr("transform",t.SVGUtil.translate(0,a.top)),this.svgScrollable.attr("width",r),this.svg.attr("width",e.width).attr("height",e.height+i.ScrollBarWidth)):this.isYScrollBarVisible&&(this.svgScrollable.attr("height",s+a.top),this.svg.attr("width",e.width+i.ScrollBarWidth).attr("height",e.height))},i.getIsScalar=function(i,a,r){var s=e.DataViewObjects.getValue(i,a);return i&&void 0!==s?s===t.axisType.scalar&&!t.AxisHelper.isOrdinal(r):!t.AxisHelper.isOrdinal(r)},i.prototype.populateObjectProperties=function(i){if(i&&i.length>0){var a=i[0].metadata;if(a?(this.legendObjectProperties=e.DataViewObjects.getObject(a.objects,"legend",{}),this.borderObjectProperties=e.DataViewObjects.getObject(a.objects,"columnBorder",{})):(this.legendObjectProperties={},this.borderObjectProperties={}),this.categoryAxisProperties=t.CartesianHelper.getCategoryAxisProperties(a),this.valueAxisProperties=t.CartesianHelper.getValueAxisProperties(a),a&&a.objects){var r=a.objects.categoryAxis,s=a.objects.valueAxis;r&&(this.categoryAxisProperties.showBorder=r.showBorder,this.categoryAxisProperties.fontSize=r.fontSize),s&&(this.valueAxisProperties.fontSize=s.fontSize)}var o=this.valueAxisProperties.position;this.yAxisOrientation=o?o.toString():t.yAxisPosition.left}},i.prototype.update=function(e){var a=this.dataViews=e.dataViews;if(this.currentViewport=e.viewport,a&&!(this.currentViewport.width<i.MinWidth||this.currentViewport.height<i.MinHeight)){0===this.layers.length&&(this.layers=this.createAndInitLayers(a));var r=this.layers;if(a&&a.length>0){var o=t.getInvalidValueWarnings(a,!1,!1,!1);o&&o.length>0&&this.hostServices.setWarnings(o),this.populateObjectProperties(a)}this.sharedColorPalette.clearPreferredScale();for(var l=0,n=r.length;n>l;l++)r[l].setData(s(a,l,n)),n>1&&this.sharedColorPalette.rotateScale();this.visualInitOptions.interactivity&&this.visualInitOptions.interactivity.isInteractiveLegend||this.renderLegend(),this.render(!this.hasSetData||e.suppressAnimations),this.hasSetData=this.hasSetData||a&&a.length>0}},i.parseLabelSettings=function(e){var a=t.dataLabelUtils.getDefaultColumnLabelSettings(!0),r=e.labels,s=i.DefaultSettings.labelSettings.minPrecision,o=i.DefaultSettings.labelSettings.maxPrecision;return t.dataLabelUtils.updateLabelSettingsFromLabelsObject(r,a),a.precision<s&&(a.precision=s),a.precision>o&&(a.precision=o),a},i.parseBorderSettings=function(t){var a=e.DataViewObjects.getValue(t,i.properties.columnBorder.show,i.DefaultSettings.columnBorder.show),r=e.DataViewObjects.getFillColor(t,i.properties.columnBorder.color,i.DefaultSettings.columnBorder.color),s=e.DataViewObjects.getValue(t,i.properties.columnBorder.width,i.DefaultSettings.columnBorder.width),o=i.DefaultSettings.columnBorder.maxWidth;return s>o?s=o:0>s&&(s=0),a||(s=0),{show:a,color:r,width:s}},i.prototype.enumerateBorder=function(t){var a={columnBorder:this.borderObjectProperties},r=e.DataViewObjects.getValue(a,i.properties.columnBorder.show,i.DefaultSettings.columnBorder.show),s=e.DataViewObjects.getFillColor(a,i.properties.columnBorder.color,i.DefaultSettings.columnBorder.color),o=e.DataViewObjects.getValue(a,i.properties.columnBorder.width,i.DefaultSettings.columnBorder.width),l=i.DefaultSettings.columnBorder.maxWidth;o>l?o=l:0>o&&(o=0);var n={objectName:"columnBorder",selector:null,properties:{show:r,color:s,width:o}};t.pushInstance(n)},i.prototype.enumerateObjectInstances=function(i){var a=new t.ObjectEnumerationBuilder,r=this.layers?this.layers.length:0;if("columnBorder"===i.objectName)this.enumerateBorder(a);else if("legend"===i.objectName){if(!this.shouldShowLegendCard())return;var s=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.show,this.legend.isVisible()),o=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.showTitle,!0),l=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.titleText,this.layerLegendData&&this.layerLegendData.title?this.layerLegendData.title:""),n=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.fontSize,this.layerLegendData&&this.layerLegendData.fontSize?this.layerLegendData.fontSize:u.DefaultLabelFontSizeInPt);a.pushInstance({selector:null,properties:{show:s,position:t.LegendPosition[this.legend.getOrientation()],showTitle:o,titleText:l,fontSize:n},objectName:i.objectName})}else"categoryAxis"===i.objectName&&this.hasCategoryAxis?this.getCategoryAxisValues(a):"valueAxis"===i.objectName&&this.getValueAxisValues(a);for(var c=0,h=r;h>c;c++){var d=this.layers[c];d.enumerateObjectInstances&&d.enumerateObjectInstances(a,i)}return a.complete()},i.prototype.shouldShowLegendCard=function(){var e=this.layers,t=this.dataViews;if(e&&t)for(var i=e.length,a=0,r=0;i>r;r++){if(e[r].hasLegend())return!0;var s=t[r];if(s&&s.categorical&&s.categorical.values&&s.categorical.values.length>0&&(a++,a>1))return!0}return!1},i.prototype.getCategoryAxisValues=function(e){var i=t.axisType.both,a=!1,r=!!this.axes.x.isLogScaleAllowed,s=[t.axisScale.log,t.axisScale.linear];this.layers&&this.layers[0].getSupportedCategoryAxisType&&(i=this.layers[0].getSupportedCategoryAxisType(),a=i===t.axisType.scalar?!0:t.CartesianHelper.isScalar(i===t.axisType.both,this.categoryAxisProperties)),a||this.categoryAxisProperties&&(this.categoryAxisProperties.start=null,this.categoryAxisProperties.end=null);var o={selector:null,properties:{},objectName:"categoryAxis",validValues:{axisScale:s}};o.properties.show=this.categoryAxisProperties&&null!=this.categoryAxisProperties.show?this.categoryAxisProperties.show:!0,this.yAxisIsCategorical&&(o.properties.position=this.valueAxisProperties&&null!=this.valueAxisProperties.position?this.valueAxisProperties.position:t.yAxisPosition.left),i===t.axisType.both&&(o.properties.axisType=a?t.axisType.scalar:t.axisType.categorical),a&&(o.properties.axisScale=this.categoryAxisProperties&&null!=this.categoryAxisProperties.axisScale&&r?this.categoryAxisProperties.axisScale:t.axisScale.linear,o.properties.start=this.categoryAxisProperties?this.categoryAxisProperties.start:null,o.properties.end=this.categoryAxisProperties?this.categoryAxisProperties.end:null),o.properties.showAxisTitle=this.categoryAxisProperties&&null!=this.categoryAxisProperties.showAxisTitle?this.categoryAxisProperties.showAxisTitle:!1,o.properties.showBorder=this.categoryAxisProperties&&null!=this.categoryAxisProperties.showBorder?this.categoryAxisProperties.showAxisTitle:!1,o.properties.fontSize=this.categoryAxisProperties&&null!=this.categoryAxisProperties.fontSize?this.categoryAxisProperties.fontSize:u.DefaultLabelFontSizeInPt,e.pushInstance(o).pushInstance({selector:null,properties:{axisStyle:this.categoryAxisProperties&&this.categoryAxisProperties.axisStyle?this.categoryAxisProperties.axisStyle:t.axisStyle.showTitleOnly,labelColor:this.categoryAxisProperties?this.categoryAxisProperties.labelColor:null,fontSize:this.categoryAxisProperties&&null!=this.categoryAxisProperties.fontSize?this.categoryAxisProperties.fontSize:u.DefaultLabelFontSizeInPt},objectName:"categoryAxis",validValues:{axisStyle:this.categoryAxisHasUnitType?[t.axisStyle.showTitleOnly,t.axisStyle.showUnitOnly,t.axisStyle.showBoth]:[t.axisStyle.showTitleOnly]}})},i.prototype.getValueAxisValues=function(e){var i=[t.axisScale.log,t.axisScale.linear],a=!!this.axes.y1.isLogScaleAllowed,r={selector:null,properties:{},objectName:"valueAxis",validValues:{axisScale:i,secAxisScale:i}};r.properties.show=this.valueAxisProperties&&null!=this.valueAxisProperties.show?this.valueAxisProperties.show:!0,this.yAxisIsCategorical||(r.properties.position=this.valueAxisProperties&&null!=this.valueAxisProperties.position?this.valueAxisProperties.position:t.yAxisPosition.left),r.properties.axisScale=this.valueAxisProperties&&null!=this.valueAxisProperties.axisScale&&a?this.valueAxisProperties.axisScale:t.axisScale.linear,r.properties.start=this.valueAxisProperties?this.valueAxisProperties.start:null,r.properties.end=this.valueAxisProperties?this.valueAxisProperties.end:null,r.properties.showAxisTitle=this.valueAxisProperties&&null!=this.valueAxisProperties.showAxisTitle?this.valueAxisProperties.showAxisTitle:!1,r.properties.fontSize=this.valueAxisProperties&&null!=this.valueAxisProperties.fontSize?this.valueAxisProperties.fontSize:u.DefaultLabelFontSizeInPt,e.pushInstance(r).pushInstance({selector:null,properties:{axisStyle:this.valueAxisProperties&&null!=this.valueAxisProperties.axisStyle?this.valueAxisProperties.axisStyle:t.axisStyle.showTitleOnly,labelColor:this.valueAxisProperties?this.valueAxisProperties.labelColor:null,fontSize:this.valueAxisProperties&&null!=this.valueAxisProperties.fontSize?this.valueAxisProperties.fontSize:u.DefaultLabelFontSizeInPt},objectName:"valueAxis",validValues:{axisStyle:this.valueAxisHasUnitType?[t.axisStyle.showTitleOnly,t.axisStyle.showUnitOnly,t.axisStyle.showBoth]:[t.axisStyle.showTitleOnly]}}),2===this.layers.length&&(r.properties.secShow=this.valueAxisProperties&&null!=this.valueAxisProperties.secShow?this.valueAxisProperties.secShow:this.y2AxisExists,r.properties.secShow&&(r.properties.axisLabel=""))},i.prototype.onClearSelection=function(){if(this.hasSetData)for(var e=0,t=this.layers.length;t>e;e++){var i=this.layers[e];i.onClearSelection(),i.render(!0)}},i.prototype.createAndInitLayers=function(t){var i,a=this;if(t&&t.length>0){var r=t[0].metadata;r&&(i=r.objects)}var s=n(this.type,i,this.interactivityService,this.animator,this.isScrollable),o=e.Prototype.inherit(this.visualInitOptions);o.svg=this.axisGraphicsContextScrollable,o.cartesianHost={updateLegend:function(e){return a.legend.drawLegend(e,a.currentViewport)},getSharedColors:function(){return a.sharedColorPalette},triggerRender:void 0};for(var l=0,c=s.length;c>l;l++)s[l].init(o);return s},i.prototype.renderLegend=function(){for(var e=this.layers,i={title:"",dataPoints:[]},a=0,r=e.length;r>a;a++)this.layerLegendData=e[a].calculateLegend(),this.layerLegendData&&(i.title=0===a?this.layerLegendData.title||"":i.title,i.dataPoints=i.dataPoints.concat(this.layerLegendData.dataPoints||[]),this.layerLegendData.grouped&&(i.grouped=!0));var s=this.legendObjectProperties;if(s){s.fontSize||(s.fontSize=u.DefaultLabelFontSizeInPt),t.LegendData.update(i,s);var o=s[t.legendProps.position];o&&this.legend.changeOrientation(t.LegendPosition[o])}else this.legend.changeOrientation(t.LegendPosition.Top);(1===i.dataPoints.length&&!i.grouped||this.hideLegends())&&(i.dataPoints=[]),this.legend.drawLegend(i,this.currentViewport)},i.prototype.hideLegends=function(){return!!(this.cartesianSmallViewPortProperties&&this.cartesianSmallViewPortProperties.hideLegendOnSmallViewPort&&this.currentViewport.height<this.cartesianSmallViewPortProperties.MinHeightLegendVisible)},i.prototype.addUnitTypeToAxisLabel=function(e){var a=i.getUnitType(e,function(e){return e.x});if(e.x.isCategoryAxis?this.categoryAxisHasUnitType=null!==a:this.valueAxisHasUnitType=null!==a,e.x.axisLabel&&a&&(e.x.isCategoryAxis?e.x.axisLabel=t.AxisHelper.createAxisLabel(this.categoryAxisProperties,e.x.axisLabel,a):e.x.axisLabel=t.AxisHelper.createAxisLabel(this.valueAxisProperties,e.x.axisLabel,a)),a=i.getUnitType(e,function(e){return e.y1}),e.y1.isCategoryAxis?this.categoryAxisHasUnitType=null!==a:this.valueAxisHasUnitType=null!==a,e.y1.axisLabel&&a&&(e.y1.isCategoryAxis?e.y1.axisLabel=t.AxisHelper.createAxisLabel(this.categoryAxisProperties,e.y1.axisLabel,a):e.y1.axisLabel=t.AxisHelper.createAxisLabel(this.valueAxisProperties,e.y1.axisLabel,a)),e.y2){var a=i.getUnitType(e,function(e){return e.y2});this.secValueAxisHasUnitType=null!==a,e.y2.axisLabel&&a&&this.valueAxisProperties&&this.valueAxisProperties.secAxisStyle&&(this.valueAxisProperties.secAxisStyle===t.axisStyle.showBoth?e.y2.axisLabel=e.y2.axisLabel+" ("+a+")":this.valueAxisProperties.secAxisStyle===t.axisStyle.showUnitOnly&&(e.y2.axisLabel=a))}},i.prototype.shouldRenderSecondaryAxis=function(e){return e&&(!this.valueAxisProperties||null==this.valueAxisProperties.secShow||this.valueAxisProperties.secShow)?e.values&&e.values.length>0:!1},i.prototype.shouldRenderAxis=function(e,t){return void 0===t&&(t="show"),e?(!e.isCategoryAxis||this.categoryAxisProperties&&null!=this.categoryAxisProperties[t]&&!this.categoryAxisProperties[t])&&(e.isCategoryAxis||this.valueAxisProperties&&null!=this.valueAxisProperties[t]&&!this.valueAxisProperties[t])?!1:e.values&&e.values.length>0:!1},i.prototype.render=function(a){var s=this.legendMargins=this.legend.getMargins(),o={height:this.currentViewport.height-s.height,width:this.currentViewport.width-s.width},n=this.getMaxMarginFactor(),c=this.leftRightMarginLimit=o.width*n;this.bottomMarginLimit=Math.max(i.MinBottomMargin,Math.ceil(o.height*n));var h=i.getTextProperties(parseFloat(this.categoryAxisProperties.fontSize)||void 0),u=i.getTextProperties(parseFloat(this.valueAxisProperties.fontSize)||void 0),d=this.margin;d.top=parseFloat(u.fontSize)/2,d.bottom=i.MinBottomMargin,d.right=0;var p=this.axes=l(this.layers,o,d,this.categoryAxisProperties,this.valueAxisProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,null);this.yAxisIsCategorical=p.y1.isCategoryAxis,this.hasCategoryAxis=this.yAxisIsCategorical?p.y1&&p.y1.values.length>0:p.x&&p.x.values.length>0;var g,m,y=this.shouldRenderAxis(p.x),f=this.shouldRenderAxis(p.y1),v=this.shouldRenderSecondaryAxis(p.y2),x=o.width-(d.left+d.right),b=!1;this.isXScrollBarVisible=!1,this.isYScrollBarVisible=!1;var S=this.yAxisOrientation,w=S===t.yAxisPosition.right;if(this.layers&&(this.layers[0].getVisualCategoryAxisIsScalar&&(b=this.layers[0].getVisualCategoryAxisIsScalar()),!b&&this.isScrollable&&this.layers[0].getPreferredPlotArea)){var C=this.scrollX?p.x.categoryThickness:p.y1.categoryThickness,D=this.scrollX?p.x.values.length:p.y1.values.length;m=this.layers[0].getPreferredPlotArea(b,D,C),this.scrollX&&m&&m.width>o.width&&(this.isXScrollBarVisible=!0,o.height-=i.ScrollBarWidth),this.scrollY&&m&&m.height>o.height&&(this.isYScrollBarVisible=!0,o.width-=i.ScrollBarWidth,x=o.width-(d.left+d.right))}this.isXScrollBarVisible||this.isYScrollBarVisible?this.brushGraphicsContext||(this.brushGraphicsContext=this.svg.append("g").classed("x brush",!0)):(this.svg.selectAll(".brush").remove(),this.brushGraphicsContext=void 0),p=l(this.layers,o,d,this.categoryAxisProperties,this.valueAxisProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,null);for(var P=!1,A=2,N=0,V=void 0,T=void 0,L=void 0;!P&&A>N;){N++,V=r({width:x,height:o.height},c,e.TextMeasurementService.measureSvgTextWidth,e.TextMeasurementService.estimateSvgTextHeight,p,this.bottomMarginLimit,h,u,null,!1,this.isXScrollBarVisible||this.isYScrollBarVisible,w,y,f,v);var M=w?V.yRight:V.yLeft,k=w?V.yLeft:V.yRight,j=y?V.xMax/1.8:0;M+=i.LeftPadding,k+=i.RightPadding,j+=i.BottomPadding,this.hideAxisLabels(s)&&(p.x.axisLabel=null,p.y1.axisLabel=null,p.y2&&(p.y2.axisLabel=null)),this.addUnitTypeToAxisLabel(p),L={x:p.x.axisLabel,y:p.y1.axisLabel,y2:p.y2?p.y2.axisLabel:null},T=null!=L.x||null!=L.y||null!=L.y2,null!=L.x&&(j+=i.XAxisLabelPadding),null!=L.y&&(M+=i.YAxisLabelPadding),null!=L.y2&&(k+=i.YAxisLabelPadding),d.left=w?k:M,d.right=w?M:k,d.bottom=j,this.margin=d,x=o.width-(d.left+d.right);var O=p.y1.values.length,I=p.y2&&p.y2.values.length;p=l(this.layers,o,d,this.categoryAxisProperties,this.valueAxisProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,p),p.y1.values.length!==O||p.y2&&p.y2.values.length!==I||(P=!0)}this.renderChart(g,p,x,V,T,L,o,a)},i.prototype.hideAxisLabels=function(e){return!(!(this.cartesianSmallViewPortProperties&&this.cartesianSmallViewPortProperties.hideAxesOnSmallViewPort&&this.currentViewport.height+e.height<this.cartesianSmallViewPortProperties.MinHeightAxesVisible)||this.visualInitOptions.interactivity.isInteractiveLegend)},i.getUnitType=function(e,t){return t(e).formatter&&t(e).formatter.displayUnit&&t(e).formatter.displayUnit.value>1?t(e).formatter.displayUnit.title:null},i.prototype.getMaxMarginFactor=function(){return this.visualInitOptions.style.maxMarginFactor||i.MaxMarginFactor},i.getChartViewport=function(e,t){return{width:e.width-t.left-t.right,height:e.height-t.top-t.bottom}},i.wordBreak=function(t,i,a,r,s){t.each(function(t,s){var o,l,n=d3.select(this);a.length>=s?(o=a[s],l=i.scale(o)):l=i.xLabelMaxWidth,n.style("text-anchor","middle").attr({dx:"0em",dy:"1em",transform:"rotate(0)"}),e.TextMeasurementService.wordBreak(this,l,i.willLabelsWordBreak?r:0)})},i.prototype.renderChart=function(a,r,s,o,l,n,c,h,d,p){var g,m,y,f,v,x=this.bottomMarginLimit,b=this.leftRightMarginLimit,S=this.layers,w=t.AnimatorCommon.GetAnimationDuration(this.animator,h),C=i.getChartViewport(c,this.margin);if(this.shouldRenderAxis(r.x)){r.x.isCategoryAxis?(g=this.categoryAxisProperties&&this.categoryAxisProperties.labelColor?this.categoryAxisProperties.labelColor:null,f=this.categoryAxisProperties&&null!=this.categoryAxisProperties.fontSize?this.categoryAxisProperties.fontSize:u.DefaultLabelFontSizeInPt):(g=this.valueAxisProperties&&this.valueAxisProperties.labelColor?this.valueAxisProperties.labelColor:null,f=this.valueAxisProperties&&this.valueAxisProperties.fontSize?this.valueAxisProperties.fontSize:u.DefaultLabelFontSizeInPt),r.x.axis.orient("bottom"),r.x.willLabelsFit||r.x.axis.tickPadding(i.TickPaddingRotatedX);var D=this.xAxisGraphicsContext;w?D.transition().duration(w).call(r.x.axis):D.call(r.x.axis),D.call(i.darkenZeroLine).call(i.setAxisLabelColor,g).call(i.setAxisLabelFontSize,f);var P=D.selectAll("text"),A=[],N=0;this.layers&&this.layers.length&&(A=this.layers[0].getColumnsWidth(),N=this.layers[0].getBorderWidth()),D.call(i.moveBorder,r.x.scale,N,f/2-8),P.call(i.wordBreak,r.x,A,x,N)}else this.xAxisGraphicsContext.selectAll("*").remove();if(this.shouldRenderAxis(r.y1)){r.y1.isCategoryAxis?(m=this.categoryAxisProperties&&this.categoryAxisProperties.labelColor?this.categoryAxisProperties.labelColor:null,v=this.categoryAxisProperties&&null!=this.categoryAxisProperties.fontSize?this.categoryAxisProperties.fontSize:u.DefaultLabelFontSizeInPt):(m=this.valueAxisProperties&&this.valueAxisProperties.labelColor?this.valueAxisProperties.labelColor:null,v=this.valueAxisProperties&&null!=this.valueAxisProperties.fontSize?this.valueAxisProperties.fontSize:u.DefaultLabelFontSizeInPt);var V=this.yAxisOrientation,T=V===t.yAxisPosition.right;r.y1.axis.tickSize(-s).tickPadding(i.TickPaddingY).orient(V.toLowerCase());var L=this.y1AxisGraphicsContext;w?L.transition().duration(w).call(r.y1.axis):L.call(r.y1.axis),L.call(i.darkenZeroLine).call(i.setAxisLabelColor,m).call(i.setAxisLabelFontSize,v),o.yLeft>=b&&L.selectAll("text").call(t.AxisHelper.LabelLayoutStrategy.clip,b-i.LeftPadding,e.TextMeasurementService.svgEllipsis),!r.y2||this.valueAxisProperties&&null!=this.valueAxisProperties.secShow&&!this.valueAxisProperties.secShow?this.y2AxisGraphicsContext.selectAll("*").remove():(y=this.valueAxisProperties&&this.valueAxisProperties.secLabelColor?this.valueAxisProperties.secLabelColor:null,r.y2.axis.tickPadding(i.TickPaddingY).orient(T?t.yAxisPosition.left.toLowerCase():t.yAxisPosition.right.toLowerCase()),w?this.y2AxisGraphicsContext.transition().duration(w).call(r.y2.axis):this.y2AxisGraphicsContext.call(r.y2.axis),this.y2AxisGraphicsContext.call(i.darkenZeroLine).call(i.setAxisLabelColor,y),o.yRight>=b&&this.y2AxisGraphicsContext.selectAll("text").call(t.AxisHelper.LabelLayoutStrategy.clip,b-i.RightPadding,e.TextMeasurementService.svgEllipsis))}else this.y1AxisGraphicsContext.selectAll("*").remove(),this.y2AxisGraphicsContext.selectAll("*").remove();if(l){var M=!this.shouldRenderAxis(r.x,"showAxisTitle"),k=!this.shouldRenderAxis(r.y1,"showAxisTitle"),j=this.valueAxisProperties&&null!=this.valueAxisProperties.secShowAxisTitle&&this.valueAxisProperties.secShowAxisTitle===!1,O={axisLabels:n,legendMargin:this.legendMargins.height,viewport:c,hideXAxisTitle:M,hideYAxisTitle:k,hideY2AxisTitle:j,xLabelColor:g,yLabelColor:m,y2LabelColor:y,margin:void 0};this.renderAxesLabels(O)}else this.axisGraphicsContext.selectAll(".xAxisLabel").remove(),this.axisGraphicsContext.selectAll(".yAxisLabel").remove();this.translateAxes(c);var I=[],F=[],G=[];if(this.behavior){for(var z=0,R=S.length;R>z;z++){var B=S[z].render(h);if(B)if(I=I.concat(B.dataPoints),F.push(B.behaviorOptions),B.labelDataPointGroups)for(var H=B.labelDataPointGroups,U=0,W=H.length;W>U;U++){var E=H[U];G.push({labelDataPoints:E.labelDataPoints,maxNumberOfLabels:E.maxNumberOfLabels})}else{var _=B.labelDataPoints,Y=_;G.push({labelDataPoints:Y,maxNumberOfLabels:Y.length})}}var X={maximumOffset:u.maxLabelOffset,startingOffset:u.startingLabelOffset},K=new e.LabelLayout(X),q=K.layout(G,C);if(S.length>1&&u.drawLabelBackground(this.labelGraphicsContextScrollable,q,"#FFFFFF",.7),this.animator&&!h?u.animateDefaultLabels(this.labelGraphicsContextScrollable,q,this.animator.getDuration()):u.drawDefaultLabels(this.labelGraphicsContextScrollable,q),this.labelGraphicsContextScrollable.selectAll("text.label").style("pointer-events","none"),this.interactivityService){var Z={layerOptions:F,clearCatcher:this.clearCatcher};this.interactivityService.bind(I,this.behavior,Z)}}},i.darkenZeroLine=function(e){var t=e.selectAll("g.tick").filter(function(e){return 0===e}).node();t&&d3.select(t).select("line").classed("zero-line",!0)},i.setAxisLabelColor=function(e,t){e.selectAll("g.tick text").style("fill",t?t.solid.color:null)},i.setAxisLabelFontSize=function(e,t){var i=a.PixelConverter.toString(t);e.selectAll("g.tick text").attr("font-size",i)},i.moveBorder=function(e,i,a,r){void 0===r&&(r=0),e.selectAll("g.tick").attr("transform",function(e,s){return t.SVGUtil.translate(i(e)+a*s,r)})},i.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:"Category"},{name:"Series",kind:e.VisualDataRoleKind.Grouping,displayName:"Series"},{name:"Y",kind:e.VisualDataRoleKind.Measure,displayName:"Y Axis"},{name:"Width",kind:e.VisualDataRoleKind.Measure,displayName:"Axis width"}],objects:{columnBorder:{displayName:"Column Border",properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_LabelsFill"),description:e.data.createDisplayNameGetter("Visual_LabelsFillDescription"),type:{fill:{solid:{color:!0}}}},width:{displayName:"Width",type:{numeric:!0}}}},labels:{displayName:e.data.createDisplayNameGetter("Visual_DataPointsLabels"),description:e.data.createDisplayNameGetter("Visual_DataPointsLabelsDescription"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},showSeries:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_LabelsFill"),description:e.data.createDisplayNameGetter("Visual_LabelsFillDescription"),type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:e.data.createDisplayNameGetter("Visual_DisplayUnits"),description:e.data.createDisplayNameGetter("Visual_DisplayUnitsDescription"),type:{formatting:{labelDisplayUnits:!0}},suppressFormatPainterCopy:!0},labelPrecision:{displayName:e.data.createDisplayNameGetter("Visual_Precision"),description:e.data.createDisplayNameGetter("Visual_PrecisionDescription"),placeHolderText:e.data.createDisplayNameGetter("Visual_Precision_Auto"),type:{numeric:!0},suppressFormatPainterCopy:!0},showAll:{displayName:e.data.createDisplayNameGetter("Visual_ShowAll"),type:{bool:!0}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},legend:{displayName:e.data.createDisplayNameGetter("Visual_Legend"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_LegendPosition"),type:{formatting:{legendPosition:!0}}},showTitle:{displayName:e.data.createDisplayNameGetter("Visual_LegendShowTitle"),type:{bool:!0}},titleText:{displayName:"Title text",type:{text:!0}},fontSize:{displayName:"Text size",type:{formatting:{fontSize:!0}}}}},categoryAxis:{displayName:e.data.createDisplayNameGetter("Visual_XAxis"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_YAxis_Position"),type:{formatting:{yAxisPosition:!0}}},axisScale:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Scale"),type:{formatting:{axisScale:!0}}},axisType:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Type"),type:{formatting:{axisType:!0}}},showAxisTitle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Title"),type:{bool:!0}},axisStyle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Style"),type:{formatting:{axisStyle:!0}}},labelColor:{displayName:e.data.createDisplayNameGetter("Visual_Axis_LabelColor"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},valueAxis:{displayName:e.data.createDisplayNameGetter("Visual_YAxis"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_YAxis_Position"),type:{formatting:{yAxisPosition:!0}}},axisScale:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Scale"),type:{formatting:{axisScale:!0}}},intersection:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Intersection"),type:{numeric:!0}},showAxisTitle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Title"),type:{bool:!0}},axisStyle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Style"),type:{formatting:{axisStyle:!0}}},labelColor:{displayName:e.data.createDisplayNameGetter("Visual_Axis_LabelColor"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},dataPoint:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint"),properties:{defaultColor:{displayName:e.data.createDisplayNameGetter("Visual_DefaultColor"),type:{fill:{solid:{color:!0}}}},showAllDataPoints:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint_Show_All"),type:{bool:!0}},fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},fillRule:{displayName:e.data.createDisplayNameGetter("Visual_Gradient"),type:{fillRule:{}},rule:{inputRole:"Gradient",output:{property:"fill",selector:["Category"]}}}}}},dataViewMappings:[{conditions:[{Category:{min:0,max:1},Series:{min:0,max:1},Y:{min:0,max:1},Width:{min:0,max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{group:{by:"Series",select:[{"for":{"in":"Y"}},{"for":{"in":"Width"}}],dataReductionAlgorithm:{top:{}}}},rowCount:{preferred:{min:1,max:1},supported:{min:0}}}}],supportsHighlight:!0,sorting:{"default":{}},drilldown:{roles:["Category"]}},i.properties={general:{formatString:{objectName:"general",propertyName:"formatString"}},columnBorder:{show:{objectName:"columnBorder",propertyName:"show"},color:{objectName:"columnBorder",propertyName:"color"},width:{objectName:"columnBorder",propertyName:"width"}}},i.DefaultSettings={columnBorder:{show:!0,color:"#fff",width:2,maxWidth:5},labelSettings:{maxPrecision:4,minPrecision:0}},i.MinOrdinalRectThickness=20,i.MinScalarRectThickness=2,i.OuterPaddingRatio=.4,i.InnerPaddingRatio=.2,i.TickLabelPadding=2,i.ClassName="cartesianChart",i.AxisGraphicsContextClassName="axisGraphicsContext",i.MaxMarginFactor=.25,i.MinBottomMargin=50,i.LeftPadding=10,i.RightPadding=10,i.BottomPadding=16,i.YAxisLabelPadding=20,i.XAxisLabelPadding=20,i.TickPaddingY=10,i.TickPaddingRotatedX=5,i.FontSize=11,i.MaxNumberOfLabels=100,i.MinWidth=100,i.MinHeight=100,i.ScrollBarWidth=10,i}();i.MekkoChart=g,i.createLayers=n;var m=a.EnumExtensions,y=a.ArrayExtensions,f=2,v=16,x={category:"Category",series:"Series",y:"Y",width:"Width"},b=function(){function i(e){var t=e.chartType;this.chartType=t,this.categoryAxisType=null,this.animator=e.animator,this.isScrollable=e.isScrollable,this.interactivityService=e.interactivityService}return i.prototype.init=function(e){this.svg=e.svg,this.unclippedGraphicsContext=this.svg.append("g").classed("columnChartUnclippedGraphicsContext",!0),this.mainGraphicsContext=this.unclippedGraphicsContext.append("svg").classed("columnChartMainGraphicsContext",!0),this.labelGraphicsContext=this.svg.append("g").classed(u.labelGraphicsContextClass["class"],!0),this.style=e.style,this.currentViewport=e.viewport,this.hostService=e.host,this.interactivity=e.interactivity,this.colors=this.style.colorPalette.dataColors,this.cartesianVisualHost=e.cartesianHost,this.options=e,this.supportsOverflow=!m.hasFlag(this.chartType,v);var t=this.element=e.element;t.addClass(i.ColumnChartClassName),this.columnChart=new p},i.prototype.getCategoryLayout=function(e,i){var a=this.currentViewport.width-(this.margin.left+this.margin.right),r=this.data?this.data.categoryMetadata:void 0,s=t.AxisHelper.getCategoryValueType(r),o=this.data?this.data.scalarCategoryAxis:!1,l=t.AxisHelper.createDomain(this.data.series,s,o,i.forcedXDomain);return t.CartesianChart.getLayout(this.data,{availableWidth:a,categoryCount:e,domain:l,isScalar:o,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:!1})},i.getBorderWidth=function(e){if(!e||!e.show||!e.width)return 0;var t=e.width;return 0>t?0:t>e.maxWidth?e.maxWidth:t},i.getBorderColor=function(e){return e?e.color:g.DefaultSettings.columnBorder.color},i.converter=function(a,r,s,o,l,n,c){void 0===s&&(s=!1),void 0===o&&(o=!1),void 0===l&&(l=!1),void 0===n&&(n=null);var h=t.CartesianHelper.getCategoryAxisProperties(n),u=t.CartesianHelper.getValueAxisProperties(n);o=t.CartesianHelper.isScalar(o,h),a=t.ColumnUtil.applyUserMinMax(o,a,h);var d=new S(a),p=t.converterHelper.getPivotedCategories(a,t.columnChartProps.general.formatString),m=p.categories,y=p.categoryFormatter,f=p.categoryIdentities,v=a.categories&&a.categories.length>0?a.categories[0].source:void 0,b=g.DefaultSettings.columnBorder,w=t.dataLabelUtils.getDefaultColumnLabelSettings(!0),C=void 0,D=void 0;if(n&&n.objects){var P=n.objects;C=e.DataViewObjects.getFillColor(P,t.columnChartProps.dataPoint.defaultColor),D=e.DataViewObjects.getValue(P,t.columnChartProps.dataPoint.showAllDataPoints),w=g.parseLabelSettings(P),b=g.parseBorderSettings(P)}for(var A=d.getLegend(r,C),N=A.legend.dataPoints,V=A.seriesSources,T=i.createDataPoints(a,m,f,N,A.seriesObjects,d,w,s,o,l,t.converterHelper.categoryIsAlsoSeriesRole(a,x.series,x.category),p.categoryObjects,C,c,v),L=T.series,M=[],k=0,j=N.length;j>k;k++)M.push(V[k]);var O=t.converterHelper.createAxesLabels(h,u,v,M);return{categories:m,categoriesWidth:T.categoriesWidth,categoryFormatter:y,
series:L,valuesMetadata:M,legendData:A.legend,hasHighlights:T.hasHighlights,categoryMetadata:v,scalarCategoryAxis:o,borderSettings:b,labelSettings:w,axesLabels:{x:O.xAxisLabel,y:O.yAxisLabel},hasDynamicSeries:T.hasDynamicSeries,defaultDataPointColor:C,showAllDataPoints:D,isMultiMeasure:!1}},i.getStackedMultiplier=function(e,i,a,r){for(var s=0,o=0,l=0;a>l;l++){var n=e[l][i];n=t.AxisHelper.normalizeNonFiniteNumber(n),n>0?s+=n:0>n&&(o-=n)}var c=s+o;return{pos:s?s/c/s:1,neg:o?o/c/o:1}},i.createDataPoints=function(a,r,s,o,l,n,c,h,u,d,p,g,y,f,b){void 0===h&&(h=!1),void 0===u&&(u=!1),void 0===d&&(d=!1);var S=a&&a.values?a.values.grouped():void 0,w=r.length,C=o.length,D=[];if(1>C||1>w||null===r[0])return{series:D,hasHighlights:!1,hasDynamicSeries:!1,categoriesWidth:[]};var P=a.categories;b=P&&P.length>0?P[0].source:null;var A=t.AxisHelper.getCategoryValueType(b),N=t.AxisHelper.isDateTime(A),V=[],T=[],L=[],M=[],k=!(!a.values||!a.values.source),j=[],O=-1,I=0,F=!1,G=n.hasHighlightValues(0);for(I=0;I<a.values.length;I++)if(a.values[I].source.roles&&a.values[I].source.roles[x.width]&&!a.values[I].source.roles[x.y]){O=I;for(var z=a.values[I].values,R=0,B=z.length;B>R;R++)j[R]=d3.sum([0,j[R],z[R]])}else{for(var H=[],U=[],W=0;w>W;W++){var E=n.getValueBySeriesAndCategory(I,W);if(H[W]=E,G){var _=n.getHighlightBySeriesAndCategory(I,W);U[W]=_,E>=0&&_>=0&&E>=_||0>=E&&0>=_&&_>=E||(F=!0)}}L.push(H),G&&M.push(U)}if(F&&!d&&(F=!1,G=!1,L=M),j.length<1)for(I=0;I<a.values.length;I++)if(a.values[I].source.roles&&a.values[I].source.roles[x.width]){O=I;for(var z=a.values[I].values,R=0,B=z.length;B>R;R++)j[R]=d3.sum([0,j[R],z[R]])}else;if(j.length<1)for(I=0;w>I;I++)j.push(1);var Y=d3.sum(j),X=d3.scale.linear().domain([0,Y]).range([0,1]),K=[0],q=[];for(I=0;w-1>I;I++){var Z=K[K.length-1]+(j[I]||0);K.push(Z)}for(I=0;w>I;I++)K[I]=X(K[I]),q[I]=X(j[I]);var J=g,Q=t.columnChartProps.general.formatString;for(I=0;C>I;I++){var $,ee=[],te=o[I];if(!k){var ie=S&&S.length>0&&S[0].values?S[0].values[I]:null,ae=ie&&ie.source&&ie.source.objects?ie.source.objects.labels:null;ae&&($=e.Prototype.inherit(c),t.dataLabelUtils.updateLabelSettingsFromLabelsObject(ae,$))}var re={displayName:te.label,key:"series"+I,index:I,data:ee,identity:te.identity,color:te.color,labelSettings:$};C>1&&(J=l[I]);for(var se=a.values[I].source,W=0;w>W;W++){0===I&&(V.push(0),T.push(0));var E=t.AxisHelper.normalizeNonFiniteNumber(L[I][W]);if(!(null==E&&I>0)){var oe=E,le=r[W];if(N&&le&&(le=le.getTime()),!u||null!=le&&!isNaN(le)){var ne;h&&(ne=i.getStackedMultiplier(L,W,C,w));var ce=E,he=0>E;ne&&(E*=he?ne.neg:ne.pos);var ue,de=Math.abs(E);he?(ue=T[W],isNaN(de)||(T[W]-=de)):(isNaN(de)||(V[W]+=de),ue=V[W]);var pe=S&&S.length>I&&S[I].values?S[I]:null,ge=a.categories&&a.categories.length>0?a.categories[0]:null,me=t.SelectionIdBuilder.builder().withCategory(ge,W).withSeries(a.values,pe).withMeasure(n.getMeasureNameByIndex(I)).createSelectionId(),ye=r[W],fe=i.getDataPointColor(te,W,J),ve=[];if(pe){var xe={values:[],source:a.values.source};ve.push({value:pe.name,metadata:xe});for(var be=0;be<pe.values.length;be++){var Se=pe.values[be];ve.push({value:Se.values[W],metadata:Se})}}var we=t.TooltipBuilder.createTooltipInfo(Q,null,ye,oe,[ge],ve,null,W),Ce=re&&re.labelSettings?re.labelSettings:c,De=Ce.labelColor,Pe=void 0;m.hasFlag(f,v)&&(Pe=this.getStackedLabelColor(he,I,C,W,L),De=Pe||I===C-1&&!he?De:t.dataLabelUtils.defaultInsideLabelColor),E=q[W];var Ae=K[W],Ne={categoryValue:le,value:E,position:ue,valueAbsolute:de,valueOriginal:ce,seriesIndex:I,labelSettings:Ce,categoryIndex:W,color:fe,selected:!1,originalValue:E,originalPosition:Ae,originalValueAbsolute:de,identity:me,key:me.getKey(),tooltipInfo:we,labelFill:De,labelFormatString:se.format,lastSeries:Pe,chartType:f};if(ee.push(Ne),G){var Ve=M[I][W],Te=Ve,Le=!0;null===Ve&&(Ve=0,Le=!1),h&&(Ve*=ne.pos);var Me=Math.abs(Ve),ke=ue;Ve>0?ke-=de-Me:0===Ve&&E>0&&(ke-=de);var je=t.SelectionId.createWithHighlight(me),ye=r[W];Le&&(Ne.tooltipInfo=we);var Oe={categoryValue:le,value:E,position:ke,valueAbsolute:Me,valueOriginal:Te,seriesIndex:I,labelSettings:Ce,categoryIndex:W,color:fe,selected:!1,highlight:!0,originalValue:E,originalPosition:Ae,originalValueAbsolute:de,drawThinner:F,identity:je,key:je.getKey(),tooltipInfo:we,labelFormatString:se.format,labelFill:De,lastSeries:Pe,chartType:f};ee.push(Oe)}}}}D.push(re)}return{series:D,categoriesWidth:q,hasHighlights:G,hasDynamicSeries:k}},i.getDataPointColor=function(i,a,r){if(r){var s=e.DataViewObjects.getFillColor(r[a],t.columnChartProps.dataPoint.fill);if(s)return s}return i.color},i.getStackedLabelColor=function(e,i,a,r,s){for(var o=!(e&&i===a-1&&1!==a),l=i+1;a>l;l++){var n=t.AxisHelper.normalizeNonFiniteNumber(s[l][r]);if(null!==n&&((!e||e&&0===i)&&n>0||e&&0!==i)){o=!1;break}}return o},i.sliceSeries=function(t,i,a){void 0===a&&(a=0);var r=[];if(t&&t.length>0)for(var s=0,o=t.length;o>s;s++){var l=r[s]=e.Prototype.inherit(t[s]);l.data=t[s].data.filter(function(e){return e.categoryIndex>=a&&e.categoryIndex<i})}return r},i.getInteractiveColumnChartDomElement=function(e){return e.children("svg").get(0)},i.prototype.getColumnsWidth=function(){var e=this.data;return e&&e.series&&e.series[0]&&e.series[0].data?e.categoriesWidth:[]},i.prototype.getBorderWidth=function(){return i.getBorderWidth(this.data.borderSettings)},i.prototype.setData=function(e){var a=!0;if(this.data={categories:[],categoriesWidth:[],categoryFormatter:null,series:[],valuesMetadata:[],legendData:null,hasHighlights:!1,categoryMetadata:null,scalarCategoryAxis:!1,borderSettings:null,labelSettings:t.dataLabelUtils.getDefaultColumnLabelSettings(a),axesLabels:{x:null,y:null},hasDynamicSeries:!1,defaultDataPointColor:null,isMultiMeasure:!1},e.length>0){var r=e[0];if(r&&r.categorical){var s=this.dataViewCat=r.categorical;this.data=i.converter(s,this.cartesianVisualHost.getSharedColors(),!0,!1,this.supportsOverflow,r.metadata,this.chartType);for(var o=this.data.series,l=0,n=o.length;n>l;l++){var c=o[l];this.interactivityService&&this.interactivityService.applySelectionStateToData(c.data)}}}},i.prototype.calculateLegend=function(){if(this.interactivity&&this.interactivity.isInteractiveLegend)return this.createInteractiveMekkoLegendDataPoints(0);var e=this.data?this.data.legendData:null,t=e?e.dataPoints:[];return y.isUndefinedOrEmpty(t)?null:e},i.prototype.hasLegend=function(){return this.data&&(this.data.hasDynamicSeries||this.data.series&&this.data.series.length>1)},i.prototype.enumerateObjectInstances=function(e,i){switch(i.objectName){case"dataPoint":t.GradientUtils.hasGradientRole(this.dataViewCat)||this.enumerateDataPoints(e);break;case"labels":this.enumerateDataLabels(e)}},i.prototype.enumerateDataLabels=function(e){var i=this.data,a=this.data.labelSettings,r=i.series.length;if(t.dataLabelUtils.enumerateDataLabels(this.getLabelSettingsOptions(e,a,!1)),0!==r&&!i.hasDynamicSeries&&(r>1||!i.categoryMetadata))for(var s=0;r>s;s++){var o=i.series[s],a=o.labelSettings?o.labelSettings:this.data.labelSettings;t.dataLabelUtils.enumerateDataLabels(this.getLabelSettingsOptions(e,a,!0,o))}},i.prototype.getLabelSettingsOptions=function(e,t,i,a){var r=!0;return{enumeration:e,dataLabelsSettings:t,show:!i,displayUnits:r,precision:!0,selector:a&&a.identity?a.identity.getSelector():null}},i.prototype.enumerateDataPoints=function(e){var i=this.data;if(i&&i.series){var a=i.series.length;if(0!==a)if(i.hasDynamicSeries||a>1||!i.categoryMetadata)for(var r=0;a>r;r++){var s=i.series[r];e.pushInstance({objectName:"dataPoint",displayName:s.displayName,selector:t.ColorHelper.normalizeSelector(s.identity.getSelector()),properties:{fill:{solid:{color:s.color}}}})}else{var o=i.series[0].data,l=i.categoryFormatter;e.pushInstance({objectName:"dataPoint",selector:null,properties:{defaultColor:{solid:{color:i.defaultDataPointColor||this.colors.getColorByIndex(0).value}}}}).pushInstance({objectName:"dataPoint",selector:null,properties:{showAllDataPoints:!!i.showAllDataPoints}});for(var r=0;r<o.length;r++){var n=o[r],c=i.categories[r];e.pushInstance({objectName:"dataPoint",displayName:l?l.format(c):c,selector:t.ColorHelper.normalizeSelector(n.identity.getSelector(),!0),properties:{fill:{solid:{color:n.color}}}})}}}},i.prototype.calculateAxesProperties=function(e){var i=this.data;this.currentViewport=e.viewport;var a=this.margin=e.margin,r=i&&i.categories?i.categories.length:0,s=i?this.getCategoryLayout(r,e):{categoryCount:0,categoryThickness:t.CartesianChart.MinOrdinalRectThickness,outerPaddingRatio:t.CartesianChart.OuterPaddingRatio,isScalar:!1};this.categoryAxisType=s.isScalar?t.axisType.scalar:null,this.columnChart.setData(i);var o=this.getPreferredPlotArea(s.isScalar,s.categoryCount,s.categoryThickness);o.width===this.currentViewport.width&&(o.width-=a.left+a.right),o.height-=a.top+a.bottom;var l=!0,n={height:o.height,width:o.width,duration:0,hostService:this.hostService,unclippedGraphicsContext:this.unclippedGraphicsContext,mainGraphicsContext:this.mainGraphicsContext,labelGraphicsContext:this.labelGraphicsContext,margin:this.margin,layout:s,animator:this.animator,interactivityService:this.interactivityService,viewportHeight:this.currentViewport.height-(a.top+a.bottom),viewportWidth:this.currentViewport.width-(a.left+a.right),is100Pct:l,isComboChart:!0};this.ApplyInteractivity(n),this.columnChart.setupVisualProps(n);var c=m.hasFlag(this.chartType,f);if(c){var h=e.forcedXDomain;e.forcedXDomain=e.forcedYDomain,e.forcedYDomain=h}return this.xAxisProperties=this.columnChart.setXScale(l,e.forcedTickCount,e.forcedXDomain,c?e.valueAxisScaleType:e.categoryAxisScaleType),this.yAxisProperties=this.columnChart.setYScale(l,e.forcedTickCount,e.forcedYDomain,c?e.categoryAxisScaleType:e.valueAxisScaleType),e.showCategoryAxisLabel&&this.xAxisProperties.isCategoryAxis||e.showValueAxisLabel&&!this.xAxisProperties.isCategoryAxis?this.xAxisProperties.axisLabel=i.axesLabels.x:this.xAxisProperties.axisLabel=null,e.showValueAxisLabel&&!this.yAxisProperties.isCategoryAxis||e.showCategoryAxisLabel&&this.yAxisProperties.isCategoryAxis?this.yAxisProperties.axisLabel=i.axesLabels.y:this.yAxisProperties.axisLabel=null,[this.xAxisProperties,this.yAxisProperties]},i.prototype.getPreferredPlotArea=function(e,i,a){var r={height:this.currentViewport.height,width:this.currentViewport.width};if(this.isScrollable&&!e){var s=t.CartesianChart.getPreferredCategorySpan(i,a);m.hasFlag(this.chartType,f)?r.height=Math.max(s,r.height):r.width=Math.max(s,r.width)}return r},i.prototype.ApplyInteractivity=function(e){var i=this,a=this.interactivity;if(a&&(a.dragDataPoint&&(e.onDragStart=function(e){e.identity&&i.hostService.onDragStart({event:d3.event,data:{data:e.identity.getSelector()}})}),a.isInteractiveLegend)){var r=function(){var e=d3.mouse(i.mainGraphicsContext[0][0]),t=e[0],a=e[1],r=i.columnChart.getClosestColumnIndex(t,a);i.selectColumn(r)},s=t.ColumnChart.getInteractiveColumnChartDomElement(this.element);this.svg.on("click",r),d3.select(s).on("click",r);var o=d3.behavior.drag().origin(Object).on("drag",r);this.svg.call(o),d3.select(s).call(o)}},i.prototype.selectColumn=function(e,t){if(void 0===t&&(t=!1),t||this.lastInteractiveSelectedColumnIndex!==e){var i=this.createInteractiveMekkoLegendDataPoints(e),a=i.dataPoints;this.cartesianVisualHost.updateLegend(i),a.length>0&&this.columnChart.selectColumn(e,this.lastInteractiveSelectedColumnIndex),this.lastInteractiveSelectedColumnIndex=e}},i.prototype.createInteractiveMekkoLegendDataPoints=function(e){var i=this.data;if(!i||y.isUndefinedOrEmpty(i.series))return{dataPoints:[]};for(var a=t.columnChartProps.general.formatString,r=[],s=i.categories&&i.categories[e],o=i.series,l=i.legendData&&i.legendData.dataPoints,n=new S(this.dataViewCat),c=0,h=o.length;h>c;c++){var u,d=n.getValueBySeriesAndCategory(c,e),p=i.valuesMetadata[c],g=t.converterHelper.getFormattedLegendLabel(p,this.dataViewCat.values,a);if(1===o.length){var m=o[0];u=m.data.length>e&&m.data[e].color}else u=l.length>c&&l[c].color;r.push({color:u,icon:t.LegendIcon.Box,label:g,category:i.categoryFormatter?i.categoryFormatter.format(s):s,measure:t.valueFormatter.format(d,t.valueFormatter.getFormatString(p,a)),identity:t.SelectionId.createNull(),selected:!1})}return{dataPoints:r}},i.prototype.overrideXScale=function(e){this.xAxisProperties=e},i.prototype.render=function(e){var i=this.columnChart.drawColumns(!e),a=this.data,r=this.margin,s=this.currentViewport,o=s.height-(r.top+r.bottom),l=s.width-(r.left+r.right);this.mainGraphicsContext.attr("height",o).attr("width",l),t.TooltipManager.addTooltip(i.shapesSelection,function(e){return e.data.tooltipInfo});var n=[],c=void 0;if(this.interactivityService){for(var h=0,u=a.series.length;u>h;h++)n=n.concat(a.series[h].data);c={datapoints:n,bars:i.shapesSelection,hasHighlights:a.hasHighlights,eventGroup:this.mainGraphicsContext,mainGraphicsContext:this.mainGraphicsContext,viewport:i.viewport,axisOptions:i.axisOptions,showLabel:a.labelSettings.show}}return this.interactivity&&this.interactivity.isInteractiveLegend&&this.data.series.length>0&&this.selectColumn(0,!0),t.SVGUtil.flushAllD3TransitionsIfNeeded(this.options),{dataPoints:n,behaviorOptions:c,labelDataPoints:i.labelDataPoints,labelsAreNumeric:!0}},i.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},i.prototype.getVisualCategoryAxisIsScalar=function(){return this.data?this.data.scalarCategoryAxis:!1},i.prototype.getSupportedCategoryAxisType=function(){var e=this.data?this.data.categoryMetadata:void 0,i=t.AxisHelper.getCategoryValueType(e),a=t.AxisHelper.isOrdinal(i);return a?t.axisType.categorical:t.axisType.both},i.prototype.setFilteredData=function(i,a){var r=e.Prototype.inherit(this.data);return r.series=t.ColumnChart.sliceSeries(r.series,a,i),r.categories=r.categories.slice(i,a),this.columnChart.setData(r),r},i.ColumnChartClassName="columnChart",i.SeriesClasses=h("series"),i.BorderClass=h("mekkoborder"),i}();i.MekkoColumnChart=b;var S=function(){function e(e){this.dataView=e}return e.hasRole=function(e,t){var i=e.roles;return i&&i[t]},e.prototype.getLegend=function(i,a){var r=[],s=[],o=[],l=!1,n=new t.ColorHelper(i,t.columnChartProps.dataPoint.fill,a),c=void 0;if(this.dataView&&this.dataView.values){for(var h=this.dataView.values,u=h.grouped(),d=!(!h||!h.source),p=t.columnChartProps.general.formatString,g=0,m=u.length;m>g;g++)for(var y=u[g],f=y.objects,v=y.values,x=0,b=v.length;b>x;x++){var S=v[x],w=S.source;if(!e.hasRole(w,"Width")||e.hasRole(w,"Y")){s.push(w),o.push(S.objects);var C=S.identity?t.SelectionId.createWithIdAndMeasure(S.identity,w.queryName):t.SelectionId.createWithMeasure(this.getMeasureNameByIndex(x)),D=t.converterHelper.getFormattedLegendLabel(w,h,p),P=d?n.getColorForSeriesValue(f||w.objects,h.identityFields,w.groupName):n.getColorForMeasure(f||w.objects,w.queryName);r.push({icon:t.LegendIcon.Box,color:P,label:D,identity:C,selected:!1}),S.identity&&void 0!==w.groupName&&(l=!0)}}var A=this.dataView.values;c=A&&A.source?A.source.displayName:""}var N={title:c,dataPoints:r,grouped:l};return{legend:N,seriesSources:s,seriesObjects:o}},e.prototype.getValueBySeriesAndCategory=function(e,t){return this.dataView.values[e].values[t]},e.prototype.getMeasureNameByIndex=function(e){return this.dataView.values[e].source.queryName},e.prototype.hasHighlightValues=function(e){var t=this.dataView&&this.dataView.values?this.dataView.values[e]:void 0;return t&&!!t.highlights},e.prototype.getHighlightBySeriesAndCategory=function(e,t){return this.dataView.values[e].highlights[t]},e}(),w=function(){function e(e){this.behaviors=e}return e.prototype.bindEvents=function(e,t){for(var i=this.behaviors,a=0,r=i.length;r>a;a++)i[a].bindEvents(e.layerOptions[a],t);e.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){for(var t=0;t<this.behaviors.length;t++)this.behaviors[t].renderSelection(e)},e}();i.MekkoChartBehavior=w}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=t.utility.SelectionManager,s=e.visuals.valueFormatter,o=function(){function i(e){this.margin={top:10,right:10,bottom:10,left:10},this.nodeWidth=21.5,this.curvatureOfLinks=.5,e&&(this.svg=e.svg,this.margin=e.margin||this.margin,this.curvatureOfLinks=e.curvatureOfLinks||this.curvatureOfLinks)}return i.getProperties=function(e){var t={};for(var i in e.objects){t[i]={};for(var a in e.objects[i].properties)t[i][a]={objectName:i,propertyName:a}}return t},Object.defineProperty(i.prototype,"textProperties",{get:function(){return{fontFamily:this.root.style("font-family"),fontSize:a.PixelConverter.fromPoint(this.dataView?this.dataView.settings.fontSize:i.DefaultSettings.fontSize)}},enumerable:!0,configurable:!0}),i.prototype.init=function(e){this.svg?this.root=this.svg:this.root=d3.select(e.element.get(0)).append("svg"),this.selectionManager=new r({hostServices:e.host});var a=e.style;this.colours=a&&a.colorPalette?a.colorPalette.dataColors:new t.DataColorPalette,this.root.classed(i.ClassName,!0),this.main=this.root.append("g"),this.links=this.main.append("g").classed(i.Links["class"],!0),this.nodes=this.main.append("g").classed(i.Nodes["class"],!0)},i.prototype.update=function(e){if(e&&e.dataViews){var t,i=e.dataViews[0];this.updateViewport(e.viewport),t=this.converter(i),this.findNodePosition(t),this.dataView=t,this.render(t)}},i.prototype.updateViewport=function(e){var t,i;t=this.getPositiveNumber(e.height),i=this.getPositiveNumber(e.width),this.viewport={height:this.getPositiveNumber(t-this.margin.top-this.margin.bottom),width:this.getPositiveNumber(i-this.margin.left-this.margin.right)},this.updateElements(t,i)},i.prototype.getPositiveNumber=function(e){return 0>e||isNaN(e)||e===1/0||e===-(1/0)?0:e},i.prototype.updateElements=function(e,i){this.root.attr({height:e,width:i}),this.main.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top))},i.prototype.converter=function(a){var r=this;if(!(a&&a.categorical&&a.categorical.categories&&a.categorical.categories[0]&&a.categorical.categories[1]&&a.categorical.categories[0].values&&a.categorical.categories[1].values))return{nodes:[],links:[],settings:{scale:{x:1,y:1},colourOfLabels:i.DefaultSettings.colourOfLabels,fontSize:i.DefaultSettings.fontSize}};var o,l,n,c,h,u,d,p=[],g=[],m=[],y=a.categorical.categories[0].values,f=a.categorical.categories[1].values,v=a.categorical.values&&a.categorical.values[0],x=v&&v.values&&v.values.map(function(e){return e||0})||[],b="g",S=a.categorical.categories[0].objects||[],w=[];return a.categorical.categories[0].identity&&(w=w.concat(a.categorical.categories[0].identity)),a.categorical.categories[1].identity&&(w=w.concat(a.categorical.categories[1].identity)),c=this.getObjectsFromDataView(a),h=this.getColour(i.Properties.labels.fill,i.DefaultSettings.colourOfLabels,c),v&&v.source&&(b=s.getFormatString(v.source,i.Properties.general.formatString)),m=y.map(function(e,t){return{source:e,destination:f[t],weigth:v?Math.max(x[t]||0,0):1}}),o=y.concat(f),l=s.create({format:s.getFormatString(a.categorical.categories[0].source,i.Properties.general.formatString),value:o[0],value2:o[o.length-1]}),n=s.create({format:b,value:Math.max(d3.max(x)||1,1)}),o.forEach(function(a,s){if(!p.some(function(e){return a===e.label.name?(e.selectionIds.push(t.SelectionId.createWithId(w[s])),!0):!1})){var o,n,c=l.format(a),u={text:c,fontFamily:r.textProperties.fontFamily,fontSize:r.textProperties.fontSize};o={name:a,formattedName:l.format(a),width:e.TextMeasurementService.measureSvgTextWidth(u),height:e.TextMeasurementService.estimateSvgTextHeight(u),colour:h},n=t.SelectionId.createWithId(w[s]),p.push({label:o,links:[],inputWeight:0,outputWeight:0,width:r.nodeWidth,height:0,colour:i.DefaultColourOfNode,tooltipData:[],selectionIds:[n]})}}),d=this.colours.getAllColors().length/p.length,p.forEach(function(e,t){e.colour=r.colours.getColorByIndex(Math.floor(t*d)).value}),m.forEach(function(e,a){var s,o,l,c;e.source!==e.destination&&(p.forEach(function(t){t.label.name===e.source&&(s=t),t.label.name===e.destination&&(o=t)}),c=r.getColour(i.Properties.links.fill,i.DefaultColourOfLink,S[a]),l={source:s,destination:o,weigth:e.weigth,height:e.weigth,colour:c,tooltipData:r.getTooltipDataForLink(n,s.label.formattedName,o.label.formattedName,e.weigth),selectionId:t.SelectionId.createWithId(w[a])},g.push(l),s.links.push(l),o.links.push(l),r.updateValueOfNode(s),r.updateValueOfNode(o),s.tooltipData=r.getTooltipForNode(n,s.label.formattedName,s.inputWeight?s.inputWeight:s.outputWeight),o.tooltipData=r.getTooltipForNode(n,o.label.formattedName,o.inputWeight?o.inputWeight:o.outputWeight))}),u=this.parseSettings(c),u.colourOfLabels=h,{nodes:p,links:g,settings:u}},i.prototype.getObjectsFromDataView=function(e){return e&&e.metadata&&e.metadata.columns&&e.metadata.objects?e.metadata.objects:null},i.prototype.getColour=function(e,i,a){var r;return r=new t.ColorHelper(this.colours,e,i),r.getColorForMeasure(a,"")},i.prototype.getTooltipDataForLink=function(e,t,a,r){var s;return s=e&&e.format?e.format(r):r.toString(),[{displayName:i.RoleNames.rows,value:t},{displayName:i.RoleNames.columns,value:a},{displayName:i.RoleNames.values,value:s}]},i.prototype.updateValueOfNode=function(e){e.inputWeight=e.links.reduce(function(t,i){return t+(i.destination===e?i.weigth:0)},0),e.outputWeight=e.links.reduce(function(t,i){return t+(i.source===e?i.weigth:0)},0)},i.prototype.getTooltipForNode=function(e,t,a){var r;return r=e&&e.format?e.format(a):a.toString(),[{displayName:"Name",value:t},{displayName:i.RoleNames.values,value:r}]},i.prototype.parseSettings=function(t){var a=!1;return a=e.DataViewObjects.getValue(t,i.Properties.labels.show,i.DefaultSettings.isVisibleLabels),{isVisibleLabels:a,scale:{x:i.DefaultSettings.scale.x,y:i.DefaultSettings.scale.y},colourOfLabels:i.DefaultSettings.colourOfLabels,fontSize:e.DataViewObjects.getValue(t,i.Properties.labels.fontSize,i.DefaultSettings.fontSize)}},i.prototype.findNodePosition=function(e){this.findNodePositionByX(e),this.findNodePositionByY(e)},i.prototype.findNodePositionByX=function(e){for(var t=e.nodes,i=[],a=[],r=0,s=!1;t.length>0;)i=[],t.forEach(function(e){e.x=r,e.links.forEach(function(t){e===t.source&&e!==t.destination&&i.every(function(e){return e!==t.destination})&&i.push(t.destination)})}),s=i.length===a.length&&a.every(function(e){return i.some(function(t){return t===e})}),s?(a.forEach(function(e){e.x=r,r++}),t=[]):(t=i,a=t,r++);e.settings.scale.x=this.getScaleByAxisX(r-1),this.scaleByAxisX(e.nodes,e.settings.scale.x)},i.prototype.scaleByAxisX=function(e,t){e.forEach(function(e){e.x*=t})},i.prototype.getScaleByAxisX=function(e){return void 0===e&&(e=1),this.getPositiveNumber((this.viewport.width-this.nodeWidth)/e)},i.prototype.findNodePositionByY=function(e){var t=e.nodes,i=e.links,a=0,r=0,s=0,o=0,l=0;t=t.sort(function(e,t){return e.x-t.x}),t.forEach(function(e){a!==e.x&&(r=0,a=e.x,o=0),o+=Math.max(e.inputWeight,e.outputWeight),o>l&&(l=o),r>s&&(s=r),r++}),e.settings.scale.y=this.getScaleByAxisY(s+1,l),this.scaleByAxisY(t,i,e.settings.scale.y)},i.prototype.getScaleByAxisY=function(e,t){return this.getPositiveNumber((this.viewport.height-e*i.NodePadding)/t)},i.prototype.scaleByAxisY=function(e,t,a){var r=0,s=0,o=0;e.forEach(function(e){s!==e.x&&(s=e.x,r=0,o=0),e.height=Math.max(e.inputWeight,e.outputWeight)*a,e.y=r+i.NodePadding*o,r+=e.height,o++}),e.forEach(function(e){e.links=e.links.sort(function(t,i){var a,r;return a=t.source===e?t.destination.y:t.source.y,r=i.source===e?i.destination.y:i.source.y,a-r});var t=0,i=0;e.links.forEach(function(r){var s=0;r.height=r.weigth*a,r.source.x<e.x||r.destination.x<e.x?(s=t,t+=r.height):(r.source.x>e.x||r.destination.x>e.x)&&(s=i,i+=r.height),r.source===e?r.dySource=s:r.destination===e&&(r.dyDestination=s)})})},i.prototype.render=function(e){var t,i;i=this.renderLinks(e),t=this.renderNodes(e),this.bindSelectionHandler(e,t,i)},i.prototype.renderNodes=function(a){var r,s,o,l=this;return o=this.main.select(i.Nodes.selector).selectAll(i.Node.selector),s=o.data(a.nodes.filter(function(e){return e.height>0})),r=s.enter().append("g"),s.attr("transform",function(e){return t.SVGUtil.translate(e.x,e.y)}).classed(i.Node["class"],!0),r.append("rect").classed(i.NodeRect["class"],!0),r.append("text").classed(i.NodeLabel["class"],!0),s.select(i.NodeRect.selector).style({fill:function(e){return e.colour},stroke:function(e){return d3.rgb(e.colour).darker(1.5)}}).attr({x:0,y:0,height:function(e){return e.height},width:function(e){return e.width}}),s.select(i.NodeLabel.selector).attr({x:function(e){return l.getLabelPositionByAxisX(e)},y:function(e){return e.height/2},dy:"0.35em"}).style("fill",function(e){return e.label.colour}).style("font-size",this.textProperties.fontSize).style("display",function(e){var t=!1,r=l.getCurrentPositionOfLabelByAxisX(e);return t=r>=l.viewport.width||0>=r||e.height+i.NodePadding<e.label.height,t||!a.settings.isVisibleLabels||a.settings.scale.x/2<i.MinWidthOfLabel?"none":null}).style("text-anchor",function(e){return l.isLabelLargerWidth(e)?"end":null}).text(function(t){var r=a.settings.scale.x/2-t.width-i.NodePadding;return l.getCurrentPositionOfLabelByAxisX(t)>r?e.TextMeasurementService.getTailoredTextOrDefault({text:t.label.formattedName,fontFamily:l.textProperties.fontFamily,fontSize:l.textProperties.fontSize},r):t.label.formattedName}),s.exit().remove(),this.renderTooltip(s),s},i.prototype.getLabelPositionByAxisX=function(e){return this.isLabelLargerWidth(e)?-i.LabelPadding:e.width+i.LabelPadding},i.prototype.isLabelLargerWidth=function(e){var t=e.x+e.width+i.LabelPadding;return t+e.label.width>this.viewport.width},i.prototype.getCurrentPositionOfLabelByAxisX=function(e){var t=this.getLabelPositionByAxisX(e);return t=t>0?t+e.x+e.label.width+e.width:e.x+t-e.label.width-e.width},i.prototype.renderLinks=function(e){var t,a,r=this;return a=this.main.select(i.Links.selector).selectAll(i.Link.selector),t=a.data(e.links.filter(function(e){return e.height>0})),t.enter().append("path").classed(i.Link["class"],!0),t.attr("d",function(e){return r.getSvgPath(e)}).style({"stroke-width":function(e){return e.height},stroke:function(e){return e.colour}}),t.exit().remove(),this.renderTooltip(t),t},i.prototype.getSvgPath=function(e){var t,i,a,r,s,o,l;return e.destination.x<e.source.x?(t=e.source.x,i=e.destination.x+e.destination.width):(t=e.source.x+e.source.width,i=e.destination.x),a=d3.interpolateNumber(t,i),r=a(this.curvatureOfLinks),s=a(1-this.curvatureOfLinks),o=e.source.y+e.dySource+e.height/2,l=e.destination.y+e.dyDestination+e.height/2,"M "+t+" "+o+" C "+r+" "+o+", "+s+" "+l+", "+i+" "+l},i.prototype.renderTooltip=function(e){t.TooltipManager.addTooltip(e,function(e){return e.data.tooltipData})},i.prototype.bindSelectionHandler=function(e,t,i){var a=this;t.on("click",function(e){var r=_.isEqual(e.selectionIds.map(function(e){return e.getKey()}),a.selectionManager.getSelectionIds().map(function(e){return e.getKey()}))?[]:e.selectionIds;a.selectMany(r,!0).then(function(){return a.setSelection(t,i)}),d3.event.stopPropagation()}),i.on("click",function(e){a.selectionManager.select(e.selectionId,d3.event.ctrlKey).then(function(){return a.setSelection(t,i)}),d3.event.stopPropagation()}),this.root.on("click",function(){a.selectionManager.clear().then(function(){return a.setSelection(t,i)})}),this.setSelection(t,i)},i.prototype.selectMany=function(e,t){var i=this;if(void 0===t&&(t=!1),t)return this.selectionManager.clear().then(function(){return i.selectMany(e,!1)});var a=e.map(function(e){return i.selectionManager.select(e,!0)});return $.when.apply(null,a)},i.prototype.setSelection=function(e,t){var i=this.selectionManager.getSelectionIds();if(e.classed("selected",i.length>0),t.classed("selected",!1),0!==i.length){var a=e.filter(function(e){return i.some(function(t){return e.selectionIds.some(function(e){return e.getKey()===t.getKey()})})}),r=t.filter(function(e){return i.some(function(t){return t.getKey()===e.selectionId.getKey()})});a.classed("selected",!1),r.classed("selected",!0)}},i.prototype.enumerateObjectInstances=function(e){var i=new t.ObjectEnumerationBuilder;if(!this.dataView)return[];switch(e.objectName){case"labels":this.enumerateLabels(i);break;case"links":this.enumerateLinks(i)}return i.complete()},i.prototype.enumerateLabels=function(e){var t,i=this.dataView.settings;i&&(t={objectName:"labels",displayName:"labels",selector:null,properties:{show:i.isVisibleLabels,fill:i.colourOfLabels,fontSize:i.fontSize}},e.pushInstance(t))},i.prototype.enumerateLinks=function(e){var i=this.dataView.links;i&&i.length>0&&i.forEach(function(i){e.pushInstance({objectName:"links",displayName:i.source.label.formattedName+" - "+i.destination.label.formattedName,selector:t.ColorHelper.normalizeSelector(i.selectionId.getSelector(),!1),properties:{fill:{solid:{color:i.colour}}}})})},i.ClassName="sankeyDiagram",i.Nodes={"class":"nodes",selector:".nodes"},i.Node={"class":"node",selector:".node"},i.NodeRect={"class":"nodeRect",selector:".nodeRect"},i.NodeLabel={"class":"nodeLabel",selector:".nodeLabel"},i.Links={"class":"links",selector:".links"},i.Link={"class":"link",selector:".link"},i.DefaultColourOfNode="rgb(62, 187, 162)",i.DefaultColourOfLink="black",i.DefaultSettings={isVisibleLabels:!0,scale:{x:1,y:1},colourOfLabels:"black",fontSize:12},i.MinWidthOfLabel=35,i.NodePadding=5,i.LabelPadding=4,i.RoleNames={rows:"Source",columns:"Destination",values:"Weight"},i.capabilities={dataRoles:[{name:i.RoleNames.rows,kind:e.VisualDataRoleKind.Grouping,displayName:i.RoleNames.rows},{name:i.RoleNames.columns,kind:e.VisualDataRoleKind.Grouping,displayName:i.RoleNames.columns},{name:i.RoleNames.values,kind:e.VisualDataRoleKind.Measure,displayName:i.RoleNames.values}],dataViewMappings:[{conditions:[{Source:{min:0,max:1},Destination:{min:0,max:1},Weight:{min:0,max:0}},{Source:{min:0,max:1},Destination:{min:0,max:1},Weight:{min:1,max:1}}],categorical:{categories:{"for":{"in":i.RoleNames.rows},dataReductionAlgorithm:{top:{}}},values:{select:[{bind:{to:i.RoleNames.columns}},{bind:{to:i.RoleNames.values}}]}}}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},labels:{displayName:e.data.createDisplayNameGetter("Visual_DataPointsLabels"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},links:{displayName:"Links",properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}}}},i.Properties=i.getProperties(i.capabilities),i}();i.SankeyDiagram=o}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=a.PixelConverter;i.bulletChartProps={values:{targetValue:{objectName:"values",propertyName:"targetValue"},minimumPercent:{objectName:"values",propertyName:"minimumPercent"},needsImprovementPercent:{objectName:"values",propertyName:"needsImprovementPercent"},satisfactoryPercent:{objectName:"values",propertyName:"satisfactoryPercent"},goodPercent:{objectName:"values",propertyName:"goodPercent"},veryGoodPercent:{objectName:"values",propertyName:"veryGoodPercent"},maximumPercent:{objectName:"values",propertyName:"maximumPercent"},targetValue2:{objectName:"values",propertyName:"targetValue2"},secondTargetVisibility:{objectName:"values",propertyName:"secondTargetVisibility"}},orientation:{orientation:{objectName:"orientation",propertyName:"orientation"}},colors:{badColor:{objectName:"colors",
propertyName:"badColor"},needsImprovementColor:{objectName:"colors",propertyName:"needsImprovementColor"},satisfactoryColor:{objectName:"colors",propertyName:"satisfactoryColor"},goodColor:{objectName:"colors",propertyName:"goodColor"},veryGoodColor:{objectName:"colors",propertyName:"veryGoodColor"},bulletColor:{objectName:"colors",propertyName:"bulletColor"}},axis:{axis:{objectName:"axis",propertyName:"axis"},axisColor:{objectName:"axis",propertyName:"axisColor"},measureUnits:{objectName:"axis",propertyName:"measureUnits"},unitsColor:{objectName:"axis",propertyName:"unitsColor"}},formatString:{objectName:"general",propertyName:"formatString"},labels:{fontSize:{objectName:"labels",propertyName:"fontSize"},show:{objectName:"labels",propertyName:"show"},labelColor:{objectName:"labels",propertyName:"labelColor"}}},i.bulletChartRoleNames={value:"Value",targetValue:"TargetValue",minValue:"Minimum",needsImprovementValue:"NeedsImprovement",satisfactoryValue:"Satisfactory",goodValue:"Good",veryGoodValue:"VeryGood",maxValue:"Maximum",targetValue2:"TargetValue2"};var s;!function(t){t.HORIZONTALLEFT="Horizontal Left",t.HORIZONTALRIGHT="Horizontal Right",t.VERTICALTOP="Vertical Top",t.VERTICALBOTTOM="Vertical Bottom",t.type=e.createEnumType([{value:t.HORIZONTALLEFT,displayName:t.HORIZONTALLEFT},{value:t.HORIZONTALRIGHT,displayName:t.HORIZONTALRIGHT},{value:t.VERTICALTOP,displayName:t.VERTICALTOP},{value:t.VERTICALBOTTOM,displayName:t.VERTICALBOTTOM}])}(s||(s={}));var o=function(){function a(){this.baselineDelta=0}return Object.defineProperty(a.prototype,"reverse",{get:function(){return this.model.bulletChartSettings.orientation.reverse},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"vertical",{get:function(){return this.model.bulletChartSettings.orientation.vertical},enumerable:!0,configurable:!0}),a.DefaultStyleProperties=function(){return{values:{targetValue:0,targetValue2:0,minimumPercent:0,needsImprovementPercent:25,satisfactoryPercent:50,goodPercent:100,veryGoodPercent:125,maximumPercent:200,secondTargetVisibility:!1},orientation:{orientation:s.HORIZONTALLEFT,reverse:!1,vertical:!1},colors:{badColor:"Darkred",needsImprovementColor:"Red",satisfactoryColor:"Yellow",goodColor:"Green",veryGoodColor:"Darkgreen",bulletColor:"Black"},axis:{axis:!0,axisColor:"Grey",measureUnits:"",unitsColor:"Grey"},labelSettings:{fontSize:11,show:!0,labelColor:"Black"}}},Object.defineProperty(a.prototype,"viewportIn",{get:function(){return{width:this.viewport.width,height:this.viewport.height}},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"viewportScroll",{get:function(){var e=this.viewportIn;return{width:e.width-a.ScrollBarSize,height:e.height-a.ScrollBarSize}},enumerable:!0,configurable:!0}),a.getTextProperties=function(e,t){return{fontFamily:a.FontFamily,fontSize:r.fromPoint(t),text:e}},a.converter=function(o,l){var n=a.DefaultStyleProperties(),c={bulletValueFormatString:null,bulletChartSettings:n,bars:[],barRects:[],valueRects:[],targetValues:[],viewportLength:0};if(!(o&&o.categorical&&o.categorical.values&&0!==o.categorical.values.length&&o.metadata&&o.metadata.columns&&0!==o.metadata.columns.length))return c;var h=o.metadata.objects,u=c.bulletChartSettings;h&&(u.values.targetValue=e.DataViewObjects.getValue(h,i.bulletChartProps.values.targetValue,n.values.targetValue),u.values.targetValue2=e.DataViewObjects.getValue(h,i.bulletChartProps.values.targetValue2,n.values.targetValue2),u.values.secondTargetVisibility=e.DataViewObjects.getValue(h,i.bulletChartProps.values.secondTargetVisibility,n.values.secondTargetVisibility),u.values.minimumPercent=e.DataViewObjects.getValue(h,i.bulletChartProps.values.minimumPercent,n.values.minimumPercent),u.values.needsImprovementPercent=e.DataViewObjects.getValue(h,i.bulletChartProps.values.needsImprovementPercent,n.values.needsImprovementPercent),u.values.satisfactoryPercent=e.DataViewObjects.getValue(h,i.bulletChartProps.values.satisfactoryPercent,n.values.satisfactoryPercent),u.values.goodPercent=e.DataViewObjects.getValue(h,i.bulletChartProps.values.goodPercent,n.values.goodPercent),u.values.veryGoodPercent=e.DataViewObjects.getValue(h,i.bulletChartProps.values.veryGoodPercent,n.values.veryGoodPercent),u.values.maximumPercent=e.DataViewObjects.getValue(h,i.bulletChartProps.values.maximumPercent,n.values.maximumPercent),u.orientation.orientation=e.DataViewObjects.getValue(h,i.bulletChartProps.orientation.orientation,n.orientation.orientation),u.colors.badColor=e.DataViewObjects.getFillColor(h,i.bulletChartProps.colors.badColor,n.colors.badColor),u.colors.needsImprovementColor=e.DataViewObjects.getFillColor(h,i.bulletChartProps.colors.needsImprovementColor,n.colors.needsImprovementColor),u.colors.satisfactoryColor=e.DataViewObjects.getFillColor(h,i.bulletChartProps.colors.satisfactoryColor,n.colors.satisfactoryColor),u.colors.goodColor=e.DataViewObjects.getFillColor(h,i.bulletChartProps.colors.goodColor,n.colors.goodColor),u.colors.veryGoodColor=e.DataViewObjects.getFillColor(h,i.bulletChartProps.colors.veryGoodColor,n.colors.veryGoodColor),u.colors.bulletColor=e.DataViewObjects.getFillColor(h,i.bulletChartProps.colors.bulletColor,n.colors.bulletColor),u.axis.axis=e.DataViewObjects.getValue(h,i.bulletChartProps.axis.axis,n.axis.axis),u.axis.axisColor=e.DataViewObjects.getFillColor(h,i.bulletChartProps.axis.axisColor,n.axis.axisColor),u.axis.measureUnits=e.TextMeasurementService.getTailoredTextOrDefault(a.getTextProperties(e.DataViewObjects.getValue(h,i.bulletChartProps.axis.measureUnits,n.axis.measureUnits),a.DefaultSubtitleFontSizeInPt),a.MaxLabelWidth),u.axis.unitsColor=e.DataViewObjects.getFillColor(h,i.bulletChartProps.axis.unitsColor,n.axis.unitsColor),u.labelSettings.fontSize=e.DataViewObjects.getValue(h,i.bulletChartProps.labels.fontSize,n.labelSettings.fontSize),u.labelSettings.show=e.DataViewObjects.getValue(h,i.bulletChartProps.labels.show,n.labelSettings.show),u.labelSettings.labelColor=e.DataViewObjects.getFillColor(h,i.bulletChartProps.labels.labelColor,n.labelSettings.labelColor)),u.orientation.orientation!==s.HORIZONTALRIGHT&&u.orientation.orientation!==s.VERTICALBOTTOM||(u.orientation.reverse=!0),u.orientation.orientation!==s.VERTICALTOP&&u.orientation.orientation!==s.VERTICALBOTTOM||(u.orientation.vertical=!0);var d,p,g,m=1;o.categorical.categories&&(d=o.categorical.categories[0],p=d.values,m=p.length,g=t.valueFormatter.getFormatString(d.source,i.bulletChartProps.formatString)),c.labelHeight=(u.labelSettings.show||0)&&parseFloat(r.fromPoint(u.labelSettings.fontSize)),c.labelHeightTop=(u.labelSettings.show||0)&&parseFloat(r.fromPoint(u.labelSettings.fontSize))/1.4,c.spaceRequiredForBarHorizontally=Math.max(60,c.labelHeight+20),c.bulletValueFormatString=t.valueFormatter.getFormatString(o.categorical.values[0].source,i.bulletChartProps.formatString),c.viewportLength=(u.orientation.vertical?l.viewport.height-c.labelHeightTop-a.SubtitleMargin-20-2*a.YMarginVertical:l.viewport.width-a.MaxLabelWidth-3*a.XMarginHorizontal)-a.ScrollBarSize;for(var y=0;m>y;y++){var f=[],v=void 0,x=void 0,b=void 0,S=void 0,w=void 0,C=void 0,D=void 0,P=void 0,A=void 0,N=void 0,V=!1,T=void 0;if(p){var L=p[y];v=t.valueFormatter.format(L,g),T=d.identity?d.identity[y]:null;var M=a.getTextProperties(v,u.labelSettings.fontSize);v=e.TextMeasurementService.getTailoredTextOrDefault(M,a.MaxLabelWidth)}var k=o.categorical.values;b=u.values.targetValue,S=u.values.targetValue2,c.hasHighlights=!!(k.length>0&&k[0].highlights);for(var j=0;j<k.length;j++){var O=k[j].source,I=k[j].values[y]||0;O&&O.roles&&(O.roles[i.bulletChartRoleNames.value]?(k[j].highlights&&(V=null!==k[j].highlights[y]),f.push({value:I,metadata:k[j]}),x=I):O.roles[i.bulletChartRoleNames.targetValue]?(f.push({value:I,metadata:k[j]}),b=I):O.roles[i.bulletChartRoleNames.targetValue2]?(f.push({value:I,metadata:k[j]}),S=I):O.roles[i.bulletChartRoleNames.minValue]?w=I:O.roles[i.bulletChartRoleNames.needsImprovementValue]?A=I:O.roles[i.bulletChartRoleNames.satisfactoryValue]?C=I:O.roles[i.bulletChartRoleNames.goodValue]?D=I:O.roles[i.bulletChartRoleNames.veryGoodValue]?N=I:O.roles[i.bulletChartRoleNames.maxValue]&&(P=I))}w||(w=u.values.minimumPercent*b/100),A||(A=u.values.needsImprovementPercent*b/100),C||(C=u.values.satisfactoryPercent*b/100),D||(D=u.values.goodPercent*b/100),N||(N=u.values.veryGoodPercent*b/100),P||(P=u.values.maximumPercent*b/100);var F=[w,A,C,D,N,P].sort(d3.descending),G=d3.scale.linear().clamp(!0).domain([w,Math.max(F[0],b,x)]).range(u.orientation.vertical?[c.viewportLength,0]:[0,c.viewportLength]),z=G(w),R=G(A),B=G(C),H=G(D),U=G(N),W=G(P),E=G(x),_=u.colors.badColor,Y=u.colors.needsImprovementColor,X=u.colors.satisfactoryColor,K=u.colors.goodColor,q=u.colors.veryGoodColor;a.addItemToBarArray(c.barRects,y,z,R,_,f,T,V),a.addItemToBarArray(c.barRects,y,R,B,Y,f,T,V),a.addItemToBarArray(c.barRects,y,B,H,X,f,T,V),a.addItemToBarArray(c.barRects,y,H,U,K,f,T,V),a.addItemToBarArray(c.barRects,y,U,W,q,f,T,V),a.addItemToBarArray(c.valueRects,y,z,E,u.colors.bulletColor,f,T,V),c.targetValues.push({barIndex:y,value:G(b),fill:u.colors.bulletColor,key:t.SelectionId.createWithIdAndMeasure(T,G(b).toString()).getKey(),value2:G(S)});var Z=null;if(u.axis.axis){Z=d3.svg.axis(),Z.orient(u.orientation.vertical?"left":"bottom");var J=Math.round(Math.max(3,c.viewportLength/100)),Q=[x,b,D,C,P,w,A,N].filter(function(e){return!isNaN(e)});Z.tickFormat(t.valueFormatter.create({format:c.bulletValueFormatString,value:Q.length?Math.max.apply(null,Q):0}).format),Z.ticks(J),Z.scale(G)}var $={scale:G,barIndex:y,categoryLabel:v,x:u.orientation.vertical?a.XMarginVertical+a.SpaceRequiredForBarVertically*y:a.XMarginHorizontal,y:u.orientation.vertical?a.YMarginVertical:a.YMarginHorizontal+c.spaceRequiredForBarHorizontally*y,axis:Z,key:t.SelectionId.createWithIdAndMeasure(T,y.toString()).getKey()};c.bars.push($)}return c},a.addItemToBarArray=function(e,a,r,s,o,l,n,c){isNaN(r)||isNaN(s)||e.push({barIndex:a,start:r,end:s,fill:o,tooltipInfo:t.TooltipBuilder.createTooltipInfo(i.bulletChartProps.formatString,null,null,null,null,l),selected:!1,identity:t.SelectionId.createWithId(n),key:t.SelectionId.createWithIdAndMeasure(n,r+" "+s).getKey(),highlight:c})},a.prototype.init=function(e){var i=d3.select(e.element.get(0));this.hostService=e.host,this.bulletBody=i.append("div").classed("bulletChart",!0).attr("drag-resize-disabled",!0),this.scrollContainer=this.bulletBody.append("svg").classed("bullet-scroll-region",!0),this.clearCatcher=t.appendClearCatcher(this.scrollContainer),this.labelGraphicsContext=this.scrollContainer.append("g"),this.bulletGraphicsContext=this.scrollContainer.append("g"),this.behavior=new n,this.interactivityService=t.createInteractivityService(e.host)},a.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){var t=e.dataViews[0];this.viewport=e.viewport,this.model=a.converter(t,e),this.baselineDelta=l.estimateSvgTextBaselineDelta(a.getTextProperties("1",this.model.bulletChartSettings.labelSettings.fontSize)),this.ClearViewport(),this.model&&(this.interactivityService&&this.interactivityService.applySelectionStateToData(this.model.barRects),this.bulletBody.style({height:this.viewportIn.height+"px",width:this.viewportIn.width+"px"}),this.vertical?this.scrollContainer.attr({width:this.model.bars.length*a.SpaceRequiredForBarVertically+a.XMarginVertical+"px",height:this.viewportScroll.height+"px"}):this.scrollContainer.attr({height:this.model.bars.length*this.model.spaceRequiredForBarHorizontally+"px",width:this.viewportScroll.width+"px"}),this.vertical?this.setUpBulletsVertically(this.bulletBody,this.model,this.reverse):this.setUpBulletsHorizontally(this.bulletBody,this.model,this.reverse))}},a.prototype.ClearViewport=function(){this.labelGraphicsContext.selectAll("text").remove(),this.bulletGraphicsContext.selectAll("rect").remove(),this.bulletGraphicsContext.selectAll("text").remove(),this.bulletGraphicsContext.selectAll("axis").remove(),this.bulletGraphicsContext.selectAll("path").remove(),this.bulletGraphicsContext.selectAll("line").remove(),this.bulletGraphicsContext.selectAll("tick").remove(),this.bulletGraphicsContext.selectAll("g").remove()},a.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},a.prototype.calculateLabelWidth=function(e,t,i){return(i?0:e.x+a.MaxLabelWidth)+a.XMarginHorizontal+(t?t.start:0)},a.prototype.calculateLabelHeight=function(e,t,i){return a.YMarginVertical+(i?5:e.y+this.model.labelHeightTop+a.BarMargin+a.SubtitleMargin)+(t?t.end:0)},a.prototype.setUpBulletsHorizontally=function(i,s,o){var l=this,n=s.bars,c=s.barRects,h=s.valueRects,u=s.targetValues,d=this.labelGraphicsContext.selectAll("text").data(n,function(e){return e.key}),p=this.bulletGraphicsContext.selectAll("rect.range").data(c,function(e){return e.key}),g=this.interactivityService&&this.interactivityService.hasSelection(),m=s.hasHighlights,y=p.enter().append("rect").attr({x:function(e){return l.calculateLabelWidth(n[e.barIndex],e,o)},y:function(e){return n[e.barIndex].y-a.BulletSize/2},width:function(e){return e.end-e.start},height:a.BulletSize}).classed("range",!0).style({fill:function(e){return e.fill},opacity:function(e){return t.ColumnUtil.getFillOpacity(e.selected,e.highlight,g,m)}});p.exit();var f=this.bulletGraphicsContext.selectAll("rect").data(h,function(e){return e.key});f.enter().append("rect").attr({x:function(e){return l.calculateLabelWidth(n[e.barIndex],e,o)},y:function(e){return n[e.barIndex].y-a.BulletSize/8},width:function(e){return e.end-e.start},height:1*a.BulletSize/4}).classed("value",!0).style({fill:function(e){return e.fill},opacity:function(e){return t.ColumnUtil.getFillOpacity(e.selected,e.highlight,g,m)}}),f.exit();var v=this.bulletGraphicsContext.selectAll("values").data(u,function(e){return isNaN(e.value)||isNaN(e.value2)?void 0:e.key});if(v.enter().append("line").attr({x1:function(e){return l.calculateLabelWidth(n[e.barIndex],null,o)+e.value},x2:function(e){return l.calculateLabelWidth(n[e.barIndex],null,o)+e.value},y1:function(e){return n[e.barIndex].y-a.MarkerMarginHorizontal},y2:function(e){return n[e.barIndex].y+a.MarkerMarginHorizontal}}).style({stroke:function(e){return e.fill},"stroke-width":2}),s.bulletChartSettings.values.secondTargetVisibility&&this.drawSecondTarget(v.enter(),function(e){return l.calculateLabelWidth(n[e.barIndex],null,o)+e.value2},function(e){return n[e.barIndex].y}),v.exit(),s.bulletChartSettings.axis.axis)for(var x=0;x<n.length;x++){var b=n[x];this.bulletGraphicsContext.append("g").attr({transform:function(){var e=l.calculateLabelWidth(b,null,o),t=b.y+a.BulletSize/2;return"translate("+e+","+t+")"}}).classed("axis",!0).call(b.axis.scale(b.scale)).style({fill:s.bulletChartSettings.axis.axisColor,"font-size":r.fromPoint(a.AxisFontSizeInPt)}).selectAll("line").style({stroke:s.bulletChartSettings.axis.axisColor})}s.bulletChartSettings.labelSettings.show&&d.enter().append("text").classed("title",!0).attr({x:function(e){return o?2*a.XMarginHorizontal+s.viewportLength:e.x},y:function(e){return e.y+l.baselineDelta},fill:s.bulletChartSettings.labelSettings.labelColor,"font-size":r.fromPoint(s.bulletChartSettings.labelSettings.fontSize)}).text(function(e){return e.categoryLabel});var S=e.TextMeasurementService.getTailoredTextOrDefault(a.getTextProperties(s.bulletChartSettings.axis.measureUnits,a.DefaultSubtitleFontSizeInPt),a.MaxMeasureUnitWidth);if(s.bulletChartSettings.axis.measureUnits&&d.enter().append("text").attr({x:function(e){return o?2*a.XMarginHorizontal+s.viewportLength+a.SubtitleMargin:e.x-a.SubtitleMargin},y:function(e){return e.y+l.model.labelHeight/2+12},fill:s.bulletChartSettings.axis.unitsColor,"font-size":r.fromPoint(a.DefaultSubtitleFontSizeInPt)}).text(S),this.interactivityService){var w={rects:y,valueRects:f,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService,bulletChartSettings:this.model.bulletChartSettings,hasHighlights:!1},C=this.model.barRects.concat(this.model.valueRects);this.interactivityService.bind(C,this.behavior,w)}d.exit(),t.TooltipManager.addTooltip(f,function(e){return e.data.tooltipInfo},!0),t.TooltipManager.addTooltip(p,function(e){return e.data.tooltipInfo},!0)},a.prototype.setUpBulletsVertically=function(i,s,o){var l=this,n=s.bars,c=s.barRects,h=s.valueRects,u=s.targetValues,d=this.labelGraphicsContext.selectAll("text").data(n,function(e){return e.key}),p=this.bulletGraphicsContext.selectAll("rect.range").data(c,function(e){return e.key}),g=this.interactivityService&&this.interactivityService.hasSelection(),m=s.hasHighlights,y=p.enter().append("rect").attr({x:function(e){return n[e.barIndex].x},y:function(e){return l.calculateLabelHeight(n[e.barIndex],e,o)},height:function(e){return e.start-e.end},width:a.BulletSize}).classed("range",!0).style({fill:function(e){return e.fill},opacity:function(e){return t.ColumnUtil.getFillOpacity(e.selected,e.highlight,g,m)}});p.exit();var f=this.bulletGraphicsContext.selectAll("rect").data(h,function(e){return e.key});f.enter().append("rect").attr({x:function(e){return n[e.barIndex].x+a.BulletSize/3},y:function(e){return l.calculateLabelHeight(n[e.barIndex],e,o)},height:function(e){return e.start-e.end},width:1*a.BulletSize/4}).classed("value",!0).style({fill:function(e){return e.fill},opacity:function(e){return t.ColumnUtil.getFillOpacity(e.selected,e.highlight,g,m)}}),f.exit();var v=this.bulletGraphicsContext.selectAll("values").data(u,function(e){return isNaN(e.value)||isNaN(e.value2)?void 0:e.key});if(v.enter().append("line").attr({x2:function(e){return n[e.barIndex].x+3*a.MarkerMarginVertical},x1:function(e){return n[e.barIndex].x+a.MarkerMarginVertical},y2:function(e){return l.calculateLabelHeight(n[e.barIndex],null,o)+e.value},y1:function(e){return l.calculateLabelHeight(n[e.barIndex],null,o)+e.value}}).style({stroke:function(e){return e.fill},"stroke-width":2}),s.bulletChartSettings.values.secondTargetVisibility&&this.drawSecondTarget(v.enter(),function(e){return n[e.barIndex].x+a.BulletSize/3+a.BulletSize/8},function(e){return l.calculateLabelHeight(n[e.barIndex],null,o)+e.value2}),v.exit(),s.bulletChartSettings.axis.axis)for(var x=0;x<n.length;x++){var b=n[x];this.bulletGraphicsContext.append("g").attr({transform:function(){var e=b.x,t=l.calculateLabelHeight(b,null,o);return"translate("+e+","+t+")"}}).classed("axis",!0).call(b.axis.scale(b.scale)).style({fill:s.bulletChartSettings.axis.axisColor,"font-size":r.fromPoint(a.AxisFontSizeInPt)}).selectAll("line").style({stroke:s.bulletChartSettings.axis.axisColor})}var S=a.YMarginVertical+(o?s.viewportLength+15:0)+this.model.labelHeightTop;s.bulletChartSettings.labelSettings.show&&d.enter().append("text").classed("title",!0).attr({x:function(e){return e.x},y:function(e){return S},fill:s.bulletChartSettings.labelSettings.labelColor,"font-size":r.fromPoint(s.bulletChartSettings.labelSettings.fontSize)}).text(function(e){return e.categoryLabel});var w=e.TextMeasurementService.getTailoredTextOrDefault(a.getTextProperties(s.bulletChartSettings.axis.measureUnits,a.DefaultSubtitleFontSizeInPt),a.MaxMeasureUnitWidth);if(s.bulletChartSettings.axis.measureUnits&&d.enter().append("text").attr({x:function(e){return e.x+a.BulletSize},y:function(e){return S+a.SubtitleMargin+12},fill:s.bulletChartSettings.axis.unitsColor,"font-size":r.fromPoint(a.DefaultSubtitleFontSizeInPt)}).text(w),this.interactivityService){var C={rects:y,valueRects:f,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService,bulletChartSettings:this.model.bulletChartSettings,hasHighlights:!1},D=this.model.barRects.concat(this.model.valueRects);this.interactivityService.bind(D,this.behavior,C)}d.exit(),t.TooltipManager.addTooltip(f,function(e){return e.data.tooltipInfo},!0),t.TooltipManager.addTooltip(p,function(e){return e.data.tooltipInfo},!0)},a.prototype.drawSecondTarget=function(e,t,i){var r={stroke:function(e){return e.fill},"stroke-width":2};e.append("line").attr({x1:function(e){return t(e)-a.SecondTargetLineSize},y1:function(e){return i(e)-a.SecondTargetLineSize},x2:function(e){return t(e)+a.SecondTargetLineSize},y2:function(e){return i(e)+a.SecondTargetLineSize}}).style(r),e.append("line").attr({x1:function(e){return t(e)+a.SecondTargetLineSize},y1:function(e){return i(e)-a.SecondTargetLineSize},x2:function(e){return t(e)-a.SecondTargetLineSize},y2:function(e){return i(e)+a.SecondTargetLineSize}}).style(r)},a.prototype.destroy=function(){},a.prototype.enumerateObjectInstances=function(e){var t=this.model;if(t){var i=e.objectName;switch(i){case"labels":return this.enumerateLabels(t);case"values":return this.enumerateValues(t);case"orientation":return this.enumerateOrientation(t);case"axis":return this.enumerateAxis(t);case"colors":return this.enumerateColors(t)}}},a.prototype.enumerateLabels=function(e){return[{selector:null,objectName:"labels",properties:{show:this.model.bulletChartSettings.labelSettings.show,labelColor:this.model.bulletChartSettings.labelSettings.labelColor,fontSize:this.model.bulletChartSettings.labelSettings.fontSize}}]},a.prototype.enumerateValues=function(e){return[{selector:null,objectName:"values",properties:{targetValue:this.model.bulletChartSettings.values.targetValue,targetValue2:this.model.bulletChartSettings.values.targetValue2,secondTargetVisibility:this.model.bulletChartSettings.values.secondTargetVisibility,minimumPercent:this.model.bulletChartSettings.values.minimumPercent,needsImprovementPercent:this.model.bulletChartSettings.values.needsImprovementPercent,satisfactoryPercent:this.model.bulletChartSettings.values.satisfactoryPercent,goodPercent:this.model.bulletChartSettings.values.goodPercent,veryGoodPercent:this.model.bulletChartSettings.values.veryGoodPercent,maximumPercent:this.model.bulletChartSettings.values.maximumPercent}}]},a.prototype.enumerateOrientation=function(e){return[{selector:null,objectName:"orientation",properties:{orientation:this.model.bulletChartSettings.orientation.orientation}}]},a.prototype.enumerateAxis=function(e){return[{selector:null,objectName:"axis",properties:{axis:this.model.bulletChartSettings.axis.axis,axisColor:this.model.bulletChartSettings.axis.axisColor,measureUnits:this.model.bulletChartSettings.axis.measureUnits,unitsColor:this.model.bulletChartSettings.axis.unitsColor}}]},a.prototype.enumerateColors=function(e){return[{selector:null,objectName:"colors",properties:{badColor:this.model.bulletChartSettings.colors.badColor,needsImprovementColor:this.model.bulletChartSettings.colors.needsImprovementColor,satisfactoryColor:this.model.bulletChartSettings.colors.satisfactoryColor,goodColor:this.model.bulletChartSettings.colors.goodColor,veryGoodColor:this.model.bulletChartSettings.colors.veryGoodColor,bulletColor:this.model.bulletChartSettings.colors.bulletColor}}]},a.ScrollBarSize=22,a.SpaceRequiredForBarVertically=100,a.XMarginHorizontal=20,a.YMarginHorizontal=30,a.XMarginVertical=50,a.YMarginVertical=10,a.BulletSize=25,a.DefaultSubtitleFontSizeInPt=9,a.BarMargin=10,a.MaxLabelWidth=80,a.MaxMeasureUnitWidth=a.MaxLabelWidth-20,a.SubtitleMargin=10,a.AxisFontSizeInPt=8,a.SecondTargetLineSize=7,a.MarkerMarginHorizontal=a.BulletSize/3,a.MarkerMarginVertical=a.BulletSize/4,a.FontFamily="Segoe UI",a.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:"Category"},{name:"Value",kind:e.VisualDataRoleKind.Measure,displayName:"Value"},{name:"TargetValue",kind:e.VisualDataRoleKind.Measure,displayName:"Target Value"},{name:"Minimum",kind:e.VisualDataRoleKind.Measure,displayName:"Minimum"},{name:"NeedsImprovement",kind:e.VisualDataRoleKind.Measure,displayName:"Needs Improvement"},{name:"Satisfactory",kind:e.VisualDataRoleKind.Measure,displayName:"Satisfactory"},{name:"Good",kind:e.VisualDataRoleKind.Measure,displayName:"Good"},{name:"VeryGood",kind:e.VisualDataRoleKind.Measure,displayName:"Very Good"},{name:"Maximum",kind:e.VisualDataRoleKind.Measure,displayName:"Maximum"},{name:"TargetValue2",kind:e.VisualDataRoleKind.Measure,displayName:"Target Value 2"}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},values:{displayName:"Data values",properties:{targetValue:{displayName:"Target Value",type:{numeric:!0}},targetValue2:{displayName:"Target Value 2",type:{numeric:!0}},secondTargetVisibility:{displayName:"Second Target Visibility",type:{bool:!0}},minimumPercent:{displayName:"Minimum %",type:{numeric:!0}},needsImprovementPercent:{displayName:"Needs Improvement %",type:{numeric:!0}},satisfactoryPercent:{displayName:"Satisfactory %",type:{numeric:!0}},goodPercent:{displayName:"Good %",type:{numeric:!0}},veryGoodPercent:{displayName:"Very Good %",type:{numeric:!0}},maximumPercent:{displayName:"Maximum %",type:{numeric:!0}}}},labels:{displayName:"Category labels",properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},labelColor:{displayName:e.data.createDisplayNameGetter("Visual_LabelsFill"),description:e.data.createDisplayNameGetter("Visual_LabelsFillDescription"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},orientation:{displayName:"Orientation",properties:{orientation:{displayName:"Orientation",type:{enumeration:s.type}}}},colors:{displayName:"Colors",properties:{badColor:{type:{fill:{solid:{color:!0}}},displayName:"Bad Color"},needsImprovementColor:{type:{fill:{solid:{color:!0}}},displayName:"Needs Improvement Color"},satisfactoryColor:{type:{fill:{solid:{color:!0}}},displayName:"Satisfactory Color"},goodColor:{type:{fill:{solid:{color:!0}}},displayName:"Good Color"},veryGoodColor:{type:{fill:{solid:{color:!0}}},displayName:"Very Good Color"},bulletColor:{type:{fill:{solid:{color:!0}}},displayName:"Bullet Color"}}},axis:{displayName:"Axis",properties:{axis:{displayName:"Axis",type:{bool:!0}},axisColor:{type:{fill:{solid:{color:!0}}},displayName:"Axis Color"},measureUnits:{type:{text:!0},displayName:"Measure Units "},unitsColor:{type:{fill:{solid:{color:!0}}},displayName:"Units Color"}}}},dataViewMappings:[{conditions:[{Category:{max:1},Value:{max:1},TargetValue:{max:1},Minimum:{max:1},NeedsImprovement:{max:1},Satisfactory:{max:1},Good:{max:1},VeryGood:{max:1},Maximum:{max:1},TargetValue2:{max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{select:[{bind:{to:"Value"}},{bind:{to:"TargetValue"}},{bind:{to:"TargetValue2"}},{bind:{to:"Minimum"}},{bind:{to:"NeedsImprovement"}},{bind:{to:"Satisfactory"}},{bind:{to:"Good"}},{bind:{to:"VeryGood"}},{bind:{to:"Maximum"}}]}}}],supportsHighlight:!0,sorting:{"default":{}},drilldown:{roles:["Category"]}},a}();i.BulletChart=o;var l;!function(e){function t(e){var t=r(e);return t.y+t.height}function i(){s||(s=$("<span/>"),$("body").append(s),o=d3.select($("body").get(0)).append("svg").style({height:"0px",width:"0px",position:"absolute"}).append("text"),l=$("<canvas/>").get(0).getContext("2d"))}function a(e){return i(),o.style(null),o.text(e.text).attr({visibility:"hidden","font-family":e.fontFamily,"font-size":e.fontSize,"font-weight":e.fontWeight,"font-style":e.fontStyle,"white-space":e.whiteSpace||"nowrap"}),o.node().getBBox()}function r(e){var t={fontFamily:e.fontFamily,fontSize:e.fontSize,text:"M"},i=a(t);return i}var s,o,l;e.estimateSvgTextBaselineDelta=t}(l=i.TextMeasurementHelper||(i.TextMeasurementHelper={}));var n=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.options=e;var i=e.clearCatcher;e.valueRects.on("click",function(e,i){d3.event.stopPropagation(),t.handleSelection(e,d3.event.ctrlKey)}),e.rects.on("click",function(e,i){d3.event.stopPropagation(),t.handleSelection(e,d3.event.ctrlKey)}),i.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var i=this.options,a=i.hasHighlights;i.valueRects.style("opacity",function(i){return t.ColumnUtil.getFillOpacity(i.selected,i.highlight,!i.highlight&&e,!i.selected&&a)}),i.rects.style("opacity",function(i){return t.ColumnUtil.getFillOpacity(i.selected,i.highlight,!i.highlight&&e,!i.selected&&a)})},e}();i.BulletWebBehavior=n}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,i=(window.jsCommon,window.powerbi);window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var a=e.visuals.valueFormatter,r=t.AnimatorCommon.GetAnimationDuration;!function(e){e[e.logn=0]="logn",e[e.sqrt=1]="sqrt",e[e.value=2]="value"}(i.WordCloudScaleType||(i.WordCloudScaleType={}));var s=i.WordCloudScaleType,o=function(){function e(e,t){this.defaultViewport=e||{width:0,height:0},this.defaultMargin=t||{top:0,bottom:0,right:0,left:0}}return Object.defineProperty(e.prototype,"margin",{get:function(){return this.marginValue||(this.margin=this.defaultMargin)},set:function(t){this.marginValue=e.restrictToMinMax(t),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this.viewportValue||(this.viewportValue=this.defaultViewport)},set:function(t){this.viewportValue=e.restrictToMinMax(t),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportIn",{get:function(){return this.viewportInValue||this.viewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportInIsZero",{get:function(){return 0===this.viewportIn.width||0===this.viewportIn.height},enumerable:!0,configurable:!0}),e.prototype.update=function(){this.viewportInValue=e.restrictToMinMax({width:this.viewport.width-(this.margin.left+this.margin.right),height:this.viewport.height-(this.margin.top+this.margin.bottom)})},e.restrictToMinMax=function(e){var t=$.extend({},e);return d3.keys(e).forEach(function(i){return t[i]=Math.max(0,e[i])}),t},e}(),l=function(){function i(e){this.durationAnimations=500,this.fakeViewport={width:1500,height:1e3},this.canvasViewport={width:128,height:2048},e&&(this.svg=e.svg||this.svg,this.layout=new o(null,e.margin||i.DefaultMargin),e.animator&&(this.animator=e.animator)),this.isUpdating=!1}return i.prototype.init=function(e){var a=this;this.svg?this.root=this.svg:this.root=d3.select(e.element.get(0)).append("svg"),i.colors=e.style.colorPalette.dataColors,this.hostService=e.host,this.selectionManager=new t.utility.SelectionManager({hostServices:this.hostService}),this.layout||(this.layout=new o(null,i.DefaultMargin)),this.root.classed(i.ClassName,!0),this.root.on("click",function(){a.selectionManager.clear(),a.setSelection(a.wordsSelection)}),this.fontFamily=this.root.style("font-family"),this.main=this.root.append("g"),this.wordsContainerSelection=this.main.append("g").classed(i.Words["class"],!0),this.canvas=document.createElement("canvas")},i.prototype.converter=function(e){var a=this;if(!(e&&e.categorical&&e.categorical.categories&&e.categorical.categories[0]&&e.categorical.categories[0].values&&e.categorical.categories[0].values.length&&e.categorical.categories[0].values.length>0))return null;var r,s,o=e.categorical.categories[0].values,l=i.parseSettings(e,o[0]);return l?(_.isEmpty(e.categorical.values)||_.isEmpty(e.categorical.values[0])||_.isEmpty(e.categorical.values[0].values)||(r=e.categorical.values[0].values),s=o.map(function(s,o){var l,c=e.categorical.categories[0];return l=c.objects&&c.objects[o]?a.getColor(i.Properties.dataPoint.fill,n.util.getRandomColor(),c.objects[o]):a.wordCloudTexts&&a.wordCloudTexts[o]?a.wordCloudTexts[o].color:n.util.getRandomColor(),{text:s,count:r&&r[o]&&!isNaN(r[o])?r[o]:1,index:o,selectionId:t.SelectionId.createWithId(e.categorical.categories[0].identity[o]),color:l}}),{settings:l,texts:s}):null},i.prototype.getColor=function(e,a,r){var s;return s=new t.ColorHelper(i.colors,e,a),n.util.hexToRgb(s.getColorForMeasure(r,""))},i.parseSettings=function(t,r){if(!(t&&t.metadata&&t.metadata.columns&&t.metadata.columns[0]))return null;var s,o,l,n,c,h,u,d,p,g=t.metadata.objects,m=!1,y=!0,f=!0,v=!1;
return p=i.getNumberFromObjects(g,i.Properties.general.maxNumberOfWords,i.DefaultSettings.maxNumberOfWords),o=i.getNumberFromObjects(g,i.Properties.general.minFontSize,i.DefaultSettings.minFontSize),l=i.getNumberFromObjects(g,i.Properties.general.maxFontSize,i.DefaultSettings.maxFontSize),n=i.getNumberFromObjects(g,i.Properties.rotateText.minAngle,i.DefaultSettings.minAngle),c=i.getNumberFromObjects(g,i.Properties.rotateText.maxAngle,i.DefaultSettings.maxAngle),m=e.DataViewObjects.getValue(g,i.Properties.rotateText.show,i.DefaultSettings.isRotateText),h=i.getNumberFromObjects(g,i.Properties.rotateText.maxNumberOfOrientations,i.DefaultSettings.maxNumberOfOrientations),s=a.create({format:a.getFormatString(t.categorical.categories[0].source,i.Properties.general.formatString),value:r}),y=e.DataViewObjects.getValue(g,i.Properties.general.isBrokenText,i.DefaultSettings.isBrokenText),f=e.DataViewObjects.getValue(g,i.Properties.stopWords.show,i.DefaultSettings.isRemoveStopWords),u=e.DataViewObjects.getValue(g,i.Properties.stopWords.words,i.DefaultSettings.stopWords),d="string"==typeof u?u.split(i.StopWordsDelemiter):i.DefaultSettings.stopWordsArray,v=e.DataViewObjects.getValue(g,i.Properties.stopWords.isDefaultStopWords,i.DefaultSettings.isDefaultStopWords),{minFontSize:o,maxFontSize:l,minAngle:n,maxAngle:c,maxNumberOfOrientations:h,valueFormatter:s,isRotateText:m,isBrokenText:y,isRemoveStopWords:f,stopWords:u,stopWordsArray:d,isDefaultStopWords:v,maxNumberOfWords:p}},i.getNumberFromObjects=function(t,i,a){return t?e.DataViewObjects.getValue(t,i,a):a},i.prototype.parseNumber=function(e,t,i,a){void 0===t&&(t=0),void 0===i&&(i=-Number.MAX_VALUE),void 0===a&&(a=Number.MAX_VALUE);var r=Number(e);return isNaN(r)||"string"==typeof e&&0===e.length?t:i>r?i:r>a?a:r},i.prototype.computePositions=function(e,t){var a,r=this,s=this.getCanvasContext(),o=[],l=null;if(!(e&&e.length>0))return null;a=Math.abs(this.parseNumber(this.settings.maxNumberOfWords,i.DefaultSettings.maxNumberOfWords,-1*e.length,e.length)),e.length>a&&(e=e.slice(0,a));for(var n=void 0;n<(this.specialViewport.width>>5)*this.specialViewport.height;n++)o[n]=0;setTimeout(function(){return r.computeCycle(e,s,o,l,t,[],0)},0)},i.prototype.computeCycle=function(e,t,i,a,r,s,o){void 0===s&&(s=[]),void 0===o&&(o=0);var l=e[o],n=1;e.length<=10?n=5:e.length<=25?n=3:e.length<=75?n=1.5:e.length<=100&&(n=1.25),l.x=this.specialViewport.width/n*(Math.random()+.5)>>1,l.y=this.specialViewport.height/n*(Math.random()+.5)>>1,this.generateSprites(t,l,e,o),l.sprite&&this.findPosition(i,l,a)&&(s.push(l),a=this.updateBorders(l,a),l.x-=this.specialViewport.width>>1,l.y-=this.specialViewport.height>>1),++o<e.length&&this.root?this.computeCycle(e,t,i,a,r,s,o):r({data:s,leftBorder:a&&a[0],rightBorder:a&&a[1]})},i.prototype.updateBorders=function(e,t){if(t&&2===t.length){var i=t[0],a=t[1];e.x+e.x0<i.x&&(i.x=e.x+e.x0),e.y+e.y0<i.y&&(i.y=e.y+e.y0),e.x+e.x1>a.x&&(a.x=e.x+e.x1),e.y+e.y1>a.y&&(a.y=e.y+e.y1)}else t=[{x:e.x+e.x0,y:e.y+e.y0},{x:e.x+e.x1,y:e.y+e.y1}];return t},i.prototype.generateSprites=function(e,t,a,r){if(!t.sprite){e.clearRect(0,0,this.canvasViewport.width<<5,this.canvasViewport.height);for(var s,o=0,l=0,n=0,c=a.length,h=[],u=r;c>u;u++){var d=a[u],p=0,g=0;if(e.save(),e.font="normal normal "+(d.size+1)+i.Size+" "+this.fontFamily,p=e.measureText(d.text+"m").width,g=d.size<<1,d.rotate){var m=Math.sin(d.rotate*i.Radians),y=Math.cos(d.rotate*i.Radians),f=p*y,v=p*m,x=g*y,b=g*m;p=Math.max(Math.abs(f+b),Math.abs(f-b))+31>>5<<5,g=Math.floor(Math.max(Math.abs(v+x),Math.abs(v-x)))}else p=p+31>>5<<5;g>n&&(n=g),o+p>=this.canvasViewport.width<<5&&(o=0,l+=n,n=0),e.translate(o+(p>>1),l+(g>>1)),d.rotate&&e.rotate(d.rotate*i.Radians),e.fillText(d.text,0,0),d.padding&&(e.lineWidth=2*d.padding,e.strokeText(d.text,0,0)),e.restore(),d.width=p,d.height=g,d.xOff=o,d.yOff=l,d.x1=p>>1,d.y1=g>>1,d.x0=-d.x1,d.y0=-d.y1,o+=p}s=e.getImageData(0,0,this.canvasViewport.width<<5,this.canvasViewport.height).data,h=[];for(var u=c-1;u>=0;u--){var d=a[u],S=d.width,w=S>>5,C=d.y1-d.y0,D=0,P=0,A=0,N=0;if(d.xOff+S>=this.canvasViewport.width<<5||d.yOff+C>=this.canvasViewport.height)d.sprite=null;else{for(var V=0;C*w>V;V++)h[V]=0;if(null===d.xOff)return;D=d.xOff,P=d.yOff,A=0,N=-1;for(var V=0;C>V;V++){for(var T=0;S>T;T++){var L=w*V+(T>>5),M=(P+V)*(this.canvasViewport.width<<5)+(D+T)<<2,k=s[M]?1<<31-T%32:0;h[L]|=k,A|=k}A?N=V:(d.y0++,C--,V--,P++)}d.y1=d.y0+N,d.sprite=h.slice(0,(d.y1-d.y0)*w)}}}},i.prototype.findPosition=function(e,t,i){for(var a,r,s,o={x:t.x,y:t.y},l=Math.sqrt(this.specialViewport.width*this.specialViewport.width+this.specialViewport.height*this.specialViewport.height),n=Math.random()<.5?1:-1,c=-n;;){if(c+=n,a=this.archimedeanSpiral(c),r=Math.floor(a.x),s=Math.floor(a.y),Math.min(Math.abs(r),Math.abs(s))>=l)break;if(t.x=o.x+r,t.y=o.y+s,!(t.x+t.x0<0||t.y+t.y0<0||t.x+t.x1>this.specialViewport.width||t.y+t.y1>this.specialViewport.height)&&(!i||!this.checkIntersect(t,e))&&(!i||this.checkIntersectOfRectangles(t,i[0],i[1]))){for(var h=t.sprite,u=t.width>>5,d=this.specialViewport.width>>5,p=t.x-(u<<4),g=127&p,m=32-g,y=t.y1-t.y0,f=(t.y+t.y0)*d+(p>>5),v=0;y>v;v++){for(var x=0,b=0;u>=b;b++){var S=x<<m,w=void 0;u>b&&(x=h[v*u+b]),w=u>b?x>>>g:0,e[f+b]|=S|w}f+=d}return t.sprite=null,!0}}return!1},i.prototype.archimedeanSpiral=function(e){var t=this.specialViewport.width/this.specialViewport.height;return e=.1*e,{x:t*e*Math.cos(e),y:e*Math.sin(e)}},i.prototype.checkIntersect=function(e,t){for(var i=this.specialViewport.width>>5,a=e.sprite,r=e.width>>5,s=e.x-(r<<4),o=127&s,l=32-o,n=e.y1-e.y0,c=(e.y+e.y0)*i+(s>>5),h=0;n>h;h++){for(var u=0,d=0;r>=d;d++){var p=0,g=void 0,m=0;if(g=u<<l,r>d&&(u=a[h*r+d]),p=r>d?u>>>o:0,m=(g|p)&t[c+d])return!0}c+=i}return!1},i.prototype.checkIntersectOfRectangles=function(e,t,i){return e.x+e.x1>t.x&&e.x+e.x0<i.x&&e.y+e.y1>t.y&&e.y+e.y0<i.y},i.prototype.getCanvasContext=function(){if(!this.canvasViewport)return null;this.canvas.width=1,this.canvas.height=1;var e=this.canvas.getContext("2d");return this.canvas.width=this.canvasViewport.width<<5,this.canvas.height=this.canvasViewport.height,e=this.canvas.getContext("2d"),e.fillStyle=e.strokeStyle="red",e.textAlign="center",e},i.prototype.getReducedText=function(e){var t=[];return 1===e.length?this.isSingleSentence=!0:this.isSingleSentence=!1,t=this.getBrokenWords(e),t.reduce(function(e,t){return e.some(function(e){return e.index!==t.index&&e.text===t.text?(e.count+=t.count,!0):!1})||e.push(t),e},[])},i.prototype.getBrokenWords=function(e){var t,a=this,r=[],s=/\s/;return this.settings.isBrokenText?(t=new RegExp("["+i.Punctuation.join("\\")+"]","gim"),e.forEach(function(e){if("string"==typeof e.text){var o;if(o=e.text.replace(t," ").split(s),a.settings.isRemoveStopWords){var l=a.settings.stopWordsArray;a.settings.isDefaultStopWords&&(l=l.concat(i.StopWords)),o=o.filter(function(e){return e.length>0&&!l.some(function(t){return e.toLocaleLowerCase()===t.toLocaleLowerCase()})})}o.forEach(function(t){t.length>0&&!s.test(t)&&r.push({text:t,count:e.count,index:e.index,selectionId:e.selectionId,color:e.color})})}else r.push(e)}),r):e},i.prototype.getWords=function(e){var t,i=this,a=0,r=0,s=this.settings.valueFormatter;if(!(e&&e.length>=1))return[];t=e.sort(function(e,t){return t.count-e.count}),a=t[t.length-1].count,r=t[0].count;var o=e.map(function(e){return{text:s.format(e.text),size:i.getFontSize(e.count,a,r),x:0,y:0,rotate:i.getAngle(),padding:1,width:0,height:0,xOff:0,yOff:0,x0:0,y0:0,x1:0,y1:0,color:e.color,selectionId:e.selectionId,wordIndex:e.index}});return this.dataBeforeRender=o,o},i.prototype.getFontSize=function(e,t,a,r){void 0===r&&(r=s.value);var o,l,n,c;if(c=Math.abs(this.parseNumber(this.settings.minFontSize,i.DefaultSettings.minFontSize)),n=Math.abs(this.parseNumber(this.settings.maxFontSize,i.DefaultSettings.maxFontSize)),n>this.layout.viewportIn.width/2&&(n=this.layout.viewportIn.width/2),this.isSingleSentence)return n;if(c>n){var h=c;c=n,n=h}switch(r){case s.logn:o=Math.log(e);case s.sqrt:o=Math.sqrt(e);case s.value:o=e}return l=o>t&&a-t!==0?n*(o-t)/(a-t):0,l=100*l/n,l=l*(n-c)/100+c},i.prototype.getAngle=function(){if(!this.settings||!this.settings.isRotateText)return 0;var e,t,a,r;if(a=Math.abs(this.parseNumber(this.settings.maxNumberOfOrientations,0)),e=this.parseNumber(this.settings.minAngle,0,i.MinAngle,i.MaxAngle),t=this.parseNumber(this.settings.maxAngle,0,i.MinAngle,i.MaxAngle),e>t){var s=e;e=t,t=s}return r=Math.abs((t-e)/a*Math.floor(Math.random()*a)),0!==a?e+r:0},i.prototype.update=function(e){var t=this;if(e&&e.viewport&&e.dataViews&&e.dataViews[0]&&e.viewport&&e.viewport.height>=0&&e.viewport.width>=0&&(e!==this.visualUpdateOptions&&(this.incomingUpdateOptions=e),!this.isUpdating&&this.incomingUpdateOptions!==this.visualUpdateOptions)){this.visualUpdateOptions=this.incomingUpdateOptions,this.layout.viewport=this.visualUpdateOptions.viewport;var i=e.dataViews[0];if(this.layout.viewportInIsZero)return;if(this.durationAnimations=r(this.animator,e.suppressAnimations),this.UpdateSize(),this.data=this.converter(i),!this.data)return;this.settings=this.data.settings,this.wordCloudTexts=this.data.texts,this.computePositions(this.getWords(this.getReducedText(this.data.texts)),function(e){return t.render(e)})}},i.prototype.UpdateSize=function(){var e,t,i;i=Math.sqrt(this.fakeViewport.width*this.fakeViewport.height/(this.layout.viewportIn.width*this.layout.viewportIn.height)),isNaN(i)?t=e=1:(t=this.layout.viewportIn.height*i,e=this.layout.viewportIn.width*i),this.specialViewport={height:t,width:e},this.root.attr({height:this.layout.viewport.height,width:this.layout.viewport.width})},i.prototype.render=function(e){var a=this;if(e&&e.data){this.wordCloudDataView=e;var r,s=this.main.select(i.Words.selector).selectAll(i.Word.selector);this.wordsSelection=s.data(e.data),this.animation(this.wordsSelection,this.durationAnimations).attr("transform",function(e){return t.SVGUtil.translate(e.x,e.y)+" rotate("+e.rotate+")"}).style({"font-size":function(e){return""+e.size+i.Size},fill:function(e){return e.color}}),r=this.wordsSelection.enter().append("svg:text").attr("transform",function(e){return t.SVGUtil.translate(e.x,e.y)+" rotate("+e.rotate+")"}).style("font-size","1px"),this.wordsSelection.on("click",function(e){a.selectionManager.select(e.selectionId,d3.event.ctrlKey).then(function(){return a.setSelection(a.wordsSelection)}),d3.event.stopPropagation()}),this.animation(r,this.durationAnimations).style({"font-size":function(e){return""+e.size+i.Size},fill:function(e){return e.color}}),this.wordsSelection.text(function(e){return e.text}).classed(i.Word["class"],!0),this.wordsSelection.exit().remove(),this.setSelection(this.wordsSelection),setTimeout(function(){a.root&&a.scaleMainView(e,s[0].length&&a.durationAnimations),a.isUpdating=!1,a.incomingUpdateOptions!==a.visualUpdateOptions&&a.update(a.incomingUpdateOptions)},this.durationAnimations+i.RenderDelay)}},i.prototype.setSelection=function(e){var t=this.selectionManager.getSelectionIds();if(t.some(function(t){return!e.data().some(function(e){return e.selectionId.getKey()===t.getKey()})})&&(this.selectionManager.clear(),t=[]),!t.length)return void this.setOpacity(e,i.MaxOpacity,!0);var a=e.filter(function(e){return t.some(function(t){return t.getKey()===e.selectionId.getKey()})});this.setOpacity(e,i.MinOpacity),this.setOpacity(a,i.MaxOpacity)},i.prototype.setOpacity=function(e,t,a){void 0===a&&(a=!1);var r=a?e:this.animation(e);r.style("fill-opacity",t),this.main&&(this.main.style("line-height","14px"),this.animation(this.main,0,this.durationAnimations+i.MinDelay).style("line-height","15px"))},i.prototype.scaleMainView=function(e,i){if(void 0===i&&(i=0),e&&e.leftBorder&&e.rightBorder){var a,r,s,o,l=1,n=this.main.node().getBBox(),c=e.leftBorder,h=e.rightBorder;s=this.layout.viewportIn.width/Math.abs(c.x-h.x),o=this.layout.viewportIn.height/Math.abs(c.y-h.y),l=Math.min(s,o),a=this.layout.margin.left+n.x*l*-1+(this.layout.viewportIn.width-n.width*l)/2,r=this.layout.margin.top+n.y*l*-1+(this.layout.viewportIn.height-n.height*l)/2,this.main.style("line-height","5px"),this.animation(this.main,i).attr("transform",t.SVGUtil.translate(a,r)+" scale("+l+")").style("line-height","10px")}},i.prototype.enumerateObjectInstances=function(e){var a=this,r=[];if(!this.settings)return r;switch(e.objectName){case"general":var s={objectName:"general",displayName:"general",selector:null,properties:{maxNumberOfWords:this.settings.maxNumberOfWords,minFontSize:this.settings.minFontSize,maxFontSize:this.settings.maxFontSize,isBrokenText:this.settings.isBrokenText}};r.push(s);break;case"dataPoint":if(!this.wordCloudDataView||!this.wordCloudDataView.data)return;var o=this.dataBeforeRender,l=[];o.forEach(function(e){-1===l.indexOf(e.wordIndex)&&(l.push(e.wordIndex),r.push({objectName:"dataPoint",displayName:a.data.texts[e.wordIndex].text,selector:t.ColorHelper.normalizeSelector(e.selectionId.getSelector(),!1),properties:{fill:{solid:{color:e.color}}}}))});break;case"rotateText":var n={objectName:"rotateText",displayName:"Rotate Text",selector:null,properties:{show:this.settings.isRotateText,minAngle:this.settings.minAngle,maxAngle:this.settings.maxAngle,maxNumberOfOrientations:this.settings.maxNumberOfOrientations}};r.push(n);break;case"stopWords":var c={objectName:"stopWords",displayName:"Stop Words",selector:null,properties:{show:this.settings.isRemoveStopWords,isDefaultStopWords:this.settings.isDefaultStopWords,words:this.settings.stopWords||this.settings.stopWordsArray.join(i.StopWordsDelemiter)}};r.push(c)}return r},i.prototype.animation=function(e,t,i,a){return void 0===t&&(t=0),void 0===i&&(i=0),e.transition().delay(i).duration(t).each("end",a)},i.prototype.destroy=function(){this.root=null,this.canvas=null},i.ClassName="wordCloud",i.Properties={general:{formatString:{objectName:"general",propertyName:"formatString"},maxNumberOfWords:{objectName:"general",propertyName:"maxNumberOfWords"},minFontSize:{objectName:"general",propertyName:"minFontSize"},maxFontSize:{objectName:"general",propertyName:"maxFontSize"},isBrokenText:{objectName:"general",propertyName:"isBrokenText"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}},stopWords:{show:{objectName:"stopWords",propertyName:"show"},isDefaultStopWords:{objectName:"stopWords",propertyName:"isDefaultStopWords"},words:{objectName:"stopWords",propertyName:"words"}},rotateText:{show:{objectName:"rotateText",propertyName:"show"},minAngle:{objectName:"rotateText",propertyName:"minAngle"},maxAngle:{objectName:"rotateText",propertyName:"maxAngle"},maxNumberOfOrientations:{objectName:"rotateText",propertyName:"maxNumberOfOrientations"}}},i.Words={"class":"words",selector:".words"},i.Word={"class":"word",selector:".word"},i.Size="px",i.StopWordsDelemiter=" ",i.Radians=Math.PI/180,i.MinAngle=-180,i.MaxAngle=180,i.MaxNumberOfWords=2500,i.MinOpacity=.2,i.MaxOpacity=1,i.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:"Category"},{name:"Values",kind:e.VisualDataRoleKind.Measure,displayName:"Values"}],dataViewMappings:[{conditions:[{Category:{min:1,max:1},Values:{min:0,max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{count:i.MaxNumberOfWords}}},values:{"for":{"in":"Values"}}}}],sorting:{implicit:{clauses:[{role:"Values",direction:2}]}},objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}},maxNumberOfWords:{displayName:"Max number of words",type:{numeric:!0}},minFontSize:{displayName:"Min Font",type:{numeric:!0}},maxFontSize:{displayName:"Max Font",type:{numeric:!0}},isBrokenText:{displayName:"Word-breaking",type:{bool:!0}},isRemoveStopWords:{displayName:"Stop Words",type:{bool:!0}}}},dataPoint:{displayName:"Data colors",properties:{fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}}}},stopWords:{displayName:"Stop Words",properties:{show:{displayName:"Show",type:{bool:!0}},isDefaultStopWords:{displayName:"Default Stop Words",type:{bool:!0}},words:{displayName:"Words",type:{text:!0}}}},rotateText:{displayName:"Rotate Text",properties:{show:{displayName:"Show",type:{bool:!0}},minAngle:{displayName:"Min Angle",type:{numeric:!0}},maxAngle:{displayName:"Max Angle",type:{numeric:!0}},maxNumberOfOrientations:{displayName:"Max number of orientations",type:{numeric:!0}}}}}},i.Punctuation=["!",".",":","'",";",",","!","@","#","$","%","^","&","*","(",")","[","]",'"',"\\","/","-","_","+","="],i.StopWords=["a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your"],i.DefaultSettings={minFontSize:20,maxFontSize:100,minAngle:-60,maxAngle:90,maxNumberOfOrientations:2,isRotateText:!1,isBrokenText:!0,isRemoveStopWords:!1,stopWordsArray:[],stopWords:void 0,isDefaultStopWords:!1,maxNumberOfWords:200},i.RenderDelay=50,i.MinDelay=10,i.DefaultMargin={top:10,right:10,bottom:10,left:10},i}();i.WordCloud=l;var n;!function(e){var t;!function(e){function t(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,i,a){return t+t+i+i+a+a});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?"rgb("+parseInt(i[1],16)+","+parseInt(i[2],16)+","+parseInt(i[3],16)+")":null}function i(){var e=Math.floor(255*Math.random()),t=Math.floor(255*Math.random()),i=Math.floor(255*Math.random());return"rgb("+e+","+t+","+i+")"}e.hexToRgb=t,e.getRandomColor=i}(t=e.util||(e.util={}))}(n||(n={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r,s=a.CssConstants.createClassAndSelector,o=a.PixelConverter;!function(e){function t(e){return new l(e)}e.createTableView=t}(r=i.TableViewFactory||(i.TableViewFactory={}));var l=function(){function e(t){this.options=$.extend(!0,{},t),this.options.baseContainer.style("overflow-y","auto").attr("drag-resize-disabled",!0),this.scrollContainer=t.baseContainer.append("div").attr("class","scrollRegion"),this.visibleGroupContainer=this.scrollContainer.append("div").attr("class","visibleGroup"),e.SetDefaultOptions(t)}return e.SetDefaultOptions=function(t){t.rowHeight=t.rowHeight||e.defaultRowHeight},e.prototype.rowHeight=function(e){return this.options.rowHeight=Math.ceil(e),this},e.prototype.columnWidth=function(e){return this.options.columnWidth=Math.ceil(e),this},e.prototype.orientation=function(e){return this.options.orientation=e,this},e.prototype.rows=function(e){return this.options.rows=Math.ceil(e),this},e.prototype.columns=function(e){return this.options.columns=Math.ceil(e),this},e.prototype.data=function(e,t,i){return void 0===i&&(i=!1),this._data=e,this.getDatumIndex=t,this.setTotalRows(),i&&$(this.options.baseContainer.node()).scrollTop(0),this},e.prototype.viewport=function(e){return this.options.viewport=e,this},e.prototype.empty=function(){this._data=[],this.render()},e.prototype.setTotalRows=function(){var t=this._data.length,i=Math.min(this.options.rows,t),a=Math.min(this.options.columns,t);a>0&&i>0?(this._totalColumns=a,this._totalRows=i):i>0?(this._totalRows=i,this._totalColumns=Math.ceil(t/i)):a>0?(this._totalColumns=a,this._totalRows=Math.ceil(t/a)):(this._totalColumns=e.defaultColumns,this._totalRows=Math.ceil(t/e.defaultColumns))},e.prototype.render=function(){var t=this.options,i=this.visibleGroupContainer,a=t.rowHeight||e.defaultRowHeight,r=[],s=t.rows,o=t.columns,l=this._data.length,s=t.rows>l?l:t.rows,o=t.columns>l?l:t.columns;if(0===o&&0===s?t.orientation===h.HORIZONTAL?(o=l,s=1):(o=1,s=l):0===o&&s>0?o=Math.ceil(l/s):o>0&&0===s&&(s=Math.ceil(l/o)),this.options.orientation===h.VERTICAL){var n=s;s=o,o=n}else this.options.orientation===h.HORIZONTAL&&(0===s&&(s=this._totalRows),0===o&&(o=this._totalColumns));for(var c=0,u=0,d=0;s>d;d++)if(this.options.orientation===h.VERTICAL&&0===t.rows&&l%t.columns>0&&t.columns<=l)l%t.columns>d?(c=d*Math.ceil(l/t.columns),u=c+Math.ceil(l/t.columns),r.push(this._data.slice(c,u))):(r.push(this._data.slice(u,u+Math.floor(l/t.columns))),u+=Math.floor(l/t.columns));else if(this.options.orientation===h.HORIZONTAL&&0===t.columns&&l%t.rows>0&&t.rows<=l)l%t.rows>d?(c=d*Math.ceil(l/t.rows),u=c+Math.ceil(l/t.rows),r.push(this._data.slice(c,u))):(r.push(this._data.slice(u,u+Math.floor(l/t.rows))),u+=Math.floor(l/t.rows));else{var u=d*o;r.push(this._data.slice(u,u+o))}i.selectAll(".row").remove();var p=i.selectAll(".row").data(r).enter().append("div").classed("row",!0).selectAll(".cell").data(function(e){return e});p.enter().append("div").classed("cell",!0).call(function(e){return t.enter(e)}),p.order();var g=i.selectAll(".cell:not(.transitioning)");if(g.call(function(e){return t.update(e)}),g.style({height:a>0?a+"px":"auto"}),this.options.orientation===h.VERTICAL){for(var m=0,d=0;d<r.length;d++)0!==r[d].length&&(m=d+1);g.style({width:"100%"});var y=i.selectAll("div.row");y.style({width:t.columnWidth>0?t.columnWidth+"px":100/m+"%"})}else g.style({width:t.columnWidth>0?t.columnWidth+"px":100/o+"%"});p.exit().call(function(e){return t.exit(e)}).remove()},e.defaultRowHeight=0,e.defaultColumns=1,e}();i.chicletSlicerProps={general:{orientation:{objectName:"general",propertyName:"orientation"},columns:{objectName:"general",propertyName:"columns"},rows:{objectName:"general",propertyName:"rows"},showDisabled:{objectName:"general",propertyName:"showDisabled"},multiselect:{objectName:"general",propertyName:"multiselect"},selection:{objectName:"general",propertyName:"selection"}},header:{show:{objectName:"header",propertyName:"show"},title:{objectName:"header",propertyName:"title"},fontColor:{objectName:"header",propertyName:"fontColor"},background:{objectName:"header",propertyName:"background"},outline:{objectName:"header",propertyName:"outline"},textSize:{objectName:"header",propertyName:"textSize"},outlineColor:{objectName:"header",propertyName:"outlineColor"},outlineWeight:{objectName:"header",propertyName:"outlineWeight"}},rows:{fontColor:{objectName:"rows",propertyName:"fontColor"},textSize:{objectName:"rows",propertyName:"textSize"},height:{objectName:"rows",propertyName:"height"},width:{objectName:"rows",propertyName:"width"},background:{objectName:"rows",propertyName:"background"},transparency:{objectName:"rows",propertyName:"transparency"},selectedColor:{objectName:"rows",propertyName:"selectedColor"},hoverColor:{objectName:"rows",propertyName:"hoverColor"},unselectedColor:{objectName:"rows",propertyName:"unselectedColor"},disabledColor:{objectName:"rows",propertyName:"disabledColor"},outline:{objectName:"rows",propertyName:"outline"},outlineColor:{objectName:"rows",propertyName:"outlineColor"},outlineWeight:{objectName:"rows",propertyName:"outlineWeight"},borderStyle:{objectName:"rows",propertyName:"borderStyle"}},images:{imageSplit:{objectName:"images",propertyName:"imageSplit"},stretchImage:{objectName:"images",propertyName:"stretchImage"},bottomImage:{objectName:"images",propertyName:"bottomImage"}},selectedPropertyIdentifier:{objectName:"general",propertyName:"selected"},filterPropertyIdentifier:{objectName:"general",propertyName:"filter"},formatString:{objectName:"general",propertyName:"formatString"},hasSavedSelection:!0};var n;!function(t){t.ROUNDED="Rounded",t.CUT="Cut",t.SQUARE="Square",t.type=e.createEnumType([{value:t.ROUNDED,displayName:t.ROUNDED},{value:t.CUT,displayName:t.CUT},{value:t.SQUARE,displayName:t.SQUARE}])}(n||(n={}));var c;!function(t){t.INPLACE="Inplace",t.BOTTOM="Bottom",t.HIDE="Hide",t.type=e.createEnumType([{value:t.INPLACE,displayName:t.INPLACE},{value:t.BOTTOM,displayName:t.BOTTOM},{value:t.HIDE,displayName:t.HIDE}])}(c||(c={}));var h;!function(t){t.HORIZONTAL="Horizontal",t.VERTICAL="Vertical",t.type=e.createEnumType([{value:t.HORIZONTAL,displayName:t.HORIZONTAL},{value:t.VERTICAL,displayName:t.VERTICAL}])}(h||(h={}));var u=function(){function a(e){e&&e.behavior&&(this.behavior=e.behavior),this.behavior||(this.behavior=new g)}return a.DefaultStyleProperties=function(){return{general:{orientation:h.VERTICAL,columns:3,rows:0,multiselect:!0,showDisabled:c.INPLACE,selection:null},margin:{top:50,bottom:50,right:50,left:50},header:{borderBottomWidth:1,show:!0,outline:"BottomOnly",fontColor:"#a6a6a6",background:null,textSize:10,outlineColor:"#a6a6a6",outlineWeight:1,title:""},headerText:{marginLeft:8,marginTop:0},slicerText:{textSize:10,height:0,width:0,fontColor:"#666666",hoverColor:"#212121",selectedColor:"#BDD7EE",unselectedColor:"#ffffff",disabledColor:"grey",marginLeft:8,outline:"Frame",background:null,transparency:0,outlineColor:"#000000",outlineWeight:1,borderStyle:"Cut"},slicerItemContainer:{marginTop:5,marginLeft:0},images:{imageSplit:50,stretchImage:!1,bottomImage:!1}}},a.converter=function(a,r,s){if(a&&a.categorical&&a.categorical.categories&&a.categorical.categories[0]&&a.categorical.categories[0].values&&a.categorical.categories[0].values.length>0){var o=new d.ChicletSlicerConverter(a,s);o.convert();var l,n=this.DefaultStyleProperties(),c=a.metadata.objects;c&&(n.general.orientation=e.DataViewObjects.getValue(c,i.chicletSlicerProps.general.orientation,n.general.orientation),n.general.columns=e.DataViewObjects.getValue(c,i.chicletSlicerProps.general.columns,n.general.columns),n.general.rows=e.DataViewObjects.getValue(c,i.chicletSlicerProps.general.rows,n.general.rows),n.general.multiselect=e.DataViewObjects.getValue(c,i.chicletSlicerProps.general.multiselect,n.general.multiselect),n.general.showDisabled=e.DataViewObjects.getValue(c,i.chicletSlicerProps.general.showDisabled,n.general.showDisabled),n.general.selection=e.DataViewObjects.getValue(a.metadata.objects,i.chicletSlicerProps.general.selection,n.general.selection),n.header.show=e.DataViewObjects.getValue(c,i.chicletSlicerProps.header.show,n.header.show),n.header.title=e.DataViewObjects.getValue(c,i.chicletSlicerProps.header.title,n.header.title),n.header.fontColor=e.DataViewObjects.getFillColor(c,i.chicletSlicerProps.header.fontColor,n.header.fontColor),n.header.background=e.DataViewObjects.getFillColor(c,i.chicletSlicerProps.header.background,n.header.background),n.header.textSize=e.DataViewObjects.getValue(c,i.chicletSlicerProps.header.textSize,n.header.textSize),n.header.outline=e.DataViewObjects.getValue(c,i.chicletSlicerProps.header.outline,n.header.outline),n.header.outlineColor=e.DataViewObjects.getFillColor(c,i.chicletSlicerProps.header.outlineColor,n.header.outlineColor),n.header.outlineWeight=e.DataViewObjects.getValue(c,i.chicletSlicerProps.header.outlineWeight,n.header.outlineWeight),n.slicerText.textSize=e.DataViewObjects.getValue(c,i.chicletSlicerProps.rows.textSize,n.slicerText.textSize),n.slicerText.height=e.DataViewObjects.getValue(c,i.chicletSlicerProps.rows.height,n.slicerText.height),n.slicerText.width=e.DataViewObjects.getValue(c,i.chicletSlicerProps.rows.width,n.slicerText.width),n.slicerText.selectedColor=e.DataViewObjects.getFillColor(c,i.chicletSlicerProps.rows.selectedColor,n.slicerText.selectedColor),n.slicerText.hoverColor=e.DataViewObjects.getFillColor(c,i.chicletSlicerProps.rows.hoverColor,n.slicerText.hoverColor),n.slicerText.unselectedColor=e.DataViewObjects.getFillColor(c,i.chicletSlicerProps.rows.unselectedColor,n.slicerText.unselectedColor),n.slicerText.disabledColor=e.DataViewObjects.getFillColor(c,i.chicletSlicerProps.rows.disabledColor,n.slicerText.disabledColor),n.slicerText.background=e.DataViewObjects.getFillColor(c,i.chicletSlicerProps.rows.background,n.slicerText.background),n.slicerText.transparency=e.DataViewObjects.getValue(c,i.chicletSlicerProps.rows.transparency,n.slicerText.transparency),n.slicerText.fontColor=e.DataViewObjects.getFillColor(c,i.chicletSlicerProps.rows.fontColor,n.slicerText.fontColor),n.slicerText.outline=e.DataViewObjects.getValue(c,i.chicletSlicerProps.rows.outline,n.slicerText.outline),n.slicerText.outlineColor=e.DataViewObjects.getFillColor(c,i.chicletSlicerProps.rows.outlineColor,n.slicerText.outlineColor),n.slicerText.outlineWeight=e.DataViewObjects.getValue(c,i.chicletSlicerProps.rows.outlineWeight,n.slicerText.outlineWeight),n.slicerText.borderStyle=e.DataViewObjects.getValue(c,i.chicletSlicerProps.rows.borderStyle,n.slicerText.borderStyle),n.images.imageSplit=e.DataViewObjects.getValue(c,i.chicletSlicerProps.images.imageSplit,n.images.imageSplit),n.images.stretchImage=e.DataViewObjects.getValue(c,i.chicletSlicerProps.images.stretchImage,n.images.stretchImage),n.images.bottomImage=e.DataViewObjects.getValue(c,i.chicletSlicerProps.images.bottomImage,n.images.bottomImage));var h=a.categorical.categories[0];return l={categorySourceName:h.source.displayName,formatString:t.valueFormatter.getFormatString(h.source,i.chicletSlicerProps.formatString),slicerSettings:n,slicerDataPoints:o.dataPoints},l.hasSelectionOverride=o.hasSelectionOverride,l}},a.prototype.init=function(e){this.element=e.element,this.currentViewport=e.viewport,this.behavior&&(this.interactivityService=t.createInteractivityService(e.host)),this.hostServices=e.host,this.hostServices.canSelect=a.canSelect,this.settings=a.DefaultStyleProperties(),this.initContainer()},a.canSelect=function(e){var t=e.data;return!(t.length>1&&t.some(function(e){return e&&e.data&&e.data.length>1}))},a.prototype.update=function(t){if(t&&t.dataViews&&t.dataViews[0]&&t.viewport){var i=this.dataView;this.dataView=t.dataViews[0];var a=!0;i&&(a=!e.DataViewAnalysis.hasSameCategoryIdentity(i,this.dataView)),t.viewport.height===this.currentViewport.height&&t.viewport.width===this.currentViewport.width?this.waitingForData=!1:this.currentViewport=t.viewport,this.updateInternal(a)}},a.prototype.onResizing=function(e){this.currentViewport=e,this.updateInternal(!1)},a.prototype.enumerateObjectInstances=function(e){var t=this.slicerData;if(t){var i=e.objectName;switch(i){case"rows":return this.enumerateRows(t);case"header":return this.enumerateHeader(t);case"general":return this.enumerateGeneral(t);case"images":return this.enumerateImages(t)}}},a.prototype.enumerateHeader=function(e){var t=this.settings;return[{selector:null,objectName:"header",properties:{show:t.header.show,title:t.header.title,fontColor:t.header.fontColor,background:t.header.background,textSize:t.header.textSize,outline:t.header.outline,outlineColor:t.header.outlineColor,outlineWeight:t.header.outlineWeight}}]},a.prototype.enumerateRows=function(e){var t=this.settings;return[{selector:null,objectName:"rows",properties:{textSize:t.slicerText.textSize,height:t.slicerText.height,width:t.slicerText.width,background:t.slicerText.background,transparency:t.slicerText.transparency,selectedColor:t.slicerText.selectedColor,hoverColor:t.slicerText.hoverColor,unselectedColor:t.slicerText.unselectedColor,disabledColor:t.slicerText.disabledColor,outline:t.slicerText.outline,outlineColor:t.slicerText.outlineColor,outlineWeight:t.slicerText.outlineWeight,fontColor:t.slicerText.fontColor,borderStyle:t.slicerText.borderStyle}}]},a.prototype.enumerateGeneral=function(e){var t=this.settings;return[{selector:null,objectName:"general",properties:{orientation:t.general.orientation,columns:t.general.columns,rows:t.general.rows,showDisabled:t.general.showDisabled,multiselect:t.general.multiselect}}]},a.prototype.enumerateImages=function(e){var t=this.settings;return[{selector:null,objectName:"images",properties:{imageSplit:t.images.imageSplit,
stretchImage:t.images.stretchImage,bottomImage:t.images.bottomImage}}]},a.prototype.updateInternal=function(t){var i=this;this.updateSlicerBodyDimensions();var r="Select All",s=a.converter(this.dataView,r,this.interactivityService);if(!s)return void this.tableView.empty();this.interactivityService&&this.interactivityService.applySelectionStateToData(s.slicerDataPoints),s.slicerSettings.header.outlineWeight=s.slicerSettings.header.outlineWeight<0?0:s.slicerSettings.header.outlineWeight,s.slicerSettings.slicerText.outlineWeight=s.slicerSettings.slicerText.outlineWeight<0?0:s.slicerSettings.slicerText.outlineWeight,s.slicerSettings.slicerText.height=s.slicerSettings.slicerText.height<0?0:s.slicerSettings.slicerText.height,s.slicerSettings.slicerText.width=s.slicerSettings.slicerText.width<0?0:s.slicerSettings.slicerText.width,s.slicerSettings.images.imageSplit=s.slicerSettings.images.imageSplit<0?0:s.slicerSettings.images.imageSplit,s.slicerSettings.general.columns=s.slicerSettings.general.columns<0?0:s.slicerSettings.general.columns,s.slicerSettings.general.rows=s.slicerSettings.general.rows<0?0:s.slicerSettings.general.rows,s.slicerSettings.general.getSavedSelection=function(){try{return JSON.parse(i.slicerData.slicerSettings.general.selection)||[]}catch(e){return[]}},s.slicerSettings.general.setSavedSelection=function(e){i.isSelectionSaved=!0,i.hostServices.persistProperties({merge:[{objectName:"general",selector:null,properties:{selection:e&&JSON.stringify(e)||""}}]})},this.slicerData?this.isSelectionSaved?this.isSelectionLoaded=!0:this.isSelectionLoaded=this.slicerData.slicerSettings.general.selection===s.slicerSettings.general.selection:this.isSelectionLoaded=!1,this.slicerData=s,this.settings=this.slicerData.slicerSettings,this.settings.general.showDisabled===c.BOTTOM?s.slicerDataPoints.sort(function(e,t){return e.selectable===t.selectable?0:e.selectable&&!t.selectable?-1:1}):this.settings.general.showDisabled===c.HIDE&&(s.slicerDataPoints=s.slicerDataPoints.filter(function(e){return e.selectable}));var o=this.settings.slicerText.height;if(0===o){var l=a.cellTotalInnerPaddings+a.cellTotalInnerBorders,n=a.getChicletTextProperties(this.settings.slicerText.textSize);o=e.TextMeasurementService.estimateSvgTextHeight(n)+e.TextMeasurementService.estimateSvgTextBaselineDelta(n)+l;var h=_.any(s.slicerDataPoints,function(e){return""!==e.imageURL&&"undefined"!=typeof e.imageURL});h&&(o+=100)}this.tableView.rowHeight(o).columnWidth(this.settings.slicerText.width).orientation(this.settings.general.orientation).rows(this.settings.general.rows).columns(this.settings.general.columns).data(s.slicerDataPoints,function(e){return $.inArray(e,s.slicerDataPoints)},t).viewport(this.getSlicerBodyViewport(this.currentViewport)).render()},a.prototype.initContainer=function(){var i=this,s=this.settings,l=this.getSlicerBodyViewport(this.currentViewport),n=d3.select(this.element.get(0)).append("div").classed(a.Container["class"],!0);this.slicerHeader=n.append("div").classed(a.Header["class"],!0),this.slicerHeader.append("span").classed(a.Clear["class"],!0).attr("title","Clear"),this.slicerHeader.append("div").classed(a.HeaderText["class"],!0).style({"margin-left":o.toString(s.headerText.marginLeft),"margin-top":o.toString(s.headerText.marginTop),"border-style":this.getBorderStyle(s.header.outline),"border-color":s.header.outlineColor,"border-width":this.getBorderWidth(s.header.outline,s.header.outlineWeight),"font-size":o.fromPoint(s.header.textSize)}),this.slicerBody=n.append("div").classed(a.Body["class"],!0).classed("slicerBody-horizontal",s.general.orientation===h.HORIZONTAL).classed("slicerBody-vertical",s.general.orientation===h.VERTICAL).style({height:o.toString(l.height),width:"100%"});var c=function(e){var t=i.settings,r=e.append("li").classed(a.ItemContainer["class"],!0).style({"margin-left":o.toString(t.slicerItemContainer.marginLeft)});r.append("div").classed("slicer-img-wrapper",!0),r.append("div").classed("slicer-text-wrapper",!0).append("span").classed(a.LabelText["class"],!0).style({"font-size":o.fromPoint(t.slicerText.textSize)})},u=function(r){var s=i.settings,l=i.slicerData;if(l&&s){i.slicerHeader.classed("hidden",!s.header.show),i.slicerHeader.select(a.HeaderText.selector).text(""!==s.header.title.trim()?s.header.title.trim():i.slicerData.categorySourceName).style({"border-style":i.getBorderStyle(s.header.outline),"border-color":s.header.outlineColor,"border-width":i.getBorderWidth(s.header.outline,s.header.outlineWeight),color:s.header.fontColor,"background-color":s.header.background,"font-size":o.fromPoint(s.header.textSize)}),i.slicerBody.classed("slicerBody-horizontal",s.general.orientation===h.HORIZONTAL).classed("slicerBody-vertical",s.general.orientation===h.VERTICAL);var n=r.selectAll(a.LabelText.selector),c=a.getChicletTextProperties(s.slicerText.textSize),u=l.formatString;n.text(function(r){var o=t.valueFormatter.format(r.category,u);return c.text=o,0===i.settings.slicerText.width?e.TextMeasurementService.getTailoredTextOrDefault(c,i.currentViewport.width/i.settings.general.columns-a.chicletTotalInnerRightLeftPaddings-a.cellTotalInnerBorders-s.slicerText.outlineWeight):e.TextMeasurementService.getTailoredTextOrDefault(c,i.settings.slicerText.width-a.chicletTotalInnerRightLeftPaddings-a.cellTotalInnerBorders-s.slicerText.outlineWeight)});var d=r.selectAll(".slicer-img-wrapper");if(d.style("height",s.images.imageSplit+"%").classed("hidden",function(e){return e.imageURL?s.images.imageSplit<10?!0:void 0:!0}).style("display",function(e){return e.imageURL?"flex":"none"}).classed("stretchImage",s.images.stretchImage).classed("bottomImage",s.images.bottomImage).style("background-image",function(e){return e.imageURL?"url("+e.imageURL+")":""}),r.selectAll(".slicer-text-wrapper").style("height",function(e){return e.imageURL?100-s.images.imageSplit+"%":"100%"}).classed("hidden",function(e){return s.images.imageSplit>90?!0:void 0}),r.selectAll(".slicerItemContainer").style({color:s.slicerText.fontColor,"border-style":i.getBorderStyle(s.slicerText.outline),"border-color":s.slicerText.outlineColor,"border-width":i.getBorderWidth(s.slicerText.outline,s.slicerText.outlineWeight),"font-size":o.fromPoint(s.slicerText.textSize),"border-radius":i.getBorderRadius(s.slicerText.borderStyle)}),s.slicerText.background?i.slicerBody.style("background-color",m.util.hexToRGBString(s.slicerText.background,(100-s.slicerText.transparency)/100)):i.slicerBody.style("background-color",null),i.interactivityService&&i.slicerBody){var p=i.slicerBody.attr("width",i.currentViewport.width),g=p.selectAll(a.ItemContainer.selector),y=p.selectAll(a.LabelText.selector),f=p.selectAll(a.Input.selector),v=i.slicerHeader.select(a.Clear.selector),x={dataPoints:l.slicerDataPoints,slicerItemContainers:g,slicerItemLabels:y,slicerItemInputs:f,slicerClear:v,interactivityService:i.interactivityService,slicerSettings:l.slicerSettings,isSelectionLoaded:i.isSelectionLoaded};i.interactivityService.bind(l.slicerDataPoints,i.behavior,x,{overrideSelectionFromData:!0,hasSelectionOverride:l.hasSelectionOverride}),i.behavior.styleSlicerInputs(r.select(a.ItemContainer.selector),i.interactivityService.hasSelection())}else i.behavior.styleSlicerInputs(r.select(a.ItemContainer.selector),!1)}},d=function(e){e.remove()},p={rowHeight:this.getRowHeight(),columnWidth:this.settings.slicerText.width,orientation:this.settings.general.orientation,rows:this.settings.general.rows,columns:this.settings.general.columns,enter:c,exit:d,update:u,loadMoreData:function(){return i.onLoadMoreData()},scrollEnabled:!0,viewport:this.getSlicerBodyViewport(this.currentViewport),baseContainer:this.slicerBody};this.tableView=r.createTableView(p)},a.prototype.onLoadMoreData=function(){!this.waitingForData&&this.dataView.metadata&&this.dataView.metadata.segment&&(this.hostServices.loadMoreData(),this.waitingForData=!0)},a.prototype.getSlicerBodyViewport=function(e){var t=this.settings,i=t.header.show?this.getHeaderHeight():0,a=e.height-(i+t.header.borderBottomWidth);return{height:a,width:e.width}},a.prototype.updateSlicerBodyDimensions=function(){var e=this.getSlicerBodyViewport(this.currentViewport);this.slicerBody.style({height:o.toString(e.height),width:"100%"})},a.getChicletTextProperties=function(e){return{fontFamily:a.DefaultFontFamily,fontSize:o.fromPoint(e||a.DefaultFontSizeInPt)}},a.prototype.getHeaderHeight=function(){return e.TextMeasurementService.estimateSvgTextHeight(a.getChicletTextProperties(this.settings.header.textSize))},a.prototype.getRowHeight=function(){var t=this.settings.slicerText;return 0!==t.height?t.height:e.TextMeasurementService.estimateSvgTextHeight(a.getChicletTextProperties(t.textSize))},a.prototype.getBorderStyle=function(e){return"0px"===e?"none":"solid"},a.prototype.getBorderWidth=function(e,t){switch(e){case"None":return"0px";case"BottomOnly":return"0px 0px "+t+"px 0px";case"TopOnly":return t+"px 0px 0px 0px";case"TopBottom":return t+"px 0px "+t+"px 0px";case"LeftRight":return"0px "+t+"px 0px "+t+"px";case"Frame":return t+"px";default:return e.replace("1",t.toString())}},a.prototype.getBorderRadius=function(e){switch(e){case n.ROUNDED:return"10px";case n.SQUARE:return"0px";default:return"5px"}},a.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:"Category"},{name:"Values",kind:e.VisualDataRoleKind.Measure,displayName:"Values"},{name:"Image",kind:e.VisualDataRoleKind.Grouping,displayName:"Image"}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{selection:{displayName:"Selection",type:{text:!0}},orientation:{displayName:"Orientation",type:{enumeration:h.type}},columns:{displayName:"Columns",type:{numeric:!0}},rows:{displayName:"Rows",type:{numeric:!0}},showDisabled:{displayName:"Show Disabled",type:{enumeration:c.type}},multiselect:{displayName:"Multiple selection",type:{bool:!0}},selected:{type:{bool:!0}},filter:{type:{filter:{}}},selfFilter:{type:{filter:{selfFilter:!0}}},selfFilterEnabled:{type:{operations:{searchEnabled:!0}}},formatString:{type:{formatting:{formatString:!0}}}}},header:{displayName:e.data.createDisplayNameGetter("Visual_Header"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},title:{displayName:"Title",type:{text:!0}},fontColor:{displayName:e.data.createDisplayNameGetter("Visual_FontColor"),type:{fill:{solid:{color:!0}}}},background:{displayName:e.data.createDisplayNameGetter("Visual_Background"),type:{fill:{solid:{color:!0}}}},outline:{displayName:e.data.createDisplayNameGetter("Visual_Outline"),type:{formatting:{outline:!0}}},textSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{numeric:!0}},outlineColor:{displayName:"Outline Color",type:{fill:{solid:{color:!0}}}},outlineWeight:{displayName:"Outline Weight",type:{numeric:!0}}}},rows:{displayName:"Chiclets",properties:{fontColor:{displayName:"Text color",type:{fill:{solid:{color:!0}}}},textSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{numeric:!0}},height:{displayName:"Height",type:{numeric:!0}},width:{displayName:"Width",type:{numeric:!0}},selectedColor:{displayName:"Selected Color",type:{fill:{solid:{color:!0}}}},hoverColor:{displayName:"Hover Color",type:{fill:{solid:{color:!0}}}},unselectedColor:{displayName:"Unselected Color",type:{fill:{solid:{color:!0}}}},disabledColor:{displayName:"Disabled Color",type:{fill:{solid:{color:!0}}}},background:{displayName:e.data.createDisplayNameGetter("Visual_Background"),type:{fill:{solid:{color:!0}}}},transparency:{displayName:"Transparency",description:"Set transparency for background color",type:{numeric:!0}},outline:{displayName:e.data.createDisplayNameGetter("Visual_Outline"),type:{formatting:{outline:!0}}},outlineColor:{displayName:"Outline Color",type:{fill:{solid:{color:!0}}}},outlineWeight:{displayName:"Outline Weight",type:{numeric:!0}},borderStyle:{displayName:"Outline Style",type:{enumeration:n.type}}}},images:{displayName:"Images",properties:{imageSplit:{displayName:"Image Split",type:{numeric:!0}},stretchImage:{displayName:"Stretch image",type:{bool:!0}},bottomImage:{displayName:"Bottom image",type:{bool:!0}}}}},dataViewMappings:[{conditions:[{Category:{max:1},Image:{min:0,max:1},Values:{min:0,max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{count:1e4}}},values:{group:{by:"Image",select:[{bind:{to:"Values"}}],dataReductionAlgorithm:{top:{count:1e4}}}},includeEmptyGroups:!0}}],supportsHighlight:!0,sorting:{"default":{}},suppressDefaultTitle:!0},a.DefaultFontFamily="Segoe UI, Tahoma, Verdana, Geneva, sans-serif",a.DefaultFontSizeInPt=11,a.cellTotalInnerPaddings=8,a.cellTotalInnerBorders=2,a.chicletTotalInnerRightLeftPaddings=14,a.ItemContainer=s("slicerItemContainer"),a.HeaderText=s("headerText"),a.Container=s("chicletSlicer"),a.LabelText=s("slicerText"),a.Header=s("slicerHeader"),a.Input=s("slicerCheckbox"),a.Clear=s("clear"),a.Body=s("slicerBody"),a}();i.ChicletSlicer=u;var d;!function(a){var r=function(){function a(e,a){var r=e.categorical;this.dataViewCategorical=r,this.dataViewMetadata=e.metadata,r.categories&&r.categories.length>0&&(this.category=r.categories[0],this.categoryIdentities=this.category.identity,this.categoryValues=this.category.values,this.categoryColumnRef=this.category.identityFields,this.categoryFormatString=t.valueFormatter.getFormatString(this.category.source,i.chicletSlicerProps.formatString)),this.dataPoints=[],this.interactivityService=a,this.hasSelectionOverride=!1}return a.prototype.convert=function(){if(this.dataPoints=[],this.numberOfCategoriesSelectedInData=0,this.categoryValues){var a,r=this.dataViewMetadata?this.dataViewMetadata.objects:void 0,s=void 0;if(r&&r.general&&r.general.filter){if(!this.categoryColumnRef)return;var o=r.general.filter,l=e.data.SQExprConverter.asScopeIdsContainer(o,this.categoryColumnRef);l?(s=l.isNot,a=l.scopeIds?l.scopeIds.length:0):s=!1}this.interactivityService&&(void 0===s?s=this.interactivityService.isSelectionModeInverted():this.interactivityService.setSelectionModeInverted(s));for(var n=void 0,c=0;c<this.categoryValues.length;c++){var h=t.isCategoryColumnSelected(i.chicletSlicerProps.selectedPropertyIdentifier,this.category,c);if(null!=h){n=h;break}}for(var u=this.dataViewCategorical,d=i.chicletSlicerProps.formatString,p=-(1/0),g="",m=0,y=this.categoryValues.length;y>m;m++){var f=this.category.identity?this.category.identity[m]:null,v=t.isCategoryColumnSelected(i.chicletSlicerProps.selectedPropertyIdentifier,this.category,m),x=!0;null!=n&&(s?(null==this.category.objects&&(v=void 0),null!=v?v=n:null==v&&(v=!n)):null==v&&(v=!n)),v&&this.numberOfCategoriesSelectedInData++;var b=this.categoryValues[m],S=t.valueFormatter.format(b,this.categoryFormatString);if(this.dataViewCategorical.values)for(var w=0;w<this.dataViewCategorical.values.length;w++){var C=u.values[w];null!=C.values[m]&&(p=C.values[m],C.highlights&&(x=!(null===C.highlights[m])),C.source.groupName&&""!==C.source.groupName&&(g=t.converterHelper.getFormattedLegendLabel(C.source,u.values,d),/^(ftp|http|https):\/\/[^ "]+$/.test(g)||(g=void 0)))}this.dataPoints.push({identity:t.SelectionId.createWithId(f),category:S,imageURL:g,value:p,selected:v,selectable:x})}null!=a&&a>this.numberOfCategoriesSelectedInData&&(this.hasSelectionOverride=!0)}},a}();a.ChicletSlicerConverter=r}(d||(d={}));var p;!function(e){function t(e){var t=r(e);return t.y+t.height}function i(){s||(s=$("<span/>"),$("body").append(s),o=d3.select($("body").get(0)).append("svg").style({height:"0px",width:"0px",position:"absolute"}).append("text"),l=$("<canvas/>").get(0).getContext("2d"))}function a(e){return i(),o.style(null),o.text(e.text).attr({visibility:"hidden","font-family":e.fontFamily,"font-size":e.fontSize,"font-weight":e.fontWeight,"font-style":e.fontStyle,"white-space":e.whiteSpace||"nowrap"}),o.node().getBBox()}function r(e){var t={fontFamily:e.fontFamily,fontSize:e.fontSize,text:"M"},i=a(t);return i}var s,o,l;e.estimateSvgTextBaselineDelta=t}(p=i.ChicletSlicerTextMeasurementHelper||(i.ChicletSlicerTextMeasurementHelper={}));var g=function(){function e(){}return e.prototype.bindEvents=function(e,t){var a=this,r=i.chicletSlicerProps.filterPropertyIdentifier,s=this.slicers=e.slicerItemContainers;this.slicerItemLabels=e.slicerItemLabels,this.slicerItemInputs=e.slicerItemInputs;var o=e.slicerClear;this.dataPoints=e.dataPoints,this.interactivityService=e.interactivityService,this.slicerSettings=e.slicerSettings,this.options=e,this.options.isSelectionLoaded||this.loadSelection(t),s.on("mouseover",function(e){e.selectable&&(e.mouseOver=!0,e.mouseOut=!1,a.renderMouseover())}),s.on("mouseout",function(e){e.selectable&&(e.mouseOver=!1,e.mouseOut=!0,a.renderMouseover())}),s.on("click",function(e,i){if(e.selectable){var s=a.slicerSettings;if(d3.event.preventDefault(),d3.event.altKey&&s.general.multiselect){var o=jQuery.map(a.dataPoints,function(e,t){return e.selected?t:void 0}),l=o.length>0?o[o.length-1]:0;if(l>i){var n=i;i=l,l=n}t.handleClearSelection();for(var c=l;i>=c;c++)t.handleSelection(a.dataPoints[c],!0)}else d3.event.ctrlKey&&s.general.multiselect?t.handleSelection(e,!0):t.handleSelection(e,!1);t.persistSelectionFilter(r),a.saveSelection(t)}}),o.on("click",function(e){t.handleClearSelection(),t.persistSelectionFilter(r),a.saveSelection(t)})},e.prototype.loadSelection=function(e){e.handleClearSelection();var t=this.slicerSettings.general.getSavedSelection();if(t.length){var a=this.dataPoints.filter(function(e){return t.some(function(t){return e.identity.getKey()===t})});a.forEach(function(t){return e.handleSelection(t,!0)}),e.persistSelectionFilter(i.chicletSlicerProps.filterPropertyIdentifier)}},e.prototype.saveSelection=function(e){var t=e.selectedIds.map(function(e){return e.getKey()});this.slicerSettings.general.setSavedSelection(t)},e.prototype.renderSelection=function(e){e||this.interactivityService.isSelectionModeInverted()?this.styleSlicerInputs(this.slicers,e):this.slicers.style("background",this.slicerSettings.slicerText.unselectedColor)},e.prototype.renderMouseover=function(){var e=this;this.slicerItemLabels.style({color:function(t){return t.mouseOver?e.slicerSettings.slicerText.hoverColor:t.mouseOut?t.selected?e.slicerSettings.slicerText.fontColor:e.slicerSettings.slicerText.fontColor:void 0}})},e.prototype.styleSlicerInputs=function(e,t){var i=this.slicerSettings,a=[];e.each(function(e){e.selectable&&e.selected&&a.push(e),d3.select(this).style({background:e.selectable?e.selected?i.slicerText.selectedColor:i.slicerText.unselectedColor:i.slicerText.disabledColor}),d3.select(this).classed("slicerItem-disabled",!e.selectable)})},e}();i.ChicletSlicerWebBehavior=g;var m;!function(e){var t;!function(e){function t(e,t){var i=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(i,function(e,t,i,a){return t+t+i+i+a+a});var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),r=a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null;return null===r?"":t||0===t?"rgba("+r.r+","+r.g+","+r.b+","+t+")":"rgb("+r.r+","+r.g+","+r.b+")"}e.hexToRGBString=t}(t=e.util||(e.util={}))}(m||(m={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=function(){function i(){}return i.converter=function(e,a,r){var s=e.categorical,o=i.getDefaultDataPointColor(e).solid.color,l=i.getLabelsColor(e),n=i.getLabelsFontSize(e);if(s&&s.categories&&s.categories.length>0&&s.values&&s.categories[0].values&&s.categories[0].values[0]){for(var c=s.categories[0],h=c.values,u=s.values,d=[],p={dataPoints:[],title:u[0]&&u[0].source?u[0].source.displayName:""},g=[],m=[],y=1e3,f=[],v=[],x=[],b=!1,S=[],w=new t.ColorHelper(a,i.chordChartProps.dataPoint.fill,o),C=0,D=h.length;D>C;C++)x[h[C]]=C;for(var C=0,D=u.length;D>C;C++){var P=t.converterHelper.getSeriesName(u[C].source);f.push(P),v[P]=C}var A=this.union_arrays(h,f);A.reverse(),i.getValidArrayLength(A)===i.getValidArrayLength(h)+i.getValidArrayLength(f)&&(b=!0);for(var N=i.chordChartProps.general.formatString,V=t.valueFormatter.getFormatString(c.source,N),C=0,D=A.length;D>C;C++){var T=null,L="",M=!1;if(void 0!==x[A[C]]){var k=x[A[C]];T=t.SelectionIdBuilder.builder().withCategory(c,x[A[C]]).createSelectionId(),M=!0;var j=c.objects?c.objects[k]:void 0;L=w.getColorForSeriesValue(j,void 0,h[k])}else if(void 0!==v[A[C]]){var k=v[A[C]],O=u[k],I=O&&O.objects&&O.objects[0],P=t.converterHelper.getSeriesName(O.source);T=t.SelectionId.createWithId(O.identity),M=!1,L=w.getColorForSeriesValue(I,void 0,P)}S.push({label:A[C],labelColor:l,barColor:L,isCategory:M,identity:T,selected:!1}),d.push([]),g.push([]);for(var F=t.valueFormatter.format(h[C],V),G=0,z=A.length;z>G;G++){var R=0,B=[];if(void 0!==x[A[C]]&&void 0!==v[A[G]]){var H=x[A[C]],U=v[A[G]];null!==u[U].values[H]&&(R=u[U].values[H],R>y&&(y=R),B=t.TooltipBuilder.createTooltipInfo(N,s,F,R,null,null,U,H))}else if(b&&void 0!==x[A[G]]&&void 0!==v[A[C]]){var H=x[A[G]],U=v[A[C]];null!==u[U].values[H]&&(R=u[U].values[H])}d[C].push(R),g[C].push({tooltipInfo:B})}var W=d3.sum(d[C]);m.push({tooltipInfo:[{displayName:A[C],value:i.isInt(W)?W.toFixed(0):W.toFixed(2)}]})}var E=d3.layout.chord().padding(.1).matrix(d),_=Math.round(y/5).toString().length-1;return{dataMatrix:d,labelDataPoints:i.convertToChordArcDescriptor(E.groups(),S),legendData:p,tooltipData:g,sliceTooltipData:m,tickUnit:Math.pow(10,_),differentFromTo:b,defaultDataPointColor:o,prevAxisVisible:r,showAllDataPoints:i.getShowAllDataPoints(e),showLabels:i.getLabelsShow(e),showAxis:i.getAxisShow(e),labelFontSize:n}}return{dataMatrix:[],labelDataPoints:[],legendData:null,tooltipData:[],sliceTooltipData:[],tickUnit:1e3,differentFromTo:!1,defaultDataPointColor:o,prevAxisVisible:r,showAllDataPoints:i.getShowAllDataPoints(e),showLabels:i.getLabelsShow(e),showAxis:i.getAxisShow(e),labelFontSize:n}},i.getValidArrayLength=function(e){for(var t=0,i=0,a=e.length;a>i;i++)void 0!==e[i]&&t++;return t},i.convertToChordArcDescriptor=function(e,t){for(var i=[],a=0,r=e.length;r>a;a++){var s=e[a];s.data=t[a],i.push(s)}return i},i.prototype.calculateRadius=function(e){if(this.data&&this.data.showLabels){var t=e.height/e.width,i=2+1/(1+Math.exp(-5*(t-1)));return Math.min(e.height,e.width)/i}return Math.min(e.height,e.width)/2},i.drawDefaultCategoryLabels=function(e,a,r,s){var o=d3.svg.arc().innerRadius(0).outerRadius(r*i.InnerArcRadiusRatio),l=d3.svg.arc().innerRadius(r*i.OuterArcRadiusRatio).outerRadius(r*i.OuterArcRadiusRatio);if(a.showLabels){var n=i.getChordChartLabelLayout(r,l,s,a.labelFontSize);i.drawDefaultLabelsForChordChart(a.labelDataPoints,e,n,s,r,o,l)}else t.dataLabelUtils.cleanDataLabels(e,!0)},i.prototype.init=function(e){var a=this.element=e.element;this.selectionManager=new t.utility.SelectionManager({hostServices:e.host}),this.svg=d3.select(a.get(0)).append("svg").style("position","absolute").classed(i.VisualClassName,!0),this.mainGraphicsContext=this.svg.append("g"),this.mainGraphicsContext.append("g").classed("ticks",!0),this.mainGraphicsContext.append("g").classed("chords",!0),this.mainGraphicsContext.append("g").classed("slices",!0),this.colors=e.style.colorPalette.dataColors},i.prototype.update=function(e){var a=this;if(e.dataViews&&e.dataViews[0]){var r=e.suppressAnimations?0:t.AnimatorCommon.MinervaAnimationDuration,s=this.dataView=e.dataViews[0],o=this.data?this.data.showAxis:!i.getAxisShow(s),l=this.data=i.converter(s,this.colors,o),n=e.viewport,c=this.chordLayout=d3.layout.chord().padding(.1).matrix(l.dataMatrix),h=n.width,u=n.height,d=this.calculateRadius(n),p=this.selectionManager,g=d,m=d*i.InnerArcRadiusRatio,y=d3.svg.arc().innerRadius(g).outerRadius(m);this.svg.attr({width:h,height:u});var f=this.mainGraphicsContext.attr("transform",t.SVGUtil.translate(h/2,u/2)),v=this.svg.select(".slices").selectAll("path"+i.sliceClass.selector).data(c.groups);v.enter().insert("path").classed(i.sliceClass["class"],!0),v.style("fill",function(e,t){return l.labelDataPoints[t].data.barColor}).style("stroke",function(e,t){return l.labelDataPoints[t].data.barColor}).on("click",function(e,t){var i=this;p.select(l.labelDataPoints[t].data.identity).then(function(e){e.length>0?(f.selectAll(".chords path.chord").style("opacity",1),f.selectAll(".slices path.slice").style("opacity",.3),f.selectAll(".chords path.chord").filter(function(e){return e.source.index!==t&&e.target.index!==t}).style("opacity",.3),d3.select(i).style("opacity",1)):(v.style("opacity",1),f.selectAll(".chords path.chord").filter(function(e){return e.source.index!==t&&e.target.index!==t}).style("opacity",1))}),d3.event.stopPropagation()}).transition().duration(r).attr("d",y),v.exit().remove(),t.TooltipManager.addTooltip(v,function(e){return l.sliceTooltipData[e.data.index].tooltipInfo});var x=this.svg.select(".chords").selectAll("path"+i.chordClass.selector).data(c.chords);x.enter().insert("path").classed(i.chordClass["class"],!0),x.style("fill",function(e,t){return l.labelDataPoints[e.target.index].data.barColor}).style("opacity",1).transition().duration(r).attr("d",d3.svg.chord().radius(g)),x.exit().remove(),this.svg.on("click",function(){return a.selectionManager.clear().then(function(){v.style("opacity",1),x.style("opacity",1)})}),i.drawTicks(this.mainGraphicsContext,l,c,m,r,n),i.drawDefaultCategoryLabels(this.mainGraphicsContext,l,d,n),t.TooltipManager.addTooltip(x,function(e){var t=[];return l.differentFromTo?t=l.tooltipData[e.data.source.index][e.data.source.subindex].tooltipInfo:(t.push({displayName:l.labelDataPoints[e.data.source.index].data.label+"->"+l.labelDataPoints[e.data.source.subindex].data.label,value:l.dataMatrix[e.data.source.index][e.data.source.subindex].toString()}),t.push({displayName:l.labelDataPoints[e.data.target.index].data.label+"->"+l.labelDataPoints[e.data.target.subindex].data.label,value:l.dataMatrix[e.data.target.index][e.data.target.subindex].toString()})),t})}},i.prototype.destroy=function(){},i.cleanTicks=function(e){var t=[],a=e.selectAll(i.tickLineClass.selector).data(t);a.exit().remove();var r=e.selectAll(i.tickTextClass.selector).data(t);r.exit().remove(),e.selectAll(i.tickPairClass.selector).remove(),e.selectAll(i.sliceTicksClass.selector).remove()},i.drawTicks=function(e,t,a,r,s,o){if(t.showAxis){var l=e.select(".ticks").selectAll("g"+i.sliceTicksClass.selector).data(a.groups),n=t.prevAxisVisible===t.showAxis?s:0;l.enter().insert("g").classed(i.sliceTicksClass["class"],!0);var c=l.selectAll("g"+i.tickPairClass.selector).data(function(e){var i=(e.endAngle-e.startAngle)/e.value,a=d3.range(0,e.value,e.value-1<.15?.15:e.value-1),r=a.map(function(a,r){var s=1e3,o="k";t.tickUnit>=1e6?(s=1e6,o="m"):t.tickUnit>=1e3?(s=1e3,o="k"):(s=1,o="");var l={angle:a*i+e.startAngle,label:Math.floor(a/s)+o};return l});return r});c.enter().insert("g").classed(i.tickPairClass["class"],!0),c.transition().duration(n).attr("transform",function(e){return"rotate("+(180*e.angle/Math.PI-90)+")translate("+r+",0)"}),c.selectAll("line"+i.tickLineClass.selector).data(function(e){return[e]}).enter().insert("line").classed(i.tickLineClass["class"],!0).style("stroke","#000").attr("x1",1).attr("y1",0).attr("x2",5).attr("y2",0),c.selectAll("text"+i.tickTextClass.selector).data(function(e){return[e]}).enter().insert("text").classed(i.tickTextClass["class"],!0).style("text-anchor",function(e){return e.angle>Math.PI?"end":null}).text(function(e){return e.label}).attr("transform",function(e){return e.angle>Math.PI?"rotate(180)translate(-16)":null}).attr("x",8).attr("dy",".35em"),c.exit().remove(),l.exit().remove()}else i.cleanTicks(e)},i.getAxisShow=function(e){if(e&&e.metadata){var t=e.metadata.objects;if(t){var i=t.axis;if(i&&i.hasOwnProperty("show"))return i.show}}return!0},i.getLabelsShow=function(e){if(e&&e.metadata){var t=e.metadata.objects;if(t){var i=t.labels;if(i&&i.hasOwnProperty("show"))return i.show}}return!0},i.getLabelsColor=function(e){if(e&&e.metadata){var t=e.metadata.objects;if(t){var a=t.labels;if(a&&a.hasOwnProperty("color"))return a.color.solid.color}}return i.DefaultLabelColor},i.getLabelsFontSize=function(e){if(e&&e.metadata){var t=e.metadata.objects;if(t){var a=t.labels;if(a&&a.hasOwnProperty("fontSize"))return a.fontSize}}return i.DefaultLabelsFontSize},i.selectLabels=function(e,a,r,s){if(void 0===r&&(r=!1),void 0===s&&(s=!1),0===e.length)return t.dataLabelUtils.cleanDataLabels(a,!0),null;a.select(i.labelGraphicsContextClass.selector).empty()&&a.append("g").classed(i.labelGraphicsContextClass["class"],!0);var o=null!==e[0].key,l=null!==e[0].identity,n=o?function(e){return e.key}:l?function(e){return e.identity.getKey()}:void 0,c=r?a.select(i.labelGraphicsContextClass.selector).selectAll(i.labelsClass.selector).data(e,function(e){return e.data.identity.getKey()}):null!==n?a.select(i.labelGraphicsContextClass.selector).selectAll(i.labelsClass.selector).data(e,n):a.select(i.labelGraphicsContextClass.selector).selectAll(i.labelsClass.selector).data(e),h=c.enter().append("text").classed(i.labelsClass["class"],!0);return s&&h.style("opacity",0),c},i.drawDefaultLabelsForChordChart=function(t,a,r,s,o,l,n){var c=new e.DataLabelManager,h=c.hideCollidedLabels(s,t,r,!0),u=i.selectLabels(h,a,!0);if(u){u.attr({x:function(e){return e.labelX},y:function(e){return e.labelY},dy:".35em"}).text(function(e){return e.labeltext}).style(r.style),u.exit().remove(),a.select(i.linesGraphicsContextClass.selector).empty()&&a.append("g").classed(i.linesGraphicsContextClass["class"],!0);var d=a.select(i.linesGraphicsContextClass.selector).selectAll("polyline").data(h,function(e){return e.data.identity.getKey()}),p=2.05,g=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2};d.enter().append("polyline").classed(i.lineClass["class"],!0),d.attr("points",function(e){var t=n.centroid(e);t[0]=.95*o*(g(e)<Math.PI?1:-1);var i=n.centroid(e),a=l.centroid(e);return a[0]*=p,a[1]*=p,[a,i,t]}).style({opacity:function(e){return i.PolylineOpacity},stroke:function(e){return e.data.labelColor}}),d.exit().remove()}},i.getChordChartLabelLayout=function(e,i,r,s){var o=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2},l=r.width-2.2*(t.dataLabelUtils.maxLabelWidth+ +s)-2*e,n=a.PixelConverter;return{labelText:function(e){return t.dataLabelUtils.getLabelFormattedText({label:e.data.label,maxWidth:l,fontSize:s})},labelLayout:{x:function(t){return e*(o(t)<Math.PI?1:-1)},y:function(e){var t=i.centroid(e);return t[1]}},filter:function(e){return null!==e&&null!==e.data&&null!==e.data.label},style:{fill:function(e){return e.data.labelColor},"text-anchor":function(e){return o(e)<Math.PI?"start":"end"},"font-size":function(e){return n.fromPoint(s)}}}},i.getDefaultDataPointColor=function(e,t){if(e&&e.metadata){var i=e.metadata.objects;if(i){var a=i.dataPoint;if(a&&a.hasOwnProperty("defaultColor")){var r=a.defaultColor;if(r)return r}}}return{solid:{color:t}}},i.getShowAllDataPoints=function(e){if(!e||!e.metadata||!e.metadata.objects)return!1;var t=e.metadata.objects,i=t.dataPoint;return i&&i.hasOwnProperty("showAllDataPoints")?i.showAllDataPoints:!1},i.prototype.enumerateObjectInstances=function(e){var a,r=[];switch(e.objectName){case"axis":a={objectName:"axis",displayName:"Axis",selector:null,properties:{show:i.getAxisShow(this.dataView)}},r.push(a);break;case"labels":a={objectName:"labels",displayName:"Labels",selector:null,properties:{show:i.getLabelsShow(this.dataView),color:i.getLabelsColor(this.dataView),fontSize:i.getLabelsFontSize(this.dataView)}},r.push(a);break;case"dataPoint":var s={objectName:"dataPoint",selector:null,properties:{defaultColor:{solid:{color:this.data&&this.data.defaultDataPointColor?this.data.defaultDataPointColor:this.colors.getColorByIndex(0).value}}}};r.push(s);var o={objectName:"dataPoint",selector:null,properties:{showAllDataPoints:this.data?!!this.data.showAllDataPoints:!1}};if(r.push(o),this.data&&this.data.labelDataPoints&&this.data.showAllDataPoints)for(var l=0,n=this.data.labelDataPoints.length;n>l;l++){
var c=this.data.labelDataPoints[l].data;if(c.isCategory){var h={objectName:"dataPoint",displayName:c.label,selector:t.ColorHelper.normalizeSelector(c.identity.getSelector()),properties:{fill:{solid:{color:c.barColor}}}};r.push(h)}}}return r},i.isInt=function(e){return e%1===0},i.union_arrays=function(e,t){for(var i={},a=0;a<e.length;a++)i[e[a]]=e[a];for(var a=0;a<t.length;a++)i[t[a]]=t[a];var r=[];for(var s in i)i.hasOwnProperty(s)&&r.push(i[s]);return r},i.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:"From"},{name:"Series",kind:e.VisualDataRoleKind.Grouping,displayName:"To"},{name:"Y",kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Values")}],dataViewMappings:[{conditions:[{Category:{max:1},Series:{max:0}},{Category:{max:1},Series:{min:1,max:1},Y:{max:1}},{Category:{max:1},Series:{max:0},Y:{min:0,max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{group:{by:"Series",select:[{bind:{to:"Y"}}],dataReductionAlgorithm:{top:{}}}},rowCount:{preferred:{min:2},supported:{min:1}}}}],objects:{dataPoint:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint"),properties:{defaultColor:{displayName:e.data.createDisplayNameGetter("Visual_DefaultColor"),type:{fill:{solid:{color:!0}}}},showAllDataPoints:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint_Show_All"),type:{bool:!0}},fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}},axis:{displayName:"Axis",properties:{show:{type:{bool:!0}}}},labels:{displayName:"Labels",properties:{show:{type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_Reference_Line_Data_Label_Color"),description:e.data.createDisplayNameGetter("Visual_Reference_Line_Data_Label_Color_Description"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}}}},i.chordChartProps={general:{formatString:{objectName:"general",propertyName:"formatString"}},dataPoint:{defaultColor:{objectName:"dataPoint",propertyName:"defaultColor"},fill:{objectName:"dataPoint",propertyName:"fill"},showAllDataPoints:{objectName:"dataPoint",propertyName:"showAllDataPoints"}},axis:{show:{objectName:"axis",propertyName:"show"}},labels:{show:{objectName:"labels",propertyName:"show"},color:{objectName:"labels",propertyName:"color"},fontSize:{objectName:"labels",propertyName:"fontSize"}}},i.PolylineOpacity=.5,i.OuterArcRadiusRatio=.9,i.InnerArcRadiusRatio=.8,i.DefaultLabelColor="#777777",i.DefaultLabelsFontSize=12,i.VisualClassName="chordChart",i.sliceClass={"class":"slice",selector:".slice"},i.chordClass={"class":"chord",selector:".chord"},i.sliceTicksClass={"class":"slice-ticks",selector:".slice-ticks"},i.tickPairClass={"class":"tick-pair",selector:".tick-pair"},i.tickLineClass={"class":"tick-line",selector:".tick-line"},i.tickTextClass={"class":"tick-text",selector:".tick-text"},i.labelGraphicsContextClass={"class":"labels",selector:".labels"},i.labelsClass={"class":"data-labels",selector:".data-labels"},i.linesGraphicsContextClass={"class":"lines",selector:".lines"},i.lineClass={"class":"line-label",selector:".line-label"},i}();i.ChordChart=r}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=a.PixelConverter,s=a.CssConstants.createClassAndSelector,o=a.Lazy,l=e.data.DataRoleHelper.getCategoryIndexOfRole,n=e.data.DataRoleHelper.getMeasureIndexOfRole,c=function(){function i(){this.AxisGraphicsContextClassName="axisGraphicsContext",this.ScrollBarWidth=10,this.textProperties={fontFamily:"wf_segoe-ui_normal",fontSize:r.toString(i.AxisFontSize)}}return Object.defineProperty(i.prototype,"margin",{get:function(){return this._margin||{left:0,right:0,top:0,bottom:0}},set:function(e){this._margin=$.extend({},e),this._viewportIn=i.substractMargin(this.viewport,this.margin)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewport",{get:function(){return this._viewport||{width:0,height:0}},set:function(e){this._viewport=$.extend({},e),this._viewportIn=i.substractMargin(this.viewport,this.margin)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewportIn",{get:function(){return this._viewportIn||this.viewport},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"legendViewport",{get:function(){return this.legend.getMargins()},enumerable:!0,configurable:!0}),i.substractMargin=function(e,t){return{width:Math.max(e.width-(t.left+t.right),0),height:Math.max(e.height-(t.top+t.bottom),0)}},i.getCustomSymbolType=function(e){var t=d3.map({circle:function(e){var t=Math.sqrt(e/Math.PI);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"},cross:function(e){var t=Math.sqrt(e/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(e){var t=Math.sqrt(e/(2*Math.tan(Math.PI/6))),i=t*Math.tan(Math.PI/6);return"M0,"+-t+"L"+i+",0 0,"+t+" "+-i+",0Z"},square:function(e){var t=Math.sqrt(e)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-up":function(e){var t=Math.sqrt(e/Math.sqrt(3)),i=t*Math.sqrt(3)/2;return"M0,"+-i+"L"+t+","+i+" "+-t+","+i+"Z"},"triangle-down":function(e){var t=Math.sqrt(e/Math.sqrt(3)),i=t*Math.sqrt(3)/2;return"M0,"+i+"L"+t+","+-i+" "+-t+","+-i+"Z"},star:function(e){for(var t=Math.sqrt(e/2),i=Math.sqrt(e/10),a="",r=Math.PI/5,s=0;10>s;s++){var o=0===(1&s)?t:i,l=Math.cos(s*r)*o,n=Math.sin(s*r)*o;0===s?a="M"+l+","+n+"L":a+=" "+l+","+n}return a+"Z"},hexagon:function(e){var t=Math.sqrt(e/(6*Math.sqrt(3))),i=Math.sqrt(e/(2*Math.sqrt(3)));return"M0,"+2*t+"L"+-i+","+t+" "+-i+","+-t+" 0,"+-2*t+" "+i+","+-t+" "+i+","+t+"Z"},x:function(e){var t=Math.sqrt(e/10);return"M0,"+t+"L"+-t+","+2*t+" "+-2*t+","+t+" "+-t+",0 "+-2*t+","+-t+" "+-t+","+-2*t+" 0,"+-t+" "+t+","+-2*t+" "+2*t+","+-t+" "+t+",0 "+2*t+","+t+" "+t+","+2*t+"Z"},uparrow:function(e){var t=Math.sqrt(e/12);return"M"+t+","+3*t+"L"+-t+","+3*t+" "+-t+","+-t+" "+-2*t+","+-t+" 0,"+-3*t+" "+2*t+","+-t+" "+t+","+-t+"Z"},downarrow:function(e){var t=Math.sqrt(e/12);return"M0,"+3*t+"L"+-2*t+","+t+" "+-t+","+t+" "+-t+","+-3*t+" "+t+","+-3*t+" "+t+","+t+" "+2*t+","+t+"Z"}}),i=t.entries()[0].value;if(e){if(isNaN(e))return t[e&&e.toString().toLowerCase()]||i;var a=t.entries()[Math.floor(e)];return a?a.value:i}return i},i.prototype.init=function(e){this.options=e,this.animator=new t.BaseAnimator,this.behavior=new t.CartesianChartBehavior([new t.ScatterChartWebBehavior]);var a=this.element=e.element;this.viewport=_.clone(e.viewport),this.style=e.style,this.hostServices=e.host,this.colors=this.style.colorPalette.dataColors,this.interactivity=e.interactivity,this.margin={top:1,right:1,bottom:1,left:1},this.yAxisOrientation=t.yAxisPosition.left,this.adjustMargins();var r=this.scrollY=!0,s=this.scrollX=!0,o=this.svg=d3.select(a.get(0)).append("svg").style("position","absolute").classed(i.ClassName,!0),l=this.axisGraphicsContext=o.append("g").classed(this.AxisGraphicsContextClassName,!0);this.svgScrollable=o.append("svg").classed("svgScrollable",!0).style("overflow","hidden");var n=this.axisGraphicsContextScrollable=this.svgScrollable.append("g").classed(this.AxisGraphicsContextClassName,!0);this.clearCatcher=t.appendClearCatcher(this.axisGraphicsContextScrollable);var c=r?n:l;this.backgroundGraphicsContext=l.append("svg:image"),this.xAxisGraphicsContext=r?l.append("g").attr("class","x axis"):n.append("g").attr("class","x axis"),this.y1AxisGraphicsContext=c.append("g").attr("class","y axis"),this.xAxisGraphicsContext.classed("showLinesOnAxis",r),this.y1AxisGraphicsContext.classed("showLinesOnAxis",s),this.xAxisGraphicsContext.classed("hideLinesOnAxis",!r),this.y1AxisGraphicsContext.classed("hideLinesOnAxis",!s),this.interactivityService=t.createInteractivityService(this.hostServices),this.legend=t.createLegend(a,this.interactivity&&this.interactivity.isInteractiveLegend,this.interactivityService,!0),this.mainGraphicsG=this.axisGraphicsContextScrollable.append("g").classed(i.MainGraphicsContextClassName,!0),this.mainGraphicsSVGSelection=this.mainGraphicsG.append("svg"),this.mainGraphicsContext=this.mainGraphicsSVGSelection.append("g"),this.svgDefaultImage="",this.keyArray=[]},i.prototype.adjustMargins=function(){var e=this.element.find(".x.axis");0===t.AxisHelper.getRecommendedNumberOfTicksForXAxis(this.viewportIn.width)&&0===t.AxisHelper.getRecommendedNumberOfTicksForYAxis(this.viewportIn.height)?(this.margin={top:0,right:0,bottom:0,left:0},e.hide()):e.show()},i.prototype.getValueAxisProperties=function(e,t){var i={};if(!e)return i;var a=e.objects;if(a){var r=a.valueAxis;r&&(i={show:r.show,position:r.position,axisScale:r.axisScale,start:r.start,end:r.end,showAxisTitle:null==r.showAxisTitle?t:r.showAxisTitle,axisStyle:r.axisStyle,axisColor:r.axisColor,secShow:r.secShow,secPosition:r.secPosition,secAxisScale:r.secAxisScale,secStart:r.secStart,secEnd:r.secEnd,secShowAxisTitle:r.secShowAxisTitle,secAxisStyle:r.secAxisStyle,labelDisplayUnits:r.labelDisplayUnits})}return i},i.prototype.getCategoryAxisProperties=function(e,t){var i={};if(!e)return i;var a=e.objects;if(a){var r=a.categoryAxis;r&&(i={show:r.show,axisType:r.axisType,axisScale:r.axisScale,axisColor:r.axisColor,start:r.start,end:r.end,showAxisTitle:null==r.showAxisTitle?t:r.showAxisTitle,axisStyle:r.axisStyle,labelDisplayUnits:r.labelDisplayUnits})}return i},i.converter=function(a,r,s,o,l){if(!a)return i.getDefaultData();var n,c,h,u,d,p=a.categorical,g=a.metadata,m=p.categories||[],y=p.values,f=!!y.source,v=y.grouped(),x=y.source,b=i.getMetadata(m,v,x),S=b.idx.category,w=b.idx.image>=0,C=b.idx.colorFill>=0;if(p.categories&&p.categories.length>0&&p.categories[S]){var D=p.categories[S];n=D.values,c=t.valueFormatter.create({format:t.valueFormatter.getFormatString(D.source,t.scatterChartProps.general.formatString),value:n[0],value2:n[n.length-1]}),u=D.identity,h=D.objects,d=D.source?D.source.queryName:null}else n=[null],c=t.valueFormatter.createDefaultFormatter(null);var P=t.dataLabelUtils.getDefaultPointLabelSettings(),A=!1,N={show:!1,url:""},V=!1,T=!1,L="",M=!0;if(g&&g.objects){var k=g.objects;L=e.DataViewObjects.getFillColor(k,t.columnChartProps.dataPoint.defaultColor),M=e.DataViewObjects.getValue(k,t.columnChartProps.dataPoint.showAllDataPoints);var j=k.categoryLabels;j&&(P.show=void 0!==j.show?j.show:P.show,P.fontSize=void 0!==j.fontSize?j.fontSize:P.fontSize,void 0!==j.color&&(P.labelColor=j.color.solid.color)),A=e.DataViewObjects.getValue(k,t.scatterChartProps.fillPoint.show,A);var O=k.backdrop;void 0!==O&&(N.show=O.show,N.show&&(N.url=O.url));var I=k.crosshair;void 0!==I&&(V=I.show);var F=k.outline;void 0!==F&&(T=F.show)}var G=i.createDataPoints(y,b,m,n,c,u,h,r,f,P,L,d);s&&s.applySelectionStateToData(G);var z=f?i.createSeriesLegend(y,r,y,t.valueFormatter.getFormatString(x,t.scatterChartProps.general.formatString),L):[],R=y&&x?x.displayName:"";R||(R=m&&m[S]&&m[S].source&&m[S].source.displayName?m[S].source.displayName:"");var B={title:R,dataPoints:z},H=i.getSizeRangeForGroups(v,b.idx.size);if(o&&null!==o.showAxisTitle&&o.showAxisTitle===!1&&(b.axesLabels.x=null),l&&null!==l.showAxisTitle&&l.showAxisTitle===!1&&(b.axesLabels.y=null),G&&G[0]){var U=G[0];null!=U.backdrop&&(N.show=!0,N.url=U.backdrop),null!=U.xStart&&(o.start=U.xStart),null!=U.xEnd&&(o.end=U.xEnd),null!=U.yStart&&(l.start=U.yStart),null!=U.yEnd&&(l.end=U.yEnd)}return{xCol:b.cols.x,yCol:b.cols.y,dataPoints:G,legendData:B,axesLabels:b.axesLabels,selectedIds:[],size:b.cols.size,sizeRange:H,dataLabelsSettings:P,defaultDataPointColor:L,hasDynamicSeries:f,showAllDataPoints:M,fillPoint:A,useShape:w,useCustomColor:C,backdrop:N,crosshair:V,outline:T}},i.createSeriesLegend=function(e,i,a,r,s){for(var o=e.grouped(),l=new t.ColorHelper(i,t.scatterChartProps.dataPoint.fill,s),n=[],c=0,h=o.length;h>c;c++){var u=o[c],d=l.getColorForSeriesValue(u.objects,e.identityFields,u.name);n.push({color:d,icon:t.LegendIcon.Circle,label:t.valueFormatter.format(u.name,r),identity:u.identity?t.SelectionId.createWithId(u.identity):t.SelectionId.createNull(),selected:!1})}return n},i.getSizeRangeForGroups=function(e,i){var a={};return e&&e.forEach(function(e){var r=t.ScatterChart.getMeasureValue(i,e.values),s=t.AxisHelper.getRangeForColumn(r);(null==a.min||a.min>s.min)&&(a.min=s.min),(null==a.max||a.max<s.max)&&(a.max=s.max)}),a},i.getMetadata=function(e,t,a){var r,s,o,c=l(e,i.ColumnCategory),h=l(e,i.ColumnColorFill),u=l(e,i.ColumnImage),d=l(e,i.ColumnBackdrop),p=n(t,i.ColumnX),g=n(t,i.ColumnY),m=n(t,i.ColumnSize),y=n(t,i.ColumnShape),f=n(t,i.ColumnRotation),v=n(t,i.ColumnXStart),x=n(t,i.ColumnXEnd),b=n(t,i.ColumnYStart),S=n(t,i.ColumnYEnd),w="",C="";if(t&&t.length){var D=t[0];p>=0&&(r=D.values[p].source,w=D.values[p].source.displayName),g>=0&&(s=D.values[g].source,C=D.values[g].source.displayName),m>=0&&(o=D.values[m].source)}return{idx:{category:c,x:p,y:g,size:m,colorFill:h,shape:y,image:u,rotation:f,backdrop:d,xStart:v,xEnd:x,yStart:b,yEnd:S},cols:{x:r,y:s,size:o},axesLabels:{x:w,y:C}}},i.createLazyFormattedCategory=function(e,t){return new o(function(){return e.format(t)})},i.createDataPoints=function(e,a,s,o,l,n,c,h,u,d,p,g){for(var m=[],y=a.idx,f=t.scatterChartProps.general.formatString,v=e.source,x=e.grouped(),b=r.fromPoint(d.fontSize),S=new t.ColorHelper(h,t.scatterChartProps.dataPoint.fill,p),w=0,C=o.length;C>w;w++)for(var D=o[w],P=0,A=x.length;A>P;P++){var N=s[y.colorFill],V=s[y.image],T=s[y.backdrop],L=x[P],M=L.values,k=t.ScatterChart.getMeasureValue(y.x,M),j=t.ScatterChart.getMeasureValue(y.y,M),O=t.ScatterChart.getMeasureValue(y.size,M),I=t.ScatterChart.getMeasureValue(y.shape,M),F=t.ScatterChart.getMeasureValue(y.rotation,M),G=t.ScatterChart.getMeasureValue(y.xStart,M),z=t.ScatterChart.getMeasureValue(y.xEnd,M),R=t.ScatterChart.getMeasureValue(y.yStart,M),B=t.ScatterChart.getMeasureValue(y.yEnd,M),H=k&&k.values&&!isNaN(k.values[w])?k.values[w]:null,U=j&&j.values&&!isNaN(j.values[w])?j.values[w]:0,W=O&&O.values?O.values[w]:null,E=i.getValueFromDataViewValueColumnById(N,w),_=i.getCustomSymbolType(I&&I.values&&I.values[w]),Y=i.getValueFromDataViewValueColumnById(V,w),X=F&&F.values?F.values[w]:0,K=i.getValueFromDataViewValueColumnById(T,w),q=G&&G.values?G.values[w]:null,Z=z&&z.values?z.values[w]:null,J=R&&R.values?R.values[w]:null,Q=B&&B.values?B.values[w]:null,$=null==H||null==U;if(!$){var ee=void 0;if(u)ee=S.getColorForSeriesValue(L.objects,e.identityFields,L.name);else{var te=null!=O?O.source.queryName:"";ee=S.getColorForMeasure(c&&c[w],te)}var ie=s&&s.length>0?s[y.category]:null,ae=t.SelectionIdBuilder.builder().withCategory(ie,w).withSeries(e,L).createSelectionId(),re=[];v&&re.push({value:L.name,metadata:{source:v,values:[]}}),k&&re.push({value:H,metadata:k}),j&&re.push({value:U,metadata:j}),O&&O.values&&O.values.length>0&&re.push({value:O.values[w],metadata:O}),N&&N.values&&N.values.length>0&&re.push({value:N.values[w],metadata:N}),I&&I.values&&I.values.length>0&&re.push({value:I.values[w],metadata:I}),V&&V.values&&V.values.length>0&&re.push({value:V.values[w],metadata:V}),F&&F.values&&F.values.length>0&&re.push({value:F.values[w],metadata:F}),T&&T.values&&T.values.length>0&&re.push({value:T.values[w],metadata:T}),G&&G.values&&G.values.length>0&&re.push({value:G.values[w],metadata:G}),z&&z.values&&z.values.length>0&&re.push({value:z.values[w],metadata:z}),R&&R.values&&R.values.length>0&&re.push({value:R.values[w],metadata:R}),B&&B.values&&B.values.length>0&&re.push({value:B.values[w],metadata:B});var se=t.TooltipBuilder.createTooltipInfo(f,void 0,D,null,ie?[ie]:void 0,re,void 0),oe={x:H,y:U,size:W,radius:{sizeMeasure:O,index:w},fill:ee,formattedCategory:this.createLazyFormattedCategory(l,D),selected:!1,identity:ae,tooltipInfo:se,labelFill:d.labelColor,labelFontSize:b,contentPosition:8,colorFill:E,shapeSymbolType:_,svgurl:Y,rotation:X,backdrop:K,xStart:q,xEnd:Z,yStart:J,yEnd:Q};m.push(oe)}}return m},i.getValueFromDataViewValueColumnById=function(e,t){return e&&e.values?e.values[t]:null},i.getDefaultData=function(){return{xCol:void 0,yCol:void 0,dataPoints:[],legendData:{dataPoints:[]},axesLabels:{x:"",y:""},selectedIds:[],sizeRange:[],dataLabelsSettings:t.dataLabelUtils.getDefaultPointLabelSettings(),defaultDataPointColor:null,hasDynamicSeries:!1,useShape:!1,useCustomColor:!1}},i.prototype.setData=function(e){if(this.data=i.getDefaultData(),e&&e.length>0){var t=e[0];t&&(this.categoryAxisProperties=this.getCategoryAxisProperties(t.metadata,!0),this.valueAxisProperties=this.getValueAxisProperties(t.metadata,!0),this.dataView=t,t.categorical&&t.categorical.values&&(this.data=i.converter(t,this.colors,this.interactivityService,this.categoryAxisProperties,this.valueAxisProperties)))}},i.prototype.update=function(e){var i=this.dataViews=e.dataViews;if(this.viewport=_.clone(e.viewport),i){if(i&&i.length>0){var a=t.getInvalidValueWarnings(i,!1,!1,!1);a&&a.length>0&&this.hostServices.setWarnings(a),this.populateObjectProperties(i)}this.setData(i),this.options.interactivity&&this.options.interactivity.isInteractiveLegend||this.renderLegend(),this.render(e.suppressAnimations)}},i.prototype.populateObjectProperties=function(i){if(i&&i.length>0){var a=i[0].metadata;a?this.legendObjectProperties=e.DataViewObjects.getObject(a.objects,"legend",{}):this.legendObjectProperties={},this.categoryAxisProperties=this.getCategoryAxisProperties(a),this.valueAxisProperties=this.getValueAxisProperties(a);var r=this.valueAxisProperties.position;this.yAxisOrientation=r?r.toString():t.yAxisPosition.left}},i.prototype.renderLegend=function(){var e={title:"",dataPoints:[]},a=this.legend;this.layerLegendData=this.data.legendData,this.layerLegendData&&(e.title=this.layerLegendData.title||"",e.dataPoints=e.dataPoints.concat(this.layerLegendData.dataPoints||[]),e.fontSize=this.legendLabelFontSize?this.legendLabelFontSize:i.LegendLabelFontSizeDefault,this.layerLegendData.grouped&&(e.grouped=!0));var r=this.legendObjectProperties;if(r){t.LegendData.update(e,r);var s=r[t.legendProps.position];s&&a.changeOrientation(t.LegendPosition[s])}else a.changeOrientation(t.LegendPosition.Top);(1===e.dataPoints.length&&!e.grouped||this.hideLegends())&&(e.dataPoints=[]);var o=this.viewport;a.drawLegend(e,{height:o.height,width:o.width}),t.Legend.positionChartArea(this.svg,a)},i.prototype.hideLegends=function(){return!!(this.cartesianSmallViewPortProperties&&this.cartesianSmallViewPortProperties.hideLegendOnSmallViewPort&&this.viewport.height<this.cartesianSmallViewPortProperties.MinHeightLegendVisible)},i.prototype.shouldRenderAxis=function(e,t){return void 0===t&&(t="show"),e?(!e.isCategoryAxis||this.categoryAxisProperties&&null!=this.categoryAxisProperties[t]&&!this.categoryAxisProperties[t])&&(e.isCategoryAxis||this.valueAxisProperties&&null!=this.valueAxisProperties[t]&&!this.valueAxisProperties[t])?!1:e.values&&e.values.length>0:!1},i.prototype.getMaxMarginFactor=function(){return this.options.style.maxMarginFactor||.25},i.prototype.adjustViewportbyBackdrop=function(){var e=new Image,t=this;if(e.src=this.data.backdrop.url,e.onload=function(){t.oldBackdrop!==this.src&&(t.render(!0),t.oldBackdrop=this.src)},e.width>0&&e.height>0)if(e.width*this.viewportIn.height<this.viewportIn.width*e.height){var i=this.viewportIn.width-this.viewportIn.height*e.width/e.height;this.viewport={width:this.viewport.width-i,height:this.viewport.height}}else{var a=this.viewportIn.height-this.viewportIn.width*e.height/e.width;this.viewport={width:this.viewport.width,height:this.viewport.height-a}}},i.prototype.render=function(i){if(this.viewport.height-=this.legendViewport.height,this.viewport.width-=this.legendViewport.width,0!==this.viewportIn.width&&0!==this.viewportIn.height){var a=this.getMaxMarginFactor();this.leftRightMarginLimit=this.viewport.width*a;var r=this.bottomMarginLimit=Math.max(25,Math.ceil(this.viewport.height*a));this.margin.top=8,this.margin.bottom=r,this.margin.right=0,this.calculateAxes(this.categoryAxisProperties,this.valueAxisProperties,this.textProperties,!0),this.yAxisIsCategorical=this.yAxisProperties.isCategoryAxis,this.hasCategoryAxis=this.yAxisIsCategorical?this.yAxisProperties&&this.yAxisProperties.values.length>0:this.xAxisProperties&&this.xAxisProperties.values.length>0;var s,o=this.shouldRenderAxis(this.xAxisProperties),l=this.shouldRenderAxis(this.yAxisProperties);this.isXScrollBarVisible=!1,this.isYScrollBarVisible=!1;var n,c,h,u=this.yAxisOrientation,d=u===t.yAxisPosition.right;this.calculateAxes(this.categoryAxisProperties,this.valueAxisProperties,this.textProperties,!0);for(var p=!1,g=2,m=0;!p&&g>m;){m++,n=t.AxisHelper.getTickLabelMargins({width:this.viewportIn.width,height:this.viewport.height},this.leftRightMarginLimit,e.TextMeasurementService.measureSvgTextWidth,e.TextMeasurementService.measureSvgTextHeight,{x:this.xAxisProperties,y1:this.yAxisProperties},this.bottomMarginLimit,this.textProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,d,o,l,!1);var y=d?n.yRight:n.yLeft,f=d?n.yLeft:n.yRight,v=n.xMax;y+=10,f+=10,v+=12,d&&l&&(f+=20),!d&&l&&(y+=20),this.hideAxisLabels()&&(this.xAxisProperties.axisLabel=null,this.yAxisProperties.axisLabel=null),this.addUnitTypeToAxisLabel(this.xAxisProperties,this.yAxisProperties),c={x:this.xAxisProperties.axisLabel,y:this.yAxisProperties.axisLabel,y2:null},h=null!=c.x||null!=c.y||null!=c.y2,null!=c.x&&(v+=18),null!=c.y&&(y+=20),null!=c.y2&&(f+=20),this.margin.left=d?f:y,this.margin.right=d?y:f,this.margin.bottom=v;var x=this.yAxisProperties.values.length;this.calculateAxes(this.categoryAxisProperties,this.valueAxisProperties,this.textProperties,!0),this.yAxisProperties.values.length===x&&(p=!0)}if(this.data.backdrop&&this.data.backdrop.show&&void 0!==this.data.backdrop.url)for(this.adjustViewportbyBackdrop(),p=!1,g=2,m=0;!p&&g>m;){m++,n=t.AxisHelper.getTickLabelMargins({width:this.viewportIn.width,height:this.viewport.height},this.leftRightMarginLimit,e.TextMeasurementService.measureSvgTextWidth,e.TextMeasurementService.measureSvgTextHeight,{x:this.xAxisProperties,y1:this.yAxisProperties},this.bottomMarginLimit,this.textProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,d,o,l,!1);var y=d?n.yRight:n.yLeft,f=d?n.yLeft:n.yRight,v=n.xMax;y+=10,d&&l&&(f+=15),v+=12,this.hideAxisLabels()&&(this.xAxisProperties.axisLabel=null,this.yAxisProperties.axisLabel=null),this.addUnitTypeToAxisLabel(this.xAxisProperties,this.yAxisProperties),c={x:this.xAxisProperties.axisLabel,y:this.yAxisProperties.axisLabel,y2:null},h=null!=c.x||null!=c.y||null!=c.y2,null!=c.x&&(v+=18),null!=c.y&&(y+=20),null!=c.y2&&(f+=20),this.margin.left=d?f:y,this.margin.right=d?y:f,this.margin.bottom=v;var x=this.yAxisProperties.values.length;this.calculateAxes(this.categoryAxisProperties,this.valueAxisProperties,this.textProperties,!0),this.yAxisProperties.values.length===x&&(p=!0)}if(this.renderChart(s,this.xAxisProperties,this.yAxisProperties,n,h,c,i),this.updateAxis(),this.data){var b=this.data,S=this.data.dataPoints,w=this.interactivityService&&this.interactivityService.hasSelection();this.mainGraphicsSVGSelection.attr("width",this.viewportIn.width).attr("height",this.viewportIn.height);var C=S.sort(function(e,t){return t.radius.sizeMeasure?t.radius.sizeMeasure.values[t.radius.index]-e.radius.sizeMeasure.values[e.radius.index]:0}),D=t.AnimatorCommon.GetAnimationDuration(this.animator,i),P=this.drawScatterMarkers(C,w,b.sizeRange,D),A=this.data.dataLabelsSettings;if(A.show){var N=this.getEnhanchedScatterChartLabelLayout(A,this.viewportIn,b.sizeRange),V=this.cloneDataPoints(S),T=t.dataLabelUtils.drawDefaultLabelsForDataPointChart(V,this.mainGraphicsG,N,this.viewportIn);T&&T.attr("transform",function(e){return t.SVGUtil.translate(e.size.width/2,0)})}else t.dataLabelUtils.cleanDataLabels(this.mainGraphicsG);this.renderCrosshair();var L;if(this.interactivityService&&(L={dataPointsSelection:P,data:this.data,plotContext:this.mainGraphicsSVGSelection}),t.TooltipManager.addTooltip(P,function(e){return e.data.tooltipInfo}),t.SVGUtil.flushAllD3TransitionsIfNeeded(this.options),this.behavior){var M=[];if(M.push(L),this.interactivityService){var k={layerOptions:M,clearCatcher:this.clearCatcher};this.interactivityService.bind(S,this.behavior,k)}}}}},i.prototype.cloneDataPoints=function(e){for(var t=new Array,i=0,a=e;i<a.length;i++){var r=a[i],s=_.clone(r);t.push(s)}return t},i.prototype.darkenZeroLine=function(e){var t=e.selectAll("g.tick").filter(function(e){return 0===e}).node();t&&d3.select(t).select("line").classed("zero-line",!0)},i.prototype.getCategoryAxisFill=function(){if(this.dataView&&this.dataView.metadata.objects){var e=this.dataView.metadata.objects.categoryAxis;if(e)return e.axisColor}return{solid:{color:"#333"}}},i.prototype.getEnhanchedScatterChartLabelLayout=function(e,i,a){var s=this.xAxisProperties.scale,o=this.yAxisProperties.scale,l=r.fromPoint(e.fontSize),n=t.dataLabelUtils.LabelTextProperties.fontFamily;return{labelText:function(a){return t.dataLabelUtils.getLabelFormattedText({label:a.formattedCategory.getValue(),fontSize:e.fontSize,maxWidth:i.width})},labelLayout:{x:function(e){return s(e.x)},y:function(r){var s=t.ScatterChart.getBubbleRadius(r.radius,a,i)+t.dataLabelUtils.labelMargin;return 0===e.position?o(r.y)-s:o(r.y)+s}},filter:function(e){return null!=e&&null!=e.formattedCategory.getValue()},style:{fill:function(e){return e.labelFill},"font-size":l,"font-family":n}}},i.prototype.getValueAxisFill=function(){if(this.dataView&&this.dataView.metadata.objects){var e=this.dataView.metadata.objects.valueAxis;if(e)return e.axisColor}return{solid:{color:"#333"}}},i.prototype.renderCrosshair=function(){return this.mainGraphicsSVGSelection?(this.crosshairCanvasSelection=this.addCrosshairCanvasToDOM(this.mainGraphicsSVGSelection),this.data&&this.data.crosshair&&(this.crosshairVerticalLineSelection=this.addCrosshairLineToDOM(this.crosshairCanvasSelection,i.CrosshairVerticalLineSelector),this.crosshairHorizontalLineSelection=this.addCrosshairLineToDOM(this.crosshairCanvasSelection,i.CrosshairHorizontalLineSelector),this.crosshairTextSelection=this.addCrosshairTextToDOM(this.crosshairCanvasSelection),this.bindCrosshairEvents()),this.crosshairCanvasSelection):void 0},i.prototype.addCrosshairCanvasToDOM=function(e){var t=i.CrosshairCanvasSelector;return this.addElementToDOM(e,{name:"g",selector:t.selector,className:t["class"],styles:{display:"none"}})},i.prototype.addCrosshairLineToDOM=function(e,t){var a=i.CrosshairLineSelector;return this.addElementToDOM(e,{name:"line",selector:t.selector,className:a["class"]+" "+t["class"],attributes:{x1:0,y1:0,x2:0,y2:0}})},i.prototype.addCrosshairTextToDOM=function(e){var t=i.CrosshairTextSelector;return this.addElementToDOM(e,{name:"text",selector:t.selector,className:t["class"]})},i.prototype.bindCrosshairEvents=function(){var t=this;this.axisGraphicsContextScrollable&&this.axisGraphicsContextScrollable.on("mousemove",function(){var i=d3.event.currentTarget,a=d3.mouse(i),r=i.viewportElement,s=r.getBoundingClientRect(),o=r.getBBox(),l=s.width/o.width,n=s.height/o.height,c=a[0],h=a[1];o.width>0&&!e.Double.equalWithPrecision(l,1,1e-5)&&(c/=l),o.height>0&&!e.Double.equalWithPrecision(n,1,1e-5)&&(h/=n),t.updateCrosshair(c,h)}).on("mouseover",function(){t.crosshairCanvasSelection.style("display","block")}).on("mouseout",function(){t.crosshairCanvasSelection.style("display","none")})},i.prototype.updateCrosshair=function(e,t){if(this.viewportIn&&this.crosshairHorizontalLineSelection&&this.crosshairVerticalLineSelection&&this.crosshairTextSelection&&this.xAxisProperties){var a,r,s=i.CrosshairTextMargin,o=this.xAxisProperties.scale,l=this.yAxisProperties.scale;this.crosshairHorizontalLineSelection.attr({x1:0,y1:t,x2:this.viewportIn.width,y2:t}),this.crosshairVerticalLineSelection.attr({x1:e,y1:0,x2:e,y2:this.viewportIn.height}),a=Math.round(100*o.invert(e))/100,r=Math.round(100*l.invert(t))/100,this.crosshairTextSelection.attr({x:e+s,y:t-s}).text("("+a+", "+r+")")}},i.prototype.addElementToDOM=function(e,t){if(!e||!t)return null;var i,a;return i=e.selectAll(t.selector),a=i.data(t.data||[[]]),a.enter().append(t.name).attr(t.attributes).style(t.styles).classed(t.className,!0),a.exit().remove(),a},i.prototype.renderBackground=function(){this.data.backdrop&&this.data.backdrop.show&&void 0!==this.data.backdrop.url?this.backgroundGraphicsContext.attr("xlink:href",this.data.backdrop.url).attr("x",0).attr("y",0).attr("width",this.viewportIn.width).attr("height",this.viewportIn.height):this.backgroundGraphicsContext.attr("width",0).attr("height",0)},i.prototype.renderChart=function(i,a,r,s,o,l,n,c,h){var u=this.bottomMarginLimit,d=this.leftRightMarginLimit,p=t.AnimatorCommon.GetAnimationDuration(this.animator,n);if(this.renderBackground(),this.shouldRenderAxis(a)){a.axis.orient("bottom"),a.willLabelsFit||a.axis.tickPadding(5);var g=this.xAxisGraphicsContext;p?g.transition().duration(p).call(a.axis).call(this.darkenZeroLine):g.call(a.axis).call(this.darkenZeroLine);var m=g.selectAll("g.tick").filter(function(e){return 0===e});if(m){var y=this.getValueAxisFill();y&&m.selectAll("line").style({stroke:y.solid.color})}var f=g.selectAll("text");a.willLabelsWordBreak?f.call(t.AxisHelper.LabelLayoutStrategy.wordBreak,a,u):f.call(t.AxisHelper.LabelLayoutStrategy.rotate,u,e.TextMeasurementService.getTailoredTextOrDefault,t.CartesianChart.AxisTextProperties,!a.willLabelsFit,u===s.xMax,a,this.margin,this.isXScrollBarVisible||this.isYScrollBarVisible)}else this.xAxisGraphicsContext.selectAll("*").remove();if(this.shouldRenderAxis(r)){var v=this.yAxisOrientation;r.axis.tickSize(-this.viewportIn.width).tickPadding(10).orient(v.toLowerCase());var x=this.y1AxisGraphicsContext;p?x.transition().duration(p).call(r.axis).call(this.darkenZeroLine):x.call(r.axis).call(this.darkenZeroLine);var b=x.selectAll("g.tick").filter(function(e){return 0===e});if(b){var S=this.getCategoryAxisFill();S&&b.selectAll("line").style({stroke:S.solid.color})}s.yLeft>=d&&x.selectAll("text").call(t.AxisHelper.LabelLayoutStrategy.clip,d-10,e.TextMeasurementService.svgEllipsis)}else this.y1AxisGraphicsContext.selectAll("*").remove();if(o){var w=!this.shouldRenderAxis(a,"showAxisTitle"),C=!this.shouldRenderAxis(r,"showAxisTitle"),D=this.valueAxisProperties&&null!=this.valueAxisProperties.secShowAxisTitle&&this.valueAxisProperties.secShowAxisTitle===!1;this.renderAxesLabels(l,this.legendViewport.height,w,C,D)}else this.axisGraphicsContext.selectAll(".xAxisLabel").remove(),this.axisGraphicsContext.selectAll(".yAxisLabel").remove()},i.prototype.renderAxesLabels=function(a,r,s,o,l){this.axisGraphicsContext.selectAll(".xAxisLabel").remove(),this.axisGraphicsContext.selectAll(".yAxisLabel").remove();var n=this.margin,c=this.viewportIn.width,h=this.viewport.height,u=i.AxisFontSize,d=this.yAxisOrientation,p=d===t.yAxisPosition.right;if(!s){var g=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(a.x).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"xAxisLabel",transform:t.SVGUtil.translate(c/2,h-u-2)})})});g.call(t.AxisHelper.LabelLayoutStrategy.clip,c,e.TextMeasurementService.svgEllipsis)}if(!o){var m=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(a.y).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"yAxisLabel",transform:"rotate(-90)",y:p?c+n.right-u:-n.left,x:-((h-n.top-r)/2),dy:"1em"})})});m.call(t.AxisHelper.LabelLayoutStrategy.clip,h-(n.bottom+n.top),e.TextMeasurementService.svgEllipsis)}if(!l&&a.y2){var y=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(a.y2).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"yAxisLabel",transform:"rotate(-90)",y:p?-n.left:c+n.right-u,x:-((h-n.top-r)/2),dy:"1em"})})});y.call(t.AxisHelper.LabelLayoutStrategy.clip,h-(n.bottom+n.top),e.TextMeasurementService.svgEllipsis);
}},i.prototype.updateAxis=function(){this.adjustMargins();var e=this.yAxisOrientation,i=e===t.yAxisPosition.right;this.xAxisGraphicsContext.attr("transform",t.SVGUtil.translate(0,this.viewportIn.height)),this.y1AxisGraphicsContext.attr("transform",t.SVGUtil.translate(i?this.viewportIn.width:0,0)),this.svg.attr({width:this.viewport.width,height:this.viewport.height}),this.svgScrollable.attr({width:this.viewport.width,height:this.viewport.height}),this.svgScrollable.attr({x:0});var a=this.margin.left,r=this.margin.top;this.axisGraphicsContext.attr("transform",t.SVGUtil.translate(a,r)),this.axisGraphicsContextScrollable.attr("transform",t.SVGUtil.translate(a,r)),this.clearCatcher.attr("transform",t.SVGUtil.translate(-a,-r)),this.isXScrollBarVisible?(this.svgScrollable.attr({x:a}),this.axisGraphicsContextScrollable.attr("transform",t.SVGUtil.translate(0,r)),this.svgScrollable.attr("width",this.viewportIn.width),this.svg.attr("width",this.viewport.width).attr("height",this.viewport.height+this.ScrollBarWidth)):this.isYScrollBarVisible&&(this.svgScrollable.attr("height",this.viewportIn.height+r),this.svg.attr("width",this.viewport.width+this.ScrollBarWidth).attr("height",this.viewport.height))},i.prototype.getUnitType=function(e){return e.formatter&&e.formatter.displayUnit&&e.formatter.displayUnit.value>1?e.formatter.displayUnit.title:null},i.prototype.addUnitTypeToAxisLabel=function(e,i){var a=this.getUnitType(e);e.isCategoryAxis?this.categoryAxisHasUnitType=null!==a:this.valueAxisHasUnitType=null!==a,e.axisLabel&&a&&(e.isCategoryAxis?e.axisLabel=t.AxisHelper.createAxisLabel(this.categoryAxisProperties,e.axisLabel,a):e.axisLabel=t.AxisHelper.createAxisLabel(this.valueAxisProperties,e.axisLabel,a)),a=this.getUnitType(i),i.isCategoryAxis?this.categoryAxisHasUnitType=null!==a:this.valueAxisHasUnitType=null!==a,i.axisLabel&&a&&(i.isCategoryAxis?i.axisLabel=t.AxisHelper.createAxisLabel(this.categoryAxisProperties,i.axisLabel,a):i.axisLabel=t.AxisHelper.createAxisLabel(this.valueAxisProperties,i.axisLabel,a))},i.prototype.hideAxisLabels=function(){return!(!(this.cartesianSmallViewPortProperties&&this.cartesianSmallViewPortProperties.hideAxesOnSmallViewPort&&this.viewport.height+this.legendViewport.height<this.cartesianSmallViewPortProperties.MinHeightAxesVisible)||this.options.interactivity.isInteractiveLegend)},i.prototype.drawScatterMarkers=function(e,a,r,s){var o,l=this,n=this.xAxisProperties.scale,c=this.yAxisProperties.scale,h=(!r||!r.min)&&this.data.fillPoint,u=this.data.useCustomColor;this.data.useShape?(this.mainGraphicsContext.selectAll(i.DotClasses.selector).remove(),o=this.mainGraphicsContext.classed("ScatterMarkers",!0).selectAll(i.ImageClasses.selector).data(e,function(e){return e.identity.getKey()}),o.enter().append("svg:image").classed(i.ImageClasses["class"],!0).attr("id","markerimage"),o.attr("xlink:href",function(e){return void 0!==e.svgurl&&null!=e.svgurl&&""!==e.svgurl?e.svgurl:l.svgDefaultImage}).attr("width",function(e){return 2*t.ScatterChart.getBubbleRadius(e.radius,r,l.viewport)}).attr("height",function(e){return 2*t.ScatterChart.getBubbleRadius(e.radius,r,l.viewport)}).transition().duration(function(e){return l.keyArray.indexOf(e.identity.getKey())>=0?s:0}).attr("transform",function(e){var i=t.ScatterChart.getBubbleRadius(e.radius,r,l.viewport);return"translate("+(n(e.x)-i)+","+(c(e.y)-i)+") rotate("+e.rotation+","+i+","+i+")"})):(this.mainGraphicsContext.selectAll(i.ImageClasses.selector).remove(),o=this.mainGraphicsContext.classed("ScatterMarkers",!0).selectAll(i.DotClasses.selector).data(e,function(e){return e.identity.getKey()}),o.enter().append("path").classed(i.DotClasses["class"],!0).attr("id","markershape"),o.style({"stroke-opacity":function(e){return t.ScatterChart.getBubbleOpacity(e,a)},"stroke-width":"1px",stroke:function(e){var t=u?e.colorFill:e.fill;return l.data.outline?d3.rgb(t).darker():d3.rgb(t)},fill:function(e){return d3.rgb(u?e.colorFill:e.fill)},"fill-opacity":function(e){return null!=e.size||h?t.ScatterChart.getBubbleOpacity(e,a):0}}).attr("d",function(e){var i=t.ScatterChart.getBubbleRadius(e.radius,r,l.viewport),a=4*i*i;return e.shapeSymbolType(a)}).transition().duration(function(e){return l.keyArray.indexOf(e.identity.getKey())>=0?s:0}).attr("transform",function(e){return"translate("+n(e.x)+","+c(e.y)+") rotate("+e.rotation+")"})),o.exit().remove(),this.keyArray=[];for(var d=0;d<e.length;d++)this.keyArray.push(e[d].identity.getKey());return o},i.prototype.calculateAxes=function(a,r,s,o){var l={viewport:this.viewport,margin:this.margin,forcedXDomain:[a?a.start:null,a?a.end:null],forceMerge:r&&r.secShow===!1,showCategoryAxisLabel:!1,showValueAxisLabel:!1,categoryAxisScaleType:a&&null!=a.axisScale?a.axisScale:null,valueAxisScaleType:r&&null!=r.axisScale?r.axisScale:null,valueAxisDisplayUnits:r&&null!=r.labelDisplayUnits?r.labelDisplayUnits:i.LabelDisplayUnitsDefault,categoryAxisDisplayUnits:a&&null!=a.labelDisplayUnits?a.labelDisplayUnits:i.LabelDisplayUnitsDefault,trimOrdinalDataOnOverflow:!1};r&&(l.forcedYDomain=t.AxisHelper.applyCustomizedDomain([r.start,r.end],l.forcedYDomain)),l.showCategoryAxisLabel=!!a&&!!a.showAxisTitle,l.showValueAxisLabel=!0;var n=this.viewport.width-(this.margin.left+this.margin.right),c=this.calculateAxesProperties(l);return c[0].willLabelsFit=t.AxisHelper.LabelLayoutStrategy.willLabelsFit(c[0],n,e.TextMeasurementService.measureSvgTextWidth,s),c[0].willLabelsWordBreak=!c[0].willLabelsFit&&!o&&t.AxisHelper.LabelLayoutStrategy.willLabelsWordBreak(c[0],this.margin,n,e.TextMeasurementService.measureSvgTextWidth,e.TextMeasurementService.estimateSvgTextHeight,e.TextMeasurementService.getTailoredTextOrDefault,s),c},i.prototype.calculateAxesProperties=function(e){var i=this.data,a=i.dataPoints;this.margin=e.margin,this.viewport=e.viewport;var r=0,s=10,o=0,l=10;a.length>0&&(r=d3.min(a,function(e){return e.y}),s=d3.max(a,function(e){return e.y}),o=d3.min(a,function(e){return e.x}),l=d3.max(a,function(e){return e.x}));var n=[o,l],c=t.AxisHelper.combineDomain(e.forcedXDomain,n);this.xAxisProperties=t.AxisHelper.createAxis({pixelSpan:this.viewportIn.width,dataDomain:c,metaDataColumn:i.xCol,formatString:t.valueFormatter.getFormatString(i.xCol,t.scatterChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!1,forcedTickCount:e.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!0,scaleType:e.categoryAxisScaleType,axisDisplayUnits:e.categoryAxisDisplayUnits}),this.xAxisProperties.axis.tickSize(-this.viewportIn.height,0),this.xAxisProperties.axisLabel=this.data.axesLabels.x;var h=t.AxisHelper.combineDomain(e.forcedYDomain,[r,s]);return this.yAxisProperties=t.AxisHelper.createAxis({pixelSpan:this.viewportIn.height,dataDomain:h,metaDataColumn:i.yCol,formatString:t.valueFormatter.getFormatString(i.yCol,t.scatterChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:e.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:e.valueAxisScaleType,axisDisplayUnits:e.valueAxisDisplayUnits}),this.yAxisProperties.axisLabel=this.data.axesLabels.y,[this.xAxisProperties,this.yAxisProperties]},i.prototype.enumerateDataPoints=function(e){var i=this.data;if(i){var a=i.dataPoints.length;if(i.hasDynamicSeries)for(var r=i.legendData.dataPoints.length,s=0;r>s;s++){var o=i.legendData.dataPoints[s];e.pushInstance({objectName:"dataPoint",displayName:o.label,selector:t.ColorHelper.normalizeSelector(o.identity.getSelector()),properties:{fill:{solid:{color:o.color}}}})}else{var l=i.showAllDataPoints;if(e.pushInstance({objectName:"dataPoint",selector:null,properties:{defaultColor:{solid:{color:i.defaultDataPointColor||this.colors.getColorByIndex(0).value}}}}).pushInstance({objectName:"dataPoint",selector:null,properties:{showAllDataPoints:l}}),l)for(var s=0;a>s;s++){var n=i.dataPoints[s];e.pushInstance({objectName:"dataPoint",displayName:n.formattedCategory.getValue(),selector:t.ColorHelper.normalizeSelector(n.identity.getSelector(),!0),properties:{fill:{solid:{color:n.fill}}}})}}}},i.prototype.enumerateObjectInstances=function(e){var i=new t.ObjectEnumerationBuilder;switch(e.objectName){case"dataPoint":var a=this.dataView&&this.dataView.categorical?this.dataView.categorical:null;t.GradientUtils.hasGradientRole(a)||this.enumerateDataPoints(i);break;case"categoryAxis":this.getCategoryAxisValues(i);break;case"valueAxis":this.getValueAxisValues(i);break;case"categoryLabels":this.data?t.dataLabelUtils.enumerateCategoryLabels(i,this.data.dataLabelsSettings,!0):t.dataLabelUtils.enumerateCategoryLabels(i,null,!0);break;case"fillPoint":var r=this.data.sizeRange;if(r&&r.min)break;i.pushInstance({objectName:"fillPoint",selector:null,properties:{show:this.data.fillPoint}});break;case"backdrop":i.pushInstance({objectName:"backdrop",displayName:"Backdrop",selector:null,properties:{show:this.data.backdrop?this.data.backdrop.show:!1,url:this.data.backdrop?this.data.backdrop.url:null}});break;case"crosshair":i.pushInstance({objectName:"crosshair",selector:null,properties:{show:this.data.crosshair}});break;case"outline":i.pushInstance({objectName:"outline",selector:null,properties:{show:this.data.outline}});break;case"legend":this.getLegendValue(i)}return i.complete()},i.prototype.hasLegend=function(){return this.data&&this.data.hasDynamicSeries},i.prototype.getLegendValue=function(a){if(this.hasLegend()){var r=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.show,this.legend.isVisible()),s=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.showTitle,!0),o=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.titleText,this.layerLegendData?this.layerLegendData.title:""),l=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.labelColor,t.LegendData.DefaultLegendLabelFillColor);this.legendLabelFontSize=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.fontSize,i.LegendLabelFontSizeDefault),a.pushInstance({selector:null,properties:{show:r,position:t.LegendPosition[this.legend.getOrientation()],showTitle:s,titleText:o,labelColor:l,fontSize:this.legendLabelFontSize},objectName:"legend"})}},i.prototype.getCategoryAxisValues=function(e){var a=t.axisType.both,r=!0,s=!1,o=[t.axisScale.log,t.axisScale.linear];r||this.categoryAxisProperties&&(this.categoryAxisProperties.start=null,this.categoryAxisProperties.end=null);var l={selector:null,properties:{},objectName:"categoryAxis",validValues:{axisScale:o}};l.properties.show=this.categoryAxisProperties&&null!=this.categoryAxisProperties.show?this.categoryAxisProperties.show:!0,this.yAxisIsCategorical&&(l.properties.position=this.valueAxisProperties&&null!=this.valueAxisProperties.position?this.valueAxisProperties.position:t.yAxisPosition.left),a===t.axisType.both&&(l.properties.axisType=r?t.axisType.scalar:t.axisType.categorical),r&&(l.properties.axisScale=this.categoryAxisProperties&&null!=this.categoryAxisProperties.axisScale&&s?this.categoryAxisProperties.axisScale:t.axisScale.linear,l.properties.start=this.categoryAxisProperties?this.categoryAxisProperties.start:null,l.properties.end=this.categoryAxisProperties?this.categoryAxisProperties.end:null,l.properties.labelDisplayUnits=this.categoryAxisProperties&&null!=this.categoryAxisProperties.labelDisplayUnits?this.categoryAxisProperties.labelDisplayUnits:i.LabelDisplayUnitsDefault),l.properties.showAxisTitle=this.categoryAxisProperties&&null!=this.categoryAxisProperties.showAxisTitle?this.categoryAxisProperties.showAxisTitle:!0,e.pushInstance(l).pushInstance({selector:null,properties:{axisStyle:this.categoryAxisProperties&&this.categoryAxisProperties.axisStyle?this.categoryAxisProperties.axisStyle:t.axisStyle.showTitleOnly,labelColor:this.categoryAxisProperties?this.categoryAxisProperties.labelColor:null},objectName:"categoryAxis",validValues:{axisStyle:this.categoryAxisHasUnitType?[t.axisStyle.showTitleOnly,t.axisStyle.showUnitOnly,t.axisStyle.showBoth]:[t.axisStyle.showTitleOnly]}})},i.prototype.getValueAxisValues=function(e){var a=[t.axisScale.log,t.axisScale.linear],r=!1,s={selector:null,properties:{},objectName:"valueAxis",validValues:{axisScale:a,secAxisScale:a}};s.properties.show=this.valueAxisProperties&&null!=this.valueAxisProperties.show?this.valueAxisProperties.show:!0,this.yAxisIsCategorical||(s.properties.position=this.valueAxisProperties&&null!=this.valueAxisProperties.position?this.valueAxisProperties.position:t.yAxisPosition.left),s.properties.axisScale=this.valueAxisProperties&&null!=this.valueAxisProperties.axisScale&&r?this.valueAxisProperties.axisScale:t.axisScale.linear,s.properties.start=this.valueAxisProperties?this.valueAxisProperties.start:null,s.properties.end=this.valueAxisProperties?this.valueAxisProperties.end:null,s.properties.showAxisTitle=this.valueAxisProperties&&null!=this.valueAxisProperties.showAxisTitle?this.valueAxisProperties.showAxisTitle:!0,s.properties.labelDisplayUnits=this.valueAxisProperties&&null!=this.valueAxisProperties.labelDisplayUnits?this.valueAxisProperties.labelDisplayUnits:i.LabelDisplayUnitsDefault,e.pushInstance(s).pushInstance({selector:null,properties:{axisStyle:this.valueAxisProperties&&null!=this.valueAxisProperties.axisStyle?this.valueAxisProperties.axisStyle:t.axisStyle.showTitleOnly,labelColor:this.valueAxisProperties?this.valueAxisProperties.labelColor:null},objectName:"valueAxis",validValues:{axisStyle:this.valueAxisHasUnitType?[t.axisStyle.showTitleOnly,t.axisStyle.showUnitOnly,t.axisStyle.showBoth]:[t.axisStyle.showTitleOnly]}})},i.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},i.DefaultBubbleOpacity=.85,i.DimmedBubbleOpacity=.4,i.ClassName="enhancedScatterChart",i.MainGraphicsContextClassName="mainGraphicsContext",i.LegendLabelFontSizeDefault=9,i.LabelDisplayUnitsDefault=0,i.AxisFontSize=11,i.DotClasses=s("dot"),i.ImageClasses=s("img"),i.CrosshairCanvasSelector=s("crosshairCanvas"),i.CrosshairLineSelector=s("crosshairLine"),i.CrosshairVerticalLineSelector=s("crosshairVerticalLine"),i.CrosshairHorizontalLineSelector=s("crosshairHorizontalLine"),i.CrosshairTextSelector=s("crosshairText"),i.CrosshairTextMargin=5,i.ColumnCategory="Category",i.ColumnSeries="Series",i.ColumnX="X",i.ColumnY="Y",i.ColumnSize="Size",i.ColumnGradient="Gradient",i.ColumnColorFill="ColorFill",i.ColumnShape="Shape",i.ColumnImage="Image",i.ColumnRotation="Rotation",i.ColumnBackdrop="Backdrop",i.ColumnXStart="X Start",i.ColumnXEnd="X End",i.ColumnYStart="Y Start",i.ColumnYEnd="Y End",i.capabilities={dataRoles:[{name:i.ColumnCategory,kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Details")},{name:i.ColumnSeries,kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Legend")},{name:i.ColumnX,kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_X")},{name:i.ColumnY,kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Y")},{name:i.ColumnSize,kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Size")},{name:i.ColumnGradient,kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Gradient")},{name:i.ColumnColorFill,kind:e.VisualDataRoleKind.Grouping,displayName:"Customized Color"},{name:i.ColumnShape,kind:e.VisualDataRoleKind.Measure,displayName:"Shape"},{name:i.ColumnImage,kind:e.VisualDataRoleKind.Grouping,displayName:"Image"},{name:i.ColumnRotation,kind:e.VisualDataRoleKind.Measure,displayName:"Rotation"},{name:i.ColumnBackdrop,kind:e.VisualDataRoleKind.Grouping,displayName:"Backdrop"},{name:i.ColumnXStart,kind:e.VisualDataRoleKind.Measure,displayName:"X Start"},{name:i.ColumnXEnd,kind:e.VisualDataRoleKind.Measure,displayName:"X End"},{name:i.ColumnYStart,kind:e.VisualDataRoleKind.Measure,displayName:"Y Start"},{name:i.ColumnYEnd,kind:e.VisualDataRoleKind.Measure,displayName:"Y End"}],dataViewMappings:[{conditions:[(a={},a[i.ColumnCategory]={max:1},a[i.ColumnSeries]={max:1},a[i.ColumnX]={max:1},a[i.ColumnY]={max:1},a[i.ColumnSize]={max:1},a[i.ColumnGradient]={max:0},a[i.ColumnColorFill]={max:1},a[i.ColumnShape]={max:1},a[i.ColumnImage]={max:0},a[i.ColumnRotation]={max:1},a[i.ColumnBackdrop]={max:1},a[i.ColumnXStart]={max:1},a[i.ColumnXEnd]={max:1},a[i.ColumnYStart]={max:1},a[i.ColumnYEnd]={max:1},a),(c={},c[i.ColumnCategory]={max:1},c[i.ColumnSeries]={max:0},c[i.ColumnX]={max:1},c[i.ColumnY]={max:1},c[i.ColumnSize]={max:1},c[i.ColumnGradient]={max:1},c[i.ColumnColorFill]={max:1},c[i.ColumnShape]={max:1},c[i.ColumnImage]={max:0},c[i.ColumnRotation]={max:1},c[i.ColumnBackdrop]={max:1},c[i.ColumnXStart]={max:1},c[i.ColumnXEnd]={max:1},c[i.ColumnYStart]={max:1},c[i.ColumnYEnd]={max:1},c),(h={},h[i.ColumnCategory]={max:1},h[i.ColumnSeries]={max:1},h[i.ColumnX]={max:1},h[i.ColumnY]={max:1},h[i.ColumnSize]={max:1},h[i.ColumnGradient]={max:0},h[i.ColumnColorFill]={max:0},h[i.ColumnShape]={max:0},h[i.ColumnImage]={max:1},h[i.ColumnRotation]={max:1},h[i.ColumnBackdrop]={max:1},h[i.ColumnXStart]={max:1},h[i.ColumnXEnd]={max:1},h[i.ColumnYStart]={max:1},h[i.ColumnYEnd]={max:1},h),(u={},u[i.ColumnCategory]={max:1},u[i.ColumnSeries]={max:0},u[i.ColumnX]={max:1},u[i.ColumnY]={max:1},u[i.ColumnSize]={max:1},u[i.ColumnGradient]={max:1},u[i.ColumnColorFill]={max:0},u[i.ColumnShape]={max:0},u[i.ColumnImage]={max:1},u[i.ColumnRotation]={max:1},u[i.ColumnBackdrop]={max:1},u[i.ColumnXStart]={max:1},u[i.ColumnXEnd]={max:1},u[i.ColumnYStart]={max:1},u[i.ColumnYEnd]={max:1},u)],categorical:{categories:{"for":{"in":i.ColumnCategory},dataReductionAlgorithm:{sample:{}}},values:{group:{by:i.ColumnSeries,select:[{bind:{to:i.ColumnX}},{bind:{to:i.ColumnY}},{bind:{to:i.ColumnSize}},{bind:{to:i.ColumnGradient}},{bind:{to:i.ColumnColorFill}},{bind:{to:i.ColumnShape}},{bind:{to:i.ColumnImage}},{bind:{to:i.ColumnRotation}},{bind:{to:i.ColumnBackdrop}},{bind:{to:i.ColumnXStart}},{bind:{to:i.ColumnXEnd}},{bind:{to:i.ColumnYStart}},{bind:{to:i.ColumnYEnd}}],dataReductionAlgorithm:{top:{}}}},rowCount:{preferred:{min:2}}}}],objects:{dataPoint:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint"),properties:{defaultColor:{displayName:e.data.createDisplayNameGetter("Visual_DefaultColor"),type:{fill:{solid:{color:!0}}}},showAllDataPoints:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint_Show_All"),type:{bool:!0}},useShape:{displayName:e.data.createDisplayNameGetter("Visual_UseImage"),type:{bool:!0}},fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},fillRule:{displayName:e.data.createDisplayNameGetter("Visual_Gradient"),type:{fillRule:{}},rule:{inputRole:i.ColumnGradient,output:{property:"fill",selector:[i.ColumnCategory]}}}}},general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},categoryAxis:{displayName:e.data.createDisplayNameGetter("Visual_XAxis"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},axisScale:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Scale"),type:{formatting:{axisScale:!0}}},start:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Start"),type:{numeric:!0}},end:{displayName:e.data.createDisplayNameGetter("Visual_Axis_End"),type:{numeric:!0}},showAxisTitle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Title"),type:{bool:!0}},axisStyle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Style"),type:{formatting:{axisStyle:!0}}},axisColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}}}},valueAxis:{displayName:e.data.createDisplayNameGetter("Visual_YAxis"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_YAxis_Position"),type:{formatting:{yAxisPosition:!0}}},axisScale:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Scale"),type:{formatting:{axisScale:!0}}},start:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Start"),type:{numeric:!0}},end:{displayName:e.data.createDisplayNameGetter("Visual_Axis_End"),type:{numeric:!0}},showAxisTitle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Title"),type:{bool:!0}},axisStyle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Style"),type:{formatting:{axisStyle:!0}}},axisColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}}}},legend:{displayName:e.data.createDisplayNameGetter("Visual_Legend"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_LegendPosition"),description:e.data.createDisplayNameGetter("Visual_LegendPositionDescription"),type:{enumeration:t.legendPosition.type}},showTitle:{displayName:e.data.createDisplayNameGetter("Visual_LegendShowTitle"),description:e.data.createDisplayNameGetter("Visual_LegendShowTitleDescription"),type:{bool:!0}},titleText:{displayName:"Legend Name",description:e.data.createDisplayNameGetter("Visual_LegendNameDescription"),type:{text:!0}},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},categoryLabels:{displayName:e.data.createDisplayNameGetter("Visual_CategoryLabels"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_LabelsFill"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},fillPoint:{displayName:e.data.createDisplayNameGetter("Visual_FillPoint"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{bool:!0}}}},backdrop:{displayName:"Backdrop",properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},url:{displayName:"Image URL",type:{text:!0}}}},crosshair:{displayName:"Crosshair",properties:{show:{displayName:"Crosshair",type:{bool:!0}}}},outline:{displayName:"Outline",properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Outline"),type:{bool:!0}}}}}},i;var a,c,h,u}();i.EnhancedScatterChart=c}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){function i(){}var a,r,s,o,o=(window.jsCommon,window.powerbi);window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var o;!function(o){var l=e.data.DataRoleHelper,n=function(){function o(){this.data=[],this.locationsToLoad=0,this.locationsLoaded=0,this.renderLoopEnabled=!0,this.needsRender=!1}return o.converter=function(e){return{}},o.prototype.enumerateObjectInstances=function(e){var i=new t.ObjectEnumerationBuilder;switch(e.objectName){case"dataPoint":this.enumerateDataPoints(i)}return i.complete()},o.prototype.enumerateDataPoints=function(e){var i=this.data;if(i)for(var a=this.dataPointsToEnumerate,r=a.length,s=0;r>s;s++){var o=a[s];e.pushInstance({objectName:"dataPoint",displayName:o.label,selector:t.ColorHelper.normalizeSelector(o.identity.getSelector()),properties:{fill:{solid:{color:o.color}}}})}},o.prototype.init=function(e){this.container=e.element,this.viewport=e.viewport,this.readyToRender=!1,this.globeMapLocationCache||(this.globeMapLocationCache={}),this.style=e.style,this.colors=this.style.colorPalette.dataColors,this.colorHelper=new t.ColorHelper(this.colors,o.Properties.dataPoint.fill),a||i(),a&&this.setup()},o.prototype.setup=function(){this.initSettings(),this.initTextures(),this.initMercartorSphere(),this.initZoomControl(),this.initScene(),this.initHeatmap(),this.readyToRender=!0,this.composeRenderData(),this.initRayCaster()},o.prototype.initSettings=function(){var e=this.settings={};e.autoRotate=!1,e.earthRadius=30,e.cameraRadius=100,e.earthSegments=100,e.heatmapSize=1e3,e.heatPointSize=7,e.heatIntensity=10,e.heatmapScaleOnZoom=.95,e.barWidth=.3,e.barHeight=5,e.rotateSpeed=.5,e.zoomSpeed=.8,e.cameraAnimDuration=1e3,e.clickInterval=200},o.prototype.initScene=function(){var e=this.viewport,t=this.settings,i=new a.Clock,r=this.renderer=new a.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});this.container.append(r.domElement),this.domElement=r.domElement;var s=this.camera=new a.PerspectiveCamera(35,e.width/e.height,.1,1e4),o=this.orbitControls=new a.OrbitControls(s,this.domElement),l=this.scene=new a.Scene;r.setSize(e.width,e.height),r.setClearColor(12240082,1),s.position.z=t.cameraRadius,o.maxDistance=t.cameraRadius,o.minDistance=t.earthRadius+1,o.rotateSpeed=t.rotateSpeed,o.zoomSpeed=t.zoomSpeed,o.autoRotate=t.autoRotate;var n=new a.AmbientLight(0),c=new a.DirectionalLight(16777215,.4),h=new a.DirectionalLight(16777215,.4),u=this.earth=this.createEarth();l.add(n),l.add(c),l.add(h),l.add(u),c.position.set(20,20,20),h.position.set(0,0,-20);var d=this;requestAnimationFrame(function p(){try{if(d.renderLoopEnabled&&requestAnimationFrame(p),!d.shouldRender())return;o.update(i.getDelta()),d.setEarthTexture(),d.intersectBars(),d.heatmap&&d.heatmap.display&&d.heatmap.display(),r.render(l,s),d.needsRender=!1}catch(e){}})},o.prototype.shouldRender=function(){return this.readyToRender&&this.needsRender},o.prototype.createEarth=function(){var e=new o.MercartorSphere(this.settings.earthRadius,this.settings.earthSegments,this.settings.earthSegments),t=new a.MeshPhongMaterial({map:this.mapTextures[0],side:a.DoubleSide,shininess:1,emissive:11184810});return new a.Mesh(e,t)},o.prototype.zoomClicked=function(e){this.orbitControls.enabled!==!1&&this.orbitControls.enableZoom!==!1&&(-1===e?this.orbitControls.constraint.dollyOut(Math.pow(.95,this.settings.zoomSpeed)):1===e&&this.orbitControls.constraint.dollyIn(Math.pow(.95,this.settings.zoomSpeed)),this.orbitControls.update(),this.animateCamera(this.camera.position))},o.prototype.rotateCam=function(e,t){this.orbitControls.enabled!==!1&&this.orbitControls.enableRotate!==!1&&(this.orbitControls.constraint.rotateLeft(2*Math.PI*e/this.domElement.offsetHeight*this.settings.rotateSpeed),this.orbitControls.constraint.rotateUp(2*Math.PI*t/this.domElement.offsetHeight*this.settings.rotateSpeed),this.orbitControls.update(),this.animateCamera(this.camera.position))},o.prototype.initTextures=function(){var e=this;if(!s){s=[];for(var t=2;5>=t;++t){var i=this.getBingMapCanvas(t);s.push(i)}}var r=function(t){var i=new a.Texture(t.get(0));return i.needsUpdate=!0,t.on("ready",function(t,a){i.needsUpdate=!0,e.needsRender=!0}),i};this.mapTextures=[];for(var o=0;o<s.length;++o)this.mapTextures.push(r(s[o]))},o.prototype.initHeatmap=function(){var e=this.settings;try{var t=this.heatmap=new r({width:e.heatmapSize,height:e.heatmapSize,intensityToAlpha:!0})}catch(i){}var s=this.heatTexture=new a.Texture(t.canvas);s.needsUpdate=!0;var o=new a.MeshBasicMaterial({map:s,transparent:!0}),l=new a.SphereGeometry(e.earthRadius+.01,e.earthSegments,e.earthSegments),n=new a.Mesh(l,o);window.heatmap=t,window.heatmapTexture=s,this.scene.add(n)},o.prototype.setEarthTexture=function(){if(this.camera){var e,t=this.settings.cameraRadius-this.settings.earthRadius,i=(this.camera.position.length()-this.settings.earthRadius)/t;e=.2>=i?this.mapTextures[3]:.4>=i?this.mapTextures[2]:.6>=i?this.mapTextures[1]:this.mapTextures[0],this.earth.material.map!==e&&(this.earth.material.map=e),this.selectedBar?this.orbitControls.rotateSpeed=this.settings.rotateSpeed:this.orbitControls.rotateSpeed=this.settings.rotateSpeed*i}},o.prototype.update=function(e){if(this.needsRender=!0,e.viewport.height!==this.viewport.height||e.viewport.width!==this.viewport.width){var t=this.viewport=e.viewport;return void(this.camera&&this.renderer&&(this.camera.aspect=t.width/t.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(t.width,t.height)))}this.cleanHeatAndBar(),e.dataViews[0]&&(e.dataViews[0].categorical||e.dataViews[0].metadata)&&this.composeRenderData(e.dataViews[0].categorical,e.dataViews[0].metadata)},o.prototype.cleanHeatAndBar=function(){this.heatmap.clear(),this.heatTexture.needsUpdate=!0,this.barsGroup&&this.scene.remove(this.barsGroup)},o.prototype.renderMagic=function(){if(!this.readyToRender)return void this.defferedRender();var e=this.data,t=this.heatmap,i=this.settings;t.clear(),this.barsGroup&&this.scene.remove(this.barsGroup),this.barsGroup=new a.Object3D,this.scene.add(this.barsGroup),this.averageBarVector=new a.Vector3;for(var r=0,s=e.length;s>r;++r){var o=e[r];if(o.lat&&o.lng){if(o.heat>.001){o.heat<.1&&(o.heat=.1);var l=(180+o.lng)/360*i.heatmapSize,n=(1-(90+o.lat)/180)*i.heatmapSize;t.addPoint(l,n,i.heatPointSize,o.heat*i.heatIntensity)}if(o.height>=0){o.height<.01&&(o.height=.01);var c=o.lat/180*Math.PI,h=o.lng/180*Math.PI,l=Math.cos(h)*Math.cos(c),u=-Math.sin(h)*Math.cos(c),n=Math.sin(c),d=new a.Vector3(l,n,u);this.averageBarVector.add(d);var p=i.barHeight*o.height,g=[],m=[];if(o.heightBySeries)for(var y=0;y<o.heightBySeries.length;y++)o.heightBySeries[y]&&g.push(o.heightBySeries[y]),m.push(o.seriesToolTipData[y]);else g.push(1);for(var f=0,v=0;v<g.length;v++){f+=g[v];var x=new a.CubeGeometry(i.barWidth,i.barWidth,p*g[v]),b=new a.Mesh(x,this.getBarMaterialByIndex(v));b.position=d.clone().multiplyScalar(i.earthRadius+p/2*f),b.lookAt(d),b.toolTipData=0===m.length?o.toolTipData:this.getToolTipDataForSeries(o.toolTipData,m[v]),this.barsGroup.add(b),f+=g[v]}}}}this.barsGroup.children.length>0&&this.camera&&(this.averageBarVector.multiplyScalar(1/this.barsGroup.children.length),this.locationsLoaded===this.locationsToLoad&&this.animateCamera(this.averageBarVector)),t.update(),t.blur(),this.heatTexture.needsUpdate=!0,this.needsRender=!0},o.prototype.getBarMaterialByIndex=function(e){return new a.MeshPhongMaterial({color:this.dataPointsToEnumerate[e].color})},o.prototype.getToolTipDataForSeries=function(e,t){var i=jQuery.extend(!0,{series:{displayName:t.displayName,value:t.value}},e);return i.height.value=t.dataPointValue,i},o.prototype.createDataPointForEnumeration=function(e,i,a,r){var s=e.values[i].source,o=t.converterHelper.getFormattedLegendLabel(s,e.values,null),l=t.SelectionId.createWithId(e.identity),n=t.converterHelper.getSeriesName(s),c=e.objects&&e.objects.dataPoint?e.objects.dataPoint.fill.solid.color:r&&r.objects?this.colorHelper.getColorForMeasure(r.objects,""):this.colors.getColorByIndex(a).value;return{label:o,identity:l,category:n,color:c,selected:null}},o.prototype.composeRenderData=function(e,i){e?this.categoricalView=e:e=this.categoricalView,this.data=[],this.dataPointsToEnumerate=[];var a=[],r=this.globeMapLocationCache;if(e){var s=0,o=0,n=[];try{e.categories&&(n=e.categories);var c=e.values.grouped();s=l.getMeasureIndexOfRole(c,"Height"),o=l.getMeasureIndexOfRole(c,"Heat");var h=l.getMeasureIndexOfRole(c,"X"),u=l.getMeasureIndexOfRole(c,"Y")}catch(d){}var p,g,m,y,f,v,x,b,S,w,C,D;if(n&&n.length>0&&n[0].values){var P=n[0];a=P.values,b=P.source.displayName,p=P.source.type.category?P.source.type.category.toLowerCase():""}else a=[];if(void 0!==s&&e.values[s]&&void 0!==e.values)if(S=e.values[s].source.displayName,C=e.values[s].source.format,c.length>1){g=new Array(a.length),m=new Array(a.length),y=new Array(a.length),this.dataPointsToEnumerate=new Array(c.length);for(var A=0;A<c.length;A++){var N=c[A].values[s].values;this.dataPointsToEnumerate[A]=this.createDataPointForEnumeration(c[A],s,A);for(var V=0;V<N.length;V++)g[V]||(g[V]=0),g[V]+=N[V]?N[V]:0,m[V]||(m[V]=[]),m[V][A]=N[V],y[V]||(y[V]=[]),y[V][A]={displayName:e.values.source.displayName,value:c[A].name,dataPointValue:N[V]}}for(var A=0;A<c.length;A++)for(var N=c[A].values[s].values,V=0;V<N.length;V++)m[V][A]=N[V]/g[V]}else g=e.values[s].values,m=new Array(c.length),this.dataPointsToEnumerate[0]=this.createDataPointForEnumeration(c[0],s,0,i);else m=new Array(a.length),
g=new Array(a.length);if(void 0!==o&&e.values[o]){if(c.length>1){f=new Array(a.length);for(var A=0;A<c.length;A++)for(var N=c[A].values[o].values,V=0;V<N.length;V++)f[V]||(f[V]=0),f[V]+=N[V]?N[V]:0}else f=e.values[o].values;w=e.values[o].source.displayName,D=e.values[o].source.format}else f=new Array(a.length);void 0!==h&&e.values[h]&&void 0!==u&&e.values[u]?(x=e.values[h].values,v=e.values[u].values):(x=null,v=null);for(var T=Math.max.apply(null,g)||1,L=Math.max.apply(null,f)||1,M=t.valueFormatter.create({format:D,value:f[0],value2:f[1]}),k=t.valueFormatter.create({format:C,value:g[0],value2:g[1]}),A=0,j=a.length;j>A;++A){var O,I,F,G,z,R=a[A];if(R&&"string"==typeof R){R=R.toLowerCase();var B=R+"/"+p;!x&&r[B]?(F=r[B],O=F.latitude,I=F.longitude):x&&(O=v[A],I=x[A]),G=g[A]/T,z=f[A]/L;var H={lat:O,lng:I,height:G?G||.01:void 0,heightBySeries:m[A],seriesToolTipData:y?y[A]:void 0,heat:z||0,toolTipData:{location:{displayName:b,value:a[A]},height:{displayName:S,value:k.format(g[A])},heat:{displayName:w,value:M.format(f[A])}}};this.data.push(H),x||F||this.geocodeRenderDatum(H,R,p)}}try{this.renderMagic()}catch(d){}}},o.prototype.geocodeRenderDatum=function(i,a,r){var s=this,o=a+"/"+r;this.globeMapLocationCache[o]={},this.locationsToLoad++;try{var l=e.visuals.BI.Services.GeocodingManager.geocode}catch(n){l=t.services.geocode}l&&l(a,r).always(function(e){s.globeMapLocationCache[o]=e,s.locationsLoaded++,e.latitude&&e.longitude&&(i.lat=e.latitude,i.lng=e.longitude,s.defferedRender())})},o.prototype.defferedRender=function(){var e=this;this.deferredRenderTimerId||(this.deferredRenderTimerId=setTimeout(function(){e.deferredRenderTimerId=null,e.composeRenderData()},500))},o.prototype.initRayCaster=function(){var e=this;this.rayCaster=new a.Raycaster;var t,i=this.settings,r=this.mousePosNormalized=new a.Vector2,s=this.mousePos=new a.Vector2,o=this.container.get(0);$(this.domElement).on("mousemove",function(t){var i=o.getBoundingClientRect();s.x=t.clientX,s.y=t.clientY,r.x=(t.clientX-i.left)/i.width*2-1,r.y=2*-((t.clientY-i.top)/i.height)+1,e.needsRender=!0}).on("mousedown",function(e){t=Date.now()}).on("mouseup",function(a){Date.now()-t>i.clickInterval||(e.hoveredBar&&a.shiftKey?(e.selectedBar=e.hoveredBar,e.animateCamera(e.selectedBar.position,function(){e.selectedBar&&(e.orbitControls.center.copy(e.selectedBar.position.clone().normalize().multiplyScalar(i.earthRadius)),e.orbitControls.minDistance=1)})):e.selectedBar&&(e.animateCamera(e.selectedBar.position,function(){e.orbitControls.center.set(0,0,0),e.orbitControls.minDistance=i.earthRadius+1}),e.selectedBar=null))}).on("mousewheel DOMMouseScroll",function(t){if(e.needsRender=!0,e.orbitControls.enabled&&e.orbitControls.enableZoom){e.heatTexture.needsUpdate=!0,t=t.originalEvent;var i=t.wheelDelta>0||t.detail<0?1:-1,a=i>0?e.settings.heatmapScaleOnZoom:1/e.settings.heatmapScaleOnZoom;e.heatmap.multiply(a),e.heatmap.update()}})},o.prototype.intersectBars=function(){if(this.rayCaster&&this.barsGroup){var e=this.rayCaster;e.setFromCamera(this.mousePosNormalized,this.camera);var i=e.intersectObjects(this.barsGroup.children);if(i&&i.length>0){var a=i[0].object;if(!a||!a.toolTipData)return;var r=a.toolTipData,s=[];r.location.displayName&&s.push(r.location),r.series&&s.push(r.series),r.height.displayName&&s.push(r.height),r.heat.displayName&&s.push(r.heat),this.hoveredBar=a,t.TooltipManager.ToolTipInstance.show(s,{x:this.mousePos.x,y:this.mousePos.y,width:0,height:0})}else this.hoveredBar=null,t.TooltipManager.ToolTipInstance.hide()}},o.prototype.animateCamera=function(e,t){var i=this;if(this.camera){var r=Date.now(),s=this.settings.cameraAnimDuration,o=r+s,l=this.camera.position.clone().normalize(),n=e.clone().normalize(),c=this.camera.position.length(),h=function(e){return e*=2,1>e?e*e*e/2:(e-=2,(e*e*e+2)/2)},u=function(){var e=Date.now(),d=(e-r)/s;d>1&&(d=1),d=h(d);var p=(new a.Vector3).add(l.clone().multiplyScalar(1-d)).add(n.clone().multiplyScalar(d)).normalize().multiplyScalar(c);i.camera.position=p,o>e?requestAnimationFrame(u):t&&t(),i.needsRender=!0};requestAnimationFrame(u)}},o.prototype.destroy=function(){if(clearTimeout(this.deferredRenderTimerId),this.renderLoopEnabled=!1,this.scene=null,this.heatmap=null,this.heatTexture=null,this.camera=null,this.renderer){if(this.renderer.context){var e=this.renderer.context.getExtension("WEBGL_lose_context");e&&e.loseContext(),this.renderer.context=null}this.renderer.domElement=null}this.renderer=null,this.data=null,this.barsGroup=null,this.orbitControls&&this.orbitControls.dispose(),this.orbitControls=null,this.domElement&&$(this.domElement).off("mousemove mouseup mousedown mousewheel DOMMouseScroll"),this.domElement=null,this.container&&this.container.empty()},o.prototype.initZoomControl=function(){var e=this,t=17,i=8.5*t,a=8.5*t,r=3*t,s=t+3,o=2*t,l={position:"absolute",left:"calc(100% - "+i+"px)",top:"calc(100% - "+a+"px)",zIndex:"1000"},n=d3.select(this.container[0]).append("div").style(l);this.zoomControl=n.append("svg").attr({width:i,height:a});var c=this.zoomControl.append("g").on("click",function(){return e.rotateCam(0,-5)});c.append("circle").attr({cx:r+o,cy:s+2*o,r:t,fill:"white",opacity:.5,stroke:"gray"}),c.append("path").attr({d:"M"+(r+2*t)+" "+(s+4.7*t)+" l12 -20 a40,70 0 0,1 -24,0z",fill:"gray"});var h=this.zoomControl.append("g").on("click",function(){return e.rotateCam(5,0)});h.append("circle").attr({cx:r,cy:s+o,r:t,fill:"white",stroke:"gray",opacity:.5}),h.append("path").attr({d:"M"+(r-t/1.5)+" "+(s+2*t)+" l20 -12 a70,40 0 0,0 0,24z",fill:"gray"});var u=this.zoomControl.append("g").on("click",function(){return e.rotateCam(0,5)});u.append("circle").attr({cx:r+o,cy:s,r:t,fill:"white",stroke:"gray",opacity:.5}),u.append("path").attr({d:"M"+(r+2*t)+" "+(s-t/1.5)+" l12 20 a40,70 0 0,0 -24,0z",fill:"gray"});var d=this.zoomControl.append("g").on("click",function(){return e.rotateCam(-5,0)});d.append("circle").attr({cx:r+2*o,cy:s+o,r:t,fill:"white",stroke:"gray",opacity:.5}),d.append("path").attr({d:"M"+(r+4.7*t)+" "+(s+2*t)+" l-20 -12 a70,40 0 0,1 0,24z",fill:"gray"});var p=this.zoomControl.append("g").on("click",function(){return e.zoomClicked(-1)});p.append("circle").attr({cx:r+4*t,cy:s+6*t,r:t,fill:"white",stroke:"gray",opacity:.5}),p.append("rect").attr({x:r+3.5*t,y:s+5.9*t,width:t,height:t/3,fill:"gray"}),p.append("rect").attr({x:r+4*t-t/6,y:s+5.55*t,width:t/3,height:t,fill:"gray"});var g=this.zoomControl.append("g").on("click",function(){return e.zoomClicked(1)});g.append("circle").attr({cx:r,cy:s+6*t,r:t,fill:"white",stroke:"gray",opacity:"0.50"}),g.append("rect").attr({x:r-t/2,y:s+5.9*t,width:t,height:t/3,fill:"gray"})},o.prototype.initMercartorSphere=function(){if(!o.MercartorSphere){var e=function(e,t,i){function r(e,t,i){return(1-i)*e+i*t}function s(e,t,i){var s=2*Math.PI,o=Math.PI,l=this.radius,n=-l*Math.cos(e*s)*Math.sin(t*o),c=-l*Math.cos(t*o),h=l*Math.sin(e*s)*Math.sin(t*o),u=e*l*2-l,d=t*l*2-l,p=0,g=r(n,u,i),m=r(c,d,i),y=r(h,p,i);return new a.Vector3(g,m,y)}function o(e,t,i){var r=90*(t-.5)*2/180*Math.PI,s=Math.sin(r),o=.5+.25*Math.log((1+s)/(1-s))/Math.PI;return new a.Vector2(e,o)}a.Geometry.call(this),this.radius=e,this.widthSegments=t,this.heightSegments=i,this.t=0;var l,n,c=[],h=[];for(n=0;i>=n;n++){var u=[],d=[];for(l=0;t>=l;l++){var p=l/t,g=n/i;this.vertices.push(s.call(this,p,g,this.t)),d.push(o.call(this,p,g,this.t)),u.push(this.vertices.length-1)}c.push(u),h.push(d)}for(n=0;n<this.heightSegments;n++)for(l=0;l<this.widthSegments;l++){var m=c[n][l+1],y=c[n][l],f=c[n+1][l],v=c[n+1][l+1],x=this.vertices[m].clone().normalize(),b=this.vertices[y].clone().normalize(),S=this.vertices[f].clone().normalize(),w=this.vertices[v].clone().normalize(),C=h[n][l+1].clone(),D=h[n][l].clone(),P=h[n+1][l].clone(),A=h[n+1][l+1].clone(),N=[x,b,S,w];this.faces.push(new a.Face4(m,y,f,v,N)),this.faceVertexUvs[0].push([C,D,P,A])}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new a.Sphere(new a.Vector3,e)};e.prototype=Object.create(a.Geometry.prototype),o.MercartorSphere=e}},o.prototype.getBingMapCanvas=function(e){function t(a,r){e>=a&&(a===e&&i(r),t(a+1,r+"0"),t(a+1,r+"1"),t(a+1,r+"2"),t(a+1,r+"3"))}function i(t){var i="https://t{server}.tiles.virtualearth.net/tiles/r{quad}.jpeg?g=0&mkt={language}",s=7,n=Math.round(Math.random()*s),h=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language,d=i.replace("{server}",n).replace("{quad}",t).replace("{language}",h),p=a(t),g=new Image;g.onload=function(){l++,u.drawImage(g,p.x*r,p.y*r,r,r),l===o&&c.trigger("ready",e)},g.crossOrigin="",g.src=d}function a(e){for(var t=0,i=0,a=e.length-1,r=a;r>=0;r--){var s=e.charAt(r),o=Math.pow(2,a-r);"1"===s?t+=o:"2"===s?i+=o:"3"===s&&(t+=o,i+=o)}return{x:t,y:i}}var r=256,s=Math.pow(2,e),o=s*s,l=0,n=r*s,c=$("<canvas/>").attr({width:n,height:n}),h=c.get(0),u=h.getContext("2d");return t(0,""),c},o.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Location"),preferredTypes:[{geography:{address:!0}},{geography:{city:!0}},{geography:{continent:!0}},{geography:{country:!0}},{geography:{county:!0}},{geography:{place:!0}},{geography:{postalCode:!0}},{geography:{region:!0}},{geography:{stateOrProvince:!0}}]},{name:"Series",kind:e.VisualDataRoleKind.Grouping,displayName:"Legend"},{name:"X",kind:e.VisualDataRoleKind.Measure,displayName:"Longitude",description:"Use to override the longitude of locations",preferredTypes:[{geography:{longitude:!0}}]},{name:"Y",kind:e.VisualDataRoleKind.Measure,displayName:"Latitude",description:"Use to override the latitude of locations",preferredTypes:[{geography:{latitude:!0}}]},{name:"Height",kind:e.VisualDataRoleKind.Measure,displayName:"Bar Height"},{name:"Heat",kind:e.VisualDataRoleKind.Measure,displayName:"Heat Intensity"}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},legend:{displayName:e.data.createDisplayNameGetter("Visual_Legend"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_LegendPosition"),type:{formatting:{legendPosition:!0}}},showTitle:{displayName:e.data.createDisplayNameGetter("Visual_LegendShowTitle"),type:{bool:!0}},titleText:{displayName:e.data.createDisplayNameGetter("Visual_LegendTitleText"),type:{text:!0}}}},dataPoint:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint"),properties:{defaultColor:{displayName:e.data.createDisplayNameGetter("Visual_DefaultColor"),type:{fill:{solid:{color:!0}}}},showAllDataPoints:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint_Show_All"),type:{bool:!0}},fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},fillRule:{displayName:e.data.createDisplayNameGetter("Visual_Gradient"),type:{fillRule:{}},rule:{inputRole:"Gradient",output:{property:"fill",selector:["Category"]}}}}},categoryLabels:{displayName:e.data.createDisplayNameGetter("Visual_CategoryLabels"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_LabelsFill"),type:{fill:{solid:{color:!0}}}}}}},dataViewMappings:[{conditions:[{Category:{max:1},Series:{max:1},Height:{max:1},Heat:{max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{group:{by:"Series",select:[{bind:{to:"Height"}},{bind:{to:"Heat"}},{bind:{to:"X"}},{bind:{to:"Y"}}],dataReductionAlgorithm:{top:{}}}},rowCount:{preferred:{min:2}}}}],sorting:{custom:{}}},o.Properties={general:{formatString:{objectName:"general",propertyName:"formatString"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}}},o}();o.GlobeMap=n}(o=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(o||(o={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=a.CssConstants.createClassAndSelector,s=a.PixelConverter,o=function(){function e(){}return e.prototype.bindEvents=function(e,t){var i=this.selection=e.selection,a=e.clearCatcher;i.on("click",function(e){t.handleSelection(e,d3.event.ctrlKey),d3.event.stopPropagation()}),a.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){this.selection.style("opacity",function(t){return e&&!t.selected?l.DimmedAreaFillOpacity:l.NodeFillOpacity})},e}();i.RadarChartWebBehavior=o;var l=function(){function i(e){e&&(e.svg&&(this.svg=e.svg),e.animator&&(this.animator=e.animator),e.margin&&(this.margin=e.margin))}return i.converter=function(e,r){if(!(e&&e.categorical&&e.categorical.categories&&e.categorical.categories.length>0&&e.categorical.categories[0]&&e.categorical.values&&e.categorical.values.length>0&&r))return{legendData:{dataPoints:[]},settings:{showLegend:!0},series:[],dataLabelsSettings:t.dataLabelUtils.getDefaultPointLabelSettings()};for(var s=e.categorical,o=s.values,l=s&&s.values?s.values.grouped():null,n=[],c=new t.ColorHelper(r,i.Properties.dataPoint.fill),h={fontSize:8.25,dataPoints:[],title:""},u=i.parseSettings(e),d=i.parseLabelSettings(e),p=0,g=o.length;g>p;p++){var m,y,f,v=r.getColorByIndex(p).value,x=[],b=l&&l.length>p&&l[p].values?l[p]:null;if(o[p].source){var S=o[p].source;if(S.queryName&&(y=S.queryName,m=t.SelectionId.createWithMeasure(y)),S.displayName&&(f=S.displayName),S.objects){var w=S.objects;v=c.getColorForMeasure(w,y)}}h.dataPoints.push({label:f,color:v,icon:t.LegendIcon.Box,selected:!1,identity:m});for(var C=0,D=o[p].values.length;D>C;C++){var P=t.SelectionIdBuilder.builder().withMeasure(y).withCategory(s.categories[0],C).withSeries(e.categorical.values,b).createSelectionId(),A=t.TooltipBuilder.createTooltipInfo(i.formatStringProp,s,s.categories[0].values[C],o[p].values[C],null,null,p),N=t.valueFormatter.getFormatString(s.values[p].source,i.formatStringProp),V=a.PixelConverter.fromPoint(d.fontSize);x.push({x:C,y:o[p].values[C],color:v,identity:P,selected:!1,tooltipInfo:A,value:o[p].values[C],labelFormatString:N,labelFontSize:V})}x.length>0&&n.push({fill:v,name:f,data:x,identity:m})}return{legendData:h,settings:u,series:n,dataLabelsSettings:d}},i.prototype.init=function(e){var a=e.element;this.svg||(this.svg=d3.select(a.get(0)).append("svg"),this.svg.style("position","absolute")),this.margin||(this.margin=i.DefaultMargin),this.svg.classed(i.VisualClassName,!0),this.interactivityService=t.createInteractivityService(e.host),this.isInteractiveChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.legend=t.createLegend(a,this.isInteractiveChart,this.interactivityService,!0,t.LegendPosition.Top),this.colors=e.style.colorPalette.dataColors,this.mainGroupElement=this.svg.append("g"),this.segments=this.mainGroupElement.append("g").classed(i.Segments["class"],!0),this.zeroSegment=this.mainGroupElement.append("g").classed(i.ZeroSegment["class"],!0),this.axis=this.mainGroupElement.append("g").classed(i.Axis["class"],!0),this.chart=this.mainGroupElement.append("g").classed(i.Chart["class"],!0)},i.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){var a=e.dataViews[0];this.radarChartData=i.converter(a,this.colors);var r,s=[],o=this.radarChartData.series,l=t.AnimatorCommon.GetAnimationDuration(this.animator,e.suppressAnimations);a.categorical&&a.categorical.categories&&a.categorical.categories[0]&&a.categorical.categories[0].values&&(s=a.categorical.categories[0].values),a.metadata&&a.metadata.columns&&a.metadata.columns.length>0&&(r=a.metadata.columns[0]),this.viewport={height:e.viewport.height>0?e.viewport.height:0,width:e.viewport.width>0?e.viewport.width:0},this.parseLegendProperties(a),this.renderLegend(this.radarChartData),this.updateViewport(),this.svg.attr({height:this.viewport.height,width:this.viewport.width});var n=this.mainGroupElement;n.attr("transform",t.SVGUtil.translate(this.viewport.width/2,this.viewport.height/2));var c=this.viewport.width-this.margin.left-this.margin.right,h=this.viewport.height-this.margin.top-this.margin.bottom;this.angle=i.Radians/s.length,this.radius=i.SegmentFactor*i.Scale*Math.min(c,h)/2,this.drawCircularSegments(s),this.drawAxes(s),this.drawAxesLabels(s,r),this.drawChart(o,l),this.drawDataLabels(o),this.drawZeroCircularSegment(s),0!==this.zeroPointRadius?this.drawZeroLabel():this.mainGroupElement.selectAll(i.ZeroLabel.selector).remove()}},i.prototype.getRadarChartLabelLayout=function(e,i){var a=t.dataLabelUtils.createColumnFormatterCacheManager(),r=this.angle,o=this.viewport,l=this.viewport.height/2,n=this.viewport.width/2,c=this.calculateChartDomain(this.radarChartData.series);return{labelText:function(r){var s=a.getOrCreate(r.labelFormatString,e);if(0===e.displayUnits){var l=_.max(i,function(e){return e.value}),n=l.value>0?l.value:0;s=a.getOrCreate(r.labelFormatString,e,n)}return t.dataLabelUtils.getLabelFormattedText({label:s.format(r.value),maxWidth:o.width,fontSize:e.fontSize})},labelLayout:{x:function(e){return-1*c(e.y)*Math.sin(e.x*r)+n},y:function(e){return-1*c(e.y)*Math.cos(e.x*r)+l-7}},filter:function(e){return null!=e&&null!=e.value},style:{fill:e.labelColor,"font-size":function(t){return s.fromPoint(e.fontSize)}}}},i.prototype.drawCircularSegments=function(e){for(var a=[],r=this.angle,s=i.SegmentFactor,o=i.SegmentLevels,l=this.radius,n=0;o-1>n;n++)for(var c=l*((n+1)/o),h=-1*c,u=0;u<e.length;u++)a.push({x1:c*(1-s*Math.sin(u*r)),y1:c*(1-s*Math.cos(u*r)),x2:c*(1-s*Math.sin((u+1)*r)),y2:c*(1-s*Math.cos((u+1)*r)),translate:t.SVGUtil.translate(h,h)});var d=this.mainGroupElement.select(i.Segments.selector).selectAll(i.SegmentNode.selector).data(a);d.enter().append("svg:line").classed(i.SegmentNode["class"],!0),d.attr({x1:function(e){return e.x1},y1:function(e){return e.y1},x2:function(e){return e.x2},y2:function(e){return e.y2},transform:function(e){return e.translate}}),d.exit().remove()},i.prototype.drawDataLabels=function(e){var i=this.getAllDataPointsList(e);if(this.radarChartData.dataLabelsSettings.show){var a=this.getRadarChartLabelLayout(this.radarChartData.dataLabelsSettings,i),r=this.viewport,s=t.dataLabelUtils.drawDefaultLabelsForDataPointChart(i,this.mainGroupElement,a,r);s.attr("transform",t.SVGUtil.translate(-(r.width/2),-(r.height/2)))}else t.dataLabelUtils.cleanDataLabels(this.mainGroupElement)},i.prototype.drawAxes=function(e){var t=this.angle,a=-1*this.radius,r=this.mainGroupElement.select(i.Axis.selector).selectAll(i.AxisNode.selector),s=r.data(e);s.enter().append("svg:line"),s.attr({x1:0,y1:0,x2:function(e,i){return a*Math.sin(i*t)},y2:function(e,i){return a*Math.cos(i*t)}}).classed(i.AxisNode["class"],!0),s.exit().remove()},i.prototype.drawAxesLabels=function(a,r){var s=this,o=this.angle,l=-1*this.radius,n=a.length,c=t.valueFormatter.create({format:t.valueFormatter.getFormatString(r,i.formatStringProp,!0),value:a[0],value2:a[n-1]}),h=this.mainGroupElement.select(i.Axis.selector).selectAll(i.AxisLabel.selector),u=h.data(a);u.enter().append("svg:text"),u.attr({"text-anchor":"middle",dy:"1.5em",transform:t.SVGUtil.translate(0,-10),x:function(e,t){return(l-30)*Math.sin(t*o)},y:function(e,t){return(l-20)*Math.cos(t*o)}}).text(function(t){var a={fontFamily:i.AxesLabelsFontFamily,fontSize:i.AxesLabelsfontSize,text:c.format(t)};return e.TextMeasurementService.getTailoredTextOrDefault(a,Math.min(i.AxesLabelsMaxWidth,s.viewport.width))}).classed(i.AxisLabel["class"],!0),u.exit().remove()},i.prototype.drawChart=function(e,a){var r=this.angle,s=5,l=this.getDataPoints(e),n=d3.layout.stack(),c=n(l),h=this.calculateChartDomain(e),u=function(e){return e.map(function(e){var t=-1*h(e.y)*Math.sin(e.x*r),i=-1*h(e.y)*Math.cos(e.x*r);return t+","+i}).join(" ")},d=this.chart.selectAll(i.ChartArea.selector).data(c);d.enter().append("g").classed(i.ChartArea["class"],!0);var p=d.selectAll(i.ChartPolygon.selector).data(function(e){return e&&e.length>0?[e]:[]});p.enter().append("polygon").classed(i.ChartPolygon["class"],!0),p.style("fill",function(e){return e[0].color}).style("opacity",i.DimmedAreaFillOpacity).on("mouseover",function(e){d3.select(this).transition().duration(a).style("opacity",i.AreaFillOpacity)}).on("mouseout",function(e){d3.select(this).transition().duration(a).style("opacity",i.DimmedAreaFillOpacity)}).attr("points",u),p.exit().remove(),d.exit().remove();var g=this.chart.selectAll(i.ChartNode.selector).data(c);g.enter().append("g").classed(i.ChartNode["class"],!0);var m=g.selectAll(i.ChartDot.selector).data(function(e){return e.filter(function(e){return null!=e.y})});m.enter().append("svg:circle").classed(i.ChartDot["class"],!0),m.attr("r",s).attr({cx:function(e){return-1*h(e.y)*Math.sin(e.x*r)},cy:function(e){return-1*h(e.y)*Math.cos(e.x*r)}}).style("fill",function(e){return e.color}),m.exit().remove(),t.TooltipManager.addTooltip(m,function(e){return e.data.tooltipInfo},!0),g.exit().remove();var y=void 0;if(this.interactivityService){var f=this.getAllDataPointsList(e);y={selection:m,clearCatcher:this.svg},this.interactivityService.bind(f,new o,y)}},i.prototype.calculateChartDomain=function(e){var t=this.radius,i=this.getAllDataPointsList(e),a=d3.min(i,function(e){return e.y}),r=d3.max(i,function(e){return e.y});this.isPercentChart(i)&&(a=a>=0?0:-1,r=0>=r?0:1);var s=d3.scale.linear().domain([a,r]).range([0,t]);return this.zeroPointRadius=0>a&&r>0?s(0):0,s},i.prototype.renderLegend=function(e){if(e.legendData){var i=e.legendData;if(this.legendObjectProperties){t.LegendData.update(i,this.legendObjectProperties);var a=this.legendObjectProperties[t.legendProps.position];a&&this.legend.changeOrientation(t.LegendPosition[a])}else this.legend.changeOrientation(t.LegendPosition.Top);var r=this.viewport;this.legend.drawLegend(i,{height:r.height,width:r.width}),t.Legend.positionChartArea(this.svg,this.legend)}},i.prototype.drawZeroCircularSegment=function(e){for(var a=[],r=this.angle,s=i.SegmentFactor,o=this.zeroPointRadius,l=-1*o,n=0;n<e.length;n++)a.push({x1:o*(1-s*Math.sin(n*r)),y1:o*(1-s*Math.cos(n*r)),x2:o*(1-s*Math.sin((n+1)*r)),y2:o*(1-s*Math.cos((n+1)*r)),translate:t.SVGUtil.translate(l,l)});var c=this.mainGroupElement.select(i.ZeroSegment.selector).selectAll(i.ZeroSegmentNode.selector).data(a);c.enter().append("svg:line").classed(i.ZeroSegmentNode["class"],!0),c.attr({x1:function(e){return e.x1},y1:function(e){return e.y1},x2:function(e){return e.x2},y2:function(e){return e.y2},transform:function(e){return e.translate}}),c.exit().remove()},i.prototype.drawZeroLabel=function(){var e=[];e.push({x:this.zeroPointRadius*(1-i.SegmentFactor)+5,y:-1*this.zeroPointRadius});var t=this.mainGroupElement.select(i.ZeroSegment.selector).selectAll(i.ZeroLabel.selector).data(e);t.enter().append("text").classed(i.ZeroLabel["class"],!0).text("0"),t.attr({x:function(e){return e.x},y:function(e){return e.y}})},i.prototype.getDataPoints=function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].data);return t},i.prototype.getAllDataPointsList=function(e){for(var t=[],i=0;i<e.length;i++)t=t.concat(e[i].data);return t},i.prototype.isPercentChart=function(e){for(var t=0;t<e.length;t++)if(-1===e[t].labelFormatString.indexOf("%"))return!1;return!0},i.prototype.parseLegendProperties=function(t){return t&&t.metadata?void(this.legendObjectProperties=e.DataViewObjects.getObject(t.metadata.objects,"legend",{})):void(this.legendObjectProperties={})},i.parseSettings=function(t){var a;return a=t&&t.metadata&&t.metadata.columns&&t.metadata.objects?t.metadata.objects:null,{showLegend:e.DataViewObjects.getValue(a,i.Properties.legend.show,!0)}},i.parseLabelSettings=function(a){var r;r=a&&a.metadata&&a.metadata.objects?a.metadata.objects:null;var s=t.dataLabelUtils.getDefaultPointLabelSettings(),o={show:e.DataViewObjects.getValue(r,i.Properties.labels.show,s.show),labelColor:e.DataViewObjects.getFillColor(r,i.Properties.labels.color,s.labelColor),displayUnits:e.DataViewObjects.getValue(r,i.Properties.labels.displayUnits,s.displayUnits),precision:e.DataViewObjects.getValue(r,i.Properties.labels.precision,s.precision),fontSize:e.DataViewObjects.getValue(r,i.Properties.labels.fontSize,s.fontSize),position:s.position};return o},i.prototype.enumerateObjectInstances=function(e){var i,a=new t.ObjectEnumerationBuilder;if(!this.radarChartData||!this.radarChartData.settings)return[];switch(i=this.radarChartData.settings,e.objectName){case"legend":a.pushInstance(this.enumerateLegend(i));break;case"dataPoint":this.enumerateDataPoint(a);break;case"labels":this.enumerateDataLabels(a)}return a.complete()},i.prototype.getLabelSettingsOptions=function(e,t){return{enumeration:e,dataLabelsSettings:t,show:!0,displayUnits:!0,precision:!0,fontSize:!0}},i.prototype.enumerateDataLabels=function(e){var i=this.radarChartData.dataLabelsSettings;t.dataLabelUtils.enumerateDataLabels(this.getLabelSettingsOptions(e,i))},i.prototype.enumerateLegend=function(i){var a,r,s=!0,o="",l=8;return s=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.showTitle,s),o=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.titleText,o),r=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.labelColor,r),l=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.fontSize,l),a={objectName:"legend",displayName:"legend",selector:null,properties:{show:i.showLegend,position:t.LegendPosition[this.legend.getOrientation()],showTitle:s,titleText:o,labelColor:r,fontSize:l}}},i.prototype.enumerateDataPoint=function(e){if(this.radarChartData&&this.radarChartData.series)for(var i=this.radarChartData.series,a=0;a<i.length;a++){var r=i[a];e.pushInstance({objectName:"dataPoint",displayName:r.name,selector:t.ColorHelper.normalizeSelector(r.identity.getSelector(),!1),properties:{fill:{solid:{color:r.fill}}}})}},i.prototype.updateViewport=function(){var e,i=this.legend.getMargins();switch(e=t.LegendPosition[this.legendObjectProperties[t.legendProps.position]]){case t.LegendPosition.Top:case t.LegendPosition.TopCenter:case t.LegendPosition.Bottom:case t.LegendPosition.BottomCenter:this.viewport.height-=i.height;break;case t.LegendPosition.Left:case t.LegendPosition.LeftCenter:case t.LegendPosition.Right:case t.LegendPosition.RightCenter:this.viewport.width-=i.width}},i.capabilities={dataRoles:[{displayName:"Category",name:"Category",kind:e.VisualDataRoleKind.Grouping},{displayName:"Y Axis",name:"Y",kind:e.VisualDataRoleKind.Measure}],dataViewMappings:[{conditions:[{Category:{min:1,max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{select:[{bind:{to:"Y"}}]}}}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},legend:{displayName:e.data.createDisplayNameGetter("Visual_Legend"),description:e.data.createDisplayNameGetter("Visual_LegendDescription"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_LegendPosition"),description:e.data.createDisplayNameGetter("Visual_LegendPositionDescription"),type:{enumeration:t.legendPosition.type}},showTitle:{displayName:e.data.createDisplayNameGetter("Visual_LegendShowTitle"),description:e.data.createDisplayNameGetter("Visual_LegendShowTitleDescription"),type:{bool:!0}},titleText:{displayName:e.data.createDisplayNameGetter("Visual_LegendName"),description:e.data.createDisplayNameGetter("Visual_LegendNameDescription"),type:{text:!0},suppressFormatPainterCopy:!0},labelColor:{displayName:e.data.createDisplayNameGetter("Visual_LegendTitleColor"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},dataPoint:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint"),description:e.data.createDisplayNameGetter("Visual_DataPointDescription"),properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}},labels:{displayName:e.data.createDisplayNameGetter("Visual_DataPointsLabels"),description:e.data.createDisplayNameGetter("Visual_DataPointsLabelsDescription"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_LabelsFill"),description:e.data.createDisplayNameGetter("Visual_LabelsFillDescription"),type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:e.data.createDisplayNameGetter("Visual_DisplayUnits"),description:e.data.createDisplayNameGetter("Visual_DisplayUnitsDescription"),type:{formatting:{labelDisplayUnits:!0}},suppressFormatPainterCopy:!0},labelPrecision:{displayName:e.data.createDisplayNameGetter("Visual_Precision"),description:e.data.createDisplayNameGetter("Visual_PrecisionDescription"),placeHolderText:e.data.createDisplayNameGetter("Visual_Precision_Auto"),type:{numeric:!0},suppressFormatPainterCopy:!0},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}}}},i.formatStringProp={objectName:"general",propertyName:"formatString"},i.Properties={legend:{show:{objectName:"legend",propertyName:"show"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}},labels:{show:{objectName:"labels",propertyName:"show"},color:{objectName:"labels",propertyName:"color"},displayUnits:{objectName:"labels",propertyName:"labelDisplayUnits"},precision:{objectName:"labels",propertyName:"labelPrecision"},fontSize:{objectName:"labels",propertyName:"fontSize"}}},i.VisualClassName="radarChart",i.Segments=r("segments"),i.SegmentNode=r("segmentNode"),i.ZeroSegment=r("zeroSegment"),i.ZeroSegmentNode=r("zeroSegmentNode"),i.ZeroLabel=r("zeroLabel"),i.Axis=r("axis"),i.AxisNode=r("axisNode"),i.AxisLabel=r("axisLabel"),i.Chart=r("chart"),i.ChartNode=r("chartNode"),i.ChartArea=r("chartArea"),i.ChartPolygon=r("chartPolygon"),i.ChartDot=r("chartDot"),i.DefaultMargin={top:50,bottom:50,right:100,left:100},i.SegmentLevels=6,i.SegmentFactor=1,i.Radians=2*Math.PI,i.Scale=1,i.NodeFillOpacity=1,i.AreaFillOpacity=.6,i.DimmedAreaFillOpacity=.4,i.AxesLabelsFontFamily="sans-serif",i.AxesLabelsfontSize="11px",i.AxesLabelsMaxWidth=200,i}();i.RadarChart=l}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=t.utility.SelectionManager,s=e.visuals.valueFormatter,o=t.AnimatorCommon.GetAnimationDuration,l=a.CssConstants.createClassAndSelector,n=a.PixelConverter,c=function(){function e(e){this.message=e}return Object.defineProperty(e.prototype,"code",{get:function(){return"BulletChartWarning"},enumerable:!0,configurable:!0}),e.prototype.getMessages=function(e){return{message:this.message,title:e.get(""),detail:e.get("")}},e.ErrorInvalidDataValues="Some data values are invalid or too big",e}();i.HistogramChartWarning=c;var h=function(){function i(e){this.ColumnPadding=1,this.MinColumnHeight=1,this.MinOpacity=.3,this.MaxOpacity=1,this.TooltipDisplayName="Range",this.SeparatorNumbers=", ",this.LegendSize=50,this.YLegendSize=50,this.XLegendSize=50,this.AxisSize=30,this.DataLabelMargin=0,this.widthOfColumn=0,this.yTitleMargin=0,this.outerPadding=5,this.ExcludeBrackets={left:"(",right:")"},this.IncludeBrackets={left:"[",right:"]"},this.margin={top:10,right:10,bottom:10,left:10},this.durationAnimations=200,this.oldInnerPaddingRatio=t.CartesianChart.InnerPaddingRatio,this.oldMinOrdinalRectThickness=t.CartesianChart.MinOrdinalRectThickness,this.textProperties={fontFamily:"wf_segoe-ui_normal",fontSize:n.toString(9)},e&&(e.svg&&(this.svg=e.svg),e.animator&&(this.animator=e.animator),this.margin=e.margin||this.margin)}return Object.defineProperty(i.prototype,"columnsSelection",{get:function(){return this.main.select(i.Columns.selector).selectAll(i.Column.selector);
},enumerable:!0,configurable:!0}),i.prototype.init=function(e){this.hostService=e.host,this.svg?this.root=this.svg:this.root=d3.select(e.element.get(0)).append("svg");var a=e.style;this.colors=a&&a.colorPalette?a.colorPalette.dataColors:new t.DataColorPalette,this.root.classed(i.ClassName,!0),this.main=this.root.append("g"),this.axes=this.main.append("g").classed(i.Axes["class"],!0),this.axisX=this.axes.append("g").classed(i.Axis["class"],!0),this.axisY=this.axes.append("g").classed(i.Axis["class"],!0),this.legend=this.main.append("g").classed(i.Legends["class"],!0),this.columns=this.main.append("g").classed(i.Columns["class"],!0),this.labels=this.main.append("g").classed(i.Labels["class"],!0),this.selectionManager=new r({hostServices:e.host})},i.prototype.converter=function(e){if(!(e&&e.categorical&&e.categorical.categories&&e.categorical.categories[0]&&e.categorical.categories[0].values&&e.categorical.categories[0].values.length>0))return null;var t,a,r,o,l,n,c,h,u,d=[],p=[],g=[],m=0,y=0;if(e.categorical.values&&e.categorical.values[0]&&e.categorical.values[0].values&&(p=e.categorical.values[0].values),e.categorical.categories[0].identity&&e.categorical.categories[0].identity.length>0&&(g=e.categorical.categories[0].identity),t=this.parseSettings(e),!t)return null;r=i.getValuesByFrequencies(e.categorical.categories[0].values,p,g),r.forEach(function(e){d.push(e.value),y+=e.frequency}),a=d3.layout.histogram(),t.bins&&t.bins>i.MinNumberOfBins&&(a=a.bins(t.bins)),o=a.frequency(t.frequency)(d),o.forEach(function(e,a){var s,o;s=r.filter(function(t){return i.isValueContainedInRange(t,e,a)}),o=s.reduce(function(e,t){return e+t.frequency},0),e.y=t.frequency?o:o/y,m+=e.length});var f=t.yAxisSettings,v=null!==f.end&&f.end>f.start?f.end:d3.max(o,function(e){return e.y}),x=f.start<v?f.start:0;return t.yAxisSettings.end=v,t.yAxisSettings.start=x,t.maxX=d3.max(o,function(e){return d3.max(e)}),l=d3.scale.linear().domain([d3.min(o,function(e){return d3.min(e)}),d3.max(o,function(e){return d3.max(e)})]).range([0,this.viewport.width-this.YLegendSize-this.AxisSize]),n=d3.scale.linear().domain([x,v]).range([this.viewport.height-this.LegendSize,this.outerPadding]),c=s.create({format:s.getFormatString(e.categorical.categories[0].source,i.Properties.general.formatString),value:r[0].value,value2:r[r.length-1].value,precision:t.precision}),h=s.create({value:0===t.xAxisSettings.displayUnits?r[r.length-1].value:t.xAxisSettings.displayUnits,precision:t.xAxisSettings.precision}),u=s.create({value:t.yAxisSettings.displayUnits,precision:t.yAxisSettings.precision}),{xScale:l,yScale:n,settings:t,data:this.getData(r,d,o,t,u,h),formatter:c,xLabelFormatter:h,yLabelFormatter:u}},i.getValuesByFrequencies=function(e,i,a){var r=[];return e.forEach(function(e,s){var o=1,l=Number(e);l=isNaN(l)?0:l,i&&i[s]&&!isNaN(i[s])&&i[s]>1&&(o=i[s]),r.push({value:l,frequency:o,selectionId:t.SelectionId.createWithId(a[s])})}),r},i.prototype.getData=function(e,t,a,r,s,o){var l=this,c=d3.min(t),h=d3.max(t),u=n.fromPoint(r.labelSettings.fontSize);return a.map(function(t,a){return t.range=i.getRange(c,h,t.dx,a),t.tooltipInfo=l.getTooltipData(t.y,t.range,r,0===a,s,o),t.selectionIds=i.getSelectionIds(e,t,a),t.labelFontSize=u,t})},i.getRange=function(e,t,i,a){var r=e+a*i,s=r+i;return[r,s]},i.prototype.getTooltipData=function(e,t,a,r,s,o){return[{displayName:i.getLegendText(a),value:s.format(e)},{displayName:this.TooltipDisplayName,value:this.rangeToString(t,r,o)}]},i.getSelectionIds=function(e,t,a){var r=[];return e.forEach(function(e){i.isValueContainedInRange(e,t,a)&&r.push(e.selectionId)}),r},i.isValueContainedInRange=function(e,t,i){return(0===i&&e.value>=t.x||e.value>t.x)&&e.value<=t.x+t.dx},i.prototype.parseSettings=function(e){if(!(e&&e.metadata&&e.metadata.columns&&e.metadata.columns[0]))return null;var a,r,s={};r=new t.ColorHelper(this.colors,i.Properties.dataPoint.fill,i.DefaultHistogramSettings.fillColor),s.displayName=e.metadata.columns[0].displayName||i.DefaultHistogramSettings.displayName,a=i.getObjectsFromDataView(e);var o={axisColor:i.getXAxisColor(a).solid.color,title:i.getXTitle(a),precision:i.getXPrecision(a),style:i.getXStyle(a),displayUnits:i.getXDisplayUnit(a),show:i.getXAxisShow(a)},l={axisColor:i.getYAxisColor(a).solid.color,title:i.getYTitle(a),precision:i.getYPrecision(a),style:i.getYStyle(a),displayUnits:i.getYDisplayUnit(a),show:i.getYAxisShow(a),start:i.getYStart(a),end:i.getYEnd(a),position:i.getYPosition(a)},n={show:i.getLabelShow(a),color:i.getLabelColor(a).solid.color,displayUnits:i.getLabelDisplayUnits(a),precision:i.getLabelPrecision(a),fontSize:i.getLabelFontSize(a)};return s.fillColor=r.getColorForMeasure(a,""),s.bins=i.getBins(a),s.frequency=i.getFrequency(a),s.precision=i.getPrecision(a),s.displayName=i.getLegend(s.displayName,o.style,o.displayUnits),s.xAxisSettings=o,s.yAxisSettings=l,s.labelSettings=n,s},i.getLegend=function(e,i,a){var r,o=s.create({value:a});switch(i){case t.axisStyle.showTitleOnly:r=e;break;case t.axisStyle.showUnitOnly:r=0===a||1===a?e:o.displayUnit.title;break;case t.axisStyle.showBoth:r=0===a||1===a?e:e+" ("+o.displayUnit.title+")"}return r},i.getLabelFontSize=function(t){return e.DataViewObjects.getValue(t,i.Properties.labels.fontSize,i.DefaultHistogramSettings.labelSettings.fontSize)},i.getLabelShow=function(t){return e.DataViewObjects.getValue(t,i.Properties.labels.show,i.DefaultHistogramSettings.labelSettings.show)},i.getLabelColor=function(t){return e.DataViewObjects.getValue(t,i.Properties.labels.color,{solid:{color:i.DefaultHistogramSettings.labelSettings.color}})},i.getLabelDisplayUnits=function(t){return e.DataViewObjects.getValue(t,i.Properties.labels.displayUnits,i.DefaultHistogramSettings.labelSettings.displayUnits)},i.getLabelPrecision=function(t){var a=e.DataViewObjects.getValue(t,i.Properties.labels.precision,i.DefaultHistogramSettings.labelSettings.precision);return a<=i.MinPrecision?i.MinPrecision:a>=i.MaxPrecision?i.MaxPrecision:a},i.getXStyle=function(t){return e.DataViewObjects.getValue(t,i.Properties.xAxis.style,i.DefaultHistogramSettings.xAxisSettings.style)},i.getXDisplayUnit=function(t){return e.DataViewObjects.getValue(t,i.Properties.xAxis.displayUnits,i.DefaultHistogramSettings.xAxisSettings.displayUnits)},i.getXPrecision=function(t){var a=e.DataViewObjects.getValue(t,i.Properties.xAxis.precision,i.DefaultHistogramSettings.xAxisSettings.precision);return a<=i.MinPrecision?i.MinPrecision:a>=i.MaxPrecision?i.MaxPrecision:a},i.getXAxisShow=function(t){return e.DataViewObjects.getValue(t,i.Properties.xAxis.show,i.DefaultHistogramSettings.xAxisSettings.show)},i.getXAxisColor=function(t){return e.DataViewObjects.getValue(t,i.Properties.xAxis.axisColor,{solid:{color:i.DefaultHistogramSettings.xAxisSettings.axisColor}})},i.getXTitle=function(t){return e.DataViewObjects.getValue(t,i.Properties.xAxis.title,i.DefaultHistogramSettings.xAxisSettings.title)},i.getYStyle=function(t){return e.DataViewObjects.getValue(t,i.Properties.yAxis.style,i.DefaultHistogramSettings.yAxisSettings.style)},i.getYPosition=function(t){return e.DataViewObjects.getValue(t,i.Properties.yAxis.position,i.DefaultHistogramSettings.yAxisSettings.position)},i.getYAxisShow=function(t){return e.DataViewObjects.getValue(t,i.Properties.yAxis.show,i.DefaultHistogramSettings.yAxisSettings.show)},i.getYAxisColor=function(t){return e.DataViewObjects.getValue(t,i.Properties.yAxis.axisColor,{solid:{color:i.DefaultHistogramSettings.yAxisSettings.axisColor}})},i.getYStart=function(t){return e.DataViewObjects.getValue(t,i.Properties.yAxis.start,i.DefaultHistogramSettings.yAxisSettings.start)},i.getYEnd=function(t){return e.DataViewObjects.getValue(t,i.Properties.yAxis.end,i.DefaultHistogramSettings.yAxisSettings.end)},i.getYDisplayUnit=function(t){return e.DataViewObjects.getValue(t,i.Properties.yAxis.displayUnits,i.DefaultHistogramSettings.yAxisSettings.displayUnits)},i.getYPrecision=function(t){var a=e.DataViewObjects.getValue(t,i.Properties.yAxis.precision,i.DefaultHistogramSettings.yAxisSettings.precision);return a<=i.MinPrecision?i.MinPrecision:a>=i.MaxPrecision?i.MaxPrecision:a},i.getYTitle=function(t){return e.DataViewObjects.getValue(t,i.Properties.yAxis.title,i.DefaultHistogramSettings.yAxisSettings.title)},i.getBins=function(t){var a=Number(e.DataViewObjects.getValue(t,i.Properties.general.bins,i.DefaultHistogramSettings.bins));return!a||isNaN(a)||a<=i.MinNumberOfBins?i.DefaultHistogramSettings.bins:a>i.MaxNumberOfBins?i.MaxNumberOfBins:a},i.getFrequency=function(t){return e.DataViewObjects.getValue(t,i.Properties.general.frequency,i.DefaultHistogramSettings.frequency)},i.getPrecision=function(t){var a=e.DataViewObjects.getValue(t,i.Properties.labels.precision,i.DefaultHistogramSettings.precision);return a<=i.MinPrecision?i.MinPrecision:a>=i.MaxPrecision?i.MaxPrecision:a},i.prototype.validateData=function(e){return e&&e.data.some(function(e){return e.range.some(function(e){return isNaN(e)||e===1/0||e===-(1/0)})})?(this.hostService.setWarnings([new c(c.ErrorInvalidDataValues)]),!1):!0},i.prototype.update=function(e){if(e&&e.dataViews&&e.dataViews[0]){t.CartesianChart.InnerPaddingRatio=1;var i=e.dataViews[0];if(this.durationAnimations=o(this.animator,e.suppressAnimations),this.setSize(e.viewport),this.histogramDataView=this.converter(i),this.validateData(this.histogramDataView)||(this.histogramDataView.data=[]),this.histogramDataView){this.YLegendSize=this.histogramDataView.settings.yAxisSettings.title?50:25,this.XLegendSize=this.histogramDataView.settings.xAxisSettings.title?50:25,this.fixXTicSize(),this.xAxisProperties=this.calculateXAxes(i.categorical.categories[0].source,this.textProperties,!1);var a=i.categorical.values&&i.categorical.values[0]&&i.categorical.values[0].values?i.categorical.values[0].source:i.categorical.categories[0].source;this.yAxisProperties=this.calculateYAxes(a,this.textProperties,!1),this.render(),t.CartesianChart.InnerPaddingRatio=this.oldInnerPaddingRatio,t.CartesianChart.MinOrdinalRectThickness=this.oldMinOrdinalRectThickness}}},i.prototype.fixXTicSize=function(){if(this.histogramDataView&&this.histogramDataView.settings){var i=this.histogramDataView.xLabelFormatter.format(this.histogramDataView.settings.maxX),a={text:i,fontFamily:this.textProperties.fontFamily,fontSize:this.textProperties.fontSize},r=e.TextMeasurementService.measureSvgTextWidth(a);t.CartesianChart.MinOrdinalRectThickness=r+3}},i.prototype.setSize=function(e){var t,i;t=e.height-this.margin.top-this.margin.bottom,i=e.width-this.margin.left-this.margin.right,this.viewport={height:t,width:i},this.updateElements(e.height,e.width)},i.prototype.updateElements=function(e,i){this.root.attr({height:e,width:i}),this.main.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top)),this.legend.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top)),this.axisX.attr("transform",t.SVGUtil.translate(0,this.viewport.height-this.XLegendSize))},i.prototype.shouldShowYOnRight=function(){return this.histogramDataView.settings.yAxisSettings.position===t.yAxisPosition.right},i.prototype.columsAndAxesTransform=function(e){var i=20,a=this.shouldShowYOnRight()?10:this.histogramDataView.settings.yAxisSettings.title?this.margin.left+e+i:this.margin.left+e;this.DataLabelMargin=a,this.columns.attr("transform",t.SVGUtil.translate(a,0)),this.axes.attr("transform",t.SVGUtil.translate(a,0)),this.axisY.attr("transform",t.SVGUtil.translate(this.shouldShowYOnRight()?this.viewport.width-this.AxisSize-this.YLegendSize+.01:0,0)),this.axisX.attr("transform",t.SVGUtil.translate(0,this.viewport.height-this.XLegendSize))},i.prototype.render=function(){if(this.histogramDataView&&this.histogramDataView.settings){this.renderAxes();var e=this.renderColumns();this.adjustTransformToAxisLabels(),this.renderLegend(),this.histogramDataView.settings.labelSettings.show?this.renderLabels():this.main.selectAll(".labels").selectAll("*").remove(),this.bindSelectionHandler(e)}},i.prototype.adjustTransformToAxisLabels=function(){var t=0;this.main.selectAll("g.axis").filter(function(e,t){return 1===t}).selectAll("g.tick text").each(function(i,a){var r=e.TextMeasurementService.getSvgMeasurementProperties(this),s={text:r.text,fontFamily:r.fontFamily,fontSize:r.fontSize},o=e.TextMeasurementService.measureSvgTextWidth(s);o>t&&(t=o)});var i=70;this.yTitleMargin=this.shouldShowYOnRight()?this.viewport.width-this.AxisSize-i+this.YLegendSize+t:0,this.columsAndAxesTransform(t)},i.prototype.renderColumns=function(){var e,a,r=this,s=this.histogramDataView.data,o=this.histogramDataView.yScale,l=s.length;return e=l&&(this.viewport.width-this.AxisSize-this.YLegendSize)/l-this.ColumnPadding,0>e&&(e=0),this.widthOfColumn=e,a=this.columnsSelection.data(s),a.enter().append("svg:rect"),a.attr("x",this.ColumnPadding/2).attr("width",e).attr("height",function(e){return r.getColumnHeight(e,o)}).style("fill",this.histogramDataView.settings.fillColor).attr("class",i.Column["class"]).attr("transform",function(i,a){return t.SVGUtil.translate(e*a+r.ColumnPadding*a,o(i.y)-r.ColumnPadding/2.5)}),l&&a.classed(i.Column["class"]),a.exit().remove(),i.renderTooltip(a),a},i.renderTooltip=function(e){t.TooltipManager.addTooltip(e,function(e){return e.data.tooltipInfo})},i.prototype.getColumnHeight=function(e,t){var i=this.viewport.height-this.XLegendSize-t(e.y);return i>0?i:this.MinColumnHeight},i.prototype.renderAxes=function(){var e,t,i=this;e=this.xAxisProperties.axis.tickFormat(function(e){return i.histogramDataView.xLabelFormatter.format(e)}).orient("bottom"),t=this.yAxisProperties.axis.orient(this.histogramDataView.settings.yAxisSettings.position.toLowerCase()).tickFormat(function(e){return i.histogramDataView.yLabelFormatter.format(e)});var a=this.histogramDataView.settings.xAxisSettings.show,r=this.histogramDataView.settings.yAxisSettings.show;a?this.axisX.transition().duration(1).call(e):this.axisX.selectAll("*").remove(),r?this.axisY.call(t):this.axisY.selectAll("*").remove(),this.main.selectAll("g.axis").filter(function(e,t){return 0===t}).selectAll("g.tick text").style({fill:this.histogramDataView.settings.xAxisSettings.axisColor}),this.main.selectAll("g.axis").filter(function(e,t){return 1===t}).selectAll("g.tick text").style({fill:this.histogramDataView.settings.yAxisSettings.axisColor})},i.prototype.getLabaelLayout=function(){var e=this,t=this.histogramDataView.settings.labelSettings,i=n.fromPoint(t.fontSize),a=s.create({value:t.displayUnits,precision:t.precision});return{labelText:function(e){return a.format(e.y).toString()},labelLayout:{x:function(t){return e.DataLabelMargin+e.histogramDataView.xScale(t.x)+e.widthOfColumn/2},y:function(t){return e.histogramDataView.yScale(t.y)-5}},filter:function(e){return null!=e},style:{fill:t.color,"font-size":i}}},i.prototype.renderLabels=function(){var e=this.getLabaelLayout(),i=this.histogramDataView.data;t.dataLabelUtils.drawDefaultLabelsForDataPointChart(i,this.main,e,this.viewport)},i.rangesToArray=function(e){return e.reduce(function(e,t,i){var a;return a=0===i?t.range:t.range.slice(1),e.concat(a)},[])},i.prototype.rangeToString=function(e,t,i){var a,r=this.IncludeBrackets.right,s=i.format(e[0]),o=i.format(e[1]);return a=t?this.IncludeBrackets.left:this.ExcludeBrackets.left,""+a+s+this.SeparatorNumbers+o+r},i.prototype.renderLegend=function(){var e,t,a=this.getDataLegends(this.histogramDataView.settings);e=this.main.select(i.Legends.selector).selectAll(i.Legend.selector),t=e.data(a),t.enter().append("svg:text"),t.attr("x",0).attr("y",0).attr("dx",function(e){return e.dx}).attr("dy",function(e){return e.dy}).attr("transform",function(e){return e.transform}).attr("class",i.Legend["class"]).text(function(e){return e.text}).classed(i.Legend["class"],!0),t.exit().remove(),this.legend.select("text").style({display:this.histogramDataView.settings.xAxisSettings.title===!0?"block":"none"}),this.legend.selectAll("text").filter(function(e,t){return 1===t}).style({display:this.histogramDataView.settings.yAxisSettings.title===!0?"block":"none"})},i.prototype.getDataLegends=function(e){var a=i.getLegendText(e);return a=i.getLegend(a,e.yAxisSettings.style,e.yAxisSettings.displayUnits),[{transform:t.SVGUtil.translate(this.viewport.width/2,this.viewport.height),text:e.displayName,dx:"1em",dy:"-1em"},{transform:t.SVGUtil.translateAndRotate(this.shouldShowYOnRight()?this.yTitleMargin:0,this.viewport.height/2,0,0,270),text:a,dx:"3em"}]},i.getLegendText=function(e){return e.frequency?i.FrequencyText:i.DensityText},i.prototype.bindSelectionHandler=function(e){var t=this;this.setSelection(e),e.on("click",function(i){t.selectionManager.clear(),i.selectionIds.forEach(function(a){t.selectionManager.select(a,!0).then(function(a){a.length>0?t.setSelection(e,i):t.setSelection(e)})}),d3.event.stopPropagation()}),this.root.on("click",function(){t.selectionManager.clear(),t.setSelection(e)})},i.prototype.setSelection=function(e,t){e.transition().duration(this.durationAnimations).style("fill-opacity",this.MaxOpacity),t&&e.filter(function(e){return e!==t}).transition().duration(this.durationAnimations).style("fill-opacity",this.MinOpacity)},i.prototype.enumerateObjectInstances=function(e){var t,i=[];if(!this.histogramDataView||!this.histogramDataView.settings)return i;switch(t=this.histogramDataView.settings,e.objectName){case"general":var a={objectName:"general",displayName:"general",selector:null,properties:{bins:t.bins,frequency:t.frequency}};i.push(a);break;case"dataPoint":var r={objectName:"dataPoint",displayName:"dataPoint",selector:null,properties:{fill:t.fillColor}};i.push(r);break;case"labels":var s=t.labelSettings,o={objectName:"labels",displayName:"labels",selector:null,properties:{show:s.show,color:s.color,displayUnits:s.displayUnits,precision:s.precision,fontSize:s.fontSize}};i.push(o);break;case"xAxis":var l=t.xAxisSettings,n={objectName:"xAxis",displayName:"X-Axis",selector:null,properties:{show:l.show,title:l.title,style:l.style,axisColor:l.axisColor,displayUnits:l.displayUnits,precision:l.precision}};i.push(n);break;case"yAxis":var c=t.yAxisSettings,h={objectName:"yAxis",displayName:"Y-Axis",selector:null,properties:{show:c.show,position:c.position,start:c.start,end:c.end,title:c.title,style:c.style,axisColor:c.axisColor,displayUnits:c.displayUnits,precision:c.precision}};i.push(h)}return i},i.getObjectsFromDataView=function(e){return e&&e.metadata&&e.metadata.columns&&e.metadata.objects?e.metadata.objects:null},i.prototype.destroy=function(){this.root=null},i.prototype.calculateXAxes=function(a,r,s){var o={viewport:this.viewport,margin:this.margin,forcedXDomain:i.rangesToArray(this.histogramDataView.data),forceMerge:!0,showCategoryAxisLabel:!1,showValueAxisLabel:!1,categoryAxisScaleType:t.axisScale.linear,valueAxisScaleType:null,trimOrdinalDataOnOverflow:!1},l=this.viewport.width,n=this.calculateXAxesProperties(o,a);return n.willLabelsFit=t.AxisHelper.LabelLayoutStrategy.willLabelsFit(n,l,e.TextMeasurementService.measureSvgTextWidth,r),n.willLabelsWordBreak=!n.willLabelsFit&&!s&&t.AxisHelper.LabelLayoutStrategy.willLabelsWordBreak(n,this.margin,l,e.TextMeasurementService.measureSvgTextWidth,e.TextMeasurementService.estimateSvgTextHeight,e.TextMeasurementService.getTailoredTextOrDefault,r),n},i.prototype.calculateXAxesProperties=function(e,a){var r=t.AxisHelper.createAxis({pixelSpan:this.viewport.width-this.YLegendSize-this.AxisSize,dataDomain:e.forcedXDomain,metaDataColumn:a,formatString:t.valueFormatter.getFormatString(a,i.Properties.general.formatString),outerPadding:0,isScalar:!1,isVertical:!1,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!0,getValueFn:function(e,t){return e},scaleType:e.categoryAxisScaleType});return r.axisLabel=this.histogramDataView.settings.displayName,r},i.prototype.calculateYAxes=function(e,i,a){var r={viewport:this.viewport,margin:this.margin,forceMerge:!0,showCategoryAxisLabel:!0,showValueAxisLabel:!1,categoryAxisScaleType:t.axisScale.linear,valueAxisScaleType:null,trimOrdinalDataOnOverflow:!1},s=this.histogramDataView.settings.yAxisSettings;r.forcedYDomain=t.AxisHelper.applyCustomizedDomain([s.start,s.end],r.forcedYDomain);var o=this.calculateYAxesProperties(r,e);return o},i.prototype.calculateYAxesProperties=function(e,a){var r=this.histogramDataView.settings.yAxisSettings,s=t.AxisHelper.createAxis({pixelSpan:this.viewport.height-this.XLegendSize+5,dataDomain:t.AxisHelper.combineDomain(e.forcedYDomain,[r.start,r.end]),metaDataColumn:a,formatString:t.valueFormatter.getFormatString(a,i.Properties.general.formatString),outerPadding:this.outerPadding,isScalar:!0,isVertical:!0,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,getValueFn:function(e,t){return e},scaleType:e.categoryAxisScaleType});return s},i.ClassName="histogram",i.FrequencyText="Frequency",i.DensityText="Density",i.Properties={general:{bins:{objectName:"general",propertyName:"bins"},frequency:{objectName:"general",propertyName:"frequency"},formatString:{objectName:"general",propertyName:"formatString"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}},labels:{show:{objectName:"labels",propertyName:"show"},color:{objectName:"labels",propertyName:"color"},displayUnits:{objectName:"labels",propertyName:"displayUnits"},precision:{objectName:"labels",propertyName:"precision"},fontSize:{objectName:"labels",propertyName:"fontSize"}},xAxis:{show:{objectName:"xAxis",propertyName:"show"},axisColor:{objectName:"xAxis",propertyName:"axisColor"},title:{objectName:"xAxis",propertyName:"title"},displayUnits:{objectName:"xAxis",propertyName:"displayUnits"},precision:{objectName:"xAxis",propertyName:"precision"},style:{objectName:"xAxis",propertyName:"style"}},yAxis:{show:{objectName:"yAxis",propertyName:"show"},axisColor:{objectName:"yAxis",propertyName:"axisColor"},title:{objectName:"yAxis",propertyName:"title"},displayUnits:{objectName:"yAxis",propertyName:"displayUnits"},precision:{objectName:"yAxis",propertyName:"precision"},style:{objectName:"yAxis",propertyName:"style"},start:{objectName:"yAxis",propertyName:"start"},end:{objectName:"yAxis",propertyName:"end"},position:{objectName:"yAxis",propertyName:"position"}}},i.DefaultHistogramSettings={frequency:!0,displayName:"Histogram",bins:null,fillColor:"#5f9ea0",precision:2,xAxisSettings:{show:!0,axisColor:"#5f9ea0",title:!0,displayUnits:0,precision:2,style:t.axisStyle.showTitleOnly},yAxisSettings:{show:!0,axisColor:"#5f9ea0",title:!0,displayUnits:0,precision:2,style:t.axisStyle.showTitleOnly,start:0,position:t.yAxisPosition.left},labelSettings:{show:!1,color:"#5f9ea0",displayUnits:0,precision:2,fontSize:9}},i.Axes=l("axes"),i.Axis=l("axis"),i.Labels=l("labels"),i.Columns=l("columns"),i.Column=l("column"),i.Legends=l("legends"),i.Legend=l("legend"),i.capabilities={dataRoles:[{name:"Values",kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Values")},{name:"Frequency",kind:e.VisualDataRoleKind.Measure,displayName:"Frequency"}],dataViewMappings:[{conditions:[{Values:{min:1,max:1},Frequency:{min:0,max:1}}],categorical:{categories:{bind:{to:"Values"},dataReductionAlgorithm:{top:{}}},values:{"for":{"in":"Frequency"}}}}],sorting:{implicit:{clauses:[{role:"Values",direction:1}]}},objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}},bins:{displayName:"Bins",type:{numeric:!0}},frequency:{displayName:"Frequency",type:{bool:!0}}}},dataPoint:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint"),properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}},xAxis:{displayName:"X-Axis",properties:{show:{displayName:"Show",type:{bool:!0}},axis:{displayName:"Axis",type:{bool:!0}},axisColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},title:{displayName:"Title",type:{bool:!0}},displayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}},precision:{displayName:"Decimal Places",type:{numeric:!0}},style:{displayName:"Style",type:{enumeration:t.axisStyle.type}}}},yAxis:{displayName:"Y-Axis",properties:{show:{displayName:"Show",type:{bool:!0}},axis:{displayName:"yAxis",type:{bool:!0}},axisColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},title:{displayName:"Title",type:{bool:!0}},displayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}},precision:{displayName:"Decimal Places",type:{numeric:!0}},style:{displayName:"Style",type:{enumeration:t.axisStyle.type}},start:{displayName:"Start",type:{numeric:!0},placeHolderText:"Start",suppressFormatPainterCopy:!0},end:{displayName:"End",type:{numeric:!0},placeHolderText:"End",suppressFormatPainterCopy:!0},position:{displayName:"Position",type:{enumeration:t.yAxisPosition.type}}}},labels:{displayName:"Data Labels",properties:{show:{displayName:"Show",type:{bool:!0}},color:{displayName:"Color",type:{fill:{solid:{color:!0}}}},displayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}},suppressFormatPainterCopy:!0},precision:{displayName:"Decimal Places",type:{numeric:!0},suppressFormatPainterCopy:!0},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}}}},i.MinNumberOfBins=0,i.MaxNumberOfBins=100,i.MinPrecision=0,i.MaxPrecision=17,i}();i.Histogram=h}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=t.AnimatorCommon.GetAnimationDuration,s=a.CssConstants.createClassAndSelector,o=e.visuals.axisScale,l=a.PixelConverter,n=40,c=15,h=5,u=1,d="#00B8AA",p=0,g=17;i.DotPlotProperties={general:{formatString:{objectName:"general",propertyName:"formatString"}},labels:{show:{objectName:"labels",propertyName:"show"},fontSize:{objectName:"labels",propertyName:"fontSize"},labelPrecision:{objectName:"labels",propertyName:"labelPrecision"},labelDisplayUnits:{objectName:"labels",propertyName:"labelDisplayUnits"},labelColor:{objectName:"labels",propertyName:"color"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}},categories:{show:{objectName:"categories",propertyName:"show"},fontColor:{objectName:"categories",propertyName:"fontColor"},fontSize:{objectName:"categories",propertyName:"fontSize"}},categoryAxis:{show:{objectName:"categoryAxis",propertyName:"show"},showAxisTitle:{objectName:"categoryAxis",propertyName:"showAxisTitle"},labelColor:{objectName:"categoryAxis",propertyName:"labelColor"}}};var m=function(){function m(e){this.DefaultMargin={top:10,bottom:10,right:20,left:20},this.durationAnimations=200,this.scaleType=o.linear,this.textProperties={fontFamily:"wf_segoe-ui_normal",fontSize:a.PixelConverter.toString(9)},this.dotPlotSelectors={svgPlotSelector:s("dotplot"),plotSelector:s("dotplotSelector"),plotGroupSelector:s("dotplotGroup"),axisSelector:s("axisGraphicsContext"),xAxisSelector:s("x axis"),circleSeletor:s("circleSelector")},this.DefaultDotPlotSettings={labelSettings:{show:!0,precision:2,fontSize:t.dataLabelUtils.DefaultFontSizeInPt,displayUnits:0,labelColor:t.dataLabelUtils.defaultLabelColor},categorySettings:{show:!0,fontColor:t.LegendData.DefaultLegendLabelFillColor},defaultDataPointColor:d,categoryAxisSettings:{show:!0,showAxisTitle:!0,labelColor:{solid:{color:t.dataLabelUtils.defaultLabelColor}}}},e&&(e.svg&&(this.svg=e.svg),e.animator&&(this.animator=e.animator),this.radius=e.radius||h,this.strokeWidth=e.strokeWidth||u)}return m.getTooltipData=function(e){return[{displayName:"Value",value:e.toString()}]},m.converter=function(a,r,s,o,c,h,u,d){var p,g=a.categorical.values,y=[],f=a.categorical.categories[0].source.displayName,v=e.DataViewObjects.getFillColor(r,i.DotPlotProperties.dataPoint.fill,h.getColorByIndex(0).value),x=a.categorical.categories[0].values.map(function(e,i){return{value:e,selectionId:t.SelectionId.createWithId(a.categorical.categories[0].identity[i])}});p={categorySettings:this.getCategorySettings(r,c),defaultDataPointColor:v,labelSettings:this.parseSettings(r,c),categoryAxisSettings:this.parseCategoryAxisSettings(r,c)};for(var b=a.categorical.categories[0],S=2*d+1,w=u.height-d-n,C=Math.floor((w-o.top)/S)-1,D=l.fromPoint(p.labelSettings.fontSize),P=d3.scale.linear().domain([0,C]).range([w-o.bottom,o.top+o.bottom]),A=0,N=g;A<N.length;A++)for(var V=N[A],T=_.min(V.values),L=_.max(V.values),M=e.DataViewObjects.getFillColor(r,i.DotPlotProperties.dataPoint.fill,h.getColorByIndex(0).value),k=V&&V.values?V.values.length:0,j=T/(L/C),O=d3.scale.log().domain([0>T?1:T,L]).range([0>=j?1:j,C]).clamp(!0),I=0;k>I;I++){for(var F=O(V.values[I]),G=[],z=0;F>z;z++)G.push({x:s(x[I].value)+s.rangeBand()/2,y:P(z),tooltipInfo:m.getTooltipData(V.values[I].toFixed(p.labelSettings.precision))});var R=t.SelectionIdBuilder.builder().withCategory(b,I).createSelectionId(),B=m.getTooltipData(V.values[I].toFixed(p.labelSettings.precision));y.push({selected:!1,value:V.values[I],label:V.values[I],color:M,identity:R,tooltipInfo:B,dataPoints:G,labelFontSize:D})}return{dataPoints:y,values:a.categorical.categories[0].values,displayName:f,categories:x,settings:p}},m.prototype.init=function(e){var i=e.element;this.behavior=new y,this.interactivityService=t.createInteractivityService(e.host),this.radius=h,this.strokeWidth=u,this.colors=e.style.colorPalette.dataColors,this.svg=d3.select(i.get(0)).append("svg").classed(this.dotPlotSelectors.svgPlotSelector["class"],!0).style("position","absolute"),this.clearCatcher=t.appendClearCatcher(this.svg);var a=this.svg.append("g").classed(this.dotPlotSelectors.axisSelector["class"],!0);this.dotPlot=this.svg.append("g").classed(this.dotPlotSelectors.plotSelector["class"],!0),this.xAxis=a.append("g").classed(this.dotPlotSelectors.xAxisSelector["class"],!0)},m.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){this.durationAnimations=r(this.animator,e.suppressAnimations);var i=this.dataView=e.dataViews[0],a=e.viewport;if(!i||!i.categorical||!i.categorical.values||i.categorical.values.length<1||!i.categorical||!i.categorical.categories||!i.categorical.categories[0])return void this.clearData();var s={height:a.height-this.DefaultMargin.top,width:a.width-this.DefaultMargin.left};this.viewportIn=s,this.svg.style({height:l.toString(a.height),width:l.toString(a.width)});var o=m.getObjectsFromDataView(i),c=m.parseCategoryAxisSettings(o,this.DefaultDotPlotSettings),h=this.calculateAxes(s,c,this.textProperties,o,!1),u=m.converter(i,o,h.scale,this.DefaultMargin,this.DefaultDotPlotSettings,this.colors,a,this.radius);this.dotPlotDataView=u;var d=u.dataPoints;this.interactivityService&&this.interactivityService.applySelectionStateToData(d),this.renderAxis(s.height-n,s,h,c,u,this.durationAnimations),this.drawDotPlot(d,u.settings);var p=u.settings.labelSettings;if(p.show){var g=this.getEnhanchedDotplotLayout(p,s),y=t.dataLabelUtils.drawDefaultLabelsForDataPointChart(d,this.svg,g,s,!e.suppressAnimations,this.durationAnimations);y&&y.attr("transform",function(e){return t.SVGUtil.translate(5+e.size.width/2,5+e.size.height/2)})}else t.dataLabelUtils.cleanDataLabels(this.svg)}},m.prototype.enumerateObjectInstances=function(e){var i=new t.ObjectEnumerationBuilder;switch(e.objectName){case"dataPoint":this.enumerateDataPoints(i,this.dataView);break;case"labels":this.enumerateDataLabels(i,this.dataView);break;case"categories":this.enumerateCategories(i,this.dataView);break;case"categoryAxis":this.enumerateCategoryAxisValues(i,this.dataView)}return i.complete()},m.prototype.enumerateCategoryAxisValues=function(t,a){var r=a&&a.metadata?a.metadata.objects:void 0;t.pushInstance({objectName:"categoryAxis",displayName:"Category Axis",selector:null,properties:{show:e.DataViewObjects.getValue(r,i.DotPlotProperties.categoryAxis.show,this.DefaultDotPlotSettings.categoryAxisSettings.show),showAxisTitle:e.DataViewObjects.getValue(r,i.DotPlotProperties.categoryAxis.showAxisTitle,this.DefaultDotPlotSettings.categoryAxisSettings.showAxisTitle),labelColor:r&&r.categoryAxis&&r.categoryAxis.labelColor?r.categoryAxis.labelColor:this.DefaultDotPlotSettings.categoryAxisSettings.labelColor
}})},m.getObjectsFromDataView=function(e){return e&&e.metadata&&e.metadata.columns&&e.metadata.objects?e.metadata.objects:null},m.parseSettings=function(t,a){var r=this.getPrecision(t,a);return{show:e.DataViewObjects.getValue(t,i.DotPlotProperties.labels.show,a.labelSettings.show),precision:r,fontSize:e.DataViewObjects.getValue(t,i.DotPlotProperties.labels.fontSize,a.labelSettings.fontSize),displayUnits:e.DataViewObjects.getValue(t,i.DotPlotProperties.labels.labelDisplayUnits,a.labelSettings.displayUnits),labelColor:e.DataViewObjects.getFillColor(t,i.DotPlotProperties.labels.labelColor,a.labelSettings.labelColor)}},m.parseCategoryAxisSettings=function(t,a){return{show:e.DataViewObjects.getValue(t,i.DotPlotProperties.categoryAxis.show,a.categoryAxisSettings.show),showAxisTitle:e.DataViewObjects.getValue(t,i.DotPlotProperties.categoryAxis.showAxisTitle,a.categoryAxisSettings.showAxisTitle),labelColor:t&&t.categoryAxis&&t.categoryAxis.labelColor?t.categoryAxis.labelColor:a.categoryAxisSettings.labelColor}},m.getCategorySettings=function(t,a){return{show:e.DataViewObject.getValue(t,i.DotPlotProperties.categories.show,a.categorySettings.show),fontColor:e.DataViewObjects.getFillColor(t,i.DotPlotProperties.categories.fontColor,a.categorySettings.fontColor)}},m.getPrecision=function(t,a){var r=e.DataViewObjects.getValue(t,i.DotPlotProperties.labels.labelPrecision,a.labelSettings.precision);return p>=r?p:r>=g?g:r},m.prototype.drawDotPlot=function(e,i){var a=this.dotPlot.selectAll(this.dotPlotSelectors.plotGroupSelector.selector).data(e),r=this.interactivityService&&this.interactivityService.hasSelection();a.enter().append("g").attr({stroke:"black","stroke-width":this.strokeWidth}).style("fill-opacity",function(e){return t.ColumnUtil.getFillOpacity(e.selected,e.highlight,r,!1)}).classed(this.dotPlotSelectors.plotGroupSelector["class"],!0);var s=a.selectAll(this.dotPlotSelectors.circleSeletor.selector).data(function(e){return e.dataPoints});s.enter().append("circle").classed(this.dotPlotSelectors.circleSeletor["class"],!0),s.attr({cx:function(e){return e.x},cy:function(e){return e.y},r:this.radius,fill:i.defaultDataPointColor}),this.renderTooltip(a),s.exit().remove(),a.exit().remove();var o=this.interactivityService;if(o){o.applySelectionStateToData(e);var l={columns:a,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService};o.bind(e,this.behavior,l)}},m.prototype.getEnhanchedDotplotLayout=function(e,r){var s=a.PixelConverter.fromPoint(e.fontSize),o=t.valueFormatter.create({format:t.valueFormatter.getFormatString(this.dataView.categorical.categories[0].source,i.DotPlotProperties.general.formatString),precision:e.precision,value:e.displayUnits});return{labelText:function(i){return t.dataLabelUtils.getLabelFormattedText({label:o.format(i.label),fontSize:e.fontSize,maxWidth:r.width})},labelLayout:{x:function(e){return e.dataPoints[e.dataPoints.length-1].x-5},y:function(e){return e.dataPoints[e.dataPoints.length-1].y-c-5}},filter:function(e){return e&&e.dataPoints&&e.dataPoints[e.dataPoints.length-1]},style:{fill:e.labelColor,"font-size":s}}},m.prototype.enumerateDataLabels=function(t,a){var r=a&&a.metadata?a.metadata.objects:void 0;t.pushInstance({objectName:"labels",displayName:"Labels",selector:null,properties:{show:e.DataViewObjects.getValue(r,i.DotPlotProperties.labels.show,this.DefaultDotPlotSettings.labelSettings.show),fontSize:e.DataViewObjects.getValue(r,i.DotPlotProperties.labels.fontSize,this.DefaultDotPlotSettings.labelSettings.fontSize),labelPrecision:e.DataViewObjects.getValue(r,i.DotPlotProperties.labels.labelPrecision,this.DefaultDotPlotSettings.labelSettings.precision),labelDisplayUnits:e.DataViewObjects.getValue(r,i.DotPlotProperties.labels.labelDisplayUnits,this.DefaultDotPlotSettings.labelSettings.displayUnits),color:e.DataViewObjects.getFillColor(r,i.DotPlotProperties.labels.labelColor,this.DefaultDotPlotSettings.labelSettings.labelColor)}})},m.prototype.enumerateDataPoints=function(t,a){var r=a&&a.metadata?a.metadata.objects:void 0,s=e.DataViewObjects.getFillColor(r,i.DotPlotProperties.dataPoint.fill,this.DefaultDotPlotSettings.defaultDataPointColor);t.pushInstance({objectName:"dataPoint",displayName:"Data Points",selector:null,properties:{fill:{solid:{color:s}}}})},m.prototype.enumerateCategories=function(e,t){var i=t&&t.metadata?t.metadata.objects:void 0,a=m.getCategorySettings(i,this.DefaultDotPlotSettings);e.pushInstance({objectName:"categories",displayName:"Categories",selector:null,properties:{show:a.show,fontSize:a.fontSize,fontColor:a.fontColor}})},m.prototype.clearData=function(){this.dotPlot.selectAll("*").remove(),this.xAxis.selectAll("*").remove(),t.dataLabelUtils.cleanDataLabels(this.svg)},m.prototype.renderTooltip=function(e){t.TooltipManager.addTooltip(e,function(e){return e.data.tooltipInfo})},m.prototype.calculateAxes=function(i,a,r,s,o){var l=this.dataView.categorical.categories&&this.dataView.categorical.categories.length>0?this.dataView.categorical.categories[0]:{source:void 0,values:[t.valueFormatter.format(null)],identity:void 0},n={viewport:i,margin:this.DefaultMargin,forcedXDomain:this.dataView.categorical.categories[0].values,forceMerge:!1,showCategoryAxisLabel:!1,showValueAxisLabel:!1,categoryAxisScaleType:this.scaleType,valueAxisScaleType:null,valueAxisDisplayUnits:0,categoryAxisDisplayUnits:0,trimOrdinalDataOnOverflow:!1},c=i.width,h=this.calculateAxesProperties(i,a,n,l.source,s);return h.willLabelsFit=t.AxisHelper.LabelLayoutStrategy.willLabelsFit(h,c,e.TextMeasurementService.measureSvgTextWidth,r),h.willLabelsWordBreak=!h.willLabelsFit&&!o&&t.AxisHelper.LabelLayoutStrategy.willLabelsWordBreak(h,this.DefaultMargin,c,e.TextMeasurementService.measureSvgTextWidth,e.TextMeasurementService.estimateSvgTextHeight,e.TextMeasurementService.getTailoredTextOrDefault,r),h},m.prototype.calculateAxesProperties=function(e,a,r,s,o){var l=t.AxisHelper.createAxis({pixelSpan:e.width,dataDomain:r.forcedXDomain,metaDataColumn:s,formatString:t.valueFormatter.getFormatString(s,i.DotPlotProperties.general.formatString),outerPadding:0,isScalar:!1,isVertical:!1,forcedTickCount:r.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!0,getValueFn:function(e,t){return a.show?e:""},scaleType:r.categoryAxisScaleType,axisDisplayUnits:r.categoryAxisDisplayUnits});return a.show&&(l.axisLabel=t.AxisHelper.createAxisLabel(o,"","")),l},m.prototype.renderAxis=function(i,a,r,s,o,l){this.xAxis.attr({transform:t.SVGUtil.translate(0,i)});var n=r.axis;n.orient("bottom"),this.xAxis.transition().duration(l).call(n).call(m.setAxisLabelColor,s.labelColor);var c=this.xAxis.selectAll(".tick text");c.data(r.values),c.call(t.AxisHelper.LabelLayoutStrategy.clip,r.xLabelMaxWidth,e.TextMeasurementService.svgEllipsis),c.append("title").text(function(e){return e}),this.xAxis.selectAll("line").style("opacity",o.settings.categoryAxisSettings.show?1:0),this.xAxis.selectAll(".xAxisLabel").remove(),o.settings.categoryAxisSettings.showAxisTitle&&this.xAxis.append("text").text(this.dataView.categorical.categories[0].source.displayName).style("text-anchor","middle").attr("class","xAxisLabel").style("fill",s.labelColor.solid.color).attr("transform","translate("+a.width/2+",40)")},m.setAxisLabelColor=function(e,t){e.selectAll("g.tick text").style("fill",t&&t.solid?t.solid.color:null)},m.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:"Category"},{name:"Values",kind:e.VisualDataRoleKind.Measure,displayName:"Values"}],dataViewMappings:[{conditions:[{Category:{max:1},Values:{max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{group:{by:"Series",select:[{"for":{"in":"Values"}}],dataReductionAlgorithm:{top:{}}}}}}],objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}}}},categoryAxis:{displayName:"X-Axis",properties:{show:{displayName:"Show",type:{bool:!0}},showAxisTitle:{displayName:"Title",description:"Title options",type:{bool:!0}},labelColor:{displayName:"Label color",type:{fill:{solid:{color:!0}}}}}},dataPoint:{displayName:"Data colors",properties:{fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}}}},labels:{displayName:"Data labels",description:"Display data label options",properties:{show:{displayName:"Show",type:{bool:!0}},showSeries:{displayName:"Show",type:{bool:!0}},color:{displayName:"Color",description:"Select color for data labels",type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:"Display units",description:"Select the units (millions, billions, etc.)",type:{formatting:{labelDisplayUnits:!0}},suppressFormatPainterCopy:!0},labelPrecision:{displayName:"Decimal places",description:"Select the number of decimal places to display",placeHolderText:"Auto",type:{numeric:!0},suppressFormatPainterCopy:!0},showAll:{displayName:"Customize series",type:{bool:!0}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}}}},m}();i.DotPlot=m;var y=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.columns=e.columns,this.clearCatcher=e.clearCatcher,this.interactivityService=e.interactivityService,this.columns.on("click",function(e,i){t.handleSelection(e,d3.event.ctrlKey)}),e.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var i=this.interactivityService.hasSelection();this.columns.style("fill-opacity",function(a){return t.ColumnUtil.getFillOpacity(a.selected,a.highlight,!a.highlight&&e,!a.selected&&i)})},e}();i.DotplotBehavior=y}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r,s=a.PixelConverter;!function(t){t.byWeight="ByWeight",t.byLinkType="ByLinkType",t.interactive="Interactive",t.type=e.createEnumType([{value:t.byWeight,displayName:"ByWeight"},{value:t.byLinkType,displayName:"ByLinkType"},{value:t.interactive,displayName:"Interactive"}])}(r||(r={})),i.forceProps={general:{formatString:{objectName:"general",propertyName:"formatString"}},labels:{show:{objectName:"labels",propertyName:"show"},color:{objectName:"labels",propertyName:"color"},fontSize:{objectName:"labels",propertyName:"fontSize"}},links:{showArrow:{objectName:"links",propertyName:"showArrow"},showLabel:{objectName:"links",propertyName:"showLabel"},colorLink:{objectName:"links",propertyName:"colorLink"},thickenLink:{objectName:"links",propertyName:"thickenLink"}},nodes:{displayImage:{objectName:"nodes",propertyName:"displayImage"},defaultImage:{objectName:"nodes",propertyName:"defaultImage"},imageUrl:{objectName:"nodes",propertyName:"imageUrl"},imageExt:{objectName:"nodes",propertyName:"imageExt"},nameMaxLength:{objectName:"nodes",propertyName:"nameMaxLength"},highlightReachableLinks:{objectName:"nodes",propertyName:"highlightReachableLinks"}},size:{charge:{objectName:"size",propertyName:"charge"}}};var o=function(){function a(){}return Object.defineProperty(a.prototype,"margin",{get:function(){return this.marginValue||{left:0,right:0,top:0,bottom:0}},set:function(e){this.marginValue=$.extend({},e),this.viewportInValue=a.substractMargin(this.viewport,this.margin)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"viewport",{get:function(){return this.viewportValue||{width:0,height:0}},set:function(e){this.viewportValue=$.extend({},e),this.viewportInValue=a.substractMargin(this.viewport,this.margin)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"viewportIn",{get:function(){return this.viewportInValue||this.viewport},enumerable:!0,configurable:!0}),a.substractMargin=function(e,t){return{width:Math.max(e.width-(t.left+t.right),0),height:Math.max(e.height-(t.top+t.bottom),0)}},a.prototype.scale1to10=function(e){var t=d3.scale.linear().domain([this.data.minFiles,this.data.maxFiles]).rangeRound([1,10]).clamp(!0);return t(e)},a.prototype.getLinkColor=function(e){switch(this.options.colorLink){case r.byWeight:return this.colors.getColorByIndex(this.scale1to10(e.filecount)).value;case r.byLinkType:return e.type&&this.data.linkTypes[e.type]?this.data.linkTypes[e.type].color:this.options.defaultLinkColor}return this.options.defaultLinkColor},a.prototype.getDefaultOptions=function(){return{showDataLabels:!0,labelColor:t.dataLabelUtils.defaultLabelColor,fontSize:t.dataLabelUtils.DefaultFontSizeInPt,showArrow:!1,showLabel:!1,colorLink:r.interactive,thickenLink:!0,displayImage:!1,defaultImage:"Home",imageUrl:"",imageExt:".png",nameMaxLength:10,highlightReachableLinks:!1,charge:-15,defaultLinkColor:"#bbb",defaultLinkHighlightColor:"#f00",defaultLinkThickness:"1.5px"}},a.prototype.updateOptions=function(t){this.options.showDataLabels=e.DataViewObjects.getValue(t,i.forceProps.labels.show,this.options.showDataLabels),this.options.labelColor=e.DataViewObjects.getFillColor(t,i.forceProps.labels.color,this.options.labelColor),this.options.fontSize=e.DataViewObjects.getValue(t,i.forceProps.labels.fontSize,this.options.fontSize),this.options.showArrow=e.DataViewObjects.getValue(t,i.forceProps.links.showArrow,this.options.showArrow),this.options.showLabel=e.DataViewObjects.getValue(t,i.forceProps.links.showLabel,this.options.showLabel),this.options.colorLink=e.DataViewObjects.getValue(t,i.forceProps.links.colorLink,this.options.colorLink),this.options.thickenLink=e.DataViewObjects.getValue(t,i.forceProps.links.thickenLink,this.options.thickenLink),this.options.displayImage=e.DataViewObjects.getValue(t,i.forceProps.nodes.displayImage,this.options.displayImage),this.options.defaultImage=e.DataViewObjects.getValue(t,i.forceProps.nodes.defaultImage,this.options.defaultImage),this.options.imageUrl=e.DataViewObjects.getValue(t,i.forceProps.nodes.imageUrl,this.options.imageUrl),this.options.imageExt=e.DataViewObjects.getValue(t,i.forceProps.nodes.imageExt,this.options.imageExt),this.options.nameMaxLength=e.DataViewObjects.getValue(t,i.forceProps.nodes.nameMaxLength,this.options.nameMaxLength),this.options.highlightReachableLinks=e.DataViewObjects.getValue(t,i.forceProps.nodes.highlightReachableLinks,this.options.highlightReachableLinks),this.options.charge=e.DataViewObjects.getValue(t,i.forceProps.size.charge,this.options.charge),(this.options.charge>=0||this.options.charge<-100)&&(this.options.charge=this.getDefaultOptions().charge)},a.prototype.enumerateObjectInstances=function(e){var i=new t.ObjectEnumerationBuilder;switch(e.objectName){case"labels":this.enumerateLabels(i);break;case"links":this.enumerateLinks(i);break;case"nodes":this.enumerateNodes(i);break;case"size":this.enumerateSize(i)}return i.complete()},a.prototype.enumerateLabels=function(e){var t,i;this.options&&this.options&&(i=this.options,t={objectName:"labels",displayName:"Labels",selector:null,properties:{show:i.showDataLabels,fontSize:i.fontSize,color:i.labelColor}},e.pushInstance(t))},a.prototype.enumerateLinks=function(e){var t,i;this.options&&(i=this.options,t={objectName:"links",displayName:"Links",selector:null,properties:{showArrow:i.showArrow,colorLink:i.colorLink,showLabel:i.showLabel,thickenLink:i.thickenLink}},e.pushInstance(t))},a.prototype.enumerateNodes=function(e){var t,i;this.options&&(i=this.options,t={objectName:"nodes",displayName:"Nodes",selector:null,properties:{displayImage:i.displayImage,defaultImage:i.defaultImage,imageUrl:i.imageUrl,imageExt:i.imageExt,nameMaxLength:i.nameMaxLength,highlightReachableLinks:i.highlightReachableLinks}},e.pushInstance(t))},a.prototype.enumerateSize=function(e){var t,i;this.options&&(i=this.options,t={objectName:"size",displayName:"Size",selector:null,properties:{charge:i.charge}},e.pushInstance(t))},a.converter=function(e,a){var r,s=e.categorical,o={},l=Number.MAX_VALUE,n=0,c={},h=[],u={},d=0,p=-1,g=-1,m=-1,y=-1,f=-1,v=-1,x=[],b=i.forceProps.general.formatString;if(e&&e.categorical&&e.categorical.categories&&e.metadata&&e.metadata.columns)for(var S=e.metadata.columns,w=0;w<S.length;w++){var C=S[w];C.roles&&(C.roles.Source?p=w:C.roles.Target?g=w:C.roles.Weight?m=w:C.roles.LinkType?y=w:C.roles.SourceType?f=w:C.roles.TargetType&&(v=w))}if(e&&e.table&&(r=e.table.rows),0>p||0>g)return{nodes:{},links:[],minFiles:0,maxFiles:0,linkedByName:{},linkTypes:{}};var D=t.valueFormatter.getFormatString(s.categories[0].source,b),P=t.valueFormatter.getFormatString(s.categories[1].source,b),A=t.valueFormatter.getFormatString(s.values?s.values[0].source:null,b,!0);return r.forEach(function(i){c[i[p]+","+i[g]]=1;var r=o[i[p]]||(o[i[p]]={name:i[p],image:f>0?i[f]:"",adj:{}}),s=o[i[g]]||(o[i[g]]={name:i[g],image:v>0?i[v]:"",adj:{}});r.adj[s.name]=1,s.adj[r.name]=1,x=[{displayName:e.metadata.columns[0].displayName,value:t.valueFormatter.format(r.name,D)},{displayName:e.metadata.columns[1].displayName,value:t.valueFormatter.format(s.name,P)}],m>0&&x.push({displayName:e.metadata.columns[2].displayName,value:t.valueFormatter.format(i[m],A)});var b={source:r,target:s,filecount:m>0?i[m]:0,type:y>0?i[y]:"",tooltipInfo:x};y>0&&(u[i[y]]||(u[i[y]]={label:i[y],color:a.getColorByIndex(d++).value})),b.filecount<l&&(l=b.filecount),b.filecount>n&&(n=b.filecount),h.push(b)}),{nodes:o,links:h,minFiles:l,maxFiles:n,linkedByName:c,linkTypes:u}},a.prototype.init=function(e){this.root=d3.select(e.element.get(0)),this.forceLayout=d3.layout.force(),this.colors=e.style.colorPalette.dataColors,this.options=this.getDefaultOptions()},a.prototype.update=function(e){var i=this;if(e.dataViews&&!(e.dataViews.length<1)&&(this.data=a.converter(this.dataView=e.dataViews[0],this.colors),this.data)){e.dataViews[0].metadata&&e.dataViews[0].metadata.objects&&this.updateOptions(e.dataViews[0].metadata.objects),this.viewport=e.viewport;var o=Math.sqrt(Object.keys(this.data.nodes).length/(this.viewport.width*this.viewport.height));this.root.selectAll("svg").remove();var l=this.root.append("svg").attr("width",this.viewport.width).attr("height",this.viewport.height).classed(a.VisualClassName,!0);this.forceLayout.gravity(100*o).links(this.data.links).size([this.viewport.width,this.viewport.height]).linkDistance(100).charge(this.options.charge/o).on("tick",this.tick()),this.updateNodes(),this.forceLayout.start(),this.paths=l.selectAll(".link").data(this.forceLayout.links()).enter().append("path").attr("class","link").attr("id",function(e,t){return"linkid_"+t}).attr("stroke-width",function(e){return i.options.thickenLink?i.scale1to10(e.filecount):i.options.defaultLinkThickness}).style("stroke",function(e){return i.getLinkColor(e)}).style("fill",function(e){return i.options.showArrow?i.getLinkColor(e):void 0}).on("mouseover",this.fadePath(.3,this.options.defaultLinkHighlightColor)).on("mouseout",this.fadePath(1,this.options.defaultLinkColor)),t.TooltipManager.addTooltip(this.paths,function(e){return e.data.tooltipInfo}),this.options.showLabel&&l.selectAll(".linklabelholder").data(this.forceLayout.links()).enter().append("g").attr("class","linklabelholder").append("text").attr("class","linklabel").attr("y","-12").attr("text-anchor","middle").style("fill","#000").append("textPath").attr("xlink:href",function(e,t){return"#linkid_"+t}).attr("startOffset","25%").text(function(e){return i.options.colorLink===r.byLinkType?e.type:e.filecount}),this.nodes=l.selectAll(".node").data(this.forceLayout.nodes()).enter().append("g").attr("class","node").call(this.forceLayout.drag).on("mouseover",this.fadeNode(.3,this.options.defaultLinkHighlightColor)).on("mouseout",this.fadeNode(1,this.options.defaultLinkColor)).on("mousedown",function(){return d3.event.stopPropagation()}).attr("drag-resize-disabled",!0),this.options.displayImage?this.nodes.append("image").attr("xlink:href",function(e){return e.image&&""!==e.image?i.options.imageUrl+e.image+i.options.imageExt:i.options.defaultImage&&""!==i.options.defaultImage?i.options.imageUrl+i.options.defaultImage+i.options.imageExt:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAbCAMAAAHNDTTxAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACuUExURQAAAMbGxvLy8sfHx/Hx8fLy8vHx8cnJycrKyvHx8fHx8cvLy/Ly8szMzM3NzfHx8dDQ0PHx8fLy8vHx8e/v79LS0tPT0/Ly8tTU1NXV1dbW1vHx8fHx8fDw8NjY2PT09PLy8vLy8vHx8fLy8vHx8fHx8enp6fDw8PLy8uPj4+Tk5OXl5fHx8b+/v/Pz8+bm5vHx8ejo6PLy8vHx8fLy8sTExPLy8vLy8sXFxfHx8YCtMbUAAAA6dFJOUwD/k/+b7/f///+r/////0z/w1RcEP//ZP///4fj/v8Yj3yXn/unDEhQ////YP9Y/8//aIMU/9+L/+fzC4s1AAAACXBIWXMAABcRAAAXEQHKJvM/AAABQElEQVQoU5WS61LCMBCFFymlwSPKVdACIgWkuNyL+P4v5ibZ0jKjP/xm0uw5ySa7mRItAhnMoIC5TwQZdCZiZjcoC8WU6EVsmZgzoqGdxafgvJAvjUXCb2M+0cXNsd/GDarZqSf7av3M2P1E3xhfLkPUvLD5joEYwVVJQXM6+9McWUwLf4nDTCQZAy96UoDjNI/jhl3xPLbQamu8xD7iaIsPKw7GJ7KZEnWLY3Gi8EFj5nqibXnwD5VEGjJXk5sbpLppfvvo1RazQVrhSopPK4TODrtnjS3dY4ic8KurruWQYF+UG60BacexTMyT2jlNg41dOmKvTpkUd/Jevy7ZxQ61ULRUpoododx8GeDPvIrktbFVdUsK6f8Na5VlVpjZJtowTXVy7kfXF5wCaV1tqXAFuIdWJu+JviaQzNzfQvQDGKRXXEmy83cAAAAASUVORK5CYII="}).attr("x","-12px").attr("y","-12px").attr("width","24px").attr("height","24px"):this.nodes.append("circle").attr("r",function(e){return e.weight<5?5:e.weight}),this.options.showDataLabels&&this.nodes.append("text").attr({x:12,dy:".35em"}).style({fill:this.options.labelColor,"font-size":s.fromPoint(this.options.fontSize)}).text(function(e){return e.name?e.name.length>i.options.nameMaxLength?e.name.substr(0,i.options.nameMaxLength):e.name:""})}},a.prototype.updateNodes=function(){var e=this.forceLayout.nodes();this.forceLayout.nodes(d3.values(this.data.nodes)),this.forceLayout.nodes().forEach(function(t,i){e[i]&&(t.x=e[i].x,t.y=e[i].y,t.px=e[i].px,t.py=e[i].py,t.weight=e[i].weight)})},a.prototype.tick=function(){var e=this,t=this.viewportIn,i=20*t.width,a=20*t.height,r=function(e){return Math.max((t.width-i)/2,Math.min((t.width+i)/2,e))},s=function(e){return Math.max((t.height-a)/2,Math.min((t.height+a)/2,e))},o=this.options.showArrow?function(e){e.source.x=r(e.source.x),e.source.y=s(e.source.y),e.target.x=r(e.target.x),e.target.y=s(e.target.y);var t=e.target.x-e.source.x,i=e.target.y-e.source.y,a=Math.sqrt(t*t+i*i),o=Math.atan2(i,t)+Math.PI/7.85,l=Math.PI/2,n=e.target.x-6*Math.cos(o),c=e.target.y-6*Math.sin(o);return"M"+e.source.x+","+e.source.y+"A"+a+","+a+" 0 0 1,"+e.target.x+","+e.target.y+"A"+a+","+a+" 0 0 0,"+e.source.x+","+e.source.y+"M"+n+","+c+"l"+(3.5*Math.cos(l-o)-10*Math.cos(o))+","+(-3.5*Math.sin(l-o)-10*Math.sin(o))+"L"+(n-3.5*Math.cos(l-o)-10*Math.cos(o))+","+(c+3.5*Math.sin(l-o)-10*Math.sin(o))+"z"}:function(e){e.source.x=r(e.source.x),e.source.y=s(e.source.y),e.target.x=r(e.target.x),e.target.y=s(e.target.y);var t=e.target.x-e.source.x,i=e.target.y-e.source.y,a=Math.sqrt(t*t+i*i);return"M"+e.source.x+","+e.source.y+"A"+a+","+a+" 0 0,1 "+e.target.x+","+e.target.y};return function(){e.paths.each(function(){this.parentNode.insertBefore(this,this)}),e.paths.attr("d",o),e.nodes.attr("transform",function(e){return"translate("+r(e.x)+","+s(e.y)+")"})}},a.prototype.fadePath=function(e,t){var i=this;if(this.options.colorLink===r.interactive)return function(a){i.paths.style("stroke-opacity",function(t){return t.source===a.source&&t.target===a.target?1:e}),i.paths.style("stroke",function(e){return e.source===a.source&&e.target===a.target?t:i.options.defaultLinkColor})}},a.prototype.isReachable=function(e,t){if(e.name===t.name)return!0;if(this.data.linkedByName[e.name+","+t.name])return!0;var i={};for(var a in this.data.nodes)i[a]=!1;i[e.name]=!0;var r=[];for(r.push(e.name);r.length>0;){var s=r.pop(),o=this.data.nodes[s];for(var l in o.adj){if(l===t.name)return!0;i[l]||(i[l]=!0,r.push(l))}}return!1},a.prototype.fadeNode=function(e,t){var i=this;if(this.options.colorLink===r.interactive){var a=function(e,t){return i.data.linkedByName[e.name+","+t.name]||i.data.linkedByName[t.name+","+e.name]||e.name===t.name};return function(r){var s=i;i.nodes.style("stroke-opacity",function(t){var i=(s.options.highlightReachableLinks?s.isReachable(r,t):a(r,t))?1:e;return this.setAttribute("fill-opacity",i),i}),i.paths.style("stroke-opacity",function(t){return(i.options.highlightReachableLinks?i.isReachable(r,t.source):t.source===r||t.target===r)?1:e}),i.paths.style("stroke",function(e){return(i.options.highlightReachableLinks?i.isReachable(r,e.source):e.source===r||e.target===r)?t:i.options.defaultLinkColor})}}},a.prototype.destroy=function(){this.root=null},a.VisualClassName="forceGraph",a.capabilities={dataRoles:[{name:"Source",kind:e.VisualDataRoleKind.Grouping,displayName:"Source"},{name:"Target",kind:e.VisualDataRoleKind.Grouping,displayName:"Target"},{name:"Weight",kind:e.VisualDataRoleKind.Measure,displayName:"Weight"},{name:"LinkType",kind:e.VisualDataRoleKind.Grouping,displayName:"LinkType",description:"Links can be colored by link types"},{name:"SourceType",kind:e.VisualDataRoleKind.Grouping,displayName:"SourceType",description:"Source type represents the image name for source entities"},{name:"TargetType",kind:e.VisualDataRoleKind.Grouping,displayName:"TargetType",description:"Target type represents the image name for target entities"}],objects:{general:{properties:{formatString:{type:{formatting:{formatString:!0}}}}},labels:{displayName:"Data labels",properties:{show:{displayName:"Show",type:{bool:!0}},color:{displayName:"Fill",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},links:{displayName:"Links",properties:{showArrow:{type:{bool:!0},displayName:"Arrow"},showLabel:{type:{bool:!0},displayName:"Label",description:"Displays weight on links"},colorLink:{type:{enumeration:r.type},displayName:"Color"},thickenLink:{type:{bool:!0},displayName:"Thickness",description:"Thickenss of links represents weight"}}},nodes:{displayName:"Nodes",properties:{displayImage:{type:{bool:!0},displayName:"Image",description:"Images are loaded from image url + source or target type + image extension"},defaultImage:{type:{text:!0},displayName:"Default image"},imageUrl:{type:{text:!0},displayName:"Image url"},imageExt:{type:{text:!0},displayName:"Image extension"},nameMaxLength:{type:{numeric:!0},displayName:"Max name length",description:"Max length of the name of entities displayed"},highlightReachableLinks:{type:{bool:!0},displayName:"Highlight all reachable links",description:"In interactive mode, whether a node's all reachable links will be highlighted"}}},size:{displayName:"Size",properties:{charge:{type:{numeric:!0},displayName:"Charge",description:"The larger the negative charge the more apart the entities, must be negative but greater than -100"}}}},dataViewMappings:[{conditions:[{Source:{max:1},Target:{max:1},Weight:{max:1},LinkType:{max:1},SourceType:{max:1},TargetType:{max:1}}],categorical:{categories:{"for":{"in":"Source"},dataReductionAlgorithm:{top:{}}},values:{select:[{bind:{to:"Target"}},{bind:{to:"Weight"}},{bind:{to:"LinkType"}},{bind:{to:"SourceType"}},{bind:{to:"TargetType"}}]},rowCount:{preferred:{min:1}}}}],suppressDefaultTitle:!0},a}();i.ForceGraph=o}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){function r(t){var i=!1;return e.createEnumType(Object.keys(t).filter(function(e,a){return!!(a%2)===i&&t[e]===e&&!void(i===!i)||!!(a%2)!==i}).map(function(e){return{value:e,displayName:e}}))}var s=t.utility.SelectionManager,o=a.PixelConverter,l="0.00 %;-0.00 %;0.00 %",n=864e5,c=6048e5,h=2629746e3,u=31556952e3,d=40,p=5;!function(e){e[e.Day="Day"]="Day",e[e.Week="Week"]="Week",e[e.Month="Month"]="Month",e[e.Year="Year"]="Year"}(i.GanttDateType||(i.GanttDateType={}));var g,m=i.GanttDateType;!function(e){var t=a.CssConstants.createClassAndSelector;e.ClassName=t("gantt"),e.Chart=t("chart"),e.ChartLine=t("chart-line"),e.Body=t("gantt-body"),e.AxisGroup=t("axis"),e.Domain=t("domain"),e.AxisTick=t("tick"),e.Tasks=t("tasks"),e.SingleTask=t("task"),e.TaskRect=t("task-rect"),e.TaskProgress=t("task-progress"),e.TaskResource=t("task-resource"),e.SingleMilestone=t("milestone"),e.TaskLabels=t("task-labels"),e.TaskLines=t("task-lines"),e.SingleTaskLine=t("task-line"),e.Label=t("label"),e.LegendItems=t("legendItem"),e.LegendTitle=t("legendTitle")}(g||(g={}));var y=function(){function i(){this.textProperties={fontFamily:"wf_segoe-ui_normal",fontSize:a.PixelConverter.toString(9)},this.margin={top:50,right:40,bottom:40,left:10}}return i.getProperties=function(e){var t={};for(var i in e.objects){t[i]={};for(var a in e.objects[i].properties)t[i][a]={objectName:i,propertyName:a}}return t},i.getMaxTaskOpacity=function(){return i.DefaultValues.MaxTaskOpacity},i.getMinTaskOpacity=function(){return i.DefaultValues.MinTaskOpacity},i.prototype.init=function(e){var i=e.element;this.style=e.style,this.body=d3.select(i.get(0)),this.hostServices=e.host,this.selectionManager=new s({hostServices:e.host}),this.isInteractiveChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.interactivityService=t.createInteractivityService(this.hostServices),this.createViewport(i),this.updateChartSize(e.viewport),this.behavior=new f,this.colors=e.style.colorPalette.dataColors,this.data={legendData:null,series:null,showLegend:null}},i.prototype.createViewport=function(e){this.ganttDiv=this.body.append("div").classed(g.Body["class"],!0),this.ganttSvg=this.ganttDiv.append("svg").classed(g.ClassName["class"],!0),this.clearCatcher=t.appendClearCatcher(this.ganttSvg),this.axisGroup=this.ganttSvg.append("g").classed(g.AxisGroup["class"],!0),this.lineGroup=this.ganttSvg.append("g").classed(g.TaskLines["class"],!0),this.chartGroup=this.ganttSvg.append("g").classed(g.Chart["class"],!0),this.taskGroup=this.chartGroup.append("g").classed(g.Tasks["class"],!0),this.legend=t.createLegend(e.children(g.Body.selector),this.isInteractiveChart,this.interactivityService,!0,t.LegendPosition.Top)},i.prototype.clearViewport=function(){this.body.selectAll(g.LegendItems.selector).remove(),this.body.selectAll(g.LegendTitle.selector).remove(),this.axisGroup.selectAll(g.AxisTick.selector).remove(),this.axisGroup.selectAll(g.Domain.selector).remove(),this.lineGroup.selectAll("*").remove(),this.chartGroup.selectAll(g.ChartLine.selector).remove(),this.chartGroup.selectAll(g.SingleTask.selector).remove()},i.prototype.updateChartSize=function(e){this.ganttDiv.style({height:o.toString(e.height),width:o.toString(e.width)})},i.prototype.createSeries=function(e,a){var r=new t.ColorHelper(this.colors,void 0),s=_.groupBy(a,function(e){return e.taskType}),o=i.getAllTasksTypes(this.dataView),l=_.map(o.types,function(i){return{tasks:s[i],fill:r.getColorForMeasure(e,i),name:i,identity:t.SelectionId.createWithMeasure(i),selected:!1}});return l},i.converter=function(a,r){var s=e.DataViewObjects.getValue(a.metadata.objects,i.Properties.taskLabels.show,!0),o=e.DataViewObjects.getFillColor(a.metadata.objects,i.Properties.taskLabels.fill,i.DefaultValues.TaskLabelColor),l=e.DataViewObjects.getValue(a.metadata.objects,i.Properties.taskLabels.fontSize,i.DefaultValues.LabelFontSize),n=e.DataViewObjects.getValue(a.metadata.objects,i.Properties.taskLabels.width,s?i.DefaultValues.TaskLabelWidth:0),c=e.DataViewObjects.getFillColor(a.metadata.objects,i.Properties.taskCompletion.fill,i.DefaultValues.ProgressColor),h=e.DataViewObjects.getFillColor(a.metadata.objects,i.Properties.taskResource.fill,i.DefaultValues.TaskResourceColor),u=e.DataViewObjects.getValue(a.metadata.objects,i.Properties.taskResource.fontSize,i.DefaultValues.ResourceFontSize),d=e.DataViewObjects.getValue(a.metadata.objects,i.Properties.taskResource.show,!0),p=e.DataViewObjects.getValue(a.metadata.objects,i.Properties.dateType.type,i.DefaultValues.DefaultDateType),g=i.getAllTasksTypes(a),m=new t.ColorHelper(r,void 0),y={fontSize:i.DefaultValues.LegendFontSize,dataPoints:[],title:g.typeName};y.dataPoints=_.map(g.types,function(e){return{label:e,color:m.getColorForMeasure(a.metadata.objects,e),icon:t.LegendIcon.Circle,selected:!1,identity:t.SelectionId.createWithMeasure(e)}});var f={taskLabelsShow:s,taskLabelsColor:o,taskLabelsFontSize:l,
taskLabelsWidth:n,taskProgressColor:c,taskResourceShow:d,taskResourceColor:h,taskResourceFontSize:u,legendData:y,taskTypes:g,dateType:p};return f},i.prototype.parseSettings=function(e){if(!e||!e.metadata||!e.metadata.columns)return null;for(var i="d",a="#",r=0,s=e.metadata.columns;r<s.length;r++){var o=s[r];if(e.categorical.categories)for(var n=0,c=e.categorical.categories;n<c.length;n++){var h=c[n];this.hasRole(h.source,"StartDate")&&(i=o.format)}}return{startDateFormatter:t.valueFormatter.create({format:i}),durationFormatter:t.valueFormatter.create({format:a}),completionFormatter:t.valueFormatter.create({format:l,value:1,allowFormatBeautification:!0})}},i.prototype.isValidDate=function(e){return"[object Date]"!==Object.prototype.toString.call(e)?!1:!isNaN(e.getTime())},i.prototype.convertToDecimal=function(e){return e>=0&&1>=e?e:e/100},i.prototype.createTasks=function(e,a){var r=this,s=e.table.columns,o=e.table.rows,l=e.categorical.categories[0],n=new t.ColorHelper(this.colors,void 0);return o.map(function(o,c){var h=r.getTaskProperty(s,o,"StartDate");h=r.isValidDate(h)?h:new Date(Date.now());var u=r.getTaskProperty(s,o,"Duration"),d=r.getTaskProperty(s,o,"Completion"),p=r.convertToDecimal(d);p=1>=p?p:1;var g=r.getTaskProperty(s,o,"Legend"),m=n.getColorForMeasure(e.metadata.objects,g),y={id:c,name:r.getTaskProperty(s,o,"Task"),start:h?h:new Date(Date.now()),duration:u>0?u:1,end:null,completion:p>0?p:0,resource:r.getTaskProperty(s,o,"Resource"),taskType:g,color:m?m:i.DefaultValues.TaskColor,tooltipInfo:null,description:"",identity:t.SelectionId.createWithIdAndMeasure(l.identity[c],g),selected:!1};return y.end=d3.time.day.offset(y.start,y.duration),y.tooltipInfo=r.getTooltipInfo(y,a),y})},i.getAllTasksTypes=function(e){var t,i=[],a="",r=e.table.rows,s=_.findIndex(e.table.columns,function(e){return e.roles.hasOwnProperty("Legend")});return-1!==s&&(a=e.table.columns[s].displayName,i=_.unique(r,function(e){return e[s]}).map(function(e){return e[s]})),t={typeName:a,types:i}},i.prototype.getTooltipInfo=function(e,t,a){void 0===a&&(a="Days");var r=[];return e.taskType&&r.push({displayName:i.capabilities.dataRoles[0].name,value:e.taskType}),r.push({displayName:i.capabilities.dataRoles[1].name,value:e.name}),isNaN(e.start.getDate())||r.push({displayName:i.capabilities.dataRoles[2].name,value:t.startDateFormatter.format(e.start.toLocaleDateString())}),r.push({displayName:i.capabilities.dataRoles[3].name,value:t.durationFormatter.format(e.duration)+" "+a}),r.push({displayName:i.capabilities.dataRoles[4].name,value:t.completionFormatter.format(e.completion)}),e.resource&&r.push({displayName:i.capabilities.dataRoles[5].name,value:e.resource}),r},i.prototype.getTaskProperty=function(e,t,i){if(!(t&&e&&e.length>0&&e[0].roles))return null;var a=e.indexOf(e.filter(function(e){return e.roles[i]})[0]);return-1!==a?t[a]:null},i.prototype.hasRole=function(e,t){var i=e.roles;return i&&i[t]},i.prototype.isChartHasTask=function(e){if(e.table&&e.table.columns)for(var t=0,i=e.table.columns;t<i.length;t++){var a=i[t];if(this.hasRole(a,"Task"))return!0}return!1},i.prototype.renderLegend=function(e){if(e){if(this.legendObjectProperties){t.LegendData.update(e,this.legendObjectProperties);var i;i=this.legendObjectProperties[t.legendProps.position],i&&this.legend.changeOrientation(t.LegendPosition[i])}var a=this.viewport;this.legend.drawLegend(e,{height:a.height,width:a.width}),t.Legend.positionChartArea(this.ganttSvg,this.legend)}},i.prototype.parseLegendProperties=function(t){return t&&t.metadata?void(this.legendObjectProperties=e.DataViewObjects.getObject(t.metadata.objects,"legend",{})):void(this.legendObjectProperties={})},i.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){var t=e.dataViews[0];if(!this.isChartHasTask(t)||0===e.dataViews[0].table.rows.length)return void this.clearViewport();this.dataView=t;var a=e.viewport;this.viewport=a,this.updateChartSize(a);var r=i.converter(t,this.colors),s=this.parseSettings(t),l=this.createTasks(t,s);if(this.parseLegendProperties(t),this.renderLegend(r.legendData),this.data.series=this.createSeries(t.metadata.objects,l),this.viewModel=r,this.interactivityService&&(this.interactivityService.applySelectionStateToData(l),this.interactivityService.applySelectionStateToData(this.data.series)),l.length>0){var n=_.sortBy(l,function(e){return e.start}),c=_.sortBy(l,function(e){return e.end}),h=this.getDateType(),u=n[0].start,p=c[l.length-1].end,m=Math.ceil(Math.round(p.valueOf()-u.valueOf())/h);m=0===m||1===m?2:m;var y=50*m;this.ganttSvg.attr({height:o.toString(l.length*d+this.margin.top),width:o.toString(this.margin.left+this.viewModel.taskLabelsWidth+y+i.DefaultValues.ResourceWidth)});var f={height:a.height,width:y},v=this.calculateAxes(f,this.textProperties,u,p,y,m,!1);if(this.timeScale=v.scale,this.renderAxis(v,200),this.renderTasks(l),this.createMilestoneLine(l),this.updateTaskLabels(l,r.taskLabelsWidth),this.updateElementsPositions(a,this.margin),this.interactivityService){var x={clearCatcher:this.clearCatcher,taskSelection:this.taskGroup.selectAll(g.SingleTask.selector),legendSelection:this.body.selectAll(g.LegendItems.selector),interactivityService:this.interactivityService};this.interactivityService.bind(l,this.behavior,x)}}}},i.prototype.getDateType=function(){var e=c;switch(this.viewModel.dateType){case"Day":e=n;break;case"Week":e=c;break;case"Month":e=h;break;case"Year":e=u}return e},i.prototype.calculateAxes=function(i,a,r,s,o,l,n){var c=e.ValueType.fromPrimitiveTypeAndCategory(e.PrimitiveType.Date),h={displayName:"StartDate",queryName:"StartDate",type:c,index:0},u={viewport:i,margin:this.margin,forcedXDomain:[r,s],forceMerge:!1,showCategoryAxisLabel:!1,showValueAxisLabel:!1,categoryAxisScaleType:e.visuals.axisScale.linear,valueAxisScaleType:null,valueAxisDisplayUnits:0,categoryAxisDisplayUnits:0,trimOrdinalDataOnOverflow:!1,forcedTickCount:l},d=i.width,p=this.calculateAxesProperties(i,u,o,h);return p.willLabelsFit=t.AxisHelper.LabelLayoutStrategy.willLabelsFit(p,d,e.TextMeasurementService.measureSvgTextWidth,a),p.willLabelsWordBreak=!p.willLabelsFit&&!n&&t.AxisHelper.LabelLayoutStrategy.willLabelsWordBreak(p,this.margin,d,e.TextMeasurementService.measureSvgTextWidth,e.TextMeasurementService.estimateSvgTextHeight,e.TextMeasurementService.getTailoredTextOrDefault,a),p},i.prototype.calculateAxesProperties=function(e,a,r,s){var o=this,l=t.AxisHelper.createAxis({pixelSpan:e.width,dataDomain:a.forcedXDomain,metaDataColumn:s,formatString:i.DefaultValues.DateFormatStrings[this.viewModel.dateType],outerPadding:0,isScalar:!0,isVertical:!1,forcedTickCount:a.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!0,getValueFn:function(e,a){return t.valueFormatter.format(new Date(e),i.DefaultValues.DateFormatStrings[o.viewModel.dateType])},scaleType:a.categoryAxisScaleType,axisDisplayUnits:a.categoryAxisDisplayUnits});return l.axisLabel=s.displayName,l},i.prototype.renderAxis=function(e,t){var i=e.axis;i.orient("bottom"),this.axisGroup.transition().duration(t).call(i)},i.prototype.updateTaskLabels=function(a,r){var s,l=this,n=15,c=this.viewModel?this.viewModel.taskLabelsShow:!0,h=this.viewModel?this.viewModel.taskLabelsColor:i.DefaultValues.TaskLabelColor,u=this.viewModel?this.viewModel.taskLabelsFontSize:i.DefaultValues.LabelFontSize;c?(s=this.lineGroup.selectAll(g.Label.selector).data(a),s.enter().append("text").classed(g.Label["class"],!0),s.attr({x:n,y:function(e,t){return l.getTaskLabelCoordinateY(e.id)},fill:h,"stroke-width":1}).style("font-size",o.fromPoint(u)).text(function(e){return e.name}),s.call(t.AxisHelper.LabelLayoutStrategy.clip,r-20,e.TextMeasurementService.svgEllipsis),s.append("title").text(function(e){return e.name}),s.exit().remove()):this.lineGroup.selectAll(g.Label.selector).remove()},i.prototype.renderTasks=function(a){var r=this,s=this.taskGroup.selectAll(g.SingleTask.selector).data(a),l=this.viewModel?this.viewModel.taskProgressColor:i.DefaultValues.ProgressColor,n=this.viewModel?this.viewModel.taskResourceShow:!0,c=4,h=this.viewModel?this.viewModel.taskResourceColor:i.DefaultValues.TaskResourceColor,u=this.viewModel?this.viewModel.taskResourceFontSize:i.DefaultValues.ResourceFontSize;s.enter().append("g").classed(g.SingleTask["class"],!0);var d=s.selectAll(g.TaskRect.selector).data(function(e){return[e]});d.enter().append("rect").classed(g.TaskRect["class"],!0),d.classed(g.TaskRect["class"],!0).attr({x:function(e){return r.timeScale(e.start)},y:function(e){return r.getBarYCoordinate(e.id)},width:function(e){return r.taskDurationToWidth(e)},height:function(){return r.getBarHeight()}}).style("fill",function(e){return e.color}),d.exit().remove();var p=s.selectAll(g.TaskProgress.selector).data(function(e){return[e]});if(p.enter().append("rect").classed(g.TaskProgress["class"],!0),p.attr({x:function(e){return r.timeScale(e.start)},y:function(e){return r.getBarYCoordinate(e.id)+r.getBarHeight()/2-i.DefaultValues.ProgressBarHeight/2},width:function(e){return r.setTaskProgress(e)},height:i.DefaultValues.ProgressBarHeight}).style("fill",l),p.exit().remove(),n){var m=s.selectAll(g.TaskResource.selector).data(function(e){return[e]});m.enter().append("text").classed(g.TaskResource["class"],!0),m.attr({x:function(e){return r.timeScale(e.end)+c},y:function(e){return r.getBarYCoordinate(e.id)+r.getBarHeight()/2+c}}).text(function(e){return e.resource}).style({fill:h,"font-size":o.fromPoint(u)}).call(t.AxisHelper.LabelLayoutStrategy.clip,i.DefaultValues.ResourceWidth-10,e.TextMeasurementService.svgEllipsis),m.exit().remove()}else s.selectAll(g.TaskResource.selector).remove();t.TooltipManager.addTooltip(s,function(e){return e.data.tooltipInfo}),s.exit().remove()},i.prototype.onClearSelection=function(){this.selectionManager.clear()},i.prototype.getTaskLabelCoordinateY=function(e){var t=+this.getTaskLabelFontSize();return d*e+(this.getBarHeight()+5-(40-t)/4)},i.prototype.setTaskProgress=function(e){var t=e.completion/1,i=this.timeScale,a=(i(e.end)-i(e.start))*t;return a},i.prototype.getBarYCoordinate=function(e){return d*e+p},i.prototype.getBarHeight=function(){return d/1.5},i.prototype.taskDurationToWidth=function(e){return this.timeScale(e.end)-this.timeScale(e.start)},i.prototype.getTooltipForMilstoneLine=function(e,t){var i=new Date(e).toDateString(),a=[{displayName:t,value:i}];return a},i.prototype.createMilestoneLine=function(e,i,a){void 0===i&&(i="Today"),void 0===a&&(a=Date.now());var r=[{x1:this.timeScale(a),y1:0,x2:this.timeScale(a),y2:this.getMilestoneLineLength(e.length),tooltipInfo:this.getTooltipForMilstoneLine(a,i)}],s=this.chartGroup.selectAll(g.ChartLine.selector).data(r);s.enter().append("line").classed(g.ChartLine["class"],!0),s.attr({x1:function(e){return e.x1},y1:function(e){return e.y1},x2:function(e){return e.x2},y2:function(e){return e.y2},tooltipInfo:function(e){return e.tooltipInfo}}),t.TooltipManager.addTooltip(s,function(e){return e.data.tooltipInfo}),s.exit().remove()},i.prototype.updateElementsPositions=function(e,i){var a=this.viewModel;this.axisGroup.attr("transform",t.SVGUtil.translate(a.taskLabelsWidth+i.left,15)),this.chartGroup.attr("transform",t.SVGUtil.translate(a.taskLabelsWidth+i.left,i.top)),this.lineGroup.attr("transform",t.SVGUtil.translate(0,i.top))},i.prototype.getMilestoneLineLength=function(e){return e*d},i.prototype.getTaskLabelFontSize=function(){return e.DataViewObjects.getValue(this.dataView.metadata.objects,i.Properties.taskLabels.fontSize,i.DefaultValues.LabelFontSize)},i.prototype.enumerateLegendOptions=function(t,a){t.pushInstance({displayName:i.Properties.legend.show.objectName,selector:null,properties:{show:e.DataViewObjects.getValue(a,i.Properties.legend.show,!0),position:e.DataViewObjects.getValue(a,i.Properties.legend.position,!0),showTitle:e.DataViewObjects.getValue(a,i.Properties.legend.showTitle,!0),titleText:e.DataViewObjects.getValue(a,i.Properties.legend.titleText,""),labelColor:e.DataViewObjects.getFillColor(a,i.Properties.legend.labelColor,i.DefaultValues.LegendLabelColor),fontSize:e.DataViewObjects.getValue(a,i.Properties.legend.fontSize,i.DefaultValues.LegendFontSize)},objectName:i.Properties.legend.show.objectName})},i.prototype.enumerateDataPoints=function(e,i){var a=this.data.series;a.forEach(function(i){e.pushInstance({objectName:"dataPoint",displayName:i.name,selector:t.ColorHelper.normalizeSelector(i.identity.getSelector(),!1),properties:{fill:{solid:{color:i.fill}}}})})},i.prototype.enumerateTaskCompletion=function(t,a){t.pushInstance({selector:null,properties:{fill:e.DataViewObjects.getFillColor(a,i.Properties.taskCompletion.fill,i.DefaultValues.ProgressColor)},objectName:i.Properties.taskCompletion.fill.objectName})},i.prototype.enumerateTaskLabels=function(t,a){t.pushInstance({selector:null,properties:{show:e.DataViewObjects.getValue(a,i.Properties.taskLabels.show,!0),fill:e.DataViewObjects.getFillColor(a,i.Properties.taskLabels.fill,i.DefaultValues.TaskLabelColor),fontSize:e.DataViewObjects.getValue(a,i.Properties.taskLabels.fontSize,i.DefaultValues.LabelFontSize),width:e.DataViewObjects.getValue(a,i.Properties.taskLabels.width,i.DefaultValues.TaskLabelWidth)},objectName:i.Properties.taskLabels.show.objectName})},i.prototype.enumerateDataLabels=function(t,a){t.pushInstance({selector:null,properties:{show:e.DataViewObjects.getValue(a,i.Properties.taskResource.show,!0),fill:e.DataViewObjects.getFillColor(a,i.Properties.taskResource.fill,i.DefaultValues.TaskResourceColor),fontSize:e.DataViewObjects.getValue(a,i.Properties.taskResource.fontSize,i.DefaultValues.ResourceFontSize)},objectName:i.Properties.taskResource.show.objectName})},i.prototype.enumerateDateType=function(t,a){t.pushInstance({selector:null,properties:{type:e.DataViewObjects.getValue(a,i.Properties.dateType.type,i.DefaultValues.DefaultDateType)},objectName:i.Properties.dateType.type.objectName})},i.prototype.enumerateObjectInstances=function(e){var i=this.dataView;if(i){var a=new t.ObjectEnumerationBuilder;switch(e.objectName){case"legend":this.enumerateLegendOptions(a,i.metadata.objects);break;case"dataPoint":this.enumerateDataPoints(a,i.metadata.objects);break;case"taskLabels":this.enumerateTaskLabels(a,i.metadata.objects);break;case"taskCompletion":this.enumerateTaskCompletion(a,i.metadata.objects);break;case"taskResource":this.enumerateDataLabels(a,i.metadata.objects);break;case"dateType":this.enumerateDateType(a,i.metadata.objects)}return a.complete()}},i.DefaultValues={AxisTickSize:6,LabelFontSize:9,LegendFontSize:8,LegendLabelColor:"#000000",MaxTaskOpacity:1,MinTaskOpacity:.4,ProgressBarHeight:4,ProgressColor:"#000000",ResourceFontSize:9,ResourceWidth:100,TaskColor:"#00B099",TaskLabelColor:"#000000",TaskLabelWidth:110,TaskLineWidth:15,TaskResourceColor:"#000000",DefaultDateType:m.Week,DateFormatStrings:{Day:"MMM dd",Week:"MMM dd",Month:"MMM yyyy",Year:"yyyy"}},i.capabilities={dataRoles:[{name:"Legend",kind:e.VisualDataRoleKind.Grouping,displayName:"Legend"},{name:"Task",kind:e.VisualDataRoleKind.Grouping,displayName:"Task"},{name:"StartDate",kind:e.VisualDataRoleKind.Grouping,displayName:"Start Date"},{name:"Duration",kind:e.VisualDataRoleKind.Measure,displayName:"Duration",requiredTypes:[{numeric:!0},{integer:!0}]},{name:"Completion",kind:e.VisualDataRoleKind.Measure,displayName:"% Completion",requiredTypes:[{numeric:!0},{integer:!0}]},{name:"Resource",kind:e.VisualDataRoleKind.Grouping,displayName:"Resource"}],dataViewMappings:[{conditions:[{Legend:{min:0,max:1},Task:{min:1,max:1},StartDate:{min:0,max:0},Duration:{min:0,max:0},Completion:{min:0,max:0},Resource:{min:0,max:0}},{Legend:{min:0,max:1},Task:{min:1,max:1},StartDate:{min:0,max:1},Duration:{min:0,max:0},Completion:{min:0,max:0},Resource:{min:0,max:0}},{Legend:{min:0,max:1},Task:{min:0,max:1},StartDate:{min:0,max:1},Duration:{min:0,max:1},Completion:{min:0,max:1},Resource:{min:0,max:1}}],table:{rows:{select:[{"for":{"in":"Legend"}},{"for":{"in":"Task"}},{"for":{"in":"StartDate"}},{"for":{"in":"Duration"}},{"for":{"in":"Completion"}},{"for":{"in":"Resource"}}]}}}],sorting:{"default":{}},objects:{legend:{displayName:"Legend",description:"Display legend options",properties:{show:{displayName:"Show",type:{bool:!0}},position:{displayName:"Position",description:"Select the location for the legend",type:{enumeration:t.legendPosition.type}},showTitle:{displayName:"Title",description:"Display a title for legend symbols",type:{bool:!0}},titleText:{displayName:"Legend Name",description:"Title text",type:{text:!0},suppressFormatPainterCopy:!0},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},taskLabels:{displayName:"Category Labels",properties:{show:{displayName:"Show",type:{bool:!0}},fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Font Size",type:{formatting:{fontSize:!0}}},width:{displayName:"Width",type:{numeric:!0}}}},taskCompletion:{displayName:"Task Completion",properties:{show:{type:{bool:!0}},fill:{displayName:"Completion Color",type:{fill:{solid:{color:!0}}}}}},taskResource:{displayName:"Data Labels",properties:{show:{displayName:"Show",type:{bool:!0}},fill:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Font Size",type:{formatting:{fontSize:!0}}}}},dateType:{displayName:"Gantt Date Type",properties:{type:{displayName:"Type",type:{enumeration:r(m)}}}}}},i.Properties=i.getProperties(i.capabilities),i}();i.Gantt=y;var f=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.options=e;var i=e.clearCatcher;e.taskSelection.on("click",function(e){t.handleSelection(e,d3.event.ctrlKey),d3.event.stopPropagation()}),i.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var t=this.options,i=y.getMaxTaskOpacity(),a=y.getMinTaskOpacity();t.taskSelection.style("opacity",function(t){return e&&!t.selected?a:i})},e}();i.GanttChartBehavior=f;var v=function(){function e(){}return Object.defineProperty(e.prototype,"code",{get:function(){return"GanttChartWarning"},enumerable:!0,configurable:!0}),e.prototype.getMessages=function(e){var t,i="This visual requires task value",a="",r="";return t={message:i,title:e.get(a),detail:e.get(r)}},e}();i.GanttChartWarning=v}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi,r=(window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft,this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});!function(e){var t;!function(t){var i;!function(i){var s=a.CssConstants.createClassAndSelector,o=t.utility.SelectionManager,l=a.PixelConverter.toString,n=a.PixelConverter.fromPoint,c=a.PixelConverter.fromPointToPixel;i.Months=e.createEnumType([{value:1,displayName:"January"},{value:2,displayName:"February"},{value:3,displayName:"March"},{value:4,displayName:"April"},{value:5,displayName:"May"},{value:6,displayName:"June"},{value:7,displayName:"July"},{value:8,displayName:"August"},{value:9,displayName:"September"},{value:10,displayName:"October"},{value:11,displayName:"November"},{value:12,displayName:"December"}]),i.WeekDays=e.createEnumType([{value:0,displayName:"Sunday"},{value:1,displayName:"Monday"},{value:2,displayName:"Tuesday"},{value:3,displayName:"Wednesday"},{value:4,displayName:"Thursday"},{value:5,displayName:"Friday"},{value:6,displayName:"Saturday"}]),function(e){e[e.year=0]="year",e[e.quarter=1]="quarter",e[e.month=2]="month",e[e.week=3]="week",e[e.day=4]="day"}(i.GranularityType||(i.GranularityType={}));var h=i.GranularityType,u={objectName:"cells",propertyName:"fillSelected"},d={objectName:"cells",propertyName:"fillUnselected"},p={objectName:"rangeHeader",propertyName:"fontColor"},g={objectName:"rangeHeader",propertyName:"textSize"},m={objectName:"rangeHeader",propertyName:"show"},y={objectName:"labels",propertyName:"fontColor"},f={objectName:"labels",propertyName:"textSize"},v={objectName:"labels",propertyName:"show"},x={objectName:"calendar",propertyName:"month"},b={objectName:"calendar",propertyName:"day"},S={objectName:"weekDay",propertyName:"day"},w=[{granularityType:h.year,name:"year"},{granularityType:h.quarter,name:"quarter"},{granularityType:h.month,name:"month"},{granularityType:h.week,name:"week"},{granularityType:h.day,name:"day"}],C=function(){function e(){this.datePeriods=[]}return e.prototype.shortMonthName=function(e){return e.toString().split(" ")[1]},e.prototype.resetDatePeriods=function(){this.datePeriods=[]},e.prototype.getDatePeriods=function(){return this.datePeriods},e.prototype.getExtendedLabel=function(){return this.extendedLabel},e.prototype.setExtendedLabel=function(e){this.extendedLabel=e},e.prototype.createLabels=function(e){var t,i=[];return _.map(this.datePeriods,function(a){!_.isEmpty(i)&&e.sameLabel(a,t)||(t=a,i.push(e.generateLabel(a)))}),i},e.prototype.addDate=function(e,t){var i=this.getDatePeriods(),a=i[i.length-1];0!==i.length&&_.isEqual(a.identifierArray,t)?a.endDate=e:(i.length>0&&(a.endDate=e),i.push({identifierArray:t,startDate:e,endDate:e,week:this.determineWeek(e),year:this.determineYear(e),fraction:1,index:i.length}))},e.prototype.setNewEndDate=function(e){_.last(this.datePeriods).endDate=e},e.prototype.splitPeriod=function(e,t,i){var a=this.datePeriods[e];a.fraction-=t;var r={identifierArray:a.identifierArray,startDate:i,endDate:a.endDate,week:this.determineWeek(i),year:this.determineYear(i),fraction:t,index:a.index+a.fraction};a.endDate=i,this.datePeriods.splice(e+1,0,r)},e.prototype.previousMonth=function(e){return e>0?e-1:11},e.prototype.nextMonth=function(e){return 11>e?e+1:0},e.prototype.countWeeks=function(e,t){var i;if(t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()>=e.getDate())i=t.getDate()-e.getDate();else{i=t.getDate()-1;for(var a=this.nextMonth(e.getMonth()),r=t.getMonth();r!==a;)i+=new Date(t.getFullYear(),r,0).getDate(),r=this.previousMonth(r);i+=new Date(t.getFullYear(),a,0).getDate()-e.getDate()}return 1+Math.floor(i/7)},e.prototype.determineWeek=function(e){var t=e.getFullYear();this.inPreviousYear(e)&&t--;var i=k.calendar.getDateOfFirstWeek(t),a=this.countWeeks(i,e);return[a,t]},e.prototype.inPreviousYear=function(e){var t=k.calendar.getDateOfFirstWeek(e.getFullYear());return t>e},e.prototype.determineYear=function(e){var t=new Date(e.getFullYear(),k.calendar.getFirstMonthOfYear(),k.calendar.getFirstDayOfYear());return e.getFullYear()-(e>=t?0:1)},e}();i.TimelineGranularity=C;var D=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.getType=function(){return h.day},t.prototype.splitDate=function(e){return[this.shortMonthName(e),e.getDate(),e.getFullYear()]},t.prototype.sameLabel=function(e,t){return e.startDate.getTime()===t.startDate.getTime()},t.prototype.generateLabel=function(e){return{title:this.shortMonthName(e.startDate)+" "+e.startDate.getDate()+" - "+e.year,text:e.startDate.getDate().toString(),id:e.index}},t}(C);i.DayGranularity=D;var P=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.getType=function(){return h.month},t.prototype.splitDate=function(e){return[this.shortMonthName(e),e.getFullYear()]},t.prototype.sameLabel=function(e,t){return this.shortMonthName(e.startDate)===this.shortMonthName(t.startDate)},t.prototype.generateLabel=function(e){var t=this.shortMonthName(e.startDate);return{title:t,text:t,id:e.index}},t}(C);i.MonthGranularity=P;var A=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.getType=function(){return h.week},t.prototype.splitDate=function(e){return this.determineWeek(e)},t.prototype.sameLabel=function(e,t){return _.isEqual(e.week,t.week)},t.prototype.generateLabel=function(e){return{title:"Week "+e.week[0]+" - "+e.week[1],text:"W"+e.week[0],id:e.index}},t}(C);i.WeekGranularity=A;var N=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.quarterText=function(e){for(var t=3,i=e.getFullYear();e<k.calendar.getQuarterStartDate(i,t);)t>0?t--:(t=3,i--);return t++,"Q"+t},t.prototype.getType=function(){return h.quarter},t.prototype.splitDate=function(e){return[this.quarterText(e),e.getFullYear()]},t.prototype.sameLabel=function(e,t){return this.quarterText(e.startDate)===this.quarterText(t.startDate)&&e.year===t.year},t.prototype.generateLabel=function(e){var t=this.quarterText(e.startDate);return{title:t+" "+e.year,text:t,id:e.index}},t}(C);i.QuarterGranularity=N;var V=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.getType=function(){return h.year},t.prototype.splitDate=function(e){return[e.getFullYear()]},t.prototype.sameLabel=function(e,t){return e.year===t.year},t.prototype.generateLabel=function(e){return{title:"Year "+e.year,text:e.year.toString(),id:e.index}},t}(C);i.YearGranularity=V;var T=function(){function e(t,i){this.granularities=[],this.setDatesRange(t,i);var a=this.dates[this.dates.length-1];this.endingDate=e.nextDay(a)}return e.previousDay=function(e){var t=new Date(e.getTime());return t.setDate(t.getDate()-1),t},e.nextDay=function(e){var t=new Date(e.getTime());return t.setDate(t.getDate()+1),t},e.prototype.setDatesRange=function(t,i){this.dates=[];for(var a=t;i>=a;)this.dates.push(a),a=e.nextDay(a)},e.prototype.addGranularity=function(e){e.resetDatePeriods();for(var t=0,i=this.dates;t<i.length;t++){var a=i[t],r=e.splitDate(a);e.addDate(a,r)}e.setNewEndDate(this.endingDate),this.granularities.push(e)},e.prototype.getGranularity=function(e){return this.granularities[e]},e.prototype.createGranularities=function(){this.granularities=[],this.addGranularity(new V),this.addGranularity(new N),this.addGranularity(new P),this.addGranularity(new A),this.addGranularity(new D)},e.prototype.createLabels=function(){var e=this;this.granularities.forEach(function(t){t.setExtendedLabel({dayLabels:t.getType()>=h.day?t.createLabels(e.granularities[h.day]):[],weekLabels:t.getType()>=h.week?t.createLabels(e.granularities[h.week]):[],monthLabels:t.getType()>=h.month?t.createLabels(e.granularities[h.month]):[],quarterLabels:t.getType()>=h.quarter?t.createLabels(e.granularities[h.quarter]):[],yearLabels:t.getType()>=h.year?t.createLabels(e.granularities[h.year]):[]})})},e}();i.TimelineGranularityData=T;var L=function(){function e(){}return e.getStartSelectionDate=function(e){return e.currentGranularity.getDatePeriods()[e.selectionStartIndex].startDate},e.getEndSelectionDate=function(e){return e.currentGranularity.getDatePeriods()[e.selectionEndIndex].endDate},e.getEndSelectionPeriod=function(e){return e.currentGranularity.getDatePeriods()[e.selectionEndIndex]},e.getCellColor=function(t,i,a){var r=t.datePeriod.startDate>=e.getStartSelectionDate(i)&&t.datePeriod.endDate<=e.getEndSelectionDate(i);return r?a.colorInProperty:a.colorOutProperty},e.getGranularityType=function(e){var t=_.findIndex(w,function(t){return t.name===e});return w[t].granularityType},e.getGranularityName=function(e){var t=_.findIndex(w,function(t){return t.granularityType===e});return w[t].name},e.separateSelection=function(t,i,a){var r=t.currentGranularity.getDatePeriods(),s=_.findIndex(r,function(e){return i<e.endDate}),o=_.findIndex(r,function(e){return a<=e.endDate});t.selectionStartIndex=s,t.selectionEndIndex=o;var l=e.getDateRatio(r[s],i,!0),n=e.getDateRatio(r[o],a,!1);if(n>0&&t.currentGranularity.splitPeriod(o,n,a),l>0){var c=r[s].fraction-l;t.currentGranularity.splitPeriod(s,c,i),t.selectionStartIndex++,t.selectionEndIndex++}},e.getDateRatio=function(e,t,i){var a=i?t.getTime()-e.startDate.getTime():e.endDate.getTime()-t.getTime(),r=e.endDate.getTime()-e.startDate.getTime();return 0===r?0:a/r},e.timeRangeText=function(t){var i=t.currentGranularity.splitDate(e.getStartSelectionDate(t)),a=t.currentGranularity.splitDate(e.getEndSelectionPeriod(t).startDate);return i.join(" ")+" - "+a.join(" ")},e.dateRangeText=function(e){return e.startDate.toDateString()+" - "+T.previousDay(e.endDate).toDateString()},e.unseparateSelection=function(e){var t=_.findIndex(e,function(e){return e.fraction<1});return t>=0?(e[t].endDate=e[t+1].endDate,e[t].fraction+=e[t+1].fraction,e.splice(t+1,1),!0):!1},e}();i.Utils=L;var M=function(){function e(e){var t=this;this.firstDayOfWeek=e.weekDayProperty,this.firstMonthOfYear=e.firstMonthProperty-1,this.firstDayOfYear=e.firstDayProperty,this.dateOfFirstWeek={},this.quarterFirstMonths=[0,3,6,9].map(function(e){return e+t.firstMonthOfYear})}return e.prototype.getFirstDayOfWeek=function(){return this.firstDayOfWeek},e.prototype.getFirstMonthOfYear=function(){return this.firstMonthOfYear},e.prototype.getFirstDayOfYear=function(){return this.firstDayOfYear},e.prototype.getQuarterStartDate=function(e,t){return new Date(e,this.quarterFirstMonths[t],this.firstDayOfYear)},e.prototype.isChanged=function(e){return this.firstMonthOfYear!==e.firstMonthProperty-1||this.firstDayOfYear!==e.firstDayProperty||this.firstDayOfWeek!==e.weekDayProperty},e.prototype.calculateDateOfFirstWeek=function(e){for(var t=new Date(e,this.firstMonthOfYear,this.firstDayOfYear);t.getDay()!==this.firstDayOfWeek;)t=T.nextDay(t);return t},e.prototype.getDateOfFirstWeek=function(e){return this.dateOfFirstWeek[e]||(this.dateOfFirstWeek[e]=this.calculateDateOfFirstWeek(e)),this.dateOfFirstWeek[e]},e}();i.Calendar=M;var k=function(){function a(){var e=this;this.requiresNoUpdate=!1,this.foreignSelection=!1,this.selector=["Y","Q","M","W","D"],this.timelineMargins={LeftMargin:15,RightMargin:15,TopMargin:15,BottomMargin:10,CellWidth:40,CellHeight:25,StartXpoint:10,StartYpoint:20,ElementWidth:30,MinCellWidth:30,MaxCellHeight:60,PeriodSlicerRectWidth:15,PeriodSlicerRectHeight:23},this.defaultTimelineProperties={DefaultLabelsShow:!0,TimelineDefaultTextSize:9,TimelineDefaultCellColor:"#ADD8E6",TimelineDefaultCellColorOut:"#FFFFFF",TimelineDefaultTimeRangeShow:!0,DefaultTimeRangeColor:"#777777",DefaultLabelColor:"#777777",DefaultGranularity:h.month,DefaultFirstMonth:1,DefaultFirstDay:1,DefaultFirstWeekDay:0},this.timelineSelectors={TimelineVisual:s("Timeline"),SelectionRangeContainer:s("selectionRangeContainer"),textLabel:s("label"),LowerTextCell:s("lowerTextCell"),UpperTextCell:s("upperTextCell"),UpperTextArea:s("upperTextArea"),LowerTextArea:s("lowerTextArea"),RangeTextArea:s("rangeTextArea"),CellsArea:s("cellsArea"),CursorsArea:s("cursorsArea"),MainArea:s("mainArea"),SelectionCursor:s("selectionCursor"),Cell:s("cell"),CellRect:s("cellRect"),VertLine:s("timelineVertLine"),TimelineSlicer:s("timelineSlicer"),PeriodSlicerGranularities:s("periodSlicerGranularities"),PeriodSlicerSelection:s("periodSlicerSelection"),PeriodSlicerSelectionRect:s("periodSlicerSelectionRect"),PeriodSlicerRect:s("periodSlicerRect")},this.drag=d3.behavior.drag().origin(function(t){return t.x=t.selectionIndex*e.timelineProperties.cellWidth,t}).on("dragstart",function(){e.dragstarted()}).on("drag",function(t){e.dragged(t)}).on("dragend",function(){e.dragended()})}return a.prototype.changeGranularity=function(e,t,i){L.unseparateSelection(this.timelineData.currentGranularity.getDatePeriods())&&L.unseparateSelection(this.timelineData.currentGranularity.getDatePeriods()),this.timelineData.currentGranularity=this.timelineGranularityData.getGranularity(e),L.separateSelection(this.timelineData,t,i)},a.prototype.init=function(e){this.hostServices=e.host,this.initialized=!1;var i=e.element;this.selectionManager=new o({hostServices:e.host}),this.timelineProperties={element:i,textYPosition:50,cellsYPosition:3*this.timelineMargins.TopMargin+65,topMargin:this.timelineMargins.TopMargin,bottomMargin:this.timelineMargins.BottomMargin,leftMargin:this.timelineMargins.LeftMargin,startXpoint:this.timelineMargins.StartXpoint,startYpoint:this.timelineMargins.StartYpoint,cellWidth:this.timelineMargins.CellWidth,cellHeight:this.timelineMargins.CellHeight,elementWidth:this.timelineMargins.ElementWidth,rightMargin:this.timelineMargins.RightMargin},this.body=d3.select(i.get(0)),this.timelineDiv=this.body.append("div"),
this.svg=this.timelineDiv.append("svg").attr("width",l(e.viewport.width)).classed(this.timelineSelectors.TimelineVisual["class"],!0),this.clearCatcher=t.appendClearCatcher(this.svg),this.clearCatcher.data([this]).on("click",function(e){return e.clear()}).on("touchstart",function(e){return e.clear()}),this.rangeText=this.svg.append("g").classed(this.timelineSelectors.RangeTextArea["class"],!0).append("text"),this.mainGroupElement=this.svg.append("g").classed(this.timelineSelectors.MainArea["class"],!0),this.yearLabelsElement=this.mainGroupElement.append("g"),this.quarterLabelsElement=this.mainGroupElement.append("g"),this.monthLabelsElement=this.mainGroupElement.append("g"),this.weekLabelsElement=this.mainGroupElement.append("g"),this.dayLabelsElement=this.mainGroupElement.append("g"),this.cellsElement=this.mainGroupElement.append("g").classed(this.timelineSelectors.CellsArea["class"],!0),this.cursorGroupElement=this.svg.append("g").classed(this.timelineSelectors.CursorsArea["class"],!0)},a.prototype.clear=function(){this.selectionManager.clear(),this.timelineData&&(this.timelineData.selectionStartIndex=0,this.timelineData.selectionEndIndex=this.timelineData.currentGranularity.getDatePeriods().length-1,_.any(this.timelineData.timelineDatapoints,function(e){return e.index%1!==0})?this.selectPeriod(this.timelineData.currentGranularity.getType()):(a.updateCursors(this.timelineData,this.timelineProperties.cellWidth),this.fillCells(this.timelineFormat.cellFormat),this.renderCursors(this.timelineData,this.timelineFormat,this.timelineProperties.cellHeight,this.timelineProperties.cellsYPosition),this.renderTimeRangeText(this.timelineData,this.timelineFormat.rangeTextFormat)),this.setSelection(this.timelineData))},a.prototype.drawGranular=function(e){var t=this,i=!1,a=e.startXpoint,r=e.startYpoint,s=e.elementWidth;this.selectorContainer=this.svg.append("g").classed(this.timelineSelectors.TimelineSlicer["class"],!0),this.selectorContainer.on("mouseleave",function(e){return i=!1});var o=this.selectorContainer.append("rect"),n=this.selector;o.attr({height:l(1),x:l(a),y:l(r+2),width:l((n.length-1)*s)});var c=this.selectorContainer.selectAll("vertLines").data(n).enter().append("rect");c.classed(this.timelineSelectors.VertLine["class"],!0).attr({x:function(e,t){return l(a+t*s)},y:l(r),width:l(2),height:l(3)}).style({cursor:"pointer"});var h,u=this.selectorContainer.selectAll(this.timelineSelectors.PeriodSlicerGranularities.selector).data(n).enter().append("text").classed(this.timelineSelectors.PeriodSlicerGranularities["class"],!0);h=u.text(function(e){return e}).attr({x:function(e,t){return l(a-3+t*s)},y:l(r-3)}),this.selectedText=this.selectorContainer.append("text").classed(this.timelineSelectors.PeriodSlicerSelection["class"],!0),this.selectedText.text(L.getGranularityName(this.defaultTimelineProperties.DefaultGranularity)).attr({x:l(a+2*s),y:l(r+17)});var d=this.selectorContainer.selectAll(this.timelineSelectors.PeriodSlicerSelectionRect.selector).data(n).enter().append("rect").classed(this.timelineSelectors.PeriodSlicerSelectionRect["class"],!0),p=function(e,a){t.selectPeriod(a),i=!0};d.attr({x:function(e,t){return l(a-s/2+t*s)},y:l(3),width:l(s),height:l(23)}).style({cursor:"pointer"}).on("mousedown",p).on("touchstart",p).on("mouseup",function(){return i=!1}).on("touchend",function(){return i=!1}).on("mouseover",function(e,a){i&&t.selectPeriod(a)});var g=d3.behavior.drag().on("dragstart",function(e,t){i=!0}).on("dragend",function(e,t){i=!1});this.periodSlicerRect=this.selectorContainer.append("rect").classed(this.timelineSelectors.PeriodSlicerRect["class"],!0).attr({x:l(a-6+this.defaultTimelineProperties.DefaultGranularity*s),y:l(r-16),rx:l(4),width:l(15),height:l(23)}).on("mouseup",function(e){return i=!1}),this.periodSlicerRect.call(g)},a.prototype.redrawPeriod=function(e){var t=this.timelineMargins.StartXpoint+e*this.timelineMargins.ElementWidth;this.periodSlicerRect.transition().attr("x",l(t-7)),this.selectedText.text(L.getGranularityName(e));var i=L.getStartSelectionDate(this.timelineData),a=L.getEndSelectionDate(this.timelineData);this.changeGranularity(e,i,a)},a.setMeasures=function(e,t,i,a,r,s){r.cellsYPosition=r.textYPosition;var o=c(e.sizeProperty);e.showProperty&&(r.cellsYPosition+=1.5*o*(t+1));var l=Math.max(0,a.height-s.TopMargin),n=a.width-s.RightMargin-s.MinCellWidth*i,h=Math.max(s.MinCellWidth,Math.min(s.MaxCellHeight,n,l-r.cellsYPosition-20)),u=Math.max(s.MinCellWidth,(a.width-h-s.RightMargin)/i);r.cellHeight=h,r.cellWidth=u},a.prototype.visualChangeOnly=function(e){if(e&&e.dataViews&&e.dataViews[0]&&e.dataViews[0].metadata&&this.options&&this.options.dataViews&&this.options.dataViews[0]&&this.options.dataViews[0].metadata){var t=e.dataViews[0].metadata.objects,i=this.options.dataViews[0].metadata.objects,a=["rangeHeader","cells","labels"],r=!a.every(function(e){return _.isEqual(t?t[e]:void 0,i?i[e]:void 0)});return e.suppressAnimations||r}return!1},a.prototype.unavailableType=function(e){return!(e.categories&&1===e.categories.length&&e.categories[0].values&&0!==e.categories[0].values.length&&e.categories[0].source&&e.categories[0].source.type)},a.prototype.unavailableChildIdentityField=function(e){return!e.root||!e.root.childIdentityFields||0===e.root.childIdentityFields.length},a.prototype.createTimelineOptions=function(e){if(this.dataView=e,!e.categorical||!e.metadata||this.unavailableType(e.categorical)||!e.tree||this.unavailableChildIdentityField(e.tree))return!1;var t=e.tree.root.childIdentityFields[0];return this.valueType=t?t.ref:null,e.categorical.categories[0].source.type.dateTime||e.categorical.categories[0].source.type.numeric&&("Year"===this.valueType||"Date"===this.valueType)?(this.values=this.prepareValues(this.dataView.categorical.categories[0].values),!0):!1},a.prototype.prepareValues=function(e){e=e.filter(Boolean);for(var t in e){var i=e[t];if("String"==typeof i&&"Invalid Date"!==String(new Date(i)))return e[t]=new Date(i)}return e},a.prototype.createTimelineData=function(){var e,t;if("Year"===this.valueType){var i=this.values;e=new Date(_.min(i),0),t=new Date(_.max(i),11)}else{var r=this.values;e=_.min(r),t=_.max(r)}if(this.initialized||this.drawGranular(this.timelineProperties),this.initialized){var s=T.nextDay(t),o=this.timelineGranularityData.getGranularity(h.day).getDatePeriods(),l=o[0].startDate,n=o[o.length-1].endDate,c=e.getTime()>=l.getTime()&&s.getTime()<=n.getTime();this.newGranularity=this.timelineData.currentGranularity.getType(),c?(this.foreignSelection=!0,this.changeGranularity(this.newGranularity,e,s),this.timelineFormat=a.fillTimelineFormat(this.options.dataViews[0].metadata.objects,this.defaultTimelineProperties)):(n>s&&(t=o[o.length-1].startDate),e>l&&(e=l),this.initialized=!1)}this.initialized||(this.timelineGranularityData=new T(e,t),this.timelineData={elementsCount:0,timelineDatapoints:[],cursorDataPoints:new Array})},a.prototype.update=function(e){var t=this.visualChangeOnly(e);if(this.requiresNoUpdate=this.requiresNoUpdate&&!t,this.requiresNoUpdate)return void(this.foreignSelection?this.foreignSelection=!1:this.requiresNoUpdate=!1);if(this.options=e,e.dataViews&&e.dataViews[0]){var i=this.createTimelineOptions(e.dataViews[0]);if(!i)return void this.clearData();this.newGranularity=this.defaultTimelineProperties.DefaultGranularity,t||this.createTimelineData(),this.timelineFormat=a.converter(this.timelineData,this.timelineProperties,this.defaultTimelineProperties,this.timelineGranularityData,e.dataViews[0],this.initialized,this.newGranularity,e.viewport,this.timelineMargins),this.render(this.timelineData,this.timelineFormat,this.timelineProperties,e),this.initialized=!0}},a.prototype.selectPeriod=function(e){this.redrawPeriod(e),this.timelineFormat=a.converter(this.timelineData,this.timelineProperties,this.defaultTimelineProperties,this.timelineGranularityData,this.options.dataViews[0],this.initialized,this.timelineData.currentGranularity.getType(),this.options.viewport,this.timelineMargins),this.render(this.timelineData,this.timelineFormat,this.timelineProperties,this.options)},a.isDataNotMatch=function(e){return e.categorical.categories.length<=0||void 0===e.categorical.categories[0]||void 0===e.categorical.categories[0].identityFields||e.categorical.categories[0].identityFields.length<=0},a.converter=function(e,t,i,r,s,o,l,n,c){var h=a.fillTimelineFormat(s.metadata.objects,i);if(o||(e.cursorDataPoints.push({x:0,selectionIndex:0,cursorIndex:0}),e.cursorDataPoints.push({x:0,selectionIndex:0,cursorIndex:1})),o&&!a.calendar.isChanged(h.calendarFormat)||(a.calendar=new M(h.calendarFormat),r.createGranularities(),r.createLabels(),e.currentGranularity=r.getGranularity(l),e.selectionStartIndex=0,e.selectionEndIndex=e.currentGranularity.getDatePeriods().length-1),e.categorySourceName=s.categorical.categories[0].source.displayName,e.columnIdentity=s.categorical.categories[0].identityFields[0],s.categorical.categories[0].source.type.numeric&&(e.columnIdentity.ref="Date"),!this.isDataNotMatch(s)){var u=e.currentGranularity.getDatePeriods();e.elementsCount=u.length,e.timelineDatapoints=[];for(var d=0,p=u;d<p.length;d++){var g=p[d],m={index:g.index,datePeriod:g};e.timelineDatapoints.push(m)}var y=e.currentGranularity.getDatePeriods().filter(function(e){return e.index%1===0}).length;return a.setMeasures(h.labelFormat,e.currentGranularity.getType(),y,n,t,c),a.updateCursors(e,t.cellWidth),h}},a.prototype.render=function(e,i,a,r){var s=this.timelineData.timelineDatapoints.filter(function(e){return e.index%1===0}).length;this.svgWidth=1+this.timelineProperties.cellHeight+a.cellWidth*s,this.renderTimeRangeText(e,i.rangeTextFormat),this.timelineDiv.attr({height:l(r.viewport.height),width:l(r.viewport.width),"drag-resize-disabled":!0}).style({"overflow-x":"auto","overflow-y":"auto"}),this.svg.attr({height:l(Math.max(0,r.viewport.height-this.timelineMargins.TopMargin)),width:l(Math.max(0,this.svgWidth))});var o=t.SVGUtil.translate(a.leftMargin,a.topMargin),n=t.SVGUtil.translate(a.cellHeight/2,a.topMargin);this.mainGroupElement.attr("transform",n),this.selectorContainer.attr("transform",o),this.cursorGroupElement.attr("transform",n);var c=this.timelineData.currentGranularity.getExtendedLabel(),h=this.timelineData.currentGranularity.getType(),u=0,d=1.5;this.renderLabels(c.yearLabels,this.yearLabelsElement,u,0===h),u+=d,this.renderLabels(c.quarterLabels,this.quarterLabelsElement,u,1===h),u+=d,this.renderLabels(c.monthLabels,this.monthLabelsElement,u,2===h),u+=d,this.renderLabels(c.weekLabels,this.weekLabelsElement,u,3===h),u+=d,this.renderLabels(c.dayLabels,this.dayLabelsElement,u,4===h),this.renderCells(e,i,a,r.suppressAnimations),this.renderCursors(e,i,a.cellHeight,a.cellsYPosition)},a.prototype.renderLabels=function(i,a,r,s){var o=this,l=a.selectAll(this.timelineSelectors.textLabel.selector);if(!this.timelineFormat.labelFormat.showProperty)return void l.remove();var h=l.data(i);h.enter().append("text").classed(this.timelineSelectors.textLabel["class"],!0),h.text(function(a,r){if(!s&&0===r&&i.length>1){var l=n(o.timelineFormat.labelFormat.sizeProperty),c={text:i[0].text,fontFamily:"arial",fontSize:l},h=e.TextMeasurementService.measureSvgTextWidth(c)/2;c={text:i[1].text,fontFamily:"arial",fontSize:l};var u=e.TextMeasurementService.measureSvgTextWidth(c)/2,d=o.timelineProperties.cellWidth*(i[1].id-i[0].id);if(h+u>d)return""}var p={label:a.text,maxWidth:o.timelineProperties.cellWidth*(s?.9:3),fontSize:o.timelineFormat.labelFormat.sizeProperty};return t.dataLabelUtils.getLabelFormattedText(p)}).style("font-size",n(this.timelineFormat.labelFormat.sizeProperty)).attr({x:function(e){return(e.id+.5)*o.timelineProperties.cellWidth},y:this.timelineProperties.textYPosition+(1+r)*c(this.timelineFormat.labelFormat.sizeProperty),fill:this.timelineFormat.labelFormat.colorProperty}).append("title").text(function(e){return e.title}),h.exit().remove()},a.prototype.clearData=function(){this.initialized=!1,this.mainGroupElement.selectAll(this.timelineSelectors.CellRect.selector).remove(),this.mainGroupElement.selectAll(this.timelineSelectors.textLabel.selector).remove(),this.rangeText.text(""),this.cursorGroupElement.selectAll(this.timelineSelectors.SelectionCursor.selector).remove(),this.svg.select(this.timelineSelectors.TimelineSlicer.selector).remove()},a.updateCursors=function(e,t){var i=e.timelineDatapoints[e.selectionStartIndex].datePeriod;e.cursorDataPoints[0].selectionIndex=i.index;var a=e.timelineDatapoints[e.selectionEndIndex].datePeriod;e.cursorDataPoints[1].selectionIndex=a.index+a.fraction},a.fillTimelineFormat=function(t,i){var a={rangeTextFormat:{showProperty:e.DataViewObjects.getValue(t,m,i.TimelineDefaultTimeRangeShow),colorProperty:e.DataViewObjects.getFillColor(t,p,i.DefaultTimeRangeColor),sizeProperty:e.DataViewObjects.getValue(t,g,i.TimelineDefaultTextSize)},cellFormat:{colorInProperty:e.DataViewObjects.getFillColor(t,u,i.TimelineDefaultCellColor),colorOutProperty:e.DataViewObjects.getFillColor(t,d,i.TimelineDefaultCellColorOut)},labelFormat:{showProperty:e.DataViewObjects.getValue(t,v,i.DefaultLabelsShow),colorProperty:e.DataViewObjects.getFillColor(t,y,i.DefaultLabelColor),sizeProperty:e.DataViewObjects.getValue(t,f,i.TimelineDefaultTextSize)},calendarFormat:{firstMonthProperty:e.DataViewObjects.getValue(t,x,1),firstDayProperty:Math.max(1,Math.min(31,e.DataViewObjects.getValue(t,b,i.DefaultFirstDay))),weekDayProperty:Math.max(0,Math.min(6,e.DataViewObjects.getValue(t,S,i.DefaultFirstWeekDay)))}};return a},a.prototype.fillCells=function(e){var t=this,i=this.timelineData.timelineDatapoints,a=this.mainGroupElement.selectAll(this.timelineSelectors.CellRect.selector).data(i);a.attr("fill",function(i){return L.getCellColor(i,t.timelineData,e)})},a.prototype.renderCells=function(e,t,i,a){var r=this,s=e.timelineDatapoints,o=0,n=this.cellsElement.selectAll(this.timelineSelectors.CellRect.selector).data(s);n.enter().append("rect").classed(this.timelineSelectors.CellRect["class"],!0),n.attr({height:l(i.cellHeight),width:function(e){return l(e.datePeriod.fraction*i.cellWidth)},x:function(e){var t=o;return o+=e.datePeriod.fraction*i.cellWidth,l(t)},y:l(i.cellsYPosition),id:function(e){return e.index}});var c=function(a,s){d3.event.preventDefault();var o=r.timelineData.cursorDataPoints,l=d3.event;l.altKey||l.shiftKey?r.timelineData.selectionEndIndex<s?(o[1].selectionIndex=a.datePeriod.index+a.datePeriod.fraction,e.selectionEndIndex=s):(o[0].selectionIndex=a.datePeriod.index,e.selectionStartIndex=s):(e.selectionStartIndex=s,e.selectionEndIndex=s,o[0].selectionIndex=a.datePeriod.index,o[1].selectionIndex=a.datePeriod.index+a.datePeriod.fraction),r.fillCells(t.cellFormat),r.renderCursors(e,t,i.cellHeight,i.cellsYPosition),r.renderTimeRangeText(e,t.rangeTextFormat),r.setSelection(e)};n.on("click",c).on("touchstart",c),this.fillCells(t.cellFormat),n.exit().remove()},a.prototype.dragstarted=function(){this.timelineData.dragging=!0},a.prototype.dragged=function(e){if(this.timelineData.dragging===!0){var t=1,i=d3.select(this.timelineSelectors.TimelineVisual.selector);if(i){var a=i.style("transform");if(void 0!==a&&"none"!==a){var r=a.split("(")[1];t=Number(r.split(", ")[0])}}var s=this.findCursorOverElement(d3.event.x);if(!s)return;var o=s.datapoint,l=s.index;0===e.cursorIndex&&l<=this.timelineData.selectionEndIndex&&(this.timelineData.selectionStartIndex=l,this.timelineData.cursorDataPoints[0].selectionIndex=o.datePeriod.index),1===e.cursorIndex&&l>=this.timelineData.selectionStartIndex&&(this.timelineData.selectionEndIndex=l,this.timelineData.cursorDataPoints[1].selectionIndex=o.datePeriod.index+o.datePeriod.fraction),this.fillCells(this.timelineFormat.cellFormat),this.renderCursors(this.timelineData,this.timelineFormat,this.timelineProperties.cellHeight,this.timelineProperties.cellsYPosition),this.renderTimeRangeText(this.timelineData,this.timelineFormat.rangeTextFormat)}},a.prototype.findCursorOverElement=function(e){var t=this.timelineData.timelineDatapoints||[],i=t.length,a=this.timelineProperties.cellWidth;if(t[0]&&t[1]&&e<=t[1].index*a)return{index:0,datapoint:t[0]};if(t[i-1]&&e>=t[i-1].index*a)return{index:i-1,datapoint:t[i-1]};for(var r=1;i>r;r++){var s=t[r].index*a,o=t[r+1].index*a;if(e>=s&&o>=e)return{index:r,datapoint:t[r]}}return null},a.prototype.dragended=function(){this.setSelection(this.timelineData)},a.prototype.renderCursors=function(e,i,a,r){var s=this,o=this.cursorGroupElement.selectAll(this.timelineSelectors.SelectionCursor.selector).data(e.cursorDataPoints);return o.enter().append("path").classed(this.timelineSelectors.SelectionCursor["class"],!0),o.attr("transform",function(e){return t.SVGUtil.translate(e.selectionIndex*s.timelineProperties.cellWidth,a/2+r)}).attr({d:d3.svg.arc().innerRadius(0).outerRadius(a/2).startAngle(function(e){return e.cursorIndex*Math.PI+Math.PI}).endAngle(function(e){return e.cursorIndex*Math.PI+2*Math.PI})}).call(this.drag),o.exit().remove(),o},a.prototype.renderTimeRangeText=function(e,i){var a=(w.length+2)*this.timelineProperties.elementWidth,r=this.svgWidth-a-this.timelineProperties.leftMargin;if(i.showProperty&&r>0){var s=L.timeRangeText(e),o={label:s,maxWidth:r,fontSize:i.sizeProperty},l=t.dataLabelUtils.getLabelFormattedText(o);this.rangeText.classed(this.timelineSelectors.SelectionRangeContainer["class"],!0),this.rangeText.attr({x:w.length*(this.timelineProperties.elementWidth+this.timelineProperties.leftMargin),y:40,fill:i.colorProperty}).style({"font-size":n(i.sizeProperty)}).text(l).append("title").text(s)}else this.rangeText.text("")},a.prototype.setSelection=function(t){this.requiresNoUpdate=!0;var i=e.data.SQExprBuilder.dateTime(L.getStartSelectionDate(t)),a=e.data.SQExprBuilder.dateTime(new Date(L.getEndSelectionDate(t).getTime()-1)),r=e.data.SQExprBuilder.between(t.columnIdentity,i,a),s=e.data.SemanticFilter.fromSQExpr(r),o={merge:[{objectName:"general",selector:void 0,properties:{filter:s}}]};this.hostServices.persistProperties(o),this.hostServices.onSelect({data:[]})},a.prototype.enumerateObjectInstances=function(e){var i=new t.ObjectEnumerationBuilder;switch(e.objectName){case"rangeHeader":this.enumerateRangeHeader(i,this.dataView);break;case"cells":this.enumerateCells(i,this.dataView);break;case"labels":this.enumerateLabels(i,this.dataView);break;case"calendar":this.enumerateCalendar(i,this.dataView);break;case"weekDay":this.enumerateWeekDay(i,this.dataView)}return i.complete()},a.prototype.enumerateRangeHeader=function(t,i){var a=i&&i.metadata?i.metadata.objects:void 0;t.pushInstance({objectName:"rangeHeader",displayName:"Selection Color",selector:null,properties:{show:e.DataViewObjects.getValue(a,m,this.defaultTimelineProperties.TimelineDefaultTimeRangeShow),fontColor:e.DataViewObjects.getFillColor(a,p,this.defaultTimelineProperties.DefaultTimeRangeColor),textSize:e.DataViewObjects.getValue(a,g,this.defaultTimelineProperties.TimelineDefaultTextSize)}})},a.prototype.enumerateCells=function(t,i){var a=i&&i.metadata?i.metadata.objects:void 0;t.pushInstance({objectName:"cells",selector:null,properties:{fillSelected:e.DataViewObjects.getFillColor(a,u,this.defaultTimelineProperties.TimelineDefaultCellColor),fillUnselected:e.DataViewObjects.getFillColor(a,d,this.defaultTimelineProperties.TimelineDefaultCellColorOut)}})},a.prototype.enumerateLabels=function(t,i){var a=i&&i.metadata?i.metadata.objects:void 0;t.pushInstance({objectName:"labels",selector:null,properties:{show:e.DataViewObjects.getValue(a,v,this.defaultTimelineProperties.DefaultLabelsShow),fontColor:e.DataViewObjects.getFillColor(a,y,this.defaultTimelineProperties.DefaultLabelColor),textSize:e.DataViewObjects.getValue(a,f,this.defaultTimelineProperties.TimelineDefaultTextSize)}})},a.prototype.enumerateCalendar=function(t,i){var a=i&&i.metadata?i.metadata.objects:void 0;t.pushInstance({objectName:"calendar",selector:null,properties:{month:Math.max(1,Math.min(12,e.DataViewObjects.getValue(a,x,1))),day:Math.max(1,Math.min(31,e.DataViewObjects.getValue(a,b,1)))}})},a.prototype.enumerateWeekDay=function(t,i){var a=i&&i.metadata?i.metadata.objects:void 0;t.pushInstance({objectName:"weekDay",selector:null,properties:{day:Math.max(0,Math.min(6,e.DataViewObjects.getValue(a,S,0)))}})},a.capabilities={dataRoles:[{name:"Time",kind:e.VisualDataRoleKind.Grouping,displayName:"Time"}],dataViewMappings:[{conditions:[{Time:{max:1}}],categorical:{categories:{"for":{"in":"Time"},dataReductionAlgorithm:{sample:{}}},values:{select:[{bind:{to:"Time"}}]}}}],objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}},selected:{type:{bool:!0}},filter:{type:{filter:{}},rule:{output:{property:"selected",selector:["Time"]}}}}},calendar:{displayName:"Fiscal Year Start",properties:{month:{displayName:"Month",type:{enumeration:i.Months}},day:{displayName:"Day",type:{numeric:!0}}}},weekDay:{displayName:"First Day of Week",properties:{day:{displayName:"Day",type:{enumeration:i.WeekDays}}}},rangeHeader:{displayName:"Range Header",properties:{show:{displayName:"Show",type:{bool:!0}},fontColor:{displayName:"Font color",type:{fill:{solid:{color:!0}}}},textSize:{displayName:"Text Size",type:{numeric:!0}}}},cells:{displayName:"Cells",properties:{fillSelected:{displayName:"Selected cell color",type:{fill:{solid:{color:!0}}}},fillUnselected:{displayName:"Unselected cell color",type:{fill:{solid:{color:!0}}}}}},labels:{displayName:"Labels",properties:{show:{displayName:"Show",type:{bool:!0}},fontColor:{displayName:"Font color",type:{fill:{solid:{color:!0}}}},textSize:{displayName:"Text Size",type:{numeric:!0}}}}}},a}();i.Timeline=k}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=e.visuals.valueFormatter,s=a.PixelConverter,o="axisGraphicsContext",l="dataPointsContainer",n="x axis",c="y axis",h="#777",u=8,d=4,p=10,g="#666666",m="wf_segoe-ui_normal",y="normal",f=20,v=10,x=20,b=45,S=10,w=20,C={legendSettings:{show:!0,showTitle:!0,labelColor:g,titleText:"",fontSize:u},categoryAxisSettings:{show:!0,labelColor:h,showAxisTitle:!1},valueAxisSettings:{show:!0,labelColor:h,showAxisTitle:!1},dataLabelsSettings:t.dataLabelUtils.getDefaultPointLabelSettings()},D=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.selection=e.selection,this.clearCatcher=e.clearCatcher,this.interactivityService=e.interactivityService,this.selection.on("click",function(e,i){t.handleSelection(e,d3.event.ctrlKey)}),this.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var i=this.interactivityService.hasSelection();this.selection.style("fill-opacity",function(a){return t.ColumnUtil.getFillOpacity(a.selected,a.highlight,!a.highlight&&e,!a.selected&&i)})},e}(),P=function(){function i(){this.margin={left:b,right:15,bottom:f,top:10}}return i.prototype.converter=function(a,o,l){if(!(a&&a.categorical&&a.categorical.values&&a.categorical.categories&&o))return null;for(var n,c,h=a.categorical,d=h.categories,p=h.values,g=[],m={dataPoints:[],title:p.source?p.source.displayName:"",fontSize:u},y=0,f=d&&d.length>0?d[0]:null,v=i.Properties.general.formatString,x=!!(p.length>0&&p[0].highlights),b=this.parseSettings(a),S=s.fromPoint(b.dataLabelsSettings.fontSize),w=0;w<p.length;w++){var C=p[w].source.groupName,D=p[w].identity?t.SelectionId.createWithId(p[w].identity):t.SelectionId.createWithMeasure(p[w].source.queryName);C?m.dataPoints.push({label:C,color:o.getColorByIndex(w).value,icon:t.LegendIcon.Box,selected:!1,identity:D}):C=p[w].source.displayName;var P=t.TooltipBuilder.createTooltipInfo(v,{categories:null,values:p},null,null,null,null,w);g[w]={dataPoints:[],tooltipInfo:P,highlight:x,identity:D,selected:!1};var A=p[w].values;if(0!==A.length)for(var N=0;N<A.length;N++){var V=x?p[w].highlights[N]:A[N];V>y&&(y=V),g[w].dataPoints.push({x:N,y:isNaN(V)?0:V,text:C,labelFontSize:S})}}l&&l.applySelectionStateToData(g),n=r.create({format:"g",value:y}),c=r.create({format:r.getFormatString(f.source,i.Properties.general.formatString),value:f.values});for(var T=[],L=this.getTextPropertiesFunction,M=0;M<f.values.length;M++){var k=void 0;if(null!=f.values[M]){k=c.format(f.values[M]);var j=e.TextMeasurementService.measureSvgTextWidth(L(k));j>i.MaxNumberOfAxisXValues&&(i.MaxNumberOfAxisXValues=j)}T.push(k)}return{series:g,legendData:m,valueFormatter:n,categoryFormatter:c,streamGraphSettings:b,categoriesText:T}},i.prototype.parseSettings=function(t){if(!t||!t.metadata)return C;var a=t.metadata.objects,r=_.cloneDeep(C),s=r.categoryAxisSettings;s.show=e.DataViewObjects.getValue(a,i.Properties.categoryAxis.show,s.show),s.labelColor=e.DataViewObjects.getFillColor(a,i.Properties.categoryAxis.labelColor,s.labelColor),s.showAxisTitle=e.DataViewObjects.getValue(a,i.Properties.categoryAxis.showAxisTitle,s.showAxisTitle);var o=r.valueAxisSettings;o.show=e.DataViewObjects.getValue(a,i.Properties.valueAxis.show,o.show),o.labelColor=e.DataViewObjects.getFillColor(a,i.Properties.valueAxis.labelColor,o.labelColor),o.showAxisTitle=e.DataViewObjects.getValue(a,i.Properties.valueAxis.showAxisTitle,o.showAxisTitle);var l=r.dataLabelsSettings;l.show=e.DataViewObjects.getValue(a,i.Properties.labels.show,l.show),l.labelColor=e.DataViewObjects.getFillColor(a,i.Properties.labels.color,l.labelColor),l.fontSize=e.DataViewObjects.getValue(a,i.Properties.labels.fontSize,l.fontSize);var n=r.legendSettings,c=t.categorical.values.source,h=c&&_.isEmpty(n.titleText)?c.displayName:n.titleText;return n.show=e.DataViewObjects.getValue(a,i.Properties.legend.show,n.show),n.showTitle=e.DataViewObjects.getValue(a,i.Properties.legend.showTitle,n.showTitle),n.titleText=e.DataViewObjects.getValue(a,i.Properties.legend.titleText,h),n.labelColor=e.DataViewObjects.getValue(a,i.Properties.legend.labelColor,n.labelColor),n.fontSize=e.DataViewObjects.getValue(a,i.Properties.legend.fontSize,n.fontSize),_.isEmpty(n.titleText)&&(n.titleText=h),r},i.prototype.init=function(e){var a=e.element,r=this.svg=d3.select(a.get(0)).append("svg").classed(i.VisualClassName,!0).style("position","absolute");this.clearCatcher=t.appendClearCatcher(r),this.axisGraphicsContext=r.append("g").classed(o,!0),this.xAxis=this.axisGraphicsContext.append("g").classed(n,!0),this.yAxis=this.axisGraphicsContext.append("g").classed(c,!0),this.dataPointsContainer=r.append("g").classed(l,!0),this.viewport=e.viewport,this.colors=e.style.colorPalette.dataColors,this.behavior=new D;var s=e.interactivity;this.interactivityService=t.createInteractivityService(e.host),this.legend=t.createLegend(a,s&&s.isInteractiveLegend,this.interactivityService,!0)},i.prototype.update=function(e){if(!e.dataViews||!e.dataViews[0]||!e.dataViews[0].categorical)return void this.clearData();this.viewport={width:Math.max(0,e.viewport.width),height:Math.max(0,e.viewport.height)};var i=e.suppressAnimations?0:250,a=this.dataView=e.dataViews[0],r=this.data=this.converter(a,this.colors,this.interactivityService);if(!r||!r.series||!r.series.length)return void this.clearData();this.renderLegend(r),this.renderXAxisLabels(),this.renderYAxisLabels(),this.svg.attr({width:this.viewport.width+"px",height:this.viewport.height+"px"});var s=this.renderChart(r.series,i);t.TooltipManager.addTooltip(s,function(e){return e.data.tooltipInfo});var o=this.interactivityService;if(o){var l={selection:s,clearCatcher:this.clearCatcher,interactivityService:o};o.bind(r.series,this.behavior,l)}},i.prototype.getStreamGraphLabelLayout=function(e,t){var i=this.data.streamGraphSettings.dataLabelsSettings,a=s.fromPoint(i.fontSize);return{labelText:function(e){return e.text},labelLayout:{x:function(t){return e(t.x)},y:function(e){return t(e.y0)}},filter:function(e){return null!=e&&null!=e.text},style:{fill:i.labelColor,"font-size":a}}},i.prototype.renderChart=function(e,a){var r=this,s=d3.layout.stack().values(function(e){return e.dataPoints}),o=this.viewport.width,n=this.viewport.height;this.getWiggle(this.dataView)&&s.offset("wiggle");var c=s(e),h=this.margin,u=d3.scale.linear().domain([0,e[0].dataPoints.length-1]).range([h.left,o-h.right]),p=d3.max(c,function(e){return d3.max(e.dataPoints,function(e){return e.y0+e.y})}),g=d3.min(c,function(e){return d3.min(e.dataPoints,function(e){return e.y0+e.y})}),m=d3.scale.linear().domain([Math.min(g,0),p]).range([n-h.bottom,h.top]).nice(),y=d3.svg.area().interpolate("monotone").x(function(e){return u(e.x)}).y0(function(e){return m(e.y0)}).y1(function(e){return m(e.y0+e.y)}).defined(function(e){return!isNaN(e.y0)&&!isNaN(e.y)}),f=this.dataPointsContainer.selectAll(i.Layer.selector).data(c);if(f.enter().append("path").classed(i.Layer["class"],!0),f.style("fill",function(e,t){return r.colors.getColorByIndex(t).value}).style("fill-opacity",t.ColumnUtil.DefaultOpacity).transition().duration(a).attr("d",function(e){return y(e.dataPoints)}),f.selectAll("path").append("g").classed(l,!0),f.exit().remove(),this.data.streamGraphSettings.dataLabelsSettings.show){var v=d3.scale.linear().domain([0,e[0].dataPoints.length-1]).range([0,o-h.left-h.right]),x=this.getStreamGraphLabelLayout(v,m),b=[];e.forEach(function(e){var t;t=e.dataPoints.filter(function(e){return e&&null!==e.y&&void 0!==e.y}),t.length>0&&(b=b.concat(t))});var S={height:n-h.top-h.bottom,width:o-h.right-h.left},w=t.dataLabelUtils.drawDefaultLabelsForDataPointChart(b,this.svg,x,S);if(w){var C=d+h.left;w.attr("transform",function(e){return t.SVGUtil.translate(C+e.size.width/2,e.size.height/2)})}}else t.dataLabelUtils.cleanDataLabels(this.svg);return this.drawAxis(this.data,u,m),f},i.prototype.drawAxis=function(a,r,s){for(var o=this.margin,l=this.viewport.height-o.bottom,n=this.viewport.width-o.left-o.right,c=this.data.categoriesText,h=d3.svg.axis(),u=i.MaxNumberOfAxisXValues,d=this.getTextPropertiesFunction,g=0;g<c.length;g++)if(null!=c[g]){var m=c[g].toString(),y=e.TextMeasurementService.measureSvgTextWidth(d(m));y>u&&(u=y)}h.scale(r).orient("bottom").ticks(c.length).tickFormat(function(t){var i=c[t];return a.categoryFormatter&&(i=a.categoryFormatter.format(i)),null===t||void 0===t||0!==t&&t!==c.length-1||(i=e.TextMeasurementService.getTailoredTextOrDefault(d(i),2*(t?o.right:o.left))),i});var f=d3.svg.axis().scale(s).orient("left").tickFormat(function(t){var i=t;return a.valueFormatter&&(i=a.valueFormatter.format(i)),i=e.TextMeasurementService.getTailoredTextOrDefault(d(i.toString()),b-p)});this.setMaxTicks(h,n,Math.max(2,Math.round(n/u))),this.setMaxTicks(f,l);var v=this.data.streamGraphSettings.valueAxisSettings;if(v.show){var x=v.labelColor;this.yAxis.attr("transform",t.SVGUtil.translate(o.left,0)).call(f),this.yAxis.selectAll("text").style("fill",x)}else this.yAxis.selectAll("*").remove();var S=this.data.streamGraphSettings.categoryAxisSettings;if(S.show){var x=S.labelColor;this.xAxis.attr("transform",t.SVGUtil.translate(0,l)).call(h),this.xAxis.selectAll("text").style("fill",x)}else this.xAxis.selectAll("*").remove()},i.prototype.renderYAxisLabels=function(){this.axisGraphicsContext.selectAll(i.YAxisLabel.selector).remove();var a=this.data.streamGraphSettings.valueAxisSettings;if(this.margin.left=a.show?b:S,a.showAxisTitle){this.margin.left+=w;var r=this.data.streamGraphSettings.categoryAxisSettings,s=r.show===!0,o=r.showAxisTitle===!0,l=this.margin.top,n=this.viewport.height-l-(s?f:v)-(o?x:0),c=this.dataView.categorical.values,h=c.source?c.source.displayName:this.getYAxisTitleFromValues(c),u=this.getTextPropertiesFunction(h);h=e.TextMeasurementService.getTailoredTextOrDefault(u,n);var d=i.YAxisLabel["class"],p=this.axisGraphicsContext.append("text").style("text-anchor","middle").style("font-family",u.fontFamily).style("font-size",u.fontSize).style("font-style",u.fontStyle).style("font-weight",u.fontWeight).text(h).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":d,transform:"rotate(-90)",fill:a.labelColor,x:-(l+n/2),dy:"1em"})})});p.call(t.AxisHelper.LabelLayoutStrategy.clip,n,e.TextMeasurementService.svgEllipsis);
}},i.prototype.getYAxisTitleFromValues=function(e){for(var i=[],a=0;a<e.length;a++)e[a]&&e[a].source&&e[a].source.displayName&&i.push({displayName:e[a].source.displayName});var r=i.map(function(e){return e?e.displayName:""}).filter(function(e,t,i){return""!==e&&i.indexOf(e)===t});return t.valueFormatter.formatListAnd(r)},i.prototype.renderXAxisLabels=function(){this.axisGraphicsContext.selectAll(i.XAxisLabel.selector).remove();var a=this.data.streamGraphSettings.categoryAxisSettings;if(this.margin.bottom=a.show?f:v,a.showAxisTitle&&this.dataView.categorical.categories[0].source){this.margin.bottom+=x;var r=this.data.streamGraphSettings.valueAxisSettings,s=r.show===!0,o=r.showAxisTitle===!0,l=(s?b:S)+(o?w:0),n=this.viewport.width-this.margin.right-l,c=this.viewport.height,h=this.dataView.categorical.categories[0].source.displayName,u=this.getTextPropertiesFunction(h);h=e.TextMeasurementService.getTailoredTextOrDefault(u,n);var d=i.XAxisLabel["class"],p=this.axisGraphicsContext.append("text").style("text-anchor","middle").style("font-family",u.fontFamily).style("font-size",u.fontSize).style("font-weight",u.fontWeight).text(h).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":d,transform:t.SVGUtil.translate(l+n/2,c),fill:a.labelColor,dy:"-0.5em"})})});p.call(t.AxisHelper.LabelLayoutStrategy.clip,n,e.TextMeasurementService.svgEllipsis)}},i.prototype.renderLegend=function(i){var a=i.streamGraphSettings.legendSettings,r=i.legendData;if(this.dataView&&this.dataView.metadata){var s=e.DataViewObjects.getObject(this.dataView.metadata.objects,"legend",{});s.titleText=a.titleText,t.LegendData.update(r,s);var o=s[t.legendProps.position];o&&this.legend.changeOrientation(t.LegendPosition[o]),this.legend.drawLegend(r,_.clone(this.viewport)),t.Legend.positionChartArea(this.svg,this.legend),this.updateViewPort()}},i.prototype.updateViewPort=function(){var e=this.legend.getMargins(),i=this.legend.getOrientation();switch(i){case t.LegendPosition.Top:case t.LegendPosition.TopCenter:case t.LegendPosition.Bottom:case t.LegendPosition.BottomCenter:this.viewport.height=Math.max(0,this.viewport.height-e.height);break;case t.LegendPosition.Left:case t.LegendPosition.LeftCenter:case t.LegendPosition.Right:case t.LegendPosition.RightCenter:this.viewport.width=Math.max(0,this.viewport.width-e.width)}},i.prototype.setMaxTicks=function(e,t,i){var a=void 0===i?this.getTicksByAxis(e).length:Math.min(i,this.getTicksByAxis(e).length);e.scale().domain.toString()===d3.scale.linear().domain.toString()?e.ticks(this.getFittedTickLength(e,t,a)):e.tickValues(this.getFittedTickValues(e,t,a))},i.prototype.getFittedTickLength=function(e,t,i){for(var a=this.getTicksByAxis(e),r=this.getMeasureTickFunction(e,a);i>0&&t>0&&(this.measureTicks(a,r)>t||e.scale().ticks([i]).length>i);i--,a=this.getTicksByAxis(e))e.ticks(i);return i},i.prototype.getFittedTickValues=function(e,t,i){for(var a,r=this.getTicksByAxis(e),s=[],o=this.getMeasureTickFunction(e,r),l=i,n=[];i>0&&t>0;l--,n=[]){switch(l){case 0:return[];case 1:n=[0];break;case 2:n=[0,r.length-1];break;default:for(var c=r.length/(l-1),h=0;l-1>h;h++)n.push(Math.round(c*h));n.push(r.length-1)}var u=n.map(function(e){return[r[e],e]});if(a=t/r.length*2,u.reduce(function(e,t){return s.push([o(e[0])+o(t[0]),(t[1]-e[1])*a]),t}),!s.some(function(e){return e[0]>e[1]}))return u.map(function(e){return e[0]})}return[]},i.prototype.measureTicks=function(e,t){return e.map(function(e){return t(e)}).reduce(function(e,t){return e+t})},i.prototype.getTicksByAxis=function(e){var t=e.scale(),i=null===e.tickValues()?t.ticks?t.ticks.apply(t,e.ticks()):t.domain():e.tickValues();return void 0===i.length?[i]:i},i.prototype.getMeasureTickFunction=function(t,i){var a="top"===t.orient()||"bottom"===t.orient()?e.TextMeasurementService.measureSvgTextWidth:e.TextMeasurementService.measureSvgTextHeight,r=this.getTextPropertiesFunction,s={};return function(e){return s[e]?s[e]:s[e]=a(r(t.tickFormat()(e)))+t.tickPadding()}},i.prototype.getTextPropertiesFunction=function(e){var t=m,i=s.fromPoint(u),a=y;return{text:e,fontFamily:t,fontSize:i,fontWeight:a}},i.prototype.getWiggle=function(t){if(t&&t.metadata){var i=t.metadata.objects;if(i){var a=e.DataViewObjects.getObject(i,"general",void 0);if(a)return a.wiggle}}return!0},i.prototype.enumerateValueAxisValues=function(e){var t=this.data&&this.data.streamGraphSettings?this.data.streamGraphSettings.valueAxisSettings:C.valueAxisSettings;e.pushInstance({selector:null,objectName:"valueAxis",displayName:"Y-Axis",properties:{show:t.show,showAxisTitle:t.showAxisTitle,labelColor:t.labelColor}})},i.prototype.enumerateCategoryAxisValues=function(e){var t=this.data&&this.data.streamGraphSettings?this.data.streamGraphSettings.categoryAxisSettings:C.categoryAxisSettings;e.pushInstance({selector:null,objectName:"categoryAxis",displayName:"X-Axis",properties:{show:t.show,showAxisTitle:t.showAxisTitle,labelColor:t.labelColor}})},i.prototype.enumerateLegend=function(e){var i=this.data&&this.data.streamGraphSettings?this.data.streamGraphSettings.legendSettings:C.legendSettings;e.pushInstance({selector:null,objectName:"legend",displayName:"Legend",properties:{show:i.show,position:t.LegendPosition[this.legend.getOrientation()],showTitle:i.showTitle,titleText:i.titleText,labelColor:i.labelColor,fontSize:i.fontSize}})},i.prototype.clearData=function(){this.svg.selectAll(i.Layer.selector).remove(),this.legend.drawLegend({dataPoints:[]},this.viewport),this.yAxis.selectAll("*").remove(),this.axisGraphicsContext.selectAll(i.YAxisLabel.selector).remove(),this.xAxis.selectAll("*").remove(),this.axisGraphicsContext.selectAll(i.XAxisLabel.selector).remove(),this.svg.select(".labels").remove()},i.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},i.prototype.enumerateObjectInstances=function(e){var i,a=new t.ObjectEnumerationBuilder,r=this.dataView;switch(this.data&&(i=this.data.streamGraphSettings.dataLabelsSettings?this.data.streamGraphSettings.dataLabelsSettings:C.dataLabelsSettings),e.objectName){case"legend":r&&r.categorical&&r.categorical.values&&r.categorical.values.source&&this.enumerateLegend(a);break;case"categoryAxis":this.enumerateCategoryAxisValues(a);break;case"valueAxis":this.enumerateValueAxisValues(a);break;case"labels":var s={enumeration:a,dataLabelsSettings:i,show:!0,fontSize:!0};t.dataLabelUtils.enumerateDataLabels(s);break;case"general":var o={objectName:"general",displayName:"General",selector:null,properties:{wiggle:this.getWiggle(r)}};a.pushInstance(o)}return a.complete()},i.VisualClassName="streamGraph",i.Properties={general:{formatString:{objectName:"general",propertyName:"formatString"}},legend:{show:{objectName:"legend",propertyName:"show"},showTitle:{objectName:"legend",propertyName:"showTitle"},titleText:{objectName:"legend",propertyName:"titleText"},labelColor:{objectName:"legend",propertyName:"labelColor"},fontSize:{objectName:"legend",propertyName:"fontSize"}},categoryAxis:{show:{objectName:"categoryAxis",propertyName:"show"},labelColor:{objectName:"categoryAxis",propertyName:"labelColor"},showAxisTitle:{objectName:"categoryAxis",propertyName:"showAxisTitle"}},valueAxis:{show:{objectName:"valueAxis",propertyName:"show"},labelColor:{objectName:"valueAxis",propertyName:"labelColor"},showAxisTitle:{objectName:"valueAxis",propertyName:"showAxisTitle"}},labels:{show:{objectName:"labels",propertyName:"show"},color:{objectName:"labels",propertyName:"color"},fontSize:{objectName:"labels",propertyName:"fontSize"}}},i.Layer={"class":"layer",selector:".layer"},i.XAxisLabel={"class":"xAxisLabel",selector:".xAxisLabel"},i.YAxisLabel={"class":"yAxisLabel",selector:".yAxisLabel"},i.MaxNumberOfAxisXValues=5,i.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:"Category"},{name:"Series",kind:e.VisualDataRoleKind.Grouping,displayName:"Series"},{name:"Y",kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Values")}],dataViewMappings:[{conditions:[{Category:{max:1},Series:{max:0}},{Category:{max:1},Series:{min:1,max:1},Y:{max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{bottom:{}}},values:{group:{by:"Series",select:[{"for":{"in":"Y"}}],dataReductionAlgorithm:{bottom:{}}}}}}],objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}},wiggle:{type:{bool:!0},displayName:"Wiggle"}}},categoryAxis:{displayName:"X-Axis",properties:{show:{displayName:"show",type:{bool:!0}},showAxisTitle:{displayName:"Title",type:{bool:!0}},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}}}},valueAxis:{displayName:"Y-Axis",properties:{show:{displayName:"show",type:{bool:!0}},showAxisTitle:{displayName:"Title",type:{bool:!0}},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}}}},legend:{displayName:"Legend",properties:{show:{displayName:"show",type:{bool:!0}},position:{displayName:"Position",type:{enumeration:t.legendPosition.type}},showTitle:{displayName:"Title",type:{bool:!0}},titleText:{displayName:"Legend Name",type:{text:!0},suppressFormatPainterCopy:!0},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},labels:{displayName:"Data Labels",properties:{show:{displayName:"Show",type:{bool:!0}},color:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}}},supportsHighlight:!0},i}();i.StreamGraph=P}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,i=(window.jsCommon,window.powerbi);window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var a=t.utility.SelectionManager,r=function(){function i(){this.margin={top:10,right:30,bottom:10,left:10},this.LegendSize=50,this.AxisSize=30}return i.prototype.init=function(e){var r=this;this.hostServices=e.host,this.selectionManager=new a({hostServices:this.hostServices}),this.root=d3.select(e.element.get(0)).append("svg").classed(i.Identity["class"],!0),this.root.on("click",function(e){r.clearSelection()}),this.main=this.root.append("g"),this.axes=this.main.append("g").classed(i.Axes["class"],!0),this.axisX=this.axes.append("g").classed(i.Axis["class"],!0),this.axisY=this.axes.append("g").classed(i.Axis["class"],!0),this.axisY2=this.axes.append("g").classed(i.Axis["class"],!0),this.legends=this.main.append("g").classed(i.Legends["class"],!0),this.line=this.main.append("g").classed(i.Values["class"],!0),this.colors=e.style&&e.style.colorPalette?e.style.colorPalette.dataColors:new t.DataColorPalette},i.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){var t=e.viewport,i=this.model=this.converter(e.dataViews[0],t);this.clearSelection(),this.resize(t),this.draw(i)}},i.prototype.destroy=function(){this.root=null},i.prototype.setIsStopped=function(e){var t={merge:[{objectName:"misc",selector:void 0,properties:{isstopped:e}}]};this.hostServices.persistProperties(t),this.hostServices.onSelect({data:[]})},i.prototype.enumerateObjectInstances=function(e){var t=[];if(!this.model||!this.model.settings)return t;var i=this.model.settings;switch(e.objectName){case"lineoptions":var a={objectName:"lineoptions",displayName:"lineoptions",selector:null,properties:{fill:i.lineFill,lineThickness:i.lineThickness}};t.push(a);break;case"dotoptions":var r={objectName:"dotoptions",displayName:"dotoptions",selector:null,properties:{color:i.dotFill,dotSizeMin:i.dotSizeMin,dotSizeMax:i.dotSizeMax}};t.push(r);break;case"counteroptions":var s={objectName:"counteroptions",displayName:"counteroptions",selector:null,properties:{counterTitle:i.counterTitle}};t.push(s);break;case"misc":var o={objectName:"misc",displayName:"misc",selector:null,properties:{isanimated:i.isanimated,isstopped:i.isstopped,duration:i.duration}};t.push(o)}return t},i.prototype.selectDot=function(e,t){var i=d3.select(e);i.classed("point_selected")?this.clearSelection():(t&&this.selectionManager.select(t),this.root.classed("filtered",!0),this.line.selectAll("circle.point").classed("point_selected",!1),d3.select(e).classed("point_selected",!0)),d3.event.stopPropagation()},i.prototype.clearSelection=function(){this.root.classed("filtered",!1),this.root.selectAll("circle.point").classed("point_selected",!1),this.selectionManager.clear()},i.prototype.converter=function(e,i){if(!(e.categorical&&e.categorical.categories&&e.categorical.categories[0]&&e.categorical.categories[0].values&&e.categorical.categories[0].values.length>0&&e.categorical&&e.categorical.values&&e.categorical.values[0]&&e.categorical.values[0].values&&e.categorical.values[0].values.length>0))return null;var a,r,s,o,l=[],n=this,c=t.AxisHelper.getCategoryValueType(e.categorical.categories[0].source,!0);this.isDateTime=t.AxisHelper.isDateTime(c);var h,u=!0,d=this.parseSettings(e),p=Math.max(0,i.width-this.margin.left-this.margin.right-this.LegendSize-this.AxisSize),g=Math.max(0,i.height-this.margin.top-this.margin.bottom-this.LegendSize),m="";l=e.categorical.categories[0].values,a=e.categorical.categories[0].source,r=d3.extent(l),this.isDateTime?(s=r[0].getTime(),o=r[1].getTime(),s=new Date(s),o=new Date(o+.05*(o-s)),m="MMM dd yyyy",h=t.valueFormatter.create({format:m})):(s=r[0],o=r[1],o+=.05*(o-s),h=t.valueFormatter.create({value:0}));var y=t.AxisHelper.createAxis({pixelSpan:p,dataDomain:[s,o],metaDataColumn:a,formatString:null,outerPadding:0,isCategoryAxis:!0,isScalar:u,isVertical:!1,forcedTickCount:void 0,useTickIntervalForDisplayUnits:!0,getValueFn:function(e,t){return n.isDateTime?h.format(new Date(e)):e}});y.formatter=h,a=e.categorical.values[0].source,l=e.categorical.values[0].values,r=d3.extent(l),s=r[0],o=r[1];for(var f,v=[],x=0,b=0,S=0,w=0;w<e.categorical.categories[0].values.length;w++)b=e.categorical.values[0].values[w],S=e.categorical.categories[0].values[w],x+=b,f=t.SelectionId.createWithId(e.categorical.categories[0].identity[w]),v.push({dot:(b-s)/(o-s),value:b,sum:x,time:S,selector:f});x+=.1*(x-s);var C=t.AxisHelper.createAxis({pixelSpan:g,dataDomain:[s,x],metaDataColumn:a,formatString:null,outerPadding:0,isCategoryAxis:!1,isScalar:!0,isVertical:!0,useTickIntervalForDisplayUnits:!0}),D=t.AxisHelper.createAxis({pixelSpan:g,dataDomain:[s,x],metaDataColumn:a,formatString:null,outerPadding:0,isCategoryAxis:!1,isScalar:!0,isVertical:!0,useTickIntervalForDisplayUnits:!0});return D.axis.orient("right"),{points:v,settings:d,xAxis:y,yAxis:C,yAxis2:D,legends:this.generateAxisLabels(i,d)}},i.prototype.parseSettings=function(a){if(!(a&&a.metadata&&a.metadata.columns&&a.metadata.columns[0]))return null;var r=a.metadata.objects,s=new t.ColorHelper(this.colors,i.Properties.lineoptions.fill,i.DefaultSettings.lineFill),o=new t.ColorHelper(this.colors,i.Properties.dotoptions.color,i.DefaultSettings.dotFill),l=i.DefaultSettings.xAxisTitle,n=i.DefaultSettings.yAxisTitle;a.categorical.categories[0]&&a.categorical.categories[0].source&&a.categorical.categories[0].source.displayName&&a.categorical.values[0]&&a.categorical.values[0].source&&a.categorical.values[0].source.displayName&&(l=a.categorical.categories[0].source.displayName,n=a.categorical.values[0].source.displayName);var c=i.DefaultSettings.lineThickness,h=i.DefaultSettings.dotSizeMin,u=i.DefaultSettings.dotSizeMax,d=i.DefaultSettings.counterTitle,p=i.DefaultSettings.isanimated,g=i.DefaultSettings.isstopped,m=i.DefaultSettings.duration;return r&&(c=e.DataViewObjects.getValue(r,i.Properties.lineoptions.lineThickness,i.DefaultSettings.lineThickness),h=e.DataViewObjects.getValue(r,i.Properties.dotoptions.dotSizeMin,i.DefaultSettings.dotSizeMin),u=e.DataViewObjects.getValue(r,i.Properties.dotoptions.dotSizeMax,i.DefaultSettings.dotSizeMax),d=e.DataViewObjects.getValue(r,i.Properties.counteroptions.counterTitle,i.DefaultSettings.counterTitle),p=e.DataViewObjects.getValue(r,i.Properties.misc.isanimated,i.DefaultSettings.isanimated),g=e.DataViewObjects.getValue(r,i.Properties.misc.isstopped,i.DefaultSettings.isstopped),m=e.DataViewObjects.getValue(r,i.Properties.misc.duration,i.DefaultSettings.duration)),{xAxisTitle:l,yAxisTitle:n,lineFill:s.getColorForMeasure(r,""),lineThickness:c,dotFill:o.getColorForMeasure(r,""),dotSizeMin:h,dotSizeMax:u,counterTitle:d,isstopped:g,isanimated:p,duration:m}},i.prototype.generateAxisLabels=function(e,i){return[{transform:t.SVGUtil.translate((e.width-this.margin.left-this.margin.right)/2,e.height-this.margin.top-this.margin.bottom),text:i.xAxisTitle,dx:"1em",dy:"-1em"},{transform:t.SVGUtil.translateAndRotate(0,(e.height-this.margin.top-this.margin.bottom)/2,0,0,270),text:i.yAxisTitle,dx:"3em"}]},i.prototype.resize=function(e){this.root.attr({height:Math.max(0,e.height),width:Math.max(0,e.width)}),this.main.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top)),this.legends.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top)),this.line.attr("transform",t.SVGUtil.translate(this.margin.left+this.LegendSize,0)),this.axes.attr("transform",t.SVGUtil.translate(this.margin.left+this.LegendSize,0)),this.axisX.attr("transform",t.SVGUtil.translate(0,e.height-this.margin.top-this.margin.bottom-this.LegendSize)),this.axisY2.attr("transform",t.SVGUtil.translate(e.width-this.margin.left-this.margin.right-this.LegendSize-this.AxisSize,0))},i.prototype.draw=function(e){var t=this,i=this;if(this.line.selectAll("*").remove(),this.legends.selectAll("*").remove(),this.axisX.selectAll("*").remove(),this.axisY.selectAll("*").remove(),this.axisY2.selectAll("*").remove(),e&&(this.renderLegends(e),e&&e.points&&e.points.length)){if(this.axisX.call(e.xAxis.axis),this.axisY.call(e.yAxis.axis),this.axisY2.call(e.yAxis2.axis),e.settings.isanimated){var a=this.line.append("g").classed("lineDotChart__playBtn",!0).attr("transform","translate(40, 20)");if(a.append("circle").attr("r",17),e.settings.isstopped)return a.append("path").attr("d","M0 2l10 6-10 6z").attr("transform","translate(-4,-8)"),void a.on("click.lineDotChart__playBt",function(){i.setIsStopped(!1)});a.append("path").attr("d","M0 2l10 6-10 6z").attr("transform-origin","center").attr("transform","translate(6, 8) rotate(180)"),a.append("rect").attr("width","2").attr("height","12").attr("transform","translate(-7,-6)"),a.on("click.lineDotChart__playBt",function(){i.setIsStopped(!0)})}var r=this.line.append("clipPath").attr("id","lineClip").append("rect").attr("x",0).attr("y",0).attr("width",1).attr("height",1e4),s=d3.svg.line().x(function(t){return e.xAxis.scale(t.time)}).y(function(t){return e.yAxis.scale(t.sum)}),o=this.line.selectAll("path.plot").data([e.points]);o.enter().append("path"),o.classed("plot",!0).attr("stroke",function(t,i){return e.settings.lineFill}).attr("stroke-width",e.settings.lineThickness).attr("d",s);var l=o.node().getTotalLength(),n=o.node().getPointAtLength(0).x,c=o.node().getPointAtLength(l).x;o.attr("clip-path","url("+location.href+"#lineClip)"),e.settings.isanimated?r.attr("x",n).interrupt().transition().ease("linear").duration(1e3*e.settings.duration).attr("width",c-n):r.interrupt().attr("x",n).attr("width",c-n),o.exit().remove();var h=300,u=0,d=this.line.selectAll("circle.point").data(e.points),i=this;d.enter().append("circle").attr("fill",e.settings.dotFill).attr("opacity",.77).attr("r",function(t){return e.settings.dotSizeMin+t.dot*(e.settings.dotSizeMax-e.settings.dotSizeMin)}).classed("point",!0).on("mouseover.point",this.showDataPoint).on("mouseout.point",this.hideDataPoint).on("click.point",function(e){i.selectDot(this,e.selector)}),e.settings.isanimated?d.interrupt().attr("transform",function(t){return"translate("+e.xAxis.scale(t.time)+" "+e.yAxis.scale(t.sum)+") scale(0.005)"}).transition().duration(h).delay(function(i,a){return t.pointDelay(e.points,a,e.settings.duration)}).ease("linear").attr("transform",function(t){return"translate("+e.xAxis.scale(t.time)+" "+e.yAxis.scale(t.sum)+") scale(3.4)"}).transition().duration(h).delay(function(i,a){return t.pointDelay(e.points,a,e.settings.duration)+h}).ease("elastic").attr("transform",function(t){return"translate("+e.xAxis.scale(t.time)+" "+e.yAxis.scale(t.sum)+") scale(1)"}):d.interrupt().attr("transform",function(t){return"translate("+e.xAxis.scale(t.time)+" "+e.yAxis.scale(t.sum)+") scale(1)"}),d.exit().remove();for(var p=0;p<d[0].length;p++)this.addTooltip(e,d[0][p]);var g=this.line.selectAll("text").data(e.points);g.enter().append("text").classed("text",!0).text(function(t,i){return e.settings.counterTitle+" "+(i+1)}).attr("x",c-260).attr("y",30),e.settings.isanimated?g.attr("opacity",0).interrupt().transition().duration(u).delay(function(i,a){return t.pointDelay(e.points,a,e.settings.duration)}).attr("transform","translate(0 0)").attr("opacity",1).transition().duration(u).delay(function(i,a){return e.points[a+1]?t.pointDelay(e.points,a+1,e.settings.duration):Number.POSITIVE_INFINITY}).attr("opacity",0):g.interrupt().attr("transform","translate(0 0)").attr("opacity",function(t,i){return Number(i===e.points.length-1)}),g.exit().remove()}},i.prototype.pointDelay=function(e,t,i){if(!e.length||!e[t]||0===t)return 0;if(this.isDateTime)var a=e[t].time,r=e[0].time.getTime(),s=e[e.length-1].time.getTime(),o=a.getTime();else var a=e[t].time,r=e[0].time,s=e[e.length-1].time,o=a;return 1e3*i*(o-r)/(s-r)},i.prototype.showDataPoint=function(e,t){d3.select(this).classed("show",!0)},i.prototype.hideDataPoint=function(e,t){d3.select(this).classed("show",!1)},i.prototype.addTooltip=function(e,i){var a=d3.select(i),r=a.datum();t.TooltipManager.addTooltip(a,function(t){return[{displayName:e.settings.xAxisTitle,value:e.xAxis.formatter.format(r.time)},{displayName:e.settings.yAxisTitle,value:r.value.toString()}]})},i.prototype.renderLegends=function(e){var t=this.legends.selectAll(i.Legend.selector).data(e.legends);t.enter().append("svg:text"),t.attr("x",0).attr("y",0).attr("dx",function(e){return e.dx}).attr("dy",function(e){return e.dy}).attr("transform",function(e){return e.transform}).text(function(e){return e.text}).classed(i.Legend["class"],!0),t.exit().remove()},i.DefaultSettings={lineFill:"rgb(102, 212, 204)",lineThickness:3,dotFill:"#005c55",dotSizeMin:4,dotSizeMax:38,counterTitle:"Total features",xAxisTitle:"",yAxisTitle:"",duration:20,isanimated:!0,isstopped:!0},i.capabilities={dataRoles:[{name:"Date",kind:e.VisualDataRoleKind.Grouping,displayName:"Date"},{name:"Values",kind:e.VisualDataRoleKind.Measure,displayName:"Values"}],dataViewMappings:[{conditions:[{Date:{min:0,max:1},Values:{min:0,max:1},Labels:{min:0,max:1}}],categorical:{categories:{"for":{"in":"Date"},dataReductionAlgorithm:{sample:{}}},values:{"for":{"in":"Values"}}}}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},lineoptions:{displayName:"Line",properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},lineThickness:{displayName:"Thickness",type:{numeric:!0}}}},dotoptions:{displayName:"Dot",properties:{color:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},dotSizeMin:{displayName:"Min size",type:{numeric:!0}},dotSizeMax:{displayName:"Min size",type:{numeric:!0}}}},counteroptions:{displayName:"Counter",properties:{counterTitle:{displayName:"Title",type:{text:!0}}}},misc:{displayName:"Animation",properties:{isanimated:{displayName:"Animated",type:{bool:!0}},isstopped:{displayName:"Stop on load",type:{bool:!0}},duration:{displayName:"Time",type:{numeric:!0}}}}}},i.Identity={"class":"lineDotChart",selector:".lineDotChart"},i.Axes={"class":"axes",selector:".axes"},i.Axis={"class":"axis",selector:".axis"},i.Legends={"class":"legends",selector:".legends"},i.Legend={"class":"legend",selector:".legend"},i.Values={"class":"line",selector:".line"},i.Properties={general:{formatString:{objectName:"general",propertyName:"formatString"}},lineoptions:{fill:{objectName:"lineoptions",propertyName:"fill"},lineThickness:{objectName:"lineoptions",propertyName:"lineThickness"}},dotoptions:{color:{objectName:"dotoptions",propertyName:"color"},dotSizeMin:{objectName:"dotoptions",propertyName:"dotSizeMin"},dotSizeMax:{objectName:"dotoptions",propertyName:"dotSizeMax"}},counteroptions:{counterTitle:{objectName:"counteroptions",propertyName:"counterTitle"}},misc:{isanimated:{objectName:"misc",propertyName:"isanimated"},isstopped:{objectName:"misc",propertyName:"isstopped"},duration:{objectName:"misc",propertyName:"duration"}}},i}();i.LineDotChart=r}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,i=(window.jsCommon,window.powerbi);window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var a=t.utility.SelectionManager;i.sunburstRoleNames={nodes:"Nodes",values:"Values"};var r=function(){function i(){this.total=0}return i.prototype.init=function(e){var t=this;this.arc=d3.svg.arc().startAngle(function(e){return e.x}).endAngle(function(e){return e.x+e.dx}).innerRadius(function(e){return Math.sqrt(e.y)}).outerRadius(function(e){return Math.sqrt(e.y+e.dy)}),this.colors=e.style.colorPalette.dataColors,this.selectionManager=new a({hostServices:e.host}),this.svg=d3.select(e.element.get(0)).append("svg"),this.svg.classed("mainDrawArea",!0),this.g=this.svg.append("g"),this.g.classed("container",!0),this.svg.append("text").classed("sunBurstPercentageFixed",!0),this.svg.on("mousedown",function(e){t.svg.selectAll("path").style("opacity",1),t.svg.select(".sunBurstPercentageFixed").style("opacity",0),t.selectionManager.clear()})},i.setAllUnhide=function(e){e.attr("setUnHide","true")},i.prototype.update=function(e){if(e.dataViews.length>0){var t=this.converter(e.dataViews[0],this.colors);this.viewport=e.viewport,this.updateInternal(t)}},i.prototype.updateInternal=function(e){var a=this;this.svg.attr({height:this.viewport.height,width:this.viewport.width}),this.g.attr("transform",t.SVGUtil.translate(this.viewport.width/2,this.viewport.height/2));var r=Math.min(this.viewport.width,this.viewport.height)/2,s=d3.layout.partition().size([2*Math.PI,r*r]).value(function(e){return e.value}),o=this.g.datum(e).selectAll("path").data(s.nodes);o.enter().append("path"),o.attr("display",function(e){return e.depth?null:"none"}).attr("d",this.arc).style("stroke","#fff").style("fill",function(e){return e.color}).style("fill-rule","evenodd").on("mousedown",function(e){e.selector&&a.selectionManager.select(e.selector),d3.selectAll("path").call(i.setAllUnhide).attr("setUnHide",null),a.highlightPath(e,a,!0);var t=a.svg.select(".sunBurstPercentageFixed"),r=0===a.total?0:(100*e.total/a.total).toPrecision(3);t.text(e?r+"%":""),t.style("fill",e.color),a.onResize(),event.stopPropagation()}),this.renderTooltip(o),o.exit().remove(),this.onResize()},i.getTreePath=function(e){for(var t=[],i=e;i.parent;)t.unshift(i),i=i.parent;return t},i.prototype.onResize=function(){var t=this.viewport.width,i=this.viewport.height,a=this.svg.select(".sunBurstPercentageFixed"),r=e.TextMeasurementService.measureSvgTextElementWidth(a[0][0]);a.style("opacity",1),a.attr("y",i/2+4),a.attr("x",t/2-r/2)},i.prototype.highlightPath=function(e,t,a){var r=e?i.getTreePath(e):[];t.svg.selectAll("path").each(function(){"true"!==d3.select(this).attr("setUnHide")&&d3.select(this).style("opacity",i.minOpacity)}),t.svg.selectAll("path").filter(function(e){return r.indexOf(e)>=0}).each(function(){d3.select(this).style("opacity",1),a===!0&&d3.select(this).attr("setUnHide","true")})},i.prototype.renderTooltip=function(e){t.TooltipManager.addTooltip(e,function(e){return e.data.tooltipInfo})},i.getTooltipData=function(e,t){return[{displayName:e,value:0>t?"":t.toString()}]},i.prototype.covertTreeNodeToSunBurstNode=function(e,a,r,s,o){var l;e.identity&&(s=s.concat([e.identity]),l={data:s});var n=0===s.length?null:new t.SelectionId(l,!1),c=e.values?e.values[0].value:0,h={name:e.name,value:Math.max(c,0),selector:n,total:c};if(e.value&&(h.color=o?o:r.getColor(e.value).value),this.total+=h.value,e.children&&e.children.length>0){h.tooltipInfo=i.getTooltipData(e.value,-1),h.children=[];for(var u=0;u<e.children.length;u++){var d=this.covertTreeNodeToSunBurstNode(e.children[u],h,r,s,h.color);h.children.push(d),h.total+=d.total}}else h.tooltipInfo=i.getTooltipData(e.value,c);return a&&(h.parent=a),h},i.prototype.converter=function(e,t){var i=t.getNewColorScale();this.total=0;var a=this.covertTreeNodeToSunBurstNode(e.matrix.rows.root,null,i,[],void 0);return a},i.minOpacity=.2,i.roleNames={nodes:"Nodes",values:"Values"},i.capabilities={dataRoles:[{name:i.roleNames.nodes,kind:e.VisualDataRoleKind.Grouping,displayName:"Groups"},{name:i.roleNames.values,kind:e.VisualDataRoleKind.Measure,displayName:"Values"}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}}},dataViewMappings:[{conditions:[{Groups:{min:0},Values:{max:1}}],matrix:{rows:{"for":{"in":i.roleNames.nodes}},values:{"for":{"in":i.roleNames.values}}}}]},i}();i.Sunburst=r}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,i=(window.jsCommon,window.powerbi);window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(e){var t;!function(t){t.sunburstCustom={name:"sunburstCustom",watermarkKey:"defaultWatermark",capabilities:e.samples.Sunburst.capabilities,create:function(){return new e.samples.Sunburst}},t.asterPlot={name:"asterPlot",capabilities:e.samples.AsterPlot.capabilities,create:function(){return new e.samples.AsterPlot}},t.tornadoChart={name:"tornadoChart",capabilities:e.samples.TornadoChart.capabilities,create:function(){return new e.samples.TornadoChart}},t.sankeyDiagram={name:"sankeyDiagram",capabilities:e.samples.SankeyDiagram.capabilities,create:function(){return new e.samples.SankeyDiagram}},t.mekkoChart={name:"mekkoChart",watermarkKey:"mekko",capabilities:e.samples.MekkoChart.capabilities,create:function(){return new e.samples.MekkoChart({chartType:0})},customizeQuery:e.ColumnChart.customizeQuery,getSortableRoles:function(t){return e.ColumnChart.getSortableRoles(t)}},t.bulletChart={name:"bulletChart",capabilities:e.samples.BulletChart.capabilities,create:function(){return new e.samples.BulletChart}},t.wordCloud={name:"wordCloud",capabilities:e.samples.WordCloud.capabilities,create:function(){return new e.samples.WordCloud}},t.chicletSlicer={name:"chicletSlicer",capabilities:e.samples.ChicletSlicer.capabilities,create:function(){return new e.samples.ChicletSlicer}},t.chordChart={name:"chordChart",capabilities:e.samples.ChordChart.capabilities,create:function(){return new e.samples.ChordChart}},t.enhancedScatterChart={name:"enhancedScatterChart",capabilities:e.samples.EnhancedScatterChart.capabilities,create:function(){return new e.samples.EnhancedScatterChart}},t.radarChart={name:"radarChart",capabilities:e.samples.RadarChart.capabilities,create:function(){return new e.samples.RadarChart}},t.dotPlot={name:"dotPlot",capabilities:e.samples.DotPlot.capabilities,create:function(){return new e.samples.DotPlot}},t.histogram={name:"histogram",capabilities:e.samples.Histogram.capabilities,create:function(){return new e.samples.Histogram}},t.timeline={name:"timeline",capabilities:e.samples.Timeline.capabilities,create:function(){return new e.samples.Timeline}},t.forceGraph={name:"forceGraph",capabilities:e.samples.ForceGraph.capabilities,create:function(){return new e.samples.ForceGraph}},t.gantt={name:"gantt",capabilities:e.samples.Gantt.capabilities,create:function(){return new e.samples.Gantt}},t.streamGraph={name:"streamGraph",capabilities:e.samples.StreamGraph.capabilities,create:function(){return new e.samples.StreamGraph}},t.lineDotChart={name:"lineDotChart",capabilities:e.samples.LineDotChart.capabilities,create:function(){return new e.samples.LineDotChart;
}}}(t=e.plugins||(e.plugins={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,i=(window.jsCommon,window.powerbi),a=(window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft,this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});!function(e){var t;!function(t){var i;!function(i){function r(){return new s}var s=function(r){function s(){r.call(this,{}),this.initCustomVisualPlugins()}return a(s,r),s.prototype.getVisuals=function(){var e=this.customVisualPlugins,t=Object.keys(e);return t.map(function(t){return e[t]})},s.prototype.getPlugin=function(e){if(!e)return null;var t=this.customVisualPlugins[e];return t?t:null},s.prototype.capabilities=function(e){var t=this.getPlugin(e);return t?t.capabilities:{}},s.prototype.initCustomVisualPlugins=function(){i.createPlugin(this.customVisualPlugins,e.visuals.plugins.asterPlot,function(){return new t.samples.AsterPlot}),i.createPlugin(this.customVisualPlugins,e.visuals.plugins.tornadoChart,function(){return new t.samples.TornadoChart({animator:new t.BaseAnimator})}),i.createPlugin(this.customVisualPlugins,e.visuals.plugins.sankeyDiagram,function(){return new t.samples.SankeyDiagram}),i.createPlugin(this.customVisualPlugins,e.visuals.plugins.mekkoChart,function(){return new t.samples.MekkoChart({chartType:0,isScrollable:!0,animator:new t.WebColumnChartAnimator,behavior:new t.CartesianChartBehavior([new t.ColumnChartWebBehavior])})}),i.createPlugin(this.customVisualPlugins,e.visuals.plugins.bulletChart,function(){return new t.samples.BulletChart}),i.createPlugin(this.customVisualPlugins,e.visuals.plugins.wordCloud,function(){return new t.samples.WordCloud({animator:new t.BaseAnimator})}),i.createPlugin(this.customVisualPlugins,e.visuals.plugins.chicletSlicer,function(){return new t.samples.ChicletSlicer({behavior:new t.samples.ChicletSlicerWebBehavior})}),i.createPlugin(this.customVisualPlugins,e.visuals.plugins.enhancedScatterChart,function(){return new t.samples.EnhancedScatterChart}),i.createPlugin(this.customVisualPlugins,e.visuals.plugins.radarChart,function(){return new t.samples.RadarChart({animator:new t.BaseAnimator})}),i.createPlugin(this.customVisualPlugins,e.visuals.plugins.dotPlot,function(){return new t.samples.DotPlot({animator:new t.BaseAnimator})}),i.createPlugin(this.customVisualPlugins,e.visuals.plugins.histogram,function(){return new t.samples.Histogram({animator:new t.BaseAnimator})}),i.createPlugin(this.customVisualPlugins,e.visuals.plugins.forceGraph,function(){return new t.samples.ForceGraph}),i.createPlugin(this.customVisualPlugins,e.visuals.plugins.gantt,function(){return new t.samples.Gantt}),i.createPlugin(this.customVisualPlugins,e.visuals.plugins.streamGraph,function(){return new t.samples.StreamGraph})},s}(i.VisualPluginService);i.CustomVisualPluginService=s,i.createCustomVisualPluginService=r}(i=t.visualPluginFactory||(t.visualPluginFactory={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))}]);