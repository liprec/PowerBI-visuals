function loadGlobeMapLibs(){}var __extends=this&&this.__extends||function(e,t){function a(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)},powerbi;!function(e){var t;!function(t){var a;!function(a){var i=jsCommon.CssConstants.createClassAndSelector,r=jsCommon.PixelConverter,s=e.visuals.valueFormatter,o="asterPlot",l="legend",n=1,c={solid:{color:"#333"}},h=8,u=.9,d=.9,p=17,g=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.selection=e.selection,this.highlightedSelection=e.highlightedSelection,this.clearCatcher=e.clearCatcher,this.interactivityService=e.interactivityService,this.selection.on("click",function(e,a){t.handleSelection(e.data,d3.event.ctrlKey)}),this.highlightedSelection&&this.highlightedSelection.on("click",function(e,a){t.handleSelection(e.data,d3.event.ctrlKey)}),this.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var a=this.interactivityService.hasSelection();this.selection.style("fill-opacity",function(i){return t.ColumnUtil.getFillOpacity(i.data.selected,i.data.highlight,!i.data.highlight&&e,!i.data.selected&&a)})},e}(),m=function(){function e(e){this.message=e}return Object.defineProperty(e.prototype,"code",{get:function(){return"AsterPlotWarning"},enumerable:!0,configurable:!0}),e.prototype.getMessages=function(e){return{message:this.message,title:e.get(""),detail:e.get("")}},e}();a.AsterPlotWarning=m;var y=function(){function a(){this.margin={top:10,right:10,bottom:15,left:10}}return a.prototype.getDefaultAsterData=function(){return{dataPoints:[],highlightedDataPoints:[],legendData:{dataPoints:[],title:null,fontSize:h,labelColor:t.LegendData.DefaultLegendLabelFillColor},legendSettings:{show:!1,position:"Top",showTitle:!0,labelColor:t.LegendData.DefaultLegendLabelFillColor,titleText:"",fontSize:h},valueFormatter:null,labelSettings:{show:!1,displayUnits:0,precision:t.dataLabelUtils.defaultLabelPrecision,labelColor:t.dataLabelUtils.defaultLabelColor,fontSize:t.dataLabelUtils.DefaultFontSizeInPt},showOuterLine:!1,outerLineThickness:n}},a.prototype.converter=function(i,o){var l=this.getDefaultAsterData();if(!this.dataViewContainsCategory(i)||1!==i.categorical.categories.length)return l;var c=i.categorical,h=c.categories[0],u=h.source,d=h.values,p=c.values,g=h.objects,m=new t.ColorHelper(o,a.Properties.dataPoint.fill),y=this.hasHighlights=!!(p&&p.length>0&&p[0].highlights);if(i.metadata||i.metadata.objects){var f=i.metadata.objects;l.labelSettings=this.getLabelSettings(f,l.labelSettings),this.updateLegendSettings(f,u,l.legendSettings),l.showOuterLine=e.DataViewObjects.getValue(f,a.Properties.outerLine.show,l.showOuterLine),l.outerLineThickness=e.DataViewObjects.getValue(f,a.Properties.outerLine.thickness,n)}var v=l.labelSettings;if(!d||d.length<1||!p||p.length<1)return l;for(var x=a.Properties.general.formatString,b=Math.max(d3.min(p[0].values)),S=Math.min(0,d3.min(p[0].values)),w=s.create({format:s.getFormatString(p[0].source,x),precision:v.precision,value:0===v.displayUnits&&null!=b?b:v.displayUnits}),C=t.valueFormatter.getFormatString(u,x),D=r.fromPoint(v.fontSize),P=0;P<d.length;P++){var A=t.valueFormatter.format(d[P],C),N=p[0].values[P],T=t.TooltipBuilder.createTooltipInfo(x,c,A,N,null,null,0);if(p.length>1){var V=t.TooltipBuilder.createTooltipInfo(x,c,A,p[1].values[P],null,null,1)[1];V&&T.push(V),N+=p[1].values[P]}var L=h.identity[P],M=m.getColorForMeasure(g&&g[P],L.key),k=t.SelectionId.createWithId(L),j=Math.max(0,p.length>1?p[1].values[P]:1);if(l.dataPoints.push({sliceHeight:p[0].values[P]-S,sliceWidth:j,label:w.format(N),color:M,identity:k,selected:!1,tooltipInfo:T,labelFontSize:D,highlight:!1}),l.legendSettings.show&&l.legendData.dataPoints.push({label:d[P],color:M,icon:t.LegendIcon.Box,selected:!1,identity:k}),y){var I=t.SelectionId.createWithHighlight(k),O=null!=p[0].highlights[P];if(N=O?p[0].highlights[P]:0,T=t.TooltipBuilder.createTooltipInfo(x,c,A,N,null,null,0),p.length>1){var V=t.TooltipBuilder.createTooltipInfo(x,c,A,p[1].highlights[P],null,null,1)[1];V&&T.push(V),N+=null!==p[1].highlights[P]?p[1].highlights[P]:0}l.highlightedDataPoints.push({sliceHeight:O?p[0].highlights[P]-S:null,sliceWidth:Math.max(0,p.length>1&&null!==p[1].highlights[P]?p[1].highlights[P]:j),label:w.format(N),color:M,identity:I,selected:!1,tooltipInfo:T,labelFontSize:D,highlight:!0})}}return l},a.prototype.dataViewContainsCategory=function(e){return e&&e.categorical&&e.categorical.values&&e.categorical.categories&&e.categorical.categories[0]},a.prototype.getLabelSettings=function(i,r){var s=a.Properties,o=e.DataViewObjects.getValue(i,s.labels.labelPrecision,r.precision);r.precision=void 0===o?o:Math.min(o,p),r.show=e.DataViewObjects.getValue(i,s.labels.show,r.show),r.fontSize=e.DataViewObjects.getValue(i,s.labels.fontSize,r.fontSize),r.displayUnits=e.DataViewObjects.getValue(i,s.labels.labelDisplayUnits,r.displayUnits);var l=new t.ColorHelper(this.colors,s.labels.color,r.labelColor);return r.labelColor=l.getColorForMeasure(i,""),r},a.prototype.updateLegendSettings=function(t,i,r){var s=a.Properties.legend;r.show=e.DataViewObjects.getValue(t,s.show,r.show),r.position=e.DataViewObjects.getValue(t,s.position,r.position),r.showTitle=e.DataViewObjects.getValue(t,s.showTitle,r.showTitle);var o=e.DataViewObjects.getValue(t,s.titleText,"");r.titleText=_.isEmpty(o)&&i?i.displayName:o,r.labelColor=e.DataViewObjects.getFillColor(t,s.labelColor,r.labelColor),r.fontSize=e.DataViewObjects.getValue(t,s.fontSize,r.fontSize)},a.prototype.init=function(e){this.hostService=e.host;var a=e.element,i=this.svg=d3.select(a.get(0)).append("svg").classed(o,!0).style("position","absolute");this.colors=e.style.colorPalette.dataColors,this.mainGroupElement=i.append("g"),this.mainLabelsElement=i.append("g"),this.behavior=new g,this.clearCatcher=t.appendClearCatcher(this.mainGroupElement);var r=e.interactivity;this.interactivityService=t.createInteractivityService(this.hostService),this.legend=t.createLegend(a,r&&r.isInteractiveLegend,this.interactivityService,!0)},a.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){var i=e.suppressAnimations?0:t.AnimatorCommon.MinervaAnimationDuration;this.currentViewport={height:Math.max(0,e.viewport.height),width:Math.max(0,e.viewport.width)};var r=this.dataView=e.dataViews[0],s=this.data=this.converter(r,this.colors);if(!s||!s.dataPoints||0===s.dataPoints.length)return void this.clearData();this.interactivityService&&(this.interactivityService.applySelectionStateToData(s.dataPoints),this.interactivityService.applySelectionStateToData(s.highlightedDataPoints)),this.renderLegend(s),this.updateViewPortAccordingToLegend(),this.svg.attr({height:Math.max(0,this.currentViewport.height),width:Math.max(0,this.currentViewport.width)});var o=this.margin,l=(this.currentViewport.width-o.left)/2,n=(this.currentViewport.height-o.top)/2;this.mainGroupElement.attr("transform",t.SVGUtil.translate(l,n)),this.mainLabelsElement.attr("transform",t.SVGUtil.translate(l,n)),this.clearCatcher.attr("transform",t.SVGUtil.translate(-l,-n)),this.mainGroupElement.selectAll(a.AsterSlice.selector).remove(),this.mainGroupElement.selectAll(a.AsterHighlightedSlice.selector).remove(),t.dataLabelUtils.cleanDataLabels(this.mainLabelsElement,!0);var c=s.dataPoints;if(c&&0!==c.length){var h,u=this.renderArcsAndLabels(c,i,s.labelSettings);this.hasHighlights&&(h=this.renderArcsAndLabels(s.highlightedDataPoints,i,s.labelSettings,!0));var d=this.interactivityService;if(d){var p={selection:u,highlightedSelection:h,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService};d.bind(s.dataPoints.concat(s.highlightedDataPoints),this.behavior,p)}}}},a.prototype.renderArcsAndLabels=function(e,i,r,s){void 0===s&&(s=!1);var o=this.margin,l=this.currentViewport.width-o.left-o.right,n=this.currentViewport.height-o.top-o.bottom,c=Math.min(l,n)/2,h=.3*(r.show?c*u:c),d=d3.max(e,function(e){return e.sliceHeight}),p=d3.sum(e,function(e){return e.sliceWidth}),g=this.interactivityService&&this.interactivityService.hasSelection(),m=this.hasHighlights,y=d3.layout.pie().sort(null).value(function(e){return(e&&!isNaN(e.sliceWidth)?e.sliceWidth:0)/p}),f=d3.svg.arc().innerRadius(h).outerRadius(function(e){var t=(c-h)*(e&&e.data&&!isNaN(e.data.sliceHeight)?e.data.sliceHeight:1)/d,a=h+(r.show?t*u:t);return Math.max(a,h)}),v=y(e),x=s?a.AsterHighlightedSlice:a.AsterSlice,b=this.mainGroupElement.selectAll(x.selector).data(v,function(e,t){return e.data?e.data.identity.getKey():t});if(b.enter().append("path").attr("stroke","#333").classed(x["class"],!0),b.attr("fill",function(e){return e.data.color}).style("fill-opacity",function(e){return t.ColumnUtil.getFillOpacity(e.data.selected,e.data.highlight,g,m)}).transition().duration(i).attrTween("d",function(e){if(!this.oldData)return this.oldData=e,function(){return f(e)};var t=d3.interpolate(this.oldData,e);return this.oldData=t(0),function(e){return f(t(e))}}),b.exit().remove(),t.TooltipManager.addTooltip(b,function(e){return e.data.data.tooltipInfo}),r.show&&(!m||m&&s)){var S=function(e){var t=c*(e&&!isNaN(e.sliceHeight)?e.sliceHeight:1)/d+h;return Math.max(t,h)},w=d3.svg.arc().innerRadius(function(e){return S(e.data)}).outerRadius(function(e){return S(e.data)}),C=function(e){var t=(c-h)*(e&&!isNaN(e.sliceHeight)?e.sliceHeight:1)/d;return t=h+t*u,Math.max(t,h)},D=d3.svg.arc().innerRadius(function(e){return C(e.data)}).outerRadius(function(e){return C(e.data)}),P=this.getLabelLayout(r,w,this.currentViewport);this.drawLabels(v,this.mainLabelsElement,P,this.currentViewport,D,w)}else t.dataLabelUtils.cleanDataLabels(this.mainLabelsElement,!0);return s||(this.drawCenterText(h),this.drawOuterLine(h,c,v)),b},a.prototype.getLabelLayout=function(a,i,s){var o=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2},l={fontFamily:t.dataLabelUtils.StandardFontFamily,fontSize:r.fromPoint(a.fontSize),text:""},n=function(t){var a=i.centroid(t);l.text=t.data.label;var r=e.TextMeasurementService.measureSvgTextWidth(l),o=s.width/2-Math.abs(a[0]),n=e.TextMeasurementService.estimateSvgTextHeight(l),c=s.height/2-Math.abs(a[1]);return t.isLabelHasConflict=r>o||n>c,t.isLabelHasConflict};return{labelText:function(t){l.text=t.data.label;var a=i.centroid(t),r=n(t)?a[0]*d:a[0],o=s.width/2-Math.abs(r);return e.TextMeasurementService.getTailoredTextOrDefault(l,o)},labelLayout:{x:function(e){var t=i.centroid(e);l.text=e.data.label;var a=e.isLabelHasConflict?t[0]*d:t[0];return a},y:function(e){var t=i.centroid(e),a=e.isLabelHasConflict?t[1]*d:t[1];return a}},filter:function(e){return null!=e&&!_.isEmpty(e.data.label)},style:{fill:a.labelColor,"font-size":l.fontSize,"text-anchor":function(e){return o(e)<Math.PI?"start":"end"}}}},a.prototype.drawLabels=function(i,r,s,o,l,n){var c=this,h=new e.DataLabelManager,u=h.hideCollidedLabels(o,i,s,!0);if(0===u.length)return void t.dataLabelUtils.cleanDataLabels(r,!0);r.select(a.labelGraphicsContextClass.selector).empty()&&r.append("g").classed(a.labelGraphicsContextClass["class"],!0);var d=r.select(a.labelGraphicsContextClass.selector).selectAll(".data-labels").data(u,function(e){return e.data.identity.getKey()});if(d.enter().append("text").classed("data-labels",!0),d){d.attr({x:function(e){return e.labelX},y:function(e){return e.labelY},dy:".35em"}).text(function(e){return e.labeltext}).style(s.style),d.exit().remove(),r.select(a.linesGraphicsContextClass.selector).empty()&&r.append("g").classed(a.linesGraphicsContextClass["class"],!0),u=_.filter(u,function(e){return null!==e.data.sliceHeight&&0!==e.data.sliceHeight});var p=r.select(a.linesGraphicsContextClass.selector).selectAll("polyline").data(u,function(e){return e.data.identity.getKey()}),g=4,m=1.02,y=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2};p.enter().append("polyline").classed("line-label",!0),p.attr("points",function(e){var t=[e.labelX,e.labelY];t[0]=t[0]+(y(e)<Math.PI?-1:1)*g;var a=l.centroid(e);return a[0]*=m,a[1]*=m,[a,t]}).style({opacity:.5,"fill-opacity":0,stroke:function(e){return c.data.labelSettings.labelColor}}),p.exit().remove()}},a.prototype.renderLegend=function(a){if(a&&a.legendData){var i=a.legendData,r=this.dataView&&this.dataView.metadata?this.dataView.metadata.objects:null,s=e.DataViewObjects.getObject(r,l,{});if(s){var o=a.legendSettings;s.titleText=o.titleText,t.LegendData.update(i,s),this.legend.changeOrientation(t.LegendPosition[o.position])}this.legend.drawLegend(i,_.clone(this.currentViewport)),t.Legend.positionChartArea(this.svg,this.legend)}},a.prototype.updateViewPortAccordingToLegend=function(){var e=this.data.legendSettings;if(e&&e.show){var a=this.legend.getMargins(),i=t.LegendPosition[e.position];switch(i){case t.LegendPosition.Top:case t.LegendPosition.TopCenter:case t.LegendPosition.Bottom:case t.LegendPosition.BottomCenter:this.currentViewport.height-=a.height;break;case t.LegendPosition.Left:case t.LegendPosition.LeftCenter:case t.LegendPosition.Right:case t.LegendPosition.RightCenter:this.currentViewport.width-=a.width}}},a.prototype.drawOuterLine=function(e,t,i){var r=this.mainGroupElement,s=d3.svg.arc().innerRadius(e).outerRadius(t);if(this.data.showOuterLine){var o=this.data.outerLineThickness+"px",l=r.selectAll(a.OuterLine.selector).data(i);l.enter().append("path"),l.attr("fill","none").attr({stroke:"#333","stroke-width":o,d:s}).style("opacity",1).classed(a.OuterLine["class"],!0),l.exit().remove()}else r.selectAll(a.OuterLine.selector).remove()},a.prototype.getCenterText=function(e){if(e&&e.metadata&&e.metadata.columns&&e.categorical&&e.categorical.values)for(var t=0,a=e.metadata.columns;t<a.length;t++){var i=a[t];if(!i.isMeasure)return i.displayName}return""},a.prototype.drawCenterText=function(i){var s=this.getCenterText(this.dataView);if(_.isEmpty(s))return void this.mainGroupElement.select(a.CenterLabelClass.selector).remove();var o={fontFamily:t.dataLabelUtils.StandardFontFamily,fontWeight:"bold",fontSize:r.toString(i*a.CenterTextFontHeightCoefficient),text:s};this.mainGroupElement.select(a.CenterLabelClass.selector).empty()&&(this.centerText=this.mainGroupElement.append("text").classed(a.CenterLabelClass["class"],!0)),this.centerText.style({"line-height":1,"font-weight":o.fontWeight,"font-size":o.fontSize,fill:this.getLabelFill(this.dataView).solid.color}).attr({dy:"0.35em","text-anchor":"middle"}).text(e.TextMeasurementService.getTailoredTextOrDefault(o,i*a.CenterTextFontWidthCoefficient))},a.prototype.getLabelFill=function(t){return this.dataViewContainsObjects(t)?e.DataViewObjects.getValue(t.metadata.objects,a.Properties.label.fill,c):c},a.prototype.dataViewContainsObjects=function(e){return e&&e.metadata&&e.metadata.objects},a.prototype.enumerateLegend=function(e){var t=this.data.legendSettings,a={selector:null,objectName:l,displayName:"Legend",properties:{show:t.show,position:t.position,showTitle:t.showTitle,titleText:t.titleText,labelColor:t.labelColor,fontSize:t.fontSize}};e.push(a)},a.prototype.clearData=function(){this.mainGroupElement.selectAll("path").remove(),t.dataLabelUtils.cleanDataLabels(this.mainLabelsElement,!0),this.legend.drawLegend({dataPoints:[]},this.currentViewport)},a.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},a.prototype.enumerateLabels=function(e){var t=this.data.labelSettings,a={objectName:"labels",displayName:"Labels",selector:null,properties:{show:t.show,fontSize:t.fontSize,labelPrecision:t.precision,labelDisplayUnits:t.displayUnits,color:t.labelColor}};e.push(a)},a.prototype.enumerateObjectInstances=function(e){var t=[];if(!this.dataViewContainsCategory(this.dataView))return t;switch(e.objectName){case l:this.data&&this.enumerateLegend(t);break;case"label":var a={objectName:"label",displayName:"Label",selector:null,properties:{fill:this.getLabelFill(this.dataView)}};t.push(a);break;case"labels":this.enumerateLabels(t);break;case"outerLine":var i={objectName:"outerLine",displayName:"Outer Line",selector:null,properties:{show:this.data.showOuterLine,thickness:this.data.outerLineThickness}};t.push(i)}return t},a.capabilities={dataRoles:[{displayName:"Category",name:"Category",kind:e.VisualDataRoleKind.Grouping},{displayName:"Y Axis",name:"Y",kind:e.VisualDataRoleKind.Measure}],dataViewMappings:[{conditions:[{Category:{max:1},Y:{max:2}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{select:[{bind:{to:"Y"}}]}}}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},legend:{displayName:"Legend",description:"Display legend options",properties:{show:{displayName:"Show",type:{bool:!0}},position:{displayName:"Position",description:"Select the location for the legend",type:{enumeration:t.legendPosition.type}},showTitle:{displayName:"Title",description:"Display a title for legend symbols",type:{bool:!0}},titleText:{displayName:"Legend Name",description:"Title text",type:{text:!0},suppressFormatPainterCopy:!0},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},label:{displayName:"Center Label",properties:{fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}}}},labels:{displayName:"Detail Labels",properties:{show:{type:{bool:!0}},color:{displayName:"Color",type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}},labelPrecision:{displayName:"Decimal Places",placeHolderText:"Auto",type:{numeric:!0}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},outerLine:{displayName:"Outer line",properties:{show:{displayName:"Show",type:{bool:!0}},thickness:{displayName:"Thickness",type:{numeric:!0}}}}},supportsHighlight:!0},a.Properties={general:{formatString:{objectName:"general",propertyName:"formatString"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}},legend:{show:{objectName:l,propertyName:"show"},position:{objectName:l,propertyName:"position"},showTitle:{objectName:l,propertyName:"showTitle"},titleText:{objectName:l,propertyName:"titleText"},labelColor:{objectName:l,propertyName:"labelColor"},fontSize:{objectName:l,propertyName:"fontSize"}},label:{fill:{objectName:"label",propertyName:"fill"}},labels:{show:{objectName:"labels",propertyName:"show"},color:{objectName:"labels",propertyName:"color"},labelDisplayUnits:{objectName:"labels",propertyName:"labelDisplayUnits"},labelPrecision:{objectName:"labels",propertyName:"labelPrecision"},fontSize:{objectName:"labels",propertyName:"fontSize"}},outerLine:{show:{objectName:"outerLine",propertyName:"show"},thickness:{objectName:"outerLine",propertyName:"thickness"}}},a.AsterSlice=i("asterSlice"),a.AsterHighlightedSlice=i("asterHighlightedSlice"),a.OuterLine=i("outerLine"),a.labelGraphicsContextClass=i("labels"),a.linesGraphicsContextClass=i("lines"),a.CenterLabelClass=i("centerLabel"),a.CenterTextFontHeightCoefficient=.4,a.CenterTextFontWidthCoefficient=1.9,a}();a.AsterPlot=y}(a=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a;!function(a){function i(){return new l}var r=jsCommon.PixelConverter,s=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.columns=e.columns,this.clearCatcher=e.clearCatcher,this.interactivityService=e.interactivityService,this.columns.on("click",function(e,a){t.handleSelection(e,d3.event.ctrlKey)}),this.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var a=this.interactivityService.hasSelection();this.columns.style("fill-opacity",function(i){return t.ColumnUtil.getFillOpacity(i.selected,i.highlight,!i.highlight&&e,!i.selected&&a)})},e}(),o=function(){function e(e,t,a,i){this.scrollYBrush=d3.svg.brush(),this.getRoot=e,this.getViewport=t,this.isScrollable=i}return Object.defineProperty(e.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this.getViewport()},enumerable:!0,configurable:!0}),e.prototype.renderY=function(e,t,a){var i=this;if(this.isYScrollBarVisible=t>this.viewport.height&&this.viewport.height>0&&this.viewport.width>0,this.brushGraphicsContextY=this.createOrRemoveScrollbar(this.isYScrollBarVisible,this.brushGraphicsContextY,"y brush"),this.updateScrollViewport(),!this.isYScrollBarVisible)return void a.call(this,jQuery.extend(!0,{},e),0,1);var r=this.viewport.height,s=this.getExtentData(t,r),o=function(t){void 0===t&&(t=0);var o=i.scrollYBrush.extent();if(0!==t){var l=(o[1]-o[0])/2;if(o[0]+=t>0?l:-l,o[1]+=t>0?l:-l,o[0]<0){var n=0-o[0];o[0]+=n,o[1]+=n}if(o[1]>r){var n=o[1]-r;o[0]-=n,o[1]-=n}i.scrollYBrush.extent(o),i.brushGraphicsContextY.select(".extent").attr("y",o[0])}var c=s.toScrollPosition(o,r);a.call(i,jQuery.extend(!0,{},e),c[0],c[1]),i.setScrollBarSize(i.brushGraphicsContextY,s.value[1],!0)},l=d3.scale.ordinal().rangeBands([0,r]);this.scrollYBrush.y(l).extent(s.value),this.renderScrollbar(this.scrollYBrush,this.brushGraphicsContextY,this.viewport.width,o),o()},e.prototype.updateScrollViewport=function(){this.scrollViewport={height:this.viewport.height,width:this.viewport.width},this.isYScrollBarVisible&&this.isScrollable&&(this.scrollViewport.width-=n.ScrollBarWidth)},e.prototype.createOrRemoveScrollbar=function(e,t,a){return e&&this.isScrollable?t||this.root.append("g").classed(a,!0):t?void t.remove():void 0},e.prototype.renderScrollbar=function(e,a,i,r){var s=this;e.on("brush",function(){return window.requestAnimationFrame(function(){return r(0)})}),this.root.on("wheel",function(){if(s.isYScrollBarVisible){var e=d3.event;r(e.deltaY)}}),a.attr({transform:t.SVGUtil.translate(i,0),"drag-resize-disabled":"true"}),a.call(e),a.selectAll(".resize").remove(),a.select(".background").remove(),a.selectAll(".extent").style({"fill-opacity":.125,cursor:"default"})},e.prototype.setScrollBarSize=function(e,t,a){e.selectAll("rect").attr(a?"width":"height",n.ScrollBarWidth),e.selectAll("rect").attr(a?"height":"width",t)},e.prototype.getExtentData=function(t,a){var i=a*a/t,r=e.ScrollBarMinLength<=i?1:i/e.ScrollBarMinLength;i=Math.max(i,e.ScrollBarMinLength);var s=function(e,t){var a=e[1]-e[0],i=e[0]/(t-a);a*=r;var s=i*(t-a),o=s+a;return[s/t,o/t]};return{value:[0,i],toScrollPosition:s}},e.prototype.clearData=function(){this.brushGraphicsContextY&&this.brushGraphicsContextY.selectAll("*").remove()},e.ScrollBarMinLength=15,e}(),l=function(){function e(){}return Object.defineProperty(e.prototype,"code",{get:function(){return"TornadoChartWarning"},enumerable:!0,configurable:!0}),e.prototype.getMessages=function(e){var t,a="This visual requires two distinct values to be returned for the Legend field.",i="",r="";return t={message:a,title:e.get(i),detail:e.get(r)}},e}();a.TornadoChartWarning=l,a.getTornadoChartWarning=i;var n=function(){function a(e){this.DefaultTornadoChartSettings={labelOutsideFillColor:t.dataLabelUtils.defaultLabelColor,labelSettings:{show:!0,precision:null,fontSize:a.DefaultFontSize,displayUnits:0,labelColor:t.dataLabelUtils.defaultInsideLabelColor},showCategories:!0,showLegend:!0,legendFontSize:a.DefaultLegendFontSize,legendColor:t.LegendData.DefaultLegendLabelFillColor,categoriesFillColor:"#777"},this.DefaultFillColors=["purple","teal"],this.columnPadding=5,this.leftLabelMargin=4,this.InnerTextHeightDelta=2,this.textOptions={},this.margin={top:10,right:5,bottom:10,left:10},this.heightColumn=0,this.widthLeftSection=0,this.widthRightSection=0,e&&(this.svg=e.svg||this.svg,this.margin=e.margin||this.margin,this.columnPadding=e.columnPadding||this.columnPadding,this.animator=e.animator)}return a.prototype.init=function(e){var i,r=this,l=e.style;this.hostService=e.host;var n=e.element;this.colors=l.colorPalette.dataColors;var c=e.interactivity;this.interactivityService=t.createInteractivityService(this.hostService);var h;this.svg?this.root=h=this.svg:this.root=h=d3.select(n.get(0)).append("svg"),h.classed(a.ClassName,!0).style("position","absolute"),i=h.style("font-size"),this.textOptions.sizeUnit=i.slice(i.length-2),this.textOptions.fontSize=Number(i.slice(0,i.length-2)),this.textOptions.fontFamily=h.style("font-family"),this.scrolling=new o(function(){return h},function(){return r.viewport},function(){return r.margin},!0);var u=this.main=h.append("g");this.clearCatcher=t.appendClearCatcher(u),this.columns=u.append("g").classed(a.Columns["class"],!0),this.axes=u.append("g").classed(a.Axes["class"],!0),this.labels=u.append("g").classed(a.Labels["class"],!0),this.categories=u.append("g").classed(a.Categories["class"],!0),this.behavior=new s,this.defaultTornadoChartDataView={categories:[],series:[],settings:null,legend:null,dataPoints:[],highlightedDataPoints:[]},this.legend=t.createLegend(n,c&&c.isInteractiveLegend,this.interactivityService,!0)},a.prototype.update=function(e){e&&e.dataViews&&e.dataViews[0]&&(this.viewport={height:Math.max(0,e.viewport.height-this.margin.top-this.margin.bottom),width:Math.max(0,e.viewport.width-this.margin.left-this.margin.right)},this.animator?this.durationAnimations=t.AnimatorCommon.GetAnimationDuration(this.animator,e.suppressAnimations):this.durationAnimations=e.suppressAnimations?0:250,this.tornadoChartDataView=this.converter(e.dataViews[0]),this.interactivityService&&(this.interactivityService.applySelectionStateToData(this.tornadoChartDataView.dataPoints),this.interactivityService.applySelectionStateToData(this.tornadoChartDataView.highlightedDataPoints)),this.render())},a.prototype.updateElements=function(){var e=t.SVGUtil.translate(this.widthLeftSection,0);this.root.attr({height:this.viewport.height+this.margin.top+this.margin.bottom,width:this.viewport.width+this.margin.left+this.margin.right}),this.columns.attr("transform",e),this.labels.attr("transform",e),this.axes.attr("transform",e)},a.prototype.converter=function(s){if(!(s&&s.categorical&&s.categorical.categories&&s.categorical.categories[0]&&s.categorical.categories[0].source&&s.categorical.values&&s.categorical.values[0]))return this.defaultTornadoChartDataView;var o=s.categorical,l=o.categories||[],n=o.values;if(n.length>a.MaxSeries)return this.hostService.setWarnings([i()]),this.defaultTornadoChartDataView;var c=l[0],h=c.values,u=h.length,d=this.getObjectsFromDataView(s),p=a.Properties.general.formatString,g=t.valueFormatter.getFormatString(n[0].source,p),m=d3.max(n[0].values),y=this.parseSettings(d,g,m);this.hasDynamicSeries=!!n.source;var f=this.hasHighlights=!!(n.length>0&&n[0].highlights);this.labelHeight=e.TextMeasurementService.estimateSvgTextHeight({fontFamily:t.dataLabelUtils.StandardFontFamily,fontSize:r.fromPoint(y.labelSettings.fontSize)});var v=[],x=[],b=[],S=[],w=[];n.grouped&&(w=n.grouped());for(var C=0,D=y.showCategories,P=t.valueFormatter.getFormatString(c.source,p),A=0;u>A;A++){var N=t.valueFormatter.format(h[A],P),T=this.getTextData(N,!0);S.push(T),D&&T.width>C&&(C=T.width)}var V=u*a.CategoryMinHeight>this.viewport.height?a.ScrollBarWidth:0;this.widthLeftSection=C+a.LabelPadding;var L=this.widthRightSection=this.viewport.width-this.widthLeftSection-V;this.updateElements();var M=Math.min(d3.min(n[0].values),0);n.length===a.MaxSeries&&(M=d3.min([M,d3.min(n[1].values)]),m=d3.max([m,d3.max(n[1].values)]),L/=a.MaxSeries);for(var k=0;k<n.length;k++){var j=this.parseSeries(n,k,this.hasDynamicSeries,w);v.push(j);for(var I=n[k],O=I.source.queryName,A=0;u>A;A++){var G=null==I.values[A]||isNaN(I.values[A])?0:I.values[A],F=t.SelectionIdBuilder.builder().withCategory(c,A).withSeries(n,I).withMeasure(O).createSelectionId(),N=S[A].text,R=void 0;R=t.TooltipBuilder.createTooltipInfo(p,o,N,G,null,null,k,A,null);var z=j.categoryAxisEnd?Math.min(j.categoryAxisEnd,m):m,B=s.categorical.values[k].source.format;if(x.push({value:G,minValue:M,maxValue:z,formatString:B,color:j.fill,selected:!1,identity:F,tooltipData:R,categoryIndex:A}),f){var H=t.SelectionId.createWithHighlight(F),E=I.highlights[A],W=null!=E?E:0;R=t.TooltipBuilder.createTooltipInfo(p,o,N,G,null,null,k,A,W),b.push({value:W,minValue:M,maxValue:z,formatString:B,color:j.fill,selected:!1,identity:H,tooltipData:R,categoryIndex:A,highlight:!0})}}}return{categories:S,series:v,settings:y,legend:this.getLegendData(v),dataPoints:x,highlightedDataPoints:b}},a.prototype.parseSettings=function(i,r,s){var o=this.getPrecision(i),l=e.DataViewObjects.getValue(i,a.Properties.labels.labelDisplayUnits,this.DefaultTornadoChartSettings.labelSettings.displayUnits),n=this.DefaultTornadoChartSettings.labelSettings,c=t.valueFormatter.create({format:r,precision:o,value:0===l&&null!=s?s:l});return{labelOutsideFillColor:this.getColor(a.Properties.labels.outsideFill,this.DefaultTornadoChartSettings.labelOutsideFillColor,i),labelSettings:{show:e.DataViewObjects.getValue(i,a.Properties.labels.show,n.show),precision:o,fontSize:e.DataViewObjects.getValue(i,a.Properties.labels.fontSize,n.fontSize),displayUnits:l,labelColor:this.getColor(a.Properties.labels.insideFill,n.labelColor,i)},showCategories:e.DataViewObjects.getValue(i,a.Properties.categories.show,this.DefaultTornadoChartSettings.showCategories),showLegend:e.DataViewObjects.getValue(i,a.Properties.legend.show,this.DefaultTornadoChartSettings.showLegend),legendFontSize:e.DataViewObjects.getValue(i,a.Properties.legend.fontSize,this.DefaultTornadoChartSettings.legendFontSize),legendColor:this.getColor(a.Properties.legend.labelColor,this.DefaultTornadoChartSettings.legendColor,i),categoriesFillColor:this.getColor(a.Properties.categories.fill,this.DefaultTornadoChartSettings.categoriesFillColor,i),labelValueFormatter:c}},a.prototype.getColor=function(e,a,i){var r=new t.ColorHelper(this.colors,e,a);return r.getColorForMeasure(i,"")},a.prototype.getPrecision=function(t){var i=e.DataViewObjects.getValue(t,a.Properties.labels.labelPrecision,this.DefaultTornadoChartSettings.labelSettings.precision);return i>=a.MaxPrecision?a.MaxPrecision:i},a.prototype.getObjectsFromDataView=function(t){return t&&t.metadata&&t.metadata.columns&&t.metadata.objects?(this.legendObjectProperties=e.DataViewObjects.getObject(t.metadata.objects,"legend",{}),t.metadata.objects):(this.legendObjectProperties={},null)},a.prototype.parseSeries=function(e,i,r,s){var o,l,n=e[i],c=r?s[i]:s[0].values[i],h=n.source,u=c.identity?t.SelectionId.createWithId(c.identity):t.SelectionIdBuilder.builder().withSeries(e,c).withMeasure(h.queryName).createSelectionId(),d=h.groupName?h.groupName:h.displayName;r?(l=c.objects?c.objects.categoryAxis:null,o=c.objects):(o=h.objects,l=o?o.categoryAxis:null);var p=this.getColor(a.Properties.dataPoint.fill,this.DefaultFillColors[i],o),g=l?l.end:null;return{fill:p,name:d,selectionId:u,categoryAxisEnd:g}},a.prototype.getLegendData=function(e){var a=[];return this.hasDynamicSeries&&(a=e.map(function(e){return{label:e.name,color:e.fill,icon:t.LegendIcon.Box,selected:!1,identity:e.selectionId}})),{dataPoints:a}},a.prototype.clearData=function(){this.columns.selectAll("*").remove(),this.axes.selectAll("*").remove(),this.labels.selectAll("*").remove(),this.categories.selectAll("*").remove(),this.legend.drawLegend({dataPoints:[]},this.viewport),this.scrolling.clearData()},a.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},a.prototype.render=function(){var e=this.tornadoChartDataView;return e&&e.settings?(this.renderLegend(),void this.scrolling.renderY(e,e.categories.length*a.CategoryMinHeight,this.renderWithScrolling.bind(this))):void this.clearData()},a.prototype.renderWithScrolling=function(e,t,i){if(this.tornadoChartDataView&&this.tornadoChartDataView.settings){var r=e.categories.length,s=t*r,o=i*r,l=Math.floor(s),n=Math.floor(o),c=Math.floor(this.scrolling.scrollViewport.height/a.CategoryMinHeight);1>i-t&&n-l>c&&(s-l>o-n?l++:o--),this.interactivityService&&(this.interactivityService.applySelectionStateToData(e.dataPoints),this.interactivityService.applySelectionStateToData(e.highlightedDataPoints));
var h=e.categories.length*a.CategoryMinHeight>this.viewport.height?a.ScrollBarWidth:0;e.categories=e.categories.slice(l,n),e.dataPoints=_.filter(e.dataPoints,function(e){return e.categoryIndex>=l&&e.categoryIndex<n}),e.highlightedDataPoints=_.filter(e.highlightedDataPoints,function(e){return e.categoryIndex>=l&&e.categoryIndex<n}),this.tornadoChartDataView=e,this.computeHeightColumn(),this.renderMiddleSection(h),this.renderAxes(),this.renderCategories()}},a.prototype.updateViewport=function(){var e,a=this.legend.getMargins();switch(e=t.LegendPosition[this.legendObjectProperties[t.legendProps.position]]){case t.LegendPosition.Top:case t.LegendPosition.TopCenter:case t.LegendPosition.Bottom:case t.LegendPosition.BottomCenter:this.viewport.height-=a.height;break;case t.LegendPosition.Left:case t.LegendPosition.LeftCenter:case t.LegendPosition.Right:case t.LegendPosition.RightCenter:this.viewport.width-=a.width}},a.prototype.computeHeightColumn=function(){var e=this.tornadoChartDataView.categories.length;this.heightColumn=(this.scrolling.scrollViewport.height-(e-1)*this.columnPadding)/e},a.prototype.renderMiddleSection=function(e){var t=this.tornadoChartDataView;this.calculateDataPoints(t.dataPoints,e),this.calculateDataPoints(t.highlightedDataPoints,e);var a=t.dataPoints.concat(t.highlightedDataPoints);this.renderColumns(a,2===t.series.length),this.renderLabels(this.hasHighlights?t.highlightedDataPoints:t.dataPoints,t.settings.labelSettings)},a.prototype.calculateDataPoints=function(e,t){var i=this.widthRightSection=this.viewport.width-this.widthLeftSection-t,r=this.tornadoChartDataView.categories.length,s=this.tornadoChartDataView.settings,o=this.hasHighlights,l=Math.max(this.heightColumn,0),n=l/2,c=l*a.HighlightedShapeFactor/2,h=this.tornadoChartDataView.series.length===a.MaxSeries;h&&(i/=2);for(var u=0;u<e.length;u++){var d=e[u],p=r>u&&h,g=u>r-1,m=this.getColumnWidth(d.value,d.minValue,d.maxValue,i),y=(i-m)*Number(p)+i*Number(g)-t;y=Math.max(y,0);var f=o&&d.highlight,v=f?l*(1-a.HighlightedShapeFactor)/2:0,x=(l+this.columnPadding)*(u%r)+v,b=this.getLabelData(d.value,y,m,p,d.formatString,s);d.dx=y,d.dy=x,d.px=m/2,d.py=f?c:n,d.angle=p?180:0,d.width=m,d.height=f?l*a.HighlightedShapeFactor:l,d.label=b}},a.prototype.renderColumns=function(e,i){void 0===i&&(i=!1);var r=this.interactivityService&&this.interactivityService.hasSelection(),s=this.hasHighlights,o=this.columns.selectAll(a.Column.selector).data(e);o.enter().append("svg:rect").classed(a.Column["class"],!0),o.style("fill",function(e){return e.color}).style("fill-opacity",function(e){return t.ColumnUtil.getFillOpacity(e.selected,e.highlight,r,s)}).attr("transform",function(e){return t.SVGUtil.translateAndRotate(e.dx,e.dy,e.px,e.py,e.angle)}).attr("height",function(e){return e.height}).attr("width",function(e){return e.width}),o.exit().remove();var l=this.interactivityService;if(l){l.applySelectionStateToData(e);var n={columns:o,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService};l.bind(e,this.behavior,n)}this.renderTooltip(o)},a.prototype.renderTooltip=function(e){t.TooltipManager.addTooltip(e,function(e){return e.data.tooltipData})},a.prototype.getColumnWidth=function(e,t,a,i){if(t===a)return i;var r=i*(e-t)/(a-t);return Math.max(0,Math.min(i,r))},a.prototype.getLabelData=function(i,s,o,l,n,c){var h,u=c?c:this.tornadoChartDataView.settings,d=u.labelSettings,p=d.fontSize,g=d.labelColor,m=l?s-this.leftLabelMargin:this.widthRightSection-(s+o+this.leftLabelMargin),y=Math.max(m,o-this.leftLabelMargin),f={fontFamily:t.dataLabelUtils.StandardFontFamily,fontSize:r.fromPoint(p),text:u.labelValueFormatter.format(i)},v=e.TextMeasurementService.getTailoredTextOrDefault(f,y),x=this.getTextData(v,!0,!1,p);return o>x.width+a.LabelPadding?h=s+o/2-x.width/2:(h=l?s-this.leftLabelMargin-x.width:s+o+this.leftLabelMargin,g=u.labelOutsideFillColor),{dx:h,source:i,value:v,color:g}},a.prototype.renderAxes=function(){var e,t,i=this.main.select(a.Axes.selector).selectAll(a.Axis.selector);return this.tornadoChartDataView.series.length!==a.MaxSeries?void i.remove():(e=this.generateAxesData(),t=i.data(e),t.enter().append("svg:line").classed(a.Axis["class"],!0),t.transition().duration(this.durationAnimations).attr("x1",function(e){return e.x1}).attr("y1",function(e){return e.y1}).attr("x2",function(e){return e.x2}).attr("y2",function(e){return e.y2}),void t.exit().remove())},a.prototype.generateAxesData=function(){var e,t,a;return e=this.widthRightSection/2,t=0,a=this.scrolling.scrollViewport.height,[{x1:e,y1:t,x2:e,y2:a}]},a.prototype.renderLabels=function(e,i){var s,o=this,l=this.main.select(a.Labels.selector).selectAll(a.Label.selector).data(_.filter(e,function(e){return e.label.dx>=0}));if(!i.show||this.labelHeight>=this.heightColumn)return void this.labels.selectAll("*").remove();var n=r.fromPoint(i.fontSize),c=this.heightColumn/2+this.labelHeight/2-this.InnerTextHeightDelta,h=this.tornadoChartDataView.categories.length;s=l.enter().append("g"),s.append("svg:title").classed(a.LabelTitle["class"],!0),s.append("svg:text").attr("dy",t.dataLabelUtils.DefaultDy).classed(a.LabelText["class"],!0),l.attr("pointer-events","none").classed(a.Label["class"],!0),l.select(a.LabelTitle.selector).text(function(e){return e.label.source}),l.attr("transform",function(e,a){var i=(o.heightColumn+o.columnPadding)*(a%h);return t.SVGUtil.translate(e.label.dx,i+c)}),l.select(a.LabelText.selector).attr("fill",function(e){return e.label.color}).attr("font-size",function(e){return n}).text(function(e){return e.label.value}),l.exit().remove()},a.prototype.renderCategories=function(){var i,r,s=this,o=this.tornadoChartDataView.settings,l=o.categoriesFillColor,n=this.main.select(a.Categories.selector).selectAll(a.Category.selector),c=this;return o.showCategories?(r=n.data(this.tornadoChartDataView.categories),i=r.enter().append("g"),i.append("svg:title").classed(a.CategoryTitle["class"],!0),i.append("svg:text").classed(a.CategoryText["class"],!0),r.attr("transform",function(e,a){var i=(s.heightColumn+s.columnPadding)*a+s.heightColumn/2,r=s.getTextData(e,!1,!0);return i=i+r.height/2-s.InnerTextHeightDelta,t.SVGUtil.translate(0,i)}).classed(a.Category["class"],!0),r.select(a.CategoryTitle.selector).text(function(e){return e.text}),r.select(a.CategoryText.selector).attr("fill",l).text(function(t){var a=c.getTextData(t.text);return e.TextMeasurementService.getTailoredTextOrDefault(a.textProperties,c.widthLeftSection)}),void r.exit().remove()):void n.remove()},a.prototype.renderLegend=function(){var e=this.tornadoChartDataView.legend;if(e){var a=this.tornadoChartDataView.settings,i={title:e.title,dataPoints:e.dataPoints,fontSize:a.legendFontSize,labelColor:a.legendColor};if(this.legendObjectProperties){var r=void 0;t.LegendData.update(i,this.legendObjectProperties),r=this.legendObjectProperties[t.legendProps.position],r&&this.legend.changeOrientation(t.LegendPosition[r])}var s={height:this.viewport.height+this.margin.top+this.margin.bottom,width:this.viewport.width+this.margin.left+this.margin.right};this.legend.drawLegend(i,s),t.Legend.positionChartArea(this.root,this.legend),i.dataPoints.length>0&&a.showLegend&&this.updateViewport()}},a.prototype.getTextData=function(t,a,i,s){void 0===a&&(a=!1),void 0===i&&(i=!1);var o,l,n=0,c=0;return t=t||"",o=s?r.fromPoint(s):""+this.textOptions.fontSize+this.textOptions.sizeUnit,l={text:t,fontFamily:this.textOptions.fontFamily,fontSize:o},a&&(n=e.TextMeasurementService.measureSvgTextWidth(l)),i&&(c=e.TextMeasurementService.estimateSvgTextHeight(l)),{text:t,width:n,height:c,textProperties:l}},a.prototype.enumerateObjectInstances=function(a){var i,r=new t.ObjectEnumerationBuilder;if(!this.tornadoChartDataView||!this.tornadoChartDataView.settings)return[];switch(i=this.tornadoChartDataView.settings,a.objectName){case"dataPoint":this.enumerateDataPoint(r);break;case"categoryAxis":this.enumerateCategoryAxis(r);break;case"labels":var s=i.labelSettings,o={objectName:"labels",displayName:"Labels",selector:null,properties:{show:s.show,fontSize:s.fontSize,labelPrecision:s.precision,labelDisplayUnits:s.displayUnits,insideFill:s.labelColor,outsideFill:i.labelOutsideFillColor}};r.pushInstance(o);break;case"legend":if(!this.hasDynamicSeries)return;var l=!0,n="",c=void 0;l=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.showTitle,l),n=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.titleText,n),c={objectName:"legend",displayName:"Legend",selector:null,properties:{show:i.showLegend,position:t.LegendPosition[this.legend.getOrientation()],showTitle:l,titleText:n,fontSize:i.legendFontSize,labelColor:i.legendColor}},r.pushInstance(c);break;case"categories":var h={objectName:"categories",displayName:"Categories",selector:null,properties:{show:i.showCategories,fill:i.categoriesFillColor}};r.pushInstance(h)}return r.complete()},a.prototype.enumerateDataPoint=function(e){if(this.tornadoChartDataView&&this.tornadoChartDataView.series)for(var a=this.tornadoChartDataView.series,i=0,r=a;i<r.length;i++){var s=r[i];e.pushInstance({objectName:"dataPoint",displayName:s.name,selector:t.ColorHelper.normalizeSelector(s.selectionId.getSelector(),!1),properties:{fill:{solid:{color:s.fill}}}})}},a.prototype.enumerateCategoryAxis=function(e){if(this.tornadoChartDataView&&this.tornadoChartDataView.series)for(var t=this.tornadoChartDataView.series,a=0,i=t;a<i.length;a++){var r=i[a];e.pushInstance({objectName:"categoryAxis",displayName:r.name,selector:r.selectionId?r.selectionId.getSelector():null,properties:{end:r.categoryAxisEnd}})}},a.prototype.destroy=function(){this.root=null},a.ClassName="tornado-chart",a.Properties={general:{formatString:{objectName:"general",propertyName:"formatString"}},labels:{show:{objectName:"labels",propertyName:"show"},fontSize:{objectName:"labels",propertyName:"fontSize"},labelPrecision:{objectName:"labels",propertyName:"labelPrecision"},labelDisplayUnits:{objectName:"labels",propertyName:"labelDisplayUnits"},insideFill:{objectName:"labels",propertyName:"insideFill"},outsideFill:{objectName:"labels",propertyName:"outsideFill"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}},legend:{show:{objectName:"legend",propertyName:"show"},labelColor:{objectName:"legend",propertyName:"labelColor"},fontSize:{objectName:"legend",propertyName:"fontSize"}},categories:{show:{objectName:"categories",propertyName:"show"},fill:{objectName:"categories",propertyName:"fill"}}},a.Columns={"class":"columns",selector:".columns"},a.Column={"class":"column",selector:".column"},a.Axes={"class":"axes",selector:".axes"},a.Axis={"class":"axis",selector:".axis"},a.Labels={"class":"labels",selector:".labels"},a.Label={"class":"label",selector:".label"},a.LabelTitle={"class":"label-title",selector:".label-title"},a.LabelText={"class":"label-text",selector:".label-text"},a.Categories={"class":"categories",selector:".categories"},a.Category={"class":"category",selector:".category"},a.CategoryTitle={"class":"category-title",selector:".category-title"},a.CategoryText={"class":"category-text",selector:".category-text"},a.MaxSeries=2,a.MaxPrecision=17,a.LabelPadding=2.5,a.CategoryMinHeight=25,a.DefaultFontSize=9,a.DefaultLegendFontSize=8,a.HighlightedShapeFactor=.5,a.ScrollBarWidth=10,a.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Group")},{name:"Series",kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Legend")},{name:"Values",kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Values")}],dataViewMappings:[{conditions:[{Category:{max:1},Values:{min:0,max:1},Series:{min:0,max:1}},{Category:{max:1},Values:{min:2,max:2},Series:{max:0}}],categorical:{categories:{"for":{"in":"Category"}},values:{group:{by:"Series",select:[{"for":{"in":"Values"}}],dataReductionAlgorithm:{top:{}}}}}}],objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}}}},dataPoint:{displayName:"Data Colors",properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}},categoryAxis:{displayName:"X-Axis",properties:{end:{displayName:"End",type:{numeric:!0},suppressFormatPainterCopy:!0}}},labels:{displayName:"Data Labels",properties:{show:{displayName:"Show",type:{bool:!0}},labelPrecision:{displayName:"Decimal Places",placeHolderText:"Auto",type:{numeric:!0}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}},labelDisplayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}},insideFill:{displayName:"Inside fill",type:{fill:{solid:{color:!0}}}},outsideFill:{displayName:"Outside fill",type:{fill:{solid:{color:!0}}}}}},legend:{displayName:"Legend",properties:{show:{displayName:"Show",type:{bool:!0}},position:{displayName:"Position",description:e.data.createDisplayNameGetter("Visual_LegendPositionDescription"),type:{enumeration:t.legendPosition.type}},showTitle:{displayName:"Title",description:e.data.createDisplayNameGetter("Visual_LegendShowTitleDescription"),type:{bool:!0}},titleText:{displayName:"Legend Name",description:e.data.createDisplayNameGetter("Visual_LegendNameDescription"),type:{text:!0}},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"TextSize",type:{formatting:{fontSize:!0}}}}},categories:{displayName:"Group",properties:{show:{displayName:"Show",type:{bool:!0}},fill:{displayName:"Color",type:{fill:{solid:{color:!0}}}}}}},supportsHighlight:!0},a}();a.TornadoChart=n}(a=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a;!function(a){function i(e,a,i,r,s,o,l,n,c,h,u,d,p,g,m){var y=35,f=s.x,v=s.y1,x=s.y2,b=f.values,S=v.values,w=0,C=0,D=0,P=0,A=0,N=f.categoryThickness?f.categoryThickness/2:0,T=t.AxisHelper.isOrdinalScale(f.scale),V=0;if(void 0!==f.outerPadding?V=f.outerPadding:void 0!==f.xLabelMaxWidth&&(V=Math.max(0,(e.width-f.xLabelMaxWidth*b.length)/2)),0!==t.AxisHelper.getRecommendedNumberOfTicksForXAxis(e.width)||0!==t.AxisHelper.getRecommendedNumberOfTicksForYAxis(e.height)){var L;if(L=u?t.AxisHelper.LabelLayoutStrategy.DefaultRotationWithScrollbar:t.AxisHelper.LabelLayoutStrategy.DefaultRotation,g)for(var M=0,k=S.length;k>M;M++)n.text=S[M],D=Math.max(D,i(n));if(x&&m)for(var j=x.values,M=0,k=j.length;k>M;M++)c.text=j[M],P=Math.max(P,i(c));var I=r(l),O=Math.floor(o/I),G=f.scale,F=G.domain();if(p&&b.length>0){for(var M=0,k=b.length;k>M;M++){var R;l.text=b[M];var z=i(l);if(f.willLabelsWordBreak){var B=jsCommon.WordBreaker.splitByWidth(l.text,l,i,f.xLabelMaxWidth,O);R=B.length*I,z=f.xLabelMaxWidth}else!f.willLabelsFit&&T?(R=z*L.sine,z*=L.cosine):R=I;if(0===M){if(T)w=f.willLabelsFit?z/2-N-V:z-N-V,w=Math.max(w,0);else if(F.length>1){var H=G(F[0]);w=z/2-H,w=Math.max(w,0)}}else if(M===k-1)if(T)(f.willLabelsFit||f.willLabelsWordBreak)&&(C=z/2-N-V,C=Math.max(C,0));else if(F.length>1){var H=G(F[1]);C=z/2-(e.width-H),C=Math.max(C,0)}A=Math.max(A,R)}w=h?Math.min(w,y):0,C=h?Math.min(C,y):0}}var E=0,W=0,U=Math.min(Math.ceil(A),o);return d?(W=Math.min(Math.max(w,P),a),E=Math.min(Math.max(C,D),a)):(W=Math.min(Math.max(w,D),a),E=Math.min(Math.max(C,P),a)),{xMax:Math.ceil(U),yLeft:Math.ceil(W),yRight:Math.ceil(E)}}function r(e,t,a){return a>1?e&&e.length>t?[e[t]]:[]:e}function s(e,t,a){return 0===e&&!!t&&!!t.showAxisTitle||1===e&&!a&&!!t&&!!t.secShowAxisTitle}function o(e,a,i,r,o,l,n){var c={viewport:a,margin:i,forcedXDomain:[r?r.start:null,r?r.end:null],forceMerge:o&&o.secShow===!1,showCategoryAxisLabel:!1,showValueAxisLabel:!1,categoryAxisScaleType:r&&null!=r.axisScale?r.axisScale:t.axisScale.linear,valueAxisScaleType:o&&null!=o.axisScale?o.axisScale:t.axisScale.linear,trimOrdinalDataOnOverflow:!1},h=!1;o&&(c.forcedYDomain=t.AxisHelper.applyCustomizedDomain([o.start,o.end],c.forcedYDomain));for(var u,d=0,p=e.length;p>d;d++){var g=e[d];c.showCategoryAxisLabel=!!r&&!!r.showAxisTitle,c.showValueAxisLabel=s(d,o,h);var m=g.calculateAxesProperties(c);0===d&&(u={x:m[0],y1:m[1]}),u.x.willLabelsFit=!1,u.x.willLabelsWordBreak=!1}return u}function l(e,a,i,r,s){void 0===s&&(s=!0);var o=[],l={isScrollable:s,animator:r,interactivityService:i};return o.push(n(t.ColumnChartType.hundredPercentStackedColumn,l)),o}function n(e,t){var a={animator:t.animator,interactivityService:t.interactivityService,isScrollable:t.isScrollable,chartType:e};return new x(a)}var c=jsCommon.CssConstants.createClassAndSelector,h=e.visuals.NewDataLabelUtils,u=function(){function e(e,t){this.data=e,this.isScalar=t}return e.prototype.lookupXValue=function(e,a){var i=t.AxisHelper.isDateTime(a);if(i&&this.isScalar)return new Date(e);var r=this.data;if(a.text)return r.categories[e];var s=r.series[0];if(s){var o=s.data;if(o){this.data.hasHighlights&&(e=2*e);var l=o[e];if(l)return i?new Date(l.categoryValue):l.categoryValue}}return e},e}();a.MekkoDataWrapper=u;var d=function(){function a(){}return a.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight,this.viewportWidth=e.viewportWidth},a.prototype.setData=function(e){this.data=e},a.createFormatter=function(e,a,i,r,s,o,l,n,c){void 0===c&&(c=!1);var h;if(i.dateTime)if(r){var u=new Date(e[0]),d=new Date(e[1]);1===o&&(u=d=new Date(a[0])),h=t.valueFormatter.create({format:s,value:u,value2:d,tickCount:o})}else{var p=n(0,i),g=n(e.length-1,i);h=t.valueFormatter.create({format:s,value:p,value2:g,tickCount:o})}else if(c&&r&&l.length>1){var m=l[1]-l[0],y=0;h=t.valueFormatter.create({format:s,value:m,value2:y,allowFormatBeautification:!0})}else h=t.valueFormatter.createDefaultFormatter(s,!0);return h},a.formatAxisTickValues=function(e,t,a,i,r,s){var o=[];return a?!s||i.numeric&&r?(e.tickFormat(function(e){return a.format(e)}),o=t.map(function(e){return a.format(e)})):(e.tickFormat(function(e){return a.format(s(e,i))}),o=t.map(function(e){return a.format(s(e,i))})):o=t.map(function(e){return s(e,i)}),o},a.prototype.createAxis=function(e){var i=e.pixelSpan,r=e.dataDomain,s=e.metaDataColumn,o=e.formatStringProp,l=e.outerPadding||0,n=!!e.isCategoryAxis,c=!!e.isScalar,h=!!e.isVertical,u=!!e.useTickIntervalForDisplayUnits,d=e.getValueFn,g=e.categoryThickness,m=t.valueFormatter.getFormatString(s,o),y=t.AxisHelper.getCategoryValueType(s,c),f=t.AxisHelper.isLogScalePossible(r,y),v=d3.scale.linear(),b=[0,1],S=r.length||1,w=x.getBorderWidth(e.borderSettings),C=i-w*(S-1);C<p.MinOrdinalRectThickness&&(C=p.MinOrdinalRectThickness),v.domain(b).range([0,C]);var D=r,P=a.createFormatter(b,r,y,c,m,S,D,d,u),A=d3.svg.axis().scale(v).tickSize(6,0).orient(h?"left":"bottom").ticks(S).tickValues(r),N=[];s&&(N=a.formatAxisTickValues(A,D,P,y,c,d));var T;if(!c&&g)T=Math.max(1,g-2*t.CartesianChart.TickLabelPadding);else{var V=D.length>1?D.length+1:D.length;T=V>1?i/V:i,T=Math.max(1,T-2*t.CartesianChart.TickLabelPadding)}return{scale:v,axis:A,formatter:P,values:N,axisType:y,axisLabel:null,isCategoryAxis:n,xLabelMaxWidth:T,categoryThickness:g,outerPadding:l,usingDefaultDomain:!1,isLogScaleAllowed:f}},a.prototype.getCategoryAxis=function(e,a,i,r,s,o,l){var n=i.categoryThickness,c=i.isScalar,h=i.outerPaddingRatio,d=new u(e,c),p=[];if(e.series&&e.series.length>0&&e.series[0].data&&e.series[0].data.length>0){var g=e.series[0].data.map(function(e){return e.originalPosition+e.value/2});p=g.filter(function(e,t){return g.indexOf(e)===t})}var m=this.createAxis({pixelSpan:a,dataDomain:p,metaDataColumn:e.categoryMetadata,formatStringProp:t.columnChartProps.general.formatString,outerPadding:n*h,isCategoryAxis:!0,isScalar:c,isVertical:r,categoryThickness:n,useTickIntervalForDisplayUnits:!0,getValueFn:function(e,t){var a=p.indexOf(e),i=d.lookupXValue(a,t);return i},scaleType:l,borderSettings:e.borderSettings});return i.categoryThickness=m.categoryThickness,m},a.prototype.setXScale=function(e,t,a,i){var r,s,o=this.width;a&&2===a.length&&(r=a[0],s=a[1]);var l=this.xProps=this.getCategoryAxis(this.data,o,this.categoryLayout,!1,r,s,i);return l},a.prototype.setYScale=function(e,a,i,r){var s=this.viewportHeight,o=t.StackedUtil.calcValueDomain(this.data.series,e),l=[o.min,o.max],n=t.AxisHelper.combineDomain(i,l),c=t.AxisHelper.scaleShouldClamp(n,l),h=this.data.valuesMetadata[0],u=e?this.graphicsContext.hostService.getLocalizedString("Percentage"):t.valueFormatter.getFormatString(h,t.columnChartProps.general.formatString),d={pixelSpan:s,dataDomain:n,metaDataColumn:h,formatString:u,outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:a,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:r,axisDisplayUnits:0,axisPrecision:0,is100Pct:e,shouldClamp:c,formatStringProp:void 0};return this.yProps=t.AxisHelper.createAxis(d),this.yProps},a.prototype.drawColumns=function(e){var i=this.data;this.columnsCenters=null;var r,s,o={columnWidth:0,xScale:this.xProps.scale,yScale:this.yProps.scale,isScalar:this.categoryLayout.isScalar,margin:this.margin},l=this.layout=a.getLayout(i,o),n=this.createMekkoLabelDataPoints(),c=t.ColumnUtil.drawSeries(i,this.graphicsContext.mainGraphicsContext,o);return this.animator&&e&&(r=this.animator.animate({viewModel:i,series:c,layout:l,itemCS:a.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}}),s=r.shapes),this.animator&&e&&!r.failed||(s=a.drawDefaultShapes(i,c,l,a.classes.item,!this.animator,this.interactivityService&&this.interactivityService.hasSelection())),t.ColumnUtil.applyInteractivity(s,this.graphicsContext.onDragStart),{shapesSelection:s,viewport:{height:this.height,width:this.width},axisOptions:o,labelDataPoints:n}},a.drawDefaultShapes=function(e,a,i,r,s,o){var l="rect";s=!1;var n;n=s?function(e){var t=_.filter(e.data,function(e){return!!e.value});return t}:function(e){return e.data};var c=a.selectAll(r.selector),h=c.data(n,function(e){return e.key});h.enter().append(l).attr("class",function(e){return r["class"].concat(e.highlight?" highlight":"")}),h.style("fill",function(e){return e.color}).style("fill-opacity",function(a){return t.ColumnUtil.getFillOpacity(a.selected,a.highlight,o,e.hasHighlights)}).attr(i.shapeLayout),h.exit().remove();var u=a.selectAll(x.BorderClass.selector),d=u.data(n,function(e){return e.key}),p=x.getBorderColor(e.borderSettings);return d.enter().append(l).classed(x.BorderClass["class"],!0),d.style("fill",function(e){return p}).style("fill-opacity",function(a){return e.hasHighlights?t.ColumnUtil.DimmedOpacity:t.ColumnUtil.DefaultOpacity}).attr(i.shapeBorder),d.exit().remove(),h},a.prototype.selectColumn=function(e,i){t.ColumnUtil.setChosenColumnOpacity(this.graphicsContext.mainGraphicsContext,a.classes.item.selector,e,i),this.moveHandle(e)},a.prototype.getClosestColumnIndex=function(e,a){return t.ColumnUtil.getClosestColumnIndex(e,this.getColumnsCenters())},a.prototype.getColumnsCenters=function(){var e=this;if(!this.columnsCenters){var a=this.categoryLayout.categoryThickness*(1-t.CartesianChart.InnerPaddingRatio);if(this.data.series.length>0){var i=0;this.categoryLayout.isScalar||(i=a/2);var r=this.data.series[0];r&&r.data&&(this.columnsCenters=r.data.map(function(t){return e.xProps.scale(e.categoryLayout.isScalar?t.categoryValue:t.categoryIndex)+i}))}}return this.columnsCenters},a.prototype.moveHandle=function(e){var t=this.getColumnsCenters(),a=t[e];if(this.columnSelectionLineHandle){var i=this.columnSelectionLineHandle;i.select("line").attr({x1:a,x2:a}),i.select("circle").attr({cx:a})}else{var i=this.columnSelectionLineHandle=this.graphicsContext.mainGraphicsContext.append("g");i.append("line").classed("interactive-hover-line",!0).attr({x1:a,x2:a,y1:0,y2:this.height}),i.append("circle").attr({cx:a,cy:this.height,r:"6px"}).classed("drag-handle",!0)}},a.getLayout=function(e,a){var i=a.xScale,r=a.yScale,s=r(0),o=i(0),l=x.getBorderWidth(e.borderSettings),n=function(e){var a=t.AxisHelper.diffScaled(i,e.value,0);return a},c=function(e){var a=o+t.AxisHelper.diffScaled(i,e.originalPosition,0)+l*e.categoryIndex;return a},h=function(e){var a=o+t.AxisHelper.diffScaled(i,e.originalPosition,0)+t.AxisHelper.diffScaled(i,e.value,0)+l*e.categoryIndex;return a};return{shapeLayout:{width:n,x:c,y:function(e){return s+t.AxisHelper.diffScaled(r,e.position,0)},height:function(e){return t.StackedUtil.getSize(r,e.valueAbsolute)}},shapeBorder:{width:function(e){return l},x:h,y:function(e){return s+t.AxisHelper.diffScaled(r,e.position,0)},height:function(e){return t.StackedUtil.getSize(r,e.valueAbsolute)}},shapeLayoutWithoutHighlights:{width:n,x:c,y:function(e){return s+t.AxisHelper.diffScaled(r,e.position,0)},height:function(e){return t.StackedUtil.getSize(r,e.originalValueAbsolute)}},zeroShapeLayout:{width:n,x:c,y:function(e){return s+t.AxisHelper.diffScaled(r,e.position,0)+t.StackedUtil.getSize(r,e.valueAbsolute)},height:function(e){return 0}},shapeXAxis:{width:n,x:c,y:function(e){return s+t.AxisHelper.diffScaled(r,e.position,0)},height:function(e){return t.StackedUtil.getSize(r,e.valueAbsolute)}}}},a.prototype.createMekkoLabelDataPoints=function(){for(var t=[],i=this.data,r=i.series,s=h.createColumnFormatterCacheManager(),o=this.layout.shapeLayout,l=0,n=r.length;n>l;l++){var c=r[l],u=c.labelSettings?c.labelSettings:i.labelSettings;if(u.show&&c.data)for(var d=h.getDisplayUnitValueFromAxisFormatter(this.yProps.formatter,u),p=0;p<c.data.length;p++){var g=c.data[p];if((!i.hasHighlights||g.highlight)&&null!=g.value){var m={left:o.x(g),top:o.y(g),width:o.width(g),height:o.height(g)},y=null,f=g.valueOriginal;u.displayUnits||(y=h.hundredPercentFormat,f=g.valueAbsolute);var v=s.getOrCreate(y,u,d),x=h.getLabelFormattedText(v.format(f)),b={text:x,fontFamily:h.LabelTextProperties.fontFamily,fontSize:h.LabelTextProperties.fontSize,fontWeight:h.LabelTextProperties.fontWeight},S=e.TextMeasurementService.measureSvgTextWidth(b),w=e.TextMeasurementService.estimateSvgTextHeight(b);t.push({isPreferred:!0,text:x,textSize:{width:S,height:w},outsideFill:u.labelColor?u.labelColor:h.defaultLabelColor,insideFill:u.labelColor?u.labelColor:h.defaultInsideLabelColor,isParentRect:!0,parentShape:{rect:m,orientation:1,validPositions:a.validLabelPositions},identity:g.identity,parentType:1})}}}return t},a.classes={item:c("column"),highlightItem:c("highlightColumn")},a.validLabelPositions=[1],a}();a.MekkoColumnChartStrategy=d;var p=function(){function a(e){this.isScrollable=!1,e?(this.type=e.chartType,e.isScrollable&&(this.isScrollable=e.isScrollable),this.animator=e.animator,e.cartesianSmallViewPortProperties&&(this.cartesianSmallViewPortProperties=e.cartesianSmallViewPortProperties),e.behavior&&(this.behavior=e.behavior)):this.behavior=new S([new t.ColumnChartWebBehavior])}return a.getTextProperties=function(e){return void 0===e&&(e=a.FontSize),{fontFamily:"wf_segoe-ui_normal",fontSize:jsCommon.PixelConverter.toString(e)}},a.prototype.init=function(e){this.visualInitOptions=e,this.layers=[];var i=this.element=e.element,r=this.currentViewport=e.viewport;this.hostServices=e.host,this.brush=d3.svg.brush(),i.addClass(a.ClassName),this.margin={top:1,right:1,bottom:1,left:1},this.yAxisOrientation=t.yAxisPosition.left,this.adjustMargins(r),this.sharedColorPalette=new t.SharedColorPalette(e.style.colorPalette.dataColors);var s=!0,o=!0,l=this.svg=d3.select(i.get(0)).append("svg");l.style("position","absolute");var n=this.axisGraphicsContext=l.append("g").classed(a.AxisGraphicsContextClassName,!0);this.svgScrollable=l.append("svg").classed("svgScrollable",!0).style("overflow","hidden");var c=this.axisGraphicsContextScrollable=this.svgScrollable.append("g").classed(a.AxisGraphicsContextClassName,!0);this.labelGraphicsContextScrollable=this.svgScrollable.append("g").classed(h.labelGraphicsContextClass["class"],!0),this.behavior&&(this.clearCatcher=t.appendClearCatcher(this.axisGraphicsContextScrollable));var u=s?c:n;this.xAxisGraphicsContext=s?n.append("g").attr("class","x axis"):c.append("g").attr("class","x axis"),this.y1AxisGraphicsContext=u.append("g").attr("class","y axis"),this.y2AxisGraphicsContext=u.append("g").attr("class","y axis"),this.xAxisGraphicsContext.classed("showLinesOnAxis",s),this.y1AxisGraphicsContext.classed("showLinesOnAxis",o),this.y2AxisGraphicsContext.classed("showLinesOnAxis",o),this.xAxisGraphicsContext.classed("hideLinesOnAxis",!s),this.y1AxisGraphicsContext.classed("hideLinesOnAxis",!o),this.y2AxisGraphicsContext.classed("hideLinesOnAxis",!o),this.behavior&&(this.interactivityService=t.createInteractivityService(this.hostServices)),this.legend=t.createLegend(i,e.interactivity&&e.interactivity.isInteractiveLegend,this.interactivityService,!0)},a.prototype.renderAxesLabels=function(i){this.axisGraphicsContext.selectAll(".xAxisLabel").remove(),this.axisGraphicsContext.selectAll(".yAxisLabel").remove();var r=this.margin,s=i.viewport.width-(r.left+r.right),o=i.viewport.height,l=a.FontSize,n=l,c=this.yAxisOrientation===t.yAxisPosition.right;if(!i.hideXAxisTitle){var h=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(i.axisLabels.x).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"xAxisLabel",transform:t.SVGUtil.translate(s/2,o-n)})})});h.style("fill",i.xLabelColor?i.xLabelColor.solid.color:null),h.call(t.AxisHelper.LabelLayoutStrategy.clip,s,e.TextMeasurementService.svgEllipsis)}if(!i.hideYAxisTitle){var u=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(i.axisLabels.y).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"yAxisLabel",transform:"rotate(-90)",y:c?s+r.right-l:-r.left,x:-((o-r.top-i.legendMargin)/2),dy:"1em"})})});u.style("fill",i.yLabelColor?i.yLabelColor.solid.color:null),u.call(t.AxisHelper.LabelLayoutStrategy.clip,o-(r.bottom+r.top),e.TextMeasurementService.svgEllipsis)}if(!i.hideY2AxisTitle&&i.axisLabels.y2){var d=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(i.axisLabels.y2).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"yAxisLabel",transform:"rotate(-90)",y:c?-r.left:s+r.right-l,x:-((o-r.top-i.legendMargin)/2),dy:"1em"})})});d.style("fill",i.y2LabelColor?i.y2LabelColor.solid.color:null),d.call(t.AxisHelper.LabelLayoutStrategy.clip,o-(r.bottom+r.top),e.TextMeasurementService.svgEllipsis)}},a.prototype.adjustMargins=function(e){var a=this.margin,i=e.width-(a.left+a.right),r=e.height-(a.top+a.bottom),s=this.element.find(".x.axis");0===t.AxisHelper.getRecommendedNumberOfTicksForXAxis(i)&&0===t.AxisHelper.getRecommendedNumberOfTicksForYAxis(r)?(this.margin={top:0,right:0,bottom:0,left:0},s.hide()):s.show()},a.prototype.translateAxes=function(e){this.adjustMargins(e);var i=this.margin,r=e.width-(i.left+i.right),s=e.height-(i.top+i.bottom),o=this.yAxisOrientation===t.yAxisPosition.right;this.xAxisGraphicsContext.attr("transform",t.SVGUtil.translate(0,s)),this.y1AxisGraphicsContext.attr("transform",t.SVGUtil.translate(o?r:0,0)),this.y2AxisGraphicsContext.attr("transform",t.SVGUtil.translate(o?0:r,0)),this.svg.attr({width:e.width,height:e.height}),this.svg.style("top",this.legend.isVisible()?this.legend.getMargins().height+"px":0),this.svgScrollable.attr({width:e.width,height:e.height}),this.svgScrollable.attr({x:0}),this.axisGraphicsContext.attr("transform",t.SVGUtil.translate(i.left,i.top)),this.axisGraphicsContextScrollable.attr("transform",t.SVGUtil.translate(i.left,i.top)),this.labelGraphicsContextScrollable.attr("transform",t.SVGUtil.translate(i.left,i.top)),this.isXScrollBarVisible?(this.svgScrollable.attr({x:this.margin.left}),this.axisGraphicsContextScrollable.attr("transform",t.SVGUtil.translate(0,i.top)),this.labelGraphicsContextScrollable.attr("transform",t.SVGUtil.translate(0,i.top)),this.svgScrollable.attr("width",r),
this.svg.attr("width",e.width).attr("height",e.height+a.ScrollBarWidth)):this.isYScrollBarVisible&&(this.svgScrollable.attr("height",s+i.top),this.svg.attr("width",e.width+a.ScrollBarWidth).attr("height",e.height))},a.getIsScalar=function(a,i,r){var s=e.DataViewObjects.getValue(a,i);return a&&void 0!==s?s===t.axisType.scalar&&!t.AxisHelper.isOrdinal(r):!t.AxisHelper.isOrdinal(r)},a.prototype.populateObjectProperties=function(a){if(a&&a.length>0){var i=a[0].metadata;if(i?(this.legendObjectProperties=e.DataViewObjects.getObject(i.objects,"legend",{}),this.borderObjectProperties=e.DataViewObjects.getObject(i.objects,"columnBorder",{})):(this.legendObjectProperties={},this.borderObjectProperties={}),this.categoryAxisProperties=t.CartesianHelper.getCategoryAxisProperties(i),this.valueAxisProperties=t.CartesianHelper.getValueAxisProperties(i),i&&i.objects){var r=i.objects.categoryAxis,s=i.objects.valueAxis;r&&(this.categoryAxisProperties.showBorder=r.showBorder,this.categoryAxisProperties.fontSize=r.fontSize),s&&(this.valueAxisProperties.fontSize=s.fontSize)}var o=this.valueAxisProperties.position;this.yAxisOrientation=o?o.toString():t.yAxisPosition.left}},a.prototype.update=function(e){var i=this.dataViews=e.dataViews;if(this.currentViewport=e.viewport,i&&!(this.currentViewport.width<a.MinWidth||this.currentViewport.height<a.MinHeight)){0===this.layers.length&&(this.layers=this.createAndInitLayers(i));var s=this.layers;if(i&&i.length>0){var o=t.getInvalidValueWarnings(i,!1,!1,!1);o&&o.length>0&&this.hostServices.setWarnings(o),this.populateObjectProperties(i)}this.sharedColorPalette.clearPreferredScale();for(var l=0,n=s.length;n>l;l++)s[l].setData(r(i,l,n)),n>1&&this.sharedColorPalette.rotateScale();this.visualInitOptions.interactivity&&this.visualInitOptions.interactivity.isInteractiveLegend||this.renderLegend(),this.render(!this.hasSetData||e.suppressAnimations),this.hasSetData=this.hasSetData||i&&i.length>0}},a.parseLabelSettings=function(e){var i=t.dataLabelUtils.getDefaultColumnLabelSettings(!0),r=e.labels,s=a.DefaultSettings.labelSettings.minPrecision,o=a.DefaultSettings.labelSettings.maxPrecision;return t.dataLabelUtils.updateLabelSettingsFromLabelsObject(r,i),i.precision<s&&(i.precision=s),i.precision>o&&(i.precision=o),i},a.parseBorderSettings=function(t){var i=e.DataViewObjects.getValue(t,a.properties.columnBorder.show,a.DefaultSettings.columnBorder.show),r=e.DataViewObjects.getFillColor(t,a.properties.columnBorder.color,a.DefaultSettings.columnBorder.color),s=e.DataViewObjects.getValue(t,a.properties.columnBorder.width,a.DefaultSettings.columnBorder.width),o=a.DefaultSettings.columnBorder.maxWidth;return s>o?s=o:0>s&&(s=0),i||(s=0),{show:i,color:r,width:s}},a.prototype.enumerateBorder=function(t){var i={columnBorder:this.borderObjectProperties},r=e.DataViewObjects.getValue(i,a.properties.columnBorder.show,a.DefaultSettings.columnBorder.show),s=e.DataViewObjects.getFillColor(i,a.properties.columnBorder.color,a.DefaultSettings.columnBorder.color),o=e.DataViewObjects.getValue(i,a.properties.columnBorder.width,a.DefaultSettings.columnBorder.width),l=a.DefaultSettings.columnBorder.maxWidth;o>l?o=l:0>o&&(o=0);var n={objectName:"columnBorder",selector:null,properties:{show:r,color:s,width:o}};t.pushInstance(n)},a.prototype.enumerateObjectInstances=function(a){var i=new t.ObjectEnumerationBuilder,r=this.layers?this.layers.length:0;if("columnBorder"===a.objectName)this.enumerateBorder(i);else if("legend"===a.objectName){if(!this.shouldShowLegendCard())return;var s=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.show,this.legend.isVisible()),o=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.showTitle,!0),l=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.titleText,this.layerLegendData&&this.layerLegendData.title?this.layerLegendData.title:""),n=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.fontSize,this.layerLegendData&&this.layerLegendData.fontSize?this.layerLegendData.fontSize:h.DefaultLabelFontSizeInPt);i.pushInstance({selector:null,properties:{show:s,position:t.LegendPosition[this.legend.getOrientation()],showTitle:o,titleText:l,fontSize:n},objectName:a.objectName})}else"categoryAxis"===a.objectName&&this.hasCategoryAxis?this.getCategoryAxisValues(i):"valueAxis"===a.objectName&&this.getValueAxisValues(i);for(var c=0,u=r;u>c;c++){var d=this.layers[c];d.enumerateObjectInstances&&d.enumerateObjectInstances(i,a)}return i.complete()},a.prototype.shouldShowLegendCard=function(){var e=this.layers,t=this.dataViews;if(e&&t)for(var a=e.length,i=0,r=0;a>r;r++){if(e[r].hasLegend())return!0;var s=t[r];if(s&&s.categorical&&s.categorical.values&&s.categorical.values.length>0&&(i++,i>1))return!0}return!1},a.prototype.getCategoryAxisValues=function(e){var a=t.axisType.both,i=!1,r=!!this.axes.x.isLogScaleAllowed,s=[t.axisScale.log,t.axisScale.linear];this.layers&&this.layers[0].getSupportedCategoryAxisType&&(a=this.layers[0].getSupportedCategoryAxisType(),i=a===t.axisType.scalar?!0:t.CartesianHelper.isScalar(a===t.axisType.both,this.categoryAxisProperties)),i||this.categoryAxisProperties&&(this.categoryAxisProperties.start=null,this.categoryAxisProperties.end=null);var o={selector:null,properties:{},objectName:"categoryAxis",validValues:{axisScale:s}};o.properties.show=this.categoryAxisProperties&&null!=this.categoryAxisProperties.show?this.categoryAxisProperties.show:!0,this.yAxisIsCategorical&&(o.properties.position=this.valueAxisProperties&&null!=this.valueAxisProperties.position?this.valueAxisProperties.position:t.yAxisPosition.left),a===t.axisType.both&&(o.properties.axisType=i?t.axisType.scalar:t.axisType.categorical),i&&(o.properties.axisScale=this.categoryAxisProperties&&null!=this.categoryAxisProperties.axisScale&&r?this.categoryAxisProperties.axisScale:t.axisScale.linear,o.properties.start=this.categoryAxisProperties?this.categoryAxisProperties.start:null,o.properties.end=this.categoryAxisProperties?this.categoryAxisProperties.end:null),o.properties.showAxisTitle=this.categoryAxisProperties&&null!=this.categoryAxisProperties.showAxisTitle?this.categoryAxisProperties.showAxisTitle:!1,o.properties.showBorder=this.categoryAxisProperties&&null!=this.categoryAxisProperties.showBorder?this.categoryAxisProperties.showAxisTitle:!1,o.properties.fontSize=this.categoryAxisProperties&&null!=this.categoryAxisProperties.fontSize?this.categoryAxisProperties.fontSize:h.DefaultLabelFontSizeInPt,e.pushInstance(o).pushInstance({selector:null,properties:{axisStyle:this.categoryAxisProperties&&this.categoryAxisProperties.axisStyle?this.categoryAxisProperties.axisStyle:t.axisStyle.showTitleOnly,labelColor:this.categoryAxisProperties?this.categoryAxisProperties.labelColor:null,fontSize:this.categoryAxisProperties&&null!=this.categoryAxisProperties.fontSize?this.categoryAxisProperties.fontSize:h.DefaultLabelFontSizeInPt},objectName:"categoryAxis",validValues:{axisStyle:this.categoryAxisHasUnitType?[t.axisStyle.showTitleOnly,t.axisStyle.showUnitOnly,t.axisStyle.showBoth]:[t.axisStyle.showTitleOnly]}})},a.prototype.getValueAxisValues=function(e){var a=[t.axisScale.log,t.axisScale.linear],i=!!this.axes.y1.isLogScaleAllowed,r={selector:null,properties:{},objectName:"valueAxis",validValues:{axisScale:a,secAxisScale:a}};r.properties.show=this.valueAxisProperties&&null!=this.valueAxisProperties.show?this.valueAxisProperties.show:!0,this.yAxisIsCategorical||(r.properties.position=this.valueAxisProperties&&null!=this.valueAxisProperties.position?this.valueAxisProperties.position:t.yAxisPosition.left),r.properties.axisScale=this.valueAxisProperties&&null!=this.valueAxisProperties.axisScale&&i?this.valueAxisProperties.axisScale:t.axisScale.linear,r.properties.start=this.valueAxisProperties?this.valueAxisProperties.start:null,r.properties.end=this.valueAxisProperties?this.valueAxisProperties.end:null,r.properties.showAxisTitle=this.valueAxisProperties&&null!=this.valueAxisProperties.showAxisTitle?this.valueAxisProperties.showAxisTitle:!1,r.properties.fontSize=this.valueAxisProperties&&null!=this.valueAxisProperties.fontSize?this.valueAxisProperties.fontSize:h.DefaultLabelFontSizeInPt,e.pushInstance(r).pushInstance({selector:null,properties:{axisStyle:this.valueAxisProperties&&null!=this.valueAxisProperties.axisStyle?this.valueAxisProperties.axisStyle:t.axisStyle.showTitleOnly,labelColor:this.valueAxisProperties?this.valueAxisProperties.labelColor:null,fontSize:this.valueAxisProperties&&null!=this.valueAxisProperties.fontSize?this.valueAxisProperties.fontSize:h.DefaultLabelFontSizeInPt},objectName:"valueAxis",validValues:{axisStyle:this.valueAxisHasUnitType?[t.axisStyle.showTitleOnly,t.axisStyle.showUnitOnly,t.axisStyle.showBoth]:[t.axisStyle.showTitleOnly]}}),2===this.layers.length&&(r.properties.secShow=this.valueAxisProperties&&null!=this.valueAxisProperties.secShow?this.valueAxisProperties.secShow:this.y2AxisExists,r.properties.secShow&&(r.properties.axisLabel=""))},a.prototype.onClearSelection=function(){if(this.hasSetData)for(var e=0,t=this.layers.length;t>e;e++){var a=this.layers[e];a.onClearSelection(),a.render(!0)}},a.prototype.createAndInitLayers=function(t){var a,i=this;if(t&&t.length>0){var r=t[0].metadata;r&&(a=r.objects)}var s=l(this.type,a,this.interactivityService,this.animator,this.isScrollable),o=e.Prototype.inherit(this.visualInitOptions);o.svg=this.axisGraphicsContextScrollable,o.cartesianHost={updateLegend:function(e){return i.legend.drawLegend(e,i.currentViewport)},getSharedColors:function(){return i.sharedColorPalette},triggerRender:void 0};for(var n=0,c=s.length;c>n;n++)s[n].init(o);return s},a.prototype.renderLegend=function(){for(var e=this.layers,a={title:"",dataPoints:[]},i=0,r=e.length;r>i;i++)this.layerLegendData=e[i].calculateLegend(),this.layerLegendData&&(a.title=0===i?this.layerLegendData.title||"":a.title,a.dataPoints=a.dataPoints.concat(this.layerLegendData.dataPoints||[]),this.layerLegendData.grouped&&(a.grouped=!0));var s=this.legendObjectProperties;if(s){s.fontSize||(s.fontSize=h.DefaultLabelFontSizeInPt),t.LegendData.update(a,s);var o=s[t.legendProps.position];o&&this.legend.changeOrientation(t.LegendPosition[o])}else this.legend.changeOrientation(t.LegendPosition.Top);(1===a.dataPoints.length&&!a.grouped||this.hideLegends())&&(a.dataPoints=[]),this.legend.drawLegend(a,this.currentViewport)},a.prototype.hideLegends=function(){return!!(this.cartesianSmallViewPortProperties&&this.cartesianSmallViewPortProperties.hideLegendOnSmallViewPort&&this.currentViewport.height<this.cartesianSmallViewPortProperties.MinHeightLegendVisible)},a.prototype.addUnitTypeToAxisLabel=function(e){var i=a.getUnitType(e,function(e){return e.x});if(e.x.isCategoryAxis?this.categoryAxisHasUnitType=null!==i:this.valueAxisHasUnitType=null!==i,e.x.axisLabel&&i&&(e.x.isCategoryAxis?e.x.axisLabel=t.AxisHelper.createAxisLabel(this.categoryAxisProperties,e.x.axisLabel,i):e.x.axisLabel=t.AxisHelper.createAxisLabel(this.valueAxisProperties,e.x.axisLabel,i)),i=a.getUnitType(e,function(e){return e.y1}),e.y1.isCategoryAxis?this.categoryAxisHasUnitType=null!==i:this.valueAxisHasUnitType=null!==i,e.y1.axisLabel&&i&&(e.y1.isCategoryAxis?e.y1.axisLabel=t.AxisHelper.createAxisLabel(this.categoryAxisProperties,e.y1.axisLabel,i):e.y1.axisLabel=t.AxisHelper.createAxisLabel(this.valueAxisProperties,e.y1.axisLabel,i)),e.y2){var i=a.getUnitType(e,function(e){return e.y2});this.secValueAxisHasUnitType=null!==i,e.y2.axisLabel&&i&&this.valueAxisProperties&&this.valueAxisProperties.secAxisStyle&&(this.valueAxisProperties.secAxisStyle===t.axisStyle.showBoth?e.y2.axisLabel=e.y2.axisLabel+" ("+i+")":this.valueAxisProperties.secAxisStyle===t.axisStyle.showUnitOnly&&(e.y2.axisLabel=i))}},a.prototype.shouldRenderSecondaryAxis=function(e){return e&&(!this.valueAxisProperties||null==this.valueAxisProperties.secShow||this.valueAxisProperties.secShow)?e.values&&e.values.length>0:!1},a.prototype.shouldRenderAxis=function(e,t){return void 0===t&&(t="show"),e?(!e.isCategoryAxis||this.categoryAxisProperties&&null!=this.categoryAxisProperties[t]&&!this.categoryAxisProperties[t])&&(e.isCategoryAxis||this.valueAxisProperties&&null!=this.valueAxisProperties[t]&&!this.valueAxisProperties[t])?!1:e.values&&e.values.length>0:!1},a.prototype.render=function(r){var s=this.legendMargins=this.legend.getMargins(),l={height:this.currentViewport.height-s.height,width:this.currentViewport.width-s.width},n=this.getMaxMarginFactor(),c=this.leftRightMarginLimit=l.width*n;this.bottomMarginLimit=Math.max(a.MinBottomMargin,Math.ceil(l.height*n));var h=a.getTextProperties(parseFloat(this.categoryAxisProperties.fontSize)||void 0),u=a.getTextProperties(parseFloat(this.valueAxisProperties.fontSize)||void 0),d=this.margin;d.top=parseFloat(u.fontSize)/2,d.bottom=a.MinBottomMargin,d.right=0;var p=this.axes=o(this.layers,l,d,this.categoryAxisProperties,this.valueAxisProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,null);this.yAxisIsCategorical=p.y1.isCategoryAxis,this.hasCategoryAxis=this.yAxisIsCategorical?p.y1&&p.y1.values.length>0:p.x&&p.x.values.length>0;var g,m,y=this.shouldRenderAxis(p.x),f=this.shouldRenderAxis(p.y1),v=this.shouldRenderSecondaryAxis(p.y2),x=l.width-(d.left+d.right),b=!1;this.isXScrollBarVisible=!1,this.isYScrollBarVisible=!1;var S=this.yAxisOrientation,w=S===t.yAxisPosition.right;if(this.layers&&(this.layers[0].getVisualCategoryAxisIsScalar&&(b=this.layers[0].getVisualCategoryAxisIsScalar()),!b&&this.isScrollable&&this.layers[0].getPreferredPlotArea)){var C=this.scrollX?p.x.categoryThickness:p.y1.categoryThickness,D=this.scrollX?p.x.values.length:p.y1.values.length;m=this.layers[0].getPreferredPlotArea(b,D,C),this.scrollX&&m&&m.width>l.width&&(this.isXScrollBarVisible=!0,l.height-=a.ScrollBarWidth),this.scrollY&&m&&m.height>l.height&&(this.isYScrollBarVisible=!0,l.width-=a.ScrollBarWidth,x=l.width-(d.left+d.right))}this.isXScrollBarVisible||this.isYScrollBarVisible?this.brushGraphicsContext||(this.brushGraphicsContext=this.svg.append("g").classed("x brush",!0)):(this.svg.selectAll(".brush").remove(),this.brushGraphicsContext=void 0),p=o(this.layers,l,d,this.categoryAxisProperties,this.valueAxisProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,null);for(var P=!1,A=2,N=0,T=void 0,V=void 0,L=void 0;!P&&A>N;){N++,T=i({width:x,height:l.height},c,e.TextMeasurementService.measureSvgTextWidth,e.TextMeasurementService.estimateSvgTextHeight,p,this.bottomMarginLimit,h,u,null,!1,this.isXScrollBarVisible||this.isYScrollBarVisible,w,y,f,v);var M=w?T.yRight:T.yLeft,k=w?T.yLeft:T.yRight,j=y?T.xMax/1.8:0;M+=a.LeftPadding,k+=a.RightPadding,j+=a.BottomPadding,this.hideAxisLabels(s)&&(p.x.axisLabel=null,p.y1.axisLabel=null,p.y2&&(p.y2.axisLabel=null)),this.addUnitTypeToAxisLabel(p),L={x:p.x.axisLabel,y:p.y1.axisLabel,y2:p.y2?p.y2.axisLabel:null},V=null!=L.x||null!=L.y||null!=L.y2,null!=L.x&&(j+=a.XAxisLabelPadding),null!=L.y&&(M+=a.YAxisLabelPadding),null!=L.y2&&(k+=a.YAxisLabelPadding),d.left=w?k:M,d.right=w?M:k,d.bottom=j,this.margin=d,x=l.width-(d.left+d.right);var I=p.y1.values.length,O=p.y2&&p.y2.values.length;p=o(this.layers,l,d,this.categoryAxisProperties,this.valueAxisProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,p),p.y1.values.length!==I||p.y2&&p.y2.values.length!==O||(P=!0)}this.renderChart(g,p,x,T,V,L,l,r)},a.prototype.hideAxisLabels=function(e){return!(!(this.cartesianSmallViewPortProperties&&this.cartesianSmallViewPortProperties.hideAxesOnSmallViewPort&&this.currentViewport.height+e.height<this.cartesianSmallViewPortProperties.MinHeightAxesVisible)||this.visualInitOptions.interactivity.isInteractiveLegend)},a.getUnitType=function(e,t){return t(e).formatter&&t(e).formatter.displayUnit&&t(e).formatter.displayUnit.value>1?t(e).formatter.displayUnit.title:null},a.prototype.getMaxMarginFactor=function(){return this.visualInitOptions.style.maxMarginFactor||a.MaxMarginFactor},a.getChartViewport=function(e,t){return{width:e.width-t.left-t.right,height:e.height-t.top-t.bottom}},a.wordBreak=function(t,a,i,r,s){t.each(function(t,s){var o,l,n=d3.select(this);i.length>=s?(o=i[s],l=a.scale(o)):l=a.xLabelMaxWidth,n.style("text-anchor","middle").attr({dx:"0em",dy:"1em",transform:"rotate(0)"}),e.TextMeasurementService.wordBreak(this,l,a.willLabelsWordBreak?r:0)})},a.prototype.renderChart=function(i,r,s,o,l,n,c,u,d,p){var g,m,y,f,v,x=this.bottomMarginLimit,b=this.leftRightMarginLimit,S=this.layers,w=t.AnimatorCommon.GetAnimationDuration(this.animator,u),C=a.getChartViewport(c,this.margin);if(this.shouldRenderAxis(r.x)){r.x.isCategoryAxis?(g=this.categoryAxisProperties&&this.categoryAxisProperties.labelColor?this.categoryAxisProperties.labelColor:null,f=this.categoryAxisProperties&&null!=this.categoryAxisProperties.fontSize?this.categoryAxisProperties.fontSize:h.DefaultLabelFontSizeInPt):(g=this.valueAxisProperties&&this.valueAxisProperties.labelColor?this.valueAxisProperties.labelColor:null,f=this.valueAxisProperties&&this.valueAxisProperties.fontSize?this.valueAxisProperties.fontSize:h.DefaultLabelFontSizeInPt),r.x.axis.orient("bottom"),r.x.willLabelsFit||r.x.axis.tickPadding(a.TickPaddingRotatedX);var D=this.xAxisGraphicsContext;w?D.transition().duration(w).call(r.x.axis):D.call(r.x.axis),D.call(a.darkenZeroLine).call(a.setAxisLabelColor,g).call(a.setAxisLabelFontSize,f);var P=D.selectAll("text"),A=[],N=0;this.layers&&this.layers.length&&(A=this.layers[0].getColumnsWidth(),N=this.layers[0].getBorderWidth()),D.call(a.moveBorder,r.x.scale,N,f/2-8),P.call(a.wordBreak,r.x,A,x,N)}else this.xAxisGraphicsContext.selectAll("*").remove();if(this.shouldRenderAxis(r.y1)){r.y1.isCategoryAxis?(m=this.categoryAxisProperties&&this.categoryAxisProperties.labelColor?this.categoryAxisProperties.labelColor:null,v=this.categoryAxisProperties&&null!=this.categoryAxisProperties.fontSize?this.categoryAxisProperties.fontSize:h.DefaultLabelFontSizeInPt):(m=this.valueAxisProperties&&this.valueAxisProperties.labelColor?this.valueAxisProperties.labelColor:null,v=this.valueAxisProperties&&null!=this.valueAxisProperties.fontSize?this.valueAxisProperties.fontSize:h.DefaultLabelFontSizeInPt);var T=this.yAxisOrientation,V=T===t.yAxisPosition.right;r.y1.axis.tickSize(-s).tickPadding(a.TickPaddingY).orient(T.toLowerCase());var L=this.y1AxisGraphicsContext;w?L.transition().duration(w).call(r.y1.axis):L.call(r.y1.axis),L.call(a.darkenZeroLine).call(a.setAxisLabelColor,m).call(a.setAxisLabelFontSize,v),o.yLeft>=b&&L.selectAll("text").call(t.AxisHelper.LabelLayoutStrategy.clip,b-a.LeftPadding,e.TextMeasurementService.svgEllipsis),!r.y2||this.valueAxisProperties&&null!=this.valueAxisProperties.secShow&&!this.valueAxisProperties.secShow?this.y2AxisGraphicsContext.selectAll("*").remove():(y=this.valueAxisProperties&&this.valueAxisProperties.secLabelColor?this.valueAxisProperties.secLabelColor:null,r.y2.axis.tickPadding(a.TickPaddingY).orient(V?t.yAxisPosition.left.toLowerCase():t.yAxisPosition.right.toLowerCase()),w?this.y2AxisGraphicsContext.transition().duration(w).call(r.y2.axis):this.y2AxisGraphicsContext.call(r.y2.axis),this.y2AxisGraphicsContext.call(a.darkenZeroLine).call(a.setAxisLabelColor,y),o.yRight>=b&&this.y2AxisGraphicsContext.selectAll("text").call(t.AxisHelper.LabelLayoutStrategy.clip,b-a.RightPadding,e.TextMeasurementService.svgEllipsis))}else this.y1AxisGraphicsContext.selectAll("*").remove(),this.y2AxisGraphicsContext.selectAll("*").remove();if(l){var M=!this.shouldRenderAxis(r.x,"showAxisTitle"),k=!this.shouldRenderAxis(r.y1,"showAxisTitle"),j=this.valueAxisProperties&&null!=this.valueAxisProperties.secShowAxisTitle&&this.valueAxisProperties.secShowAxisTitle===!1,I={axisLabels:n,legendMargin:this.legendMargins.height,viewport:c,hideXAxisTitle:M,hideYAxisTitle:k,hideY2AxisTitle:j,xLabelColor:g,yLabelColor:m,y2LabelColor:y,margin:void 0};this.renderAxesLabels(I)}else this.axisGraphicsContext.selectAll(".xAxisLabel").remove(),this.axisGraphicsContext.selectAll(".yAxisLabel").remove();this.translateAxes(c);var O=[],G=[],F=[];if(this.behavior){for(var R=0,z=S.length;z>R;R++){var B=S[R].render(u);if(B)if(O=O.concat(B.dataPoints),G.push(B.behaviorOptions),B.labelDataPointGroups)for(var H=B.labelDataPointGroups,E=0,W=H.length;W>E;E++){var U=H[E];F.push({labelDataPoints:U.labelDataPoints,maxNumberOfLabels:U.maxNumberOfLabels})}else{var _=B.labelDataPoints,Y=_;F.push({labelDataPoints:Y,maxNumberOfLabels:Y.length})}}var K={maximumOffset:h.maxLabelOffset,startingOffset:h.startingLabelOffset},X=new e.LabelLayout(K),q=X.layout(F,C);if(S.length>1&&h.drawLabelBackground(this.labelGraphicsContextScrollable,q,"#FFFFFF",.7),this.animator&&!u?h.animateDefaultLabels(this.labelGraphicsContextScrollable,q,this.animator.getDuration()):h.drawDefaultLabels(this.labelGraphicsContextScrollable,q),this.labelGraphicsContextScrollable.selectAll("text.label").style("pointer-events","none"),this.interactivityService){var Z={layerOptions:G,clearCatcher:this.clearCatcher};this.interactivityService.bind(O,this.behavior,Z)}}},a.darkenZeroLine=function(e){var t=e.selectAll("g.tick").filter(function(e){return 0===e}).node();t&&d3.select(t).select("line").classed("zero-line",!0)},a.setAxisLabelColor=function(e,t){e.selectAll("g.tick text").style("fill",t?t.solid.color:null)},a.setAxisLabelFontSize=function(e,t){var a=jsCommon.PixelConverter.toString(t);e.selectAll("g.tick text").attr("font-size",a)},a.moveBorder=function(e,a,i,r){void 0===r&&(r=0),e.selectAll("g.tick").attr("transform",function(e,s){return t.SVGUtil.translate(a(e)+i*s,r)})},a.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:"Category"},{name:"Series",kind:e.VisualDataRoleKind.Grouping,displayName:"Series"},{name:"Y",kind:e.VisualDataRoleKind.Measure,displayName:"Y Axis"},{name:"Width",kind:e.VisualDataRoleKind.Measure,displayName:"Axis width"}],objects:{columnBorder:{displayName:"Column Border",properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_LabelsFill"),description:e.data.createDisplayNameGetter("Visual_LabelsFillDescription"),type:{fill:{solid:{color:!0}}}},width:{displayName:"Width",type:{numeric:!0}}}},labels:{displayName:e.data.createDisplayNameGetter("Visual_DataPointsLabels"),description:e.data.createDisplayNameGetter("Visual_DataPointsLabelsDescription"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},showSeries:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_LabelsFill"),description:e.data.createDisplayNameGetter("Visual_LabelsFillDescription"),type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:e.data.createDisplayNameGetter("Visual_DisplayUnits"),description:e.data.createDisplayNameGetter("Visual_DisplayUnitsDescription"),type:{formatting:{labelDisplayUnits:!0}},suppressFormatPainterCopy:!0},labelPrecision:{displayName:e.data.createDisplayNameGetter("Visual_Precision"),description:e.data.createDisplayNameGetter("Visual_PrecisionDescription"),placeHolderText:e.data.createDisplayNameGetter("Visual_Precision_Auto"),type:{numeric:!0},suppressFormatPainterCopy:!0},showAll:{displayName:e.data.createDisplayNameGetter("Visual_ShowAll"),type:{bool:!0}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},legend:{displayName:e.data.createDisplayNameGetter("Visual_Legend"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_LegendPosition"),type:{formatting:{legendPosition:!0}}},showTitle:{displayName:e.data.createDisplayNameGetter("Visual_LegendShowTitle"),type:{bool:!0}},titleText:{displayName:"Title text",type:{text:!0}},fontSize:{displayName:"Text size",type:{formatting:{fontSize:!0}}}}},categoryAxis:{displayName:e.data.createDisplayNameGetter("Visual_XAxis"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_YAxis_Position"),type:{formatting:{yAxisPosition:!0}}},axisScale:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Scale"),type:{formatting:{axisScale:!0}}},axisType:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Type"),type:{formatting:{axisType:!0}}},showAxisTitle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Title"),type:{bool:!0}},axisStyle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Style"),type:{formatting:{axisStyle:!0}}},labelColor:{displayName:e.data.createDisplayNameGetter("Visual_Axis_LabelColor"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},valueAxis:{displayName:e.data.createDisplayNameGetter("Visual_YAxis"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_YAxis_Position"),type:{formatting:{yAxisPosition:!0}}},axisScale:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Scale"),type:{formatting:{axisScale:!0}}},intersection:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Intersection"),type:{numeric:!0}},showAxisTitle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Title"),type:{bool:!0}},axisStyle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Style"),type:{formatting:{axisStyle:!0}}},labelColor:{displayName:e.data.createDisplayNameGetter("Visual_Axis_LabelColor"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},dataPoint:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint"),properties:{defaultColor:{displayName:e.data.createDisplayNameGetter("Visual_DefaultColor"),type:{fill:{solid:{color:!0}}}},showAllDataPoints:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint_Show_All"),type:{bool:!0}},fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},fillRule:{displayName:e.data.createDisplayNameGetter("Visual_Gradient"),type:{fillRule:{}},rule:{inputRole:"Gradient",output:{property:"fill",selector:["Category"]}}}}}},dataViewMappings:[{conditions:[{Category:{min:0,max:1},Series:{min:0,max:1},Y:{min:0,max:1},Width:{min:0,max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{group:{by:"Series",select:[{"for":{"in":"Y"}},{"for":{"in":"Width"}}],dataReductionAlgorithm:{top:{}}}},rowCount:{preferred:{min:1,max:1},supported:{min:0}}}}],supportsHighlight:!0,sorting:{"default":{}},drilldown:{roles:["Category"]}},a.properties={general:{formatString:{objectName:"general",propertyName:"formatString"}},columnBorder:{show:{objectName:"columnBorder",propertyName:"show"},color:{objectName:"columnBorder",propertyName:"color"},width:{objectName:"columnBorder",propertyName:"width"}}},a.DefaultSettings={columnBorder:{show:!0,color:"#fff",width:2,maxWidth:5},labelSettings:{maxPrecision:4,minPrecision:0}},a.MinOrdinalRectThickness=20,a.MinScalarRectThickness=2,a.OuterPaddingRatio=.4,a.InnerPaddingRatio=.2,a.TickLabelPadding=2,a.ClassName="cartesianChart",a.AxisGraphicsContextClassName="axisGraphicsContext",a.MaxMarginFactor=.25,a.MinBottomMargin=50,a.LeftPadding=10,a.RightPadding=10,a.BottomPadding=16,a.YAxisLabelPadding=20,a.XAxisLabelPadding=20,a.TickPaddingY=10,a.TickPaddingRotatedX=5,a.FontSize=11,a.MaxNumberOfLabels=100,a.MinWidth=100,a.MinHeight=100,a.ScrollBarWidth=10,a}();a.MekkoChart=p,a.createLayers=l;var g=jsCommon.EnumExtensions,m=jsCommon.ArrayExtensions,y=2,f=16,v={category:"Category",series:"Series",y:"Y",width:"Width"},x=function(){function a(e){var t=e.chartType;this.chartType=t,this.categoryAxisType=null,this.animator=e.animator,this.isScrollable=e.isScrollable,this.interactivityService=e.interactivityService}return a.prototype.init=function(e){this.svg=e.svg,this.unclippedGraphicsContext=this.svg.append("g").classed("columnChartUnclippedGraphicsContext",!0),this.mainGraphicsContext=this.unclippedGraphicsContext.append("svg").classed("columnChartMainGraphicsContext",!0),this.labelGraphicsContext=this.svg.append("g").classed(h.labelGraphicsContextClass["class"],!0),this.style=e.style,this.currentViewport=e.viewport,this.hostService=e.host,this.interactivity=e.interactivity,this.colors=this.style.colorPalette.dataColors,this.cartesianVisualHost=e.cartesianHost,this.options=e,this.supportsOverflow=!g.hasFlag(this.chartType,f);var t=this.element=e.element;t.addClass(a.ColumnChartClassName),this.columnChart=new d},a.prototype.getCategoryLayout=function(e,a){var i=this.currentViewport.width-(this.margin.left+this.margin.right),r=this.data?this.data.categoryMetadata:void 0,s=t.AxisHelper.getCategoryValueType(r),o=this.data?this.data.scalarCategoryAxis:!1,l=t.AxisHelper.createDomain(this.data.series,s,o,a.forcedXDomain);return t.CartesianChart.getLayout(this.data,{availableWidth:i,categoryCount:e,domain:l,isScalar:o,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:!1})},a.getBorderWidth=function(e){if(!e||!e.show||!e.width)return 0;var t=e.width;return 0>t?0:t>e.maxWidth?e.maxWidth:t},a.getBorderColor=function(e){return e?e.color:p.DefaultSettings.columnBorder.color},a.converter=function(i,r,s,o,l,n,c){void 0===s&&(s=!1),void 0===o&&(o=!1),void 0===l&&(l=!1),void 0===n&&(n=null);var h=t.CartesianHelper.getCategoryAxisProperties(n),u=t.CartesianHelper.getValueAxisProperties(n);o=t.CartesianHelper.isScalar(o,h),i=t.ColumnUtil.applyUserMinMax(o,i,h);var d=new b(i),g=t.converterHelper.getPivotedCategories(i,t.columnChartProps.general.formatString),m=g.categories,y=g.categoryFormatter,f=g.categoryIdentities,x=i.categories&&i.categories.length>0?i.categories[0].source:void 0,S=p.DefaultSettings.columnBorder,w=t.dataLabelUtils.getDefaultColumnLabelSettings(!0),C=void 0,D=void 0;if(n&&n.objects){var P=n.objects;C=e.DataViewObjects.getFillColor(P,t.columnChartProps.dataPoint.defaultColor),D=e.DataViewObjects.getValue(P,t.columnChartProps.dataPoint.showAllDataPoints),w=p.parseLabelSettings(P),S=p.parseBorderSettings(P)}for(var A=d.getLegend(r,C),N=A.legend.dataPoints,T=A.seriesSources,V=a.createDataPoints(i,m,f,N,A.seriesObjects,d,w,s,o,l,t.converterHelper.categoryIsAlsoSeriesRole(i,v.series,v.category),g.categoryObjects,C,c,x),L=V.series,M=[],k=0,j=N.length;j>k;k++)M.push(T[k]);var I=t.converterHelper.createAxesLabels(h,u,x,M);return{categories:m,categoriesWidth:V.categoriesWidth,categoryFormatter:y,series:L,valuesMetadata:M,legendData:A.legend,hasHighlights:V.hasHighlights,categoryMetadata:x,scalarCategoryAxis:o,borderSettings:S,labelSettings:w,axesLabels:{x:I.xAxisLabel,y:I.yAxisLabel},hasDynamicSeries:V.hasDynamicSeries,defaultDataPointColor:C,showAllDataPoints:D,isMultiMeasure:!1}},a.getStackedMultiplier=function(e,a,i,r){for(var s=0,o=0,l=0;i>l;l++){var n=e[l][a];n=t.AxisHelper.normalizeNonFiniteNumber(n),n>0?s+=n:0>n&&(o-=n)}var c=s+o;return{pos:s?s/c/s:1,neg:o?o/c/o:1}},a.createDataPoints=function(i,r,s,o,l,n,c,h,u,d,p,m,y,x,b){void 0===h&&(h=!1),void 0===u&&(u=!1),void 0===d&&(d=!1);var S=i&&i.values?i.values.grouped():void 0,w=r.length,C=o.length,D=[];if(1>C||1>w||null===r[0])return{series:D,hasHighlights:!1,hasDynamicSeries:!1,categoriesWidth:[]};var P=i.categories;b=P&&P.length>0?P[0].source:null;var A=t.AxisHelper.getCategoryValueType(b),N=t.AxisHelper.isDateTime(A),T=[],V=[],L=[],M=[],k=!(!i.values||!i.values.source),j=[],I=-1,O=0,G=!1,F=n.hasHighlightValues(0);for(O=0;O<i.values.length;O++)if(i.values[O].source.roles&&i.values[O].source.roles[v.width]&&!i.values[O].source.roles[v.y]){I=O;for(var R=i.values[O].values,z=0,B=R.length;B>z;z++)j[z]=d3.sum([0,j[z],R[z]])}else{for(var H=[],E=[],W=0;w>W;W++){var U=n.getValueBySeriesAndCategory(O,W);if(H[W]=U,F){var _=n.getHighlightBySeriesAndCategory(O,W);E[W]=_,U>=0&&_>=0&&U>=_||0>=U&&0>=_&&_>=U||(G=!0)}}
L.push(H),F&&M.push(E)}if(G&&!d&&(G=!1,F=!1,L=M),j.length<1)for(O=0;O<i.values.length;O++)if(i.values[O].source.roles&&i.values[O].source.roles[v.width]){I=O;for(var R=i.values[O].values,z=0,B=R.length;B>z;z++)j[z]=d3.sum([0,j[z],R[z]])}else;if(j.length<1)for(O=0;w>O;O++)j.push(1);var Y=d3.sum(j),K=d3.scale.linear().domain([0,Y]).range([0,1]),X=[0],q=[];for(O=0;w-1>O;O++){var Z=X[X.length-1]+(j[O]||0);X.push(Z)}for(O=0;w>O;O++)X[O]=K(X[O]),q[O]=K(j[O]);var Q=m,$=t.columnChartProps.general.formatString;for(O=0;C>O;O++){var J,ee=[],te=o[O];if(!k){var ae=S&&S.length>0&&S[0].values?S[0].values[O]:null,ie=ae&&ae.source&&ae.source.objects?ae.source.objects.labels:null;ie&&(J=e.Prototype.inherit(c),t.dataLabelUtils.updateLabelSettingsFromLabelsObject(ie,J))}var re={displayName:te.label,key:"series"+O,index:O,data:ee,identity:te.identity,color:te.color,labelSettings:J};C>1&&(Q=l[O]);for(var se=i.values[O].source,W=0;w>W;W++){0===O&&(T.push(0),V.push(0));var U=t.AxisHelper.normalizeNonFiniteNumber(L[O][W]);if(!(null==U&&O>0)){var oe=U,le=r[W];if(N&&le&&(le=le.getTime()),!u||null!=le&&!isNaN(le)){var ne;h&&(ne=a.getStackedMultiplier(L,W,C,w));var ce=U,he=0>U;ne&&(U*=he?ne.neg:ne.pos);var ue,de=Math.abs(U);he?(ue=V[W],isNaN(de)||(V[W]-=de)):(isNaN(de)||(T[W]+=de),ue=T[W]);var pe=S&&S.length>O&&S[O].values?S[O]:null,ge=i.categories&&i.categories.length>0?i.categories[0]:null,me=t.SelectionIdBuilder.builder().withCategory(ge,W).withSeries(i.values,pe).withMeasure(n.getMeasureNameByIndex(O)).createSelectionId(),ye=r[W],fe=a.getDataPointColor(te,W,Q),ve=[];if(pe){var xe={values:[],source:i.values.source};ve.push({value:pe.name,metadata:xe});for(var be=0;be<pe.values.length;be++){var Se=pe.values[be];ve.push({value:Se.values[W],metadata:Se})}}var we=t.TooltipBuilder.createTooltipInfo($,null,ye,oe,[ge],ve,null,W),Ce=re&&re.labelSettings?re.labelSettings:c,De=Ce.labelColor,Pe=void 0;g.hasFlag(x,f)&&(Pe=this.getStackedLabelColor(he,O,C,W,L),De=Pe||O===C-1&&!he?De:t.dataLabelUtils.defaultInsideLabelColor),U=q[W];var Ae=X[W],Ne={categoryValue:le,value:U,position:ue,valueAbsolute:de,valueOriginal:ce,seriesIndex:O,labelSettings:Ce,categoryIndex:W,color:fe,selected:!1,originalValue:U,originalPosition:Ae,originalValueAbsolute:de,identity:me,key:me.getKey(),tooltipInfo:we,labelFill:De,labelFormatString:se.format,lastSeries:Pe,chartType:x};if(ee.push(Ne),F){var Te=M[O][W],Ve=Te,Le=!0;null===Te&&(Te=0,Le=!1),h&&(Te*=ne.pos);var Me=Math.abs(Te),ke=ue;Te>0?ke-=de-Me:0===Te&&U>0&&(ke-=de);var je=t.SelectionId.createWithHighlight(me),ye=r[W];Le&&(Ne.tooltipInfo=we);var Ie={categoryValue:le,value:U,position:ke,valueAbsolute:Me,valueOriginal:Ve,seriesIndex:O,labelSettings:Ce,categoryIndex:W,color:fe,selected:!1,highlight:!0,originalValue:U,originalPosition:Ae,originalValueAbsolute:de,drawThinner:G,identity:je,key:je.getKey(),tooltipInfo:we,labelFormatString:se.format,labelFill:De,lastSeries:Pe,chartType:x};ee.push(Ie)}}}}D.push(re)}return{series:D,categoriesWidth:q,hasHighlights:F,hasDynamicSeries:k}},a.getDataPointColor=function(a,i,r){if(r){var s=e.DataViewObjects.getFillColor(r[i],t.columnChartProps.dataPoint.fill);if(s)return s}return a.color},a.getStackedLabelColor=function(e,a,i,r,s){for(var o=!(e&&a===i-1&&1!==i),l=a+1;i>l;l++){var n=t.AxisHelper.normalizeNonFiniteNumber(s[l][r]);if(null!==n&&((!e||e&&0===a)&&n>0||e&&0!==a)){o=!1;break}}return o},a.sliceSeries=function(t,a,i){void 0===i&&(i=0);var r=[];if(t&&t.length>0)for(var s=0,o=t.length;o>s;s++){var l=r[s]=e.Prototype.inherit(t[s]);l.data=t[s].data.filter(function(e){return e.categoryIndex>=i&&e.categoryIndex<a})}return r},a.getInteractiveColumnChartDomElement=function(e){return e.children("svg").get(0)},a.prototype.getColumnsWidth=function(){var e=this.data;return e&&e.series&&e.series[0]&&e.series[0].data?e.categoriesWidth:[]},a.prototype.getBorderWidth=function(){return a.getBorderWidth(this.data.borderSettings)},a.prototype.setData=function(e){var i=!0;if(this.data={categories:[],categoriesWidth:[],categoryFormatter:null,series:[],valuesMetadata:[],legendData:null,hasHighlights:!1,categoryMetadata:null,scalarCategoryAxis:!1,borderSettings:null,labelSettings:t.dataLabelUtils.getDefaultColumnLabelSettings(i),axesLabels:{x:null,y:null},hasDynamicSeries:!1,defaultDataPointColor:null,isMultiMeasure:!1},e.length>0){var r=e[0];if(r&&r.categorical){var s=this.dataViewCat=r.categorical;this.data=a.converter(s,this.cartesianVisualHost.getSharedColors(),!0,!1,this.supportsOverflow,r.metadata,this.chartType);for(var o=this.data.series,l=0,n=o.length;n>l;l++){var c=o[l];this.interactivityService&&this.interactivityService.applySelectionStateToData(c.data)}}}},a.prototype.calculateLegend=function(){if(this.interactivity&&this.interactivity.isInteractiveLegend)return this.createInteractiveMekkoLegendDataPoints(0);var e=this.data?this.data.legendData:null,t=e?e.dataPoints:[];return m.isUndefinedOrEmpty(t)?null:e},a.prototype.hasLegend=function(){return this.data&&(this.data.hasDynamicSeries||this.data.series&&this.data.series.length>1)},a.prototype.enumerateObjectInstances=function(e,a){switch(a.objectName){case"dataPoint":t.GradientUtils.hasGradientRole(this.dataViewCat)||this.enumerateDataPoints(e);break;case"labels":this.enumerateDataLabels(e)}},a.prototype.enumerateDataLabels=function(e){var a=this.data,i=this.data.labelSettings,r=a.series.length;if(t.dataLabelUtils.enumerateDataLabels(this.getLabelSettingsOptions(e,i,!1)),0!==r&&!a.hasDynamicSeries&&(r>1||!a.categoryMetadata))for(var s=0;r>s;s++){var o=a.series[s],i=o.labelSettings?o.labelSettings:this.data.labelSettings;t.dataLabelUtils.enumerateDataLabels(this.getLabelSettingsOptions(e,i,!0,o))}},a.prototype.getLabelSettingsOptions=function(e,t,a,i){var r=!0;return{enumeration:e,dataLabelsSettings:t,show:!a,displayUnits:r,precision:!0,selector:i&&i.identity?i.identity.getSelector():null}},a.prototype.enumerateDataPoints=function(e){var a=this.data;if(a&&a.series){var i=a.series.length;if(0!==i)if(a.hasDynamicSeries||i>1||!a.categoryMetadata)for(var r=0;i>r;r++){var s=a.series[r];e.pushInstance({objectName:"dataPoint",displayName:s.displayName,selector:t.ColorHelper.normalizeSelector(s.identity.getSelector()),properties:{fill:{solid:{color:s.color}}}})}else{var o=a.series[0].data,l=a.categoryFormatter;e.pushInstance({objectName:"dataPoint",selector:null,properties:{defaultColor:{solid:{color:a.defaultDataPointColor||this.colors.getColorByIndex(0).value}}}}).pushInstance({objectName:"dataPoint",selector:null,properties:{showAllDataPoints:!!a.showAllDataPoints}});for(var r=0;r<o.length;r++){var n=o[r],c=a.categories[r];e.pushInstance({objectName:"dataPoint",displayName:l?l.format(c):c,selector:t.ColorHelper.normalizeSelector(n.identity.getSelector(),!0),properties:{fill:{solid:{color:n.color}}}})}}}},a.prototype.calculateAxesProperties=function(e){var a=this.data;this.currentViewport=e.viewport;var i=this.margin=e.margin,r=a&&a.categories?a.categories.length:0,s=a?this.getCategoryLayout(r,e):{categoryCount:0,categoryThickness:t.CartesianChart.MinOrdinalRectThickness,outerPaddingRatio:t.CartesianChart.OuterPaddingRatio,isScalar:!1};this.categoryAxisType=s.isScalar?t.axisType.scalar:null,this.columnChart.setData(a);var o=this.getPreferredPlotArea(s.isScalar,s.categoryCount,s.categoryThickness);o.width===this.currentViewport.width&&(o.width-=i.left+i.right),o.height-=i.top+i.bottom;var l=!0,n={height:o.height,width:o.width,duration:0,hostService:this.hostService,unclippedGraphicsContext:this.unclippedGraphicsContext,mainGraphicsContext:this.mainGraphicsContext,labelGraphicsContext:this.labelGraphicsContext,margin:this.margin,layout:s,animator:this.animator,interactivityService:this.interactivityService,viewportHeight:this.currentViewport.height-(i.top+i.bottom),viewportWidth:this.currentViewport.width-(i.left+i.right),is100Pct:l,isComboChart:!0};this.ApplyInteractivity(n),this.columnChart.setupVisualProps(n);var c=g.hasFlag(this.chartType,y);if(c){var h=e.forcedXDomain;e.forcedXDomain=e.forcedYDomain,e.forcedYDomain=h}return this.xAxisProperties=this.columnChart.setXScale(l,e.forcedTickCount,e.forcedXDomain,c?e.valueAxisScaleType:e.categoryAxisScaleType),this.yAxisProperties=this.columnChart.setYScale(l,e.forcedTickCount,e.forcedYDomain,c?e.categoryAxisScaleType:e.valueAxisScaleType),e.showCategoryAxisLabel&&this.xAxisProperties.isCategoryAxis||e.showValueAxisLabel&&!this.xAxisProperties.isCategoryAxis?this.xAxisProperties.axisLabel=a.axesLabels.x:this.xAxisProperties.axisLabel=null,e.showValueAxisLabel&&!this.yAxisProperties.isCategoryAxis||e.showCategoryAxisLabel&&this.yAxisProperties.isCategoryAxis?this.yAxisProperties.axisLabel=a.axesLabels.y:this.yAxisProperties.axisLabel=null,[this.xAxisProperties,this.yAxisProperties]},a.prototype.getPreferredPlotArea=function(e,a,i){var r={height:this.currentViewport.height,width:this.currentViewport.width};if(this.isScrollable&&!e){var s=t.CartesianChart.getPreferredCategorySpan(a,i);g.hasFlag(this.chartType,y)?r.height=Math.max(s,r.height):r.width=Math.max(s,r.width)}return r},a.prototype.ApplyInteractivity=function(e){var a=this,i=this.interactivity;if(i&&(i.dragDataPoint&&(e.onDragStart=function(e){e.identity&&a.hostService.onDragStart({event:d3.event,data:{data:e.identity.getSelector()}})}),i.isInteractiveLegend)){var r=function(){var e=d3.mouse(a.mainGraphicsContext[0][0]),t=e[0],i=e[1],r=a.columnChart.getClosestColumnIndex(t,i);a.selectColumn(r)},s=t.ColumnChart.getInteractiveColumnChartDomElement(this.element);this.svg.on("click",r),d3.select(s).on("click",r);var o=d3.behavior.drag().origin(Object).on("drag",r);this.svg.call(o),d3.select(s).call(o)}},a.prototype.selectColumn=function(e,t){if(void 0===t&&(t=!1),t||this.lastInteractiveSelectedColumnIndex!==e){var a=this.createInteractiveMekkoLegendDataPoints(e),i=a.dataPoints;this.cartesianVisualHost.updateLegend(a),i.length>0&&this.columnChart.selectColumn(e,this.lastInteractiveSelectedColumnIndex),this.lastInteractiveSelectedColumnIndex=e}},a.prototype.createInteractiveMekkoLegendDataPoints=function(e){var a=this.data;if(!a||m.isUndefinedOrEmpty(a.series))return{dataPoints:[]};for(var i=t.columnChartProps.general.formatString,r=[],s=a.categories&&a.categories[e],o=a.series,l=a.legendData&&a.legendData.dataPoints,n=new b(this.dataViewCat),c=0,h=o.length;h>c;c++){var u,d=n.getValueBySeriesAndCategory(c,e),p=a.valuesMetadata[c],g=t.converterHelper.getFormattedLegendLabel(p,this.dataViewCat.values,i);if(1===o.length){var y=o[0];u=y.data.length>e&&y.data[e].color}else u=l.length>c&&l[c].color;r.push({color:u,icon:t.LegendIcon.Box,label:g,category:a.categoryFormatter?a.categoryFormatter.format(s):s,measure:t.valueFormatter.format(d,t.valueFormatter.getFormatString(p,i)),identity:t.SelectionId.createNull(),selected:!1})}return{dataPoints:r}},a.prototype.overrideXScale=function(e){this.xAxisProperties=e},a.prototype.render=function(e){var a=this.columnChart.drawColumns(!e),i=this.data,r=this.margin,s=this.currentViewport,o=s.height-(r.top+r.bottom),l=s.width-(r.left+r.right);this.mainGraphicsContext.attr("height",o).attr("width",l),t.TooltipManager.addTooltip(a.shapesSelection,function(e){return e.data.tooltipInfo});var n=[],c=void 0;if(this.interactivityService){for(var h=0,u=i.series.length;u>h;h++)n=n.concat(i.series[h].data);c={datapoints:n,bars:a.shapesSelection,hasHighlights:i.hasHighlights,eventGroup:this.mainGraphicsContext,mainGraphicsContext:this.mainGraphicsContext,viewport:a.viewport,axisOptions:a.axisOptions,showLabel:i.labelSettings.show}}return this.interactivity&&this.interactivity.isInteractiveLegend&&this.data.series.length>0&&this.selectColumn(0,!0),t.SVGUtil.flushAllD3TransitionsIfNeeded(this.options),{dataPoints:n,behaviorOptions:c,labelDataPoints:a.labelDataPoints,labelsAreNumeric:!0}},a.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},a.prototype.getVisualCategoryAxisIsScalar=function(){return this.data?this.data.scalarCategoryAxis:!1},a.prototype.getSupportedCategoryAxisType=function(){var e=this.data?this.data.categoryMetadata:void 0,a=t.AxisHelper.getCategoryValueType(e),i=t.AxisHelper.isOrdinal(a);return i?t.axisType.categorical:t.axisType.both},a.prototype.setFilteredData=function(a,i){var r=e.Prototype.inherit(this.data);return r.series=t.ColumnChart.sliceSeries(r.series,i,a),r.categories=r.categories.slice(a,i),this.columnChart.setData(r),r},a.ColumnChartClassName="columnChart",a.SeriesClasses=c("series"),a.BorderClass=c("mekkoborder"),a}();a.MekkoColumnChart=x;var b=function(){function e(e){this.dataView=e}return e.hasRole=function(e,t){var a=e.roles;return a&&a[t]},e.prototype.getLegend=function(a,i){var r=[],s=[],o=[],l=!1,n=new t.ColorHelper(a,t.columnChartProps.dataPoint.fill,i),c=void 0;if(this.dataView&&this.dataView.values){for(var h=this.dataView.values,u=h.grouped(),d=!(!h||!h.source),p=t.columnChartProps.general.formatString,g=0,m=u.length;m>g;g++)for(var y=u[g],f=y.objects,v=y.values,x=0,b=v.length;b>x;x++){var S=v[x],w=S.source;if(!e.hasRole(w,"Width")||e.hasRole(w,"Y")){s.push(w),o.push(S.objects);var C=S.identity?t.SelectionId.createWithIdAndMeasure(S.identity,w.queryName):t.SelectionId.createWithMeasure(this.getMeasureNameByIndex(x)),D=t.converterHelper.getFormattedLegendLabel(w,h,p),P=d?n.getColorForSeriesValue(f||w.objects,h.identityFields,w.groupName):n.getColorForMeasure(f||w.objects,w.queryName);r.push({icon:t.LegendIcon.Box,color:P,label:D,identity:C,selected:!1}),S.identity&&void 0!==w.groupName&&(l=!0)}}var A=this.dataView.values;c=A&&A.source?A.source.displayName:""}var N={title:c,dataPoints:r,grouped:l};return{legend:N,seriesSources:s,seriesObjects:o}},e.prototype.getValueBySeriesAndCategory=function(e,t){return this.dataView.values[e].values[t]},e.prototype.getMeasureNameByIndex=function(e){return this.dataView.values[e].source.queryName},e.prototype.hasHighlightValues=function(e){var t=this.dataView&&this.dataView.values?this.dataView.values[e]:void 0;return t&&!!t.highlights},e.prototype.getHighlightBySeriesAndCategory=function(e,t){return this.dataView.values[e].highlights[t]},e}(),S=function(){function e(e){this.behaviors=e}return e.prototype.bindEvents=function(e,t){for(var a=this.behaviors,i=0,r=a.length;r>i;i++)a[i].bindEvents(e.layerOptions[i],t);e.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){for(var t=0;t<this.behaviors.length;t++)this.behaviors[t].renderSelection(e)},e}();a.MekkoChartBehavior=S}(a=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a;!function(a){var i=t.utility.SelectionManager,r=e.visuals.valueFormatter,s=function(){function a(e){this.margin={top:10,right:10,bottom:10,left:10},this.nodeWidth=21.5,this.curvatureOfLinks=.5,e&&(this.svg=e.svg,this.margin=e.margin||this.margin,this.curvatureOfLinks=e.curvatureOfLinks||this.curvatureOfLinks)}return a.getProperties=function(e){var t={};for(var a in e.objects){t[a]={};for(var i in e.objects[a].properties)t[a][i]={objectName:a,propertyName:i}}return t},Object.defineProperty(a.prototype,"textProperties",{get:function(){return{fontFamily:this.root.style("font-family"),fontSize:jsCommon.PixelConverter.fromPoint(this.dataView?this.dataView.settings.fontSize:a.DefaultSettings.fontSize)}},enumerable:!0,configurable:!0}),a.prototype.init=function(e){this.svg?this.root=this.svg:this.root=d3.select(e.element.get(0)).append("svg"),this.selectionManager=new i({hostServices:e.host});var r=e.style;this.colours=r&&r.colorPalette?r.colorPalette.dataColors:new t.DataColorPalette,this.root.classed(a.ClassName,!0),this.main=this.root.append("g"),this.links=this.main.append("g").classed(a.Links["class"],!0),this.nodes=this.main.append("g").classed(a.Nodes["class"],!0)},a.prototype.update=function(e){if(e&&e.dataViews){var t,a=e.dataViews[0];this.updateViewport(e.viewport),t=this.converter(a),this.findNodePosition(t),this.dataView=t,this.render(t)}},a.prototype.updateViewport=function(e){var t,a;t=this.getPositiveNumber(e.height),a=this.getPositiveNumber(e.width),this.viewport={height:this.getPositiveNumber(t-this.margin.top-this.margin.bottom),width:this.getPositiveNumber(a-this.margin.left-this.margin.right)},this.updateElements(t,a)},a.prototype.getPositiveNumber=function(e){return 0>e||isNaN(e)||e===1/0||e===-(1/0)?0:e},a.prototype.updateElements=function(e,a){this.root.attr({height:e,width:a}),this.main.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top))},a.prototype.converter=function(i){var s=this;if(!(i&&i.categorical&&i.categorical.categories&&i.categorical.categories[0]&&i.categorical.categories[1]&&i.categorical.categories[0].values&&i.categorical.categories[1].values))return{nodes:[],links:[],settings:{scale:{x:1,y:1},colourOfLabels:a.DefaultSettings.colourOfLabels,fontSize:a.DefaultSettings.fontSize}};var o,l,n,c,h,u,d,p=[],g=[],m=[],y=i.categorical.categories[0].values,f=i.categorical.categories[1].values,v=i.categorical.values&&i.categorical.values[0],x=v&&v.values&&v.values.map(function(e){return e||0})||[],b="g",S=i.categorical.categories[0].objects||[],w=[];return i.categorical.categories[0].identity&&(w=w.concat(i.categorical.categories[0].identity)),i.categorical.categories[1].identity&&(w=w.concat(i.categorical.categories[1].identity)),c=this.getObjectsFromDataView(i),h=this.getColour(a.Properties.labels.fill,a.DefaultSettings.colourOfLabels,c),v&&v.source&&(b=r.getFormatString(v.source,a.Properties.general.formatString)),m=y.map(function(e,t){return{source:e,destination:f[t],weigth:v?Math.max(x[t]||0,0):1}}),o=y.concat(f),l=r.create({format:r.getFormatString(i.categorical.categories[0].source,a.Properties.general.formatString),value:o[0],value2:o[o.length-1]}),n=r.create({format:b,value:Math.max(d3.max(x)||1,1)}),o.forEach(function(i,r){if(!p.some(function(e){return i===e.label.name?(e.selectionIds.push(t.SelectionId.createWithId(w[r])),!0):!1})){var o,n,c=l.format(i),u={text:c,fontFamily:s.textProperties.fontFamily,fontSize:s.textProperties.fontSize};o={name:i,formattedName:l.format(i),width:e.TextMeasurementService.measureSvgTextWidth(u),height:e.TextMeasurementService.estimateSvgTextHeight(u),colour:h},n=t.SelectionId.createWithId(w[r]),p.push({label:o,links:[],inputWeight:0,outputWeight:0,width:s.nodeWidth,height:0,colour:a.DefaultColourOfNode,tooltipData:[],selectionIds:[n]})}}),d=this.colours.getAllColors().length/p.length,p.forEach(function(e,t){e.colour=s.colours.getColorByIndex(Math.floor(t*d)).value}),m.forEach(function(e,i){var r,o,l,c;e.source!==e.destination&&(p.forEach(function(t){t.label.name===e.source&&(r=t),t.label.name===e.destination&&(o=t)}),c=s.getColour(a.Properties.links.fill,a.DefaultColourOfLink,S[i]),l={source:r,destination:o,weigth:e.weigth,height:e.weigth,colour:c,tooltipData:s.getTooltipDataForLink(n,r.label.formattedName,o.label.formattedName,e.weigth),selectionId:t.SelectionId.createWithId(w[i])},g.push(l),r.links.push(l),o.links.push(l),s.updateValueOfNode(r),s.updateValueOfNode(o),r.tooltipData=s.getTooltipForNode(n,r.label.formattedName,r.inputWeight?r.inputWeight:r.outputWeight),o.tooltipData=s.getTooltipForNode(n,o.label.formattedName,o.inputWeight?o.inputWeight:o.outputWeight))}),u=this.parseSettings(c),u.colourOfLabels=h,{nodes:p,links:g,settings:u}},a.prototype.getObjectsFromDataView=function(e){return e&&e.metadata&&e.metadata.columns&&e.metadata.objects?e.metadata.objects:null},a.prototype.getColour=function(e,a,i){var r;return r=new t.ColorHelper(this.colours,e,a),r.getColorForMeasure(i,"")},a.prototype.getTooltipDataForLink=function(e,t,i,r){var s;return s=e&&e.format?e.format(r):r.toString(),[{displayName:a.RoleNames.rows,value:t},{displayName:a.RoleNames.columns,value:i},{displayName:a.RoleNames.values,value:s}]},a.prototype.updateValueOfNode=function(e){e.inputWeight=e.links.reduce(function(t,a){return t+(a.destination===e?a.weigth:0)},0),e.outputWeight=e.links.reduce(function(t,a){return t+(a.source===e?a.weigth:0)},0)},a.prototype.getTooltipForNode=function(e,t,i){var r;return r=e&&e.format?e.format(i):i.toString(),[{displayName:"Name",value:t},{displayName:a.RoleNames.values,value:r}]},a.prototype.parseSettings=function(t){var i=!1;return i=e.DataViewObjects.getValue(t,a.Properties.labels.show,a.DefaultSettings.isVisibleLabels),{isVisibleLabels:i,scale:{x:a.DefaultSettings.scale.x,y:a.DefaultSettings.scale.y},colourOfLabels:a.DefaultSettings.colourOfLabels,fontSize:e.DataViewObjects.getValue(t,a.Properties.labels.fontSize,a.DefaultSettings.fontSize)}},a.prototype.findNodePosition=function(e){this.findNodePositionByX(e),this.findNodePositionByY(e)},a.prototype.findNodePositionByX=function(e){for(var t=e.nodes,a=[],i=[],r=0,s=!1;t.length>0;)a=[],t.forEach(function(e){e.x=r,e.links.forEach(function(t){e===t.source&&e!==t.destination&&a.every(function(e){return e!==t.destination})&&a.push(t.destination)})}),s=a.length===i.length&&i.every(function(e){return a.some(function(t){return t===e})}),s?(i.forEach(function(e){e.x=r,r++}),t=[]):(t=a,i=t,r++);e.settings.scale.x=this.getScaleByAxisX(r-1),this.scaleByAxisX(e.nodes,e.settings.scale.x)},a.prototype.scaleByAxisX=function(e,t){e.forEach(function(e){e.x*=t})},a.prototype.getScaleByAxisX=function(e){return void 0===e&&(e=1),this.getPositiveNumber((this.viewport.width-this.nodeWidth)/e)},a.prototype.findNodePositionByY=function(e){var t=e.nodes,a=e.links,i=0,r=0,s=0,o=0,l=0;t=t.sort(function(e,t){return e.x-t.x}),t.forEach(function(e){i!==e.x&&(r=0,i=e.x,o=0),o+=Math.max(e.inputWeight,e.outputWeight),o>l&&(l=o),r>s&&(s=r),r++}),e.settings.scale.y=this.getScaleByAxisY(s+1,l),this.scaleByAxisY(t,a,e.settings.scale.y)},a.prototype.getScaleByAxisY=function(e,t){return this.getPositiveNumber((this.viewport.height-e*a.NodePadding)/t)},a.prototype.scaleByAxisY=function(e,t,i){var r=0,s=0,o=0;e.forEach(function(e){s!==e.x&&(s=e.x,r=0,o=0),e.height=Math.max(e.inputWeight,e.outputWeight)*i,e.y=r+a.NodePadding*o,r+=e.height,o++}),e.forEach(function(e){e.links=e.links.sort(function(t,a){var i,r;return i=t.source===e?t.destination.y:t.source.y,r=a.source===e?a.destination.y:a.source.y,i-r});var t=0,a=0;e.links.forEach(function(r){var s=0;r.height=r.weigth*i,r.source.x<e.x||r.destination.x<e.x?(s=t,t+=r.height):(r.source.x>e.x||r.destination.x>e.x)&&(s=a,a+=r.height),r.source===e?r.dySource=s:r.destination===e&&(r.dyDestination=s)})})},a.prototype.render=function(e){var t,a;a=this.renderLinks(e),t=this.renderNodes(e),this.bindSelectionHandler(e,t,a)},a.prototype.renderNodes=function(i){var r,s,o,l=this;return o=this.main.select(a.Nodes.selector).selectAll(a.Node.selector),s=o.data(i.nodes.filter(function(e){return e.height>0})),r=s.enter().append("g"),s.attr("transform",function(e){return t.SVGUtil.translate(e.x,e.y)}).classed(a.Node["class"],!0),r.append("rect").classed(a.NodeRect["class"],!0),r.append("text").classed(a.NodeLabel["class"],!0),s.select(a.NodeRect.selector).style({fill:function(e){return e.colour},stroke:function(e){return d3.rgb(e.colour).darker(1.5)}}).attr({x:0,y:0,height:function(e){return e.height},width:function(e){return e.width}}),s.select(a.NodeLabel.selector).attr({x:function(e){return l.getLabelPositionByAxisX(e)},y:function(e){return e.height/2},dy:"0.35em"}).style("fill",function(e){return e.label.colour}).style("font-size",this.textProperties.fontSize).style("display",function(e){var t=!1,r=l.getCurrentPositionOfLabelByAxisX(e);return t=r>=l.viewport.width||0>=r||e.height+a.NodePadding<e.label.height,t||!i.settings.isVisibleLabels||i.settings.scale.x/2<a.MinWidthOfLabel?"none":null}).style("text-anchor",function(e){return l.isLabelLargerWidth(e)?"end":null}).text(function(t){var r=i.settings.scale.x/2-t.width-a.NodePadding;return l.getCurrentPositionOfLabelByAxisX(t)>r?e.TextMeasurementService.getTailoredTextOrDefault({text:t.label.formattedName,fontFamily:l.textProperties.fontFamily,fontSize:l.textProperties.fontSize},r):t.label.formattedName}),s.exit().remove(),this.renderTooltip(s),s},a.prototype.getLabelPositionByAxisX=function(e){return this.isLabelLargerWidth(e)?-a.LabelPadding:e.width+a.LabelPadding},a.prototype.isLabelLargerWidth=function(e){var t=e.x+e.width+a.LabelPadding;return t+e.label.width>this.viewport.width},a.prototype.getCurrentPositionOfLabelByAxisX=function(e){var t=this.getLabelPositionByAxisX(e);return t=t>0?t+e.x+e.label.width+e.width:e.x+t-e.label.width-e.width},a.prototype.renderLinks=function(e){var t,i,r=this;return i=this.main.select(a.Links.selector).selectAll(a.Link.selector),t=i.data(e.links.filter(function(e){return e.height>0})),t.enter().append("path").classed(a.Link["class"],!0),t.attr("d",function(e){return r.getSvgPath(e)}).style({"stroke-width":function(e){return e.height},stroke:function(e){return e.colour}}),t.exit().remove(),this.renderTooltip(t),t},a.prototype.getSvgPath=function(e){var t,a,i,r,s,o,l;return e.destination.x<e.source.x?(t=e.source.x,a=e.destination.x+e.destination.width):(t=e.source.x+e.source.width,a=e.destination.x),i=d3.interpolateNumber(t,a),r=i(this.curvatureOfLinks),s=i(1-this.curvatureOfLinks),o=e.source.y+e.dySource+e.height/2,l=e.destination.y+e.dyDestination+e.height/2,"M "+t+" "+o+" C "+r+" "+o+", "+s+" "+l+", "+a+" "+l},a.prototype.renderTooltip=function(e){t.TooltipManager.addTooltip(e,function(e){return e.data.tooltipData})},a.prototype.bindSelectionHandler=function(e,t,a){var i=this;t.on("click",function(e){var r=_.isEqual(e.selectionIds.map(function(e){return e.getKey()}),i.selectionManager.getSelectionIds().map(function(e){return e.getKey()}))?[]:e.selectionIds;i.selectMany(r,!0).then(function(){return i.setSelection(t,a)}),d3.event.stopPropagation()}),a.on("click",function(e){i.selectionManager.select(e.selectionId,d3.event.ctrlKey).then(function(){return i.setSelection(t,a)}),d3.event.stopPropagation()}),this.root.on("click",function(){i.selectionManager.clear().then(function(){return i.setSelection(t,a)})}),this.setSelection(t,a)},a.prototype.selectMany=function(e,t){var a=this;if(void 0===t&&(t=!1),t)return this.selectionManager.clear().then(function(){return a.selectMany(e,!1)});var i=e.map(function(e){return a.selectionManager.select(e,!0)});return $.when.apply(null,i)},a.prototype.setSelection=function(e,t){var a=this.selectionManager.getSelectionIds();if(e.classed("selected",a.length>0),t.classed("selected",!1),0!==a.length){var i=e.filter(function(e){return a.some(function(t){return e.selectionIds.some(function(e){return e.getKey()===t.getKey()})})}),r=t.filter(function(e){return a.some(function(t){return t.getKey()===e.selectionId.getKey()})});i.classed("selected",!1),r.classed("selected",!0)}},a.prototype.enumerateObjectInstances=function(e){var a=new t.ObjectEnumerationBuilder;if(!this.dataView)return[];switch(e.objectName){case"labels":this.enumerateLabels(a);break;case"links":this.enumerateLinks(a)}return a.complete()},a.prototype.enumerateLabels=function(e){var t,a=this.dataView.settings;a&&(t={objectName:"labels",displayName:"labels",selector:null,properties:{show:a.isVisibleLabels,fill:a.colourOfLabels,fontSize:a.fontSize}},e.pushInstance(t))},a.prototype.enumerateLinks=function(e){var a=this.dataView.links;a&&a.length>0&&a.forEach(function(a){e.pushInstance({objectName:"links",displayName:a.source.label.formattedName+" - "+a.destination.label.formattedName,selector:t.ColorHelper.normalizeSelector(a.selectionId.getSelector(),!1),properties:{fill:{solid:{color:a.colour}}}})})},a.ClassName="sankeyDiagram",a.Nodes={"class":"nodes",selector:".nodes"},a.Node={"class":"node",selector:".node"},a.NodeRect={"class":"nodeRect",selector:".nodeRect"},a.NodeLabel={"class":"nodeLabel",selector:".nodeLabel"},a.Links={"class":"links",selector:".links"},a.Link={"class":"link",selector:".link"},a.DefaultColourOfNode="rgb(62, 187, 162)",a.DefaultColourOfLink="black",a.DefaultSettings={isVisibleLabels:!0,scale:{x:1,y:1},colourOfLabels:"black",fontSize:12},a.MinWidthOfLabel=35,a.NodePadding=5,a.LabelPadding=4,a.RoleNames={rows:"Source",columns:"Destination",values:"Weight"},a.capabilities={dataRoles:[{name:a.RoleNames.rows,kind:e.VisualDataRoleKind.Grouping,displayName:a.RoleNames.rows},{name:a.RoleNames.columns,kind:e.VisualDataRoleKind.Grouping,displayName:a.RoleNames.columns},{name:a.RoleNames.values,kind:e.VisualDataRoleKind.Measure,displayName:a.RoleNames.values}],dataViewMappings:[{conditions:[{Source:{min:0,max:1},Destination:{min:0,max:1},Weight:{min:0,max:0}},{Source:{min:0,max:1},Destination:{min:0,max:1},Weight:{min:1,max:1}}],categorical:{categories:{"for":{"in":a.RoleNames.rows},dataReductionAlgorithm:{top:{}}},values:{select:[{bind:{to:a.RoleNames.columns}},{bind:{to:a.RoleNames.values}}]}}}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},labels:{displayName:e.data.createDisplayNameGetter("Visual_DataPointsLabels"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},links:{displayName:"Links",properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}}}},a.Properties=a.getProperties(a.capabilities),a}();a.SankeyDiagram=s}(a=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a;!function(a){var i=jsCommon.PixelConverter;a.bulletChartProps={values:{targetValue:{objectName:"values",propertyName:"targetValue"},minimumPercent:{objectName:"values",propertyName:"minimumPercent"},needsImprovementPercent:{objectName:"values",propertyName:"needsImprovementPercent"},satisfactoryPercent:{objectName:"values",propertyName:"satisfactoryPercent"},goodPercent:{objectName:"values",propertyName:"goodPercent"},veryGoodPercent:{objectName:"values",propertyName:"veryGoodPercent"},maximumPercent:{objectName:"values",propertyName:"maximumPercent"},targetValue2:{objectName:"values",propertyName:"targetValue2"}},orientation:{orientation:{objectName:"orientation",propertyName:"orientation"}},colors:{badColor:{objectName:"colors",propertyName:"badColor"},needsImprovementColor:{objectName:"colors",propertyName:"needsImprovementColor"},satisfactoryColor:{objectName:"colors",propertyName:"satisfactoryColor"},goodColor:{objectName:"colors",propertyName:"goodColor"},veryGoodColor:{objectName:"colors",propertyName:"veryGoodColor"},bulletColor:{objectName:"colors",propertyName:"bulletColor"}},axis:{axis:{objectName:"axis",propertyName:"axis"},axisColor:{objectName:"axis",propertyName:"axisColor"},measureUnits:{objectName:"axis",propertyName:"measureUnits"},unitsColor:{objectName:"axis",propertyName:"unitsColor"}},formatString:{objectName:"general",propertyName:"formatString"},labels:{fontSize:{objectName:"labels",propertyName:"fontSize"},show:{objectName:"labels",propertyName:"show"},labelColor:{objectName:"labels",propertyName:"labelColor"}}},a.bulletChartRoleNames={value:"Value",targetValue:"TargetValue",minValue:"Minimum",needsImprovementValue:"NeedsImprovement",satisfactoryValue:"Satisfactory",goodValue:"Good",veryGoodValue:"VeryGood",maxValue:"Maximum",targetValue2:"TargetValue2"};var r;!function(t){t.HORIZONTALLEFT="Horizontal Left",t.HORIZONTALRIGHT="Horizontal Right",t.VERTICALTOP="Vertical Top",t.VERTICALBOTTOM="Vertical Bottom",t.type=e.createEnumType([{value:t.HORIZONTALLEFT,displayName:t.HORIZONTALLEFT},{value:t.HORIZONTALRIGHT,displayName:t.HORIZONTALRIGHT},{value:t.VERTICALTOP,displayName:t.VERTICALTOP},{value:t.VERTICALBOTTOM,displayName:t.VERTICALBOTTOM}])}(r||(r={}));var s=function(){function s(){this.baselineDelta=0}return Object.defineProperty(s.prototype,"reverse",{get:function(){return this.model.bulletChartSettings.orientation.reverse},enumerable:!0,
configurable:!0}),Object.defineProperty(s.prototype,"vertical",{get:function(){return this.model.bulletChartSettings.orientation.vertical},enumerable:!0,configurable:!0}),s.DefaultStyleProperties=function(){return{values:{targetValue:0,targetValue2:0,minimumPercent:0,needsImprovementPercent:25,satisfactoryPercent:50,goodPercent:100,veryGoodPercent:125,maximumPercent:200},orientation:{orientation:r.HORIZONTALLEFT,reverse:!1,vertical:!1},colors:{badColor:"Darkred",needsImprovementColor:"Red",satisfactoryColor:"Yellow",goodColor:"Green",veryGoodColor:"Darkgreen",bulletColor:"Black"},axis:{axis:!0,axisColor:"Grey",measureUnits:"",unitsColor:"Grey"},labelSettings:{fontSize:11,show:!0,labelColor:"Black"}}},Object.defineProperty(s.prototype,"viewportIn",{get:function(){return{width:this.viewport.width,height:this.viewport.height}},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"viewportScroll",{get:function(){var e=this.viewportIn;return{width:e.width-s.ScrollBarSize,height:e.height-s.ScrollBarSize}},enumerable:!0,configurable:!0}),s.getTextProperties=function(e,t){return{fontFamily:s.FontFamily,fontSize:i.fromPoint(t),text:e}},s.converter=function(i,o){var l=s.DefaultStyleProperties(),n={bulletValueFormatString:null,bulletChartSettings:l,bars:[],barRects:[],valueRects:[],targetValues:[]};if(!(i&&i.categorical&&i.categorical.values&&0!==i.categorical.values.length&&i.metadata&&i.metadata.columns&&0!==i.metadata.columns.length))return n;var c=i.metadata.objects,h=n.bulletChartSettings;c&&(h.values.targetValue=e.DataViewObjects.getValue(c,a.bulletChartProps.values.targetValue,l.values.targetValue),h.values.targetValue2=e.DataViewObjects.getValue(c,a.bulletChartProps.values.targetValue2,l.values.targetValue2),h.values.minimumPercent=e.DataViewObjects.getValue(c,a.bulletChartProps.values.minimumPercent,l.values.minimumPercent),h.values.needsImprovementPercent=e.DataViewObjects.getValue(c,a.bulletChartProps.values.needsImprovementPercent,l.values.needsImprovementPercent),h.values.satisfactoryPercent=e.DataViewObjects.getValue(c,a.bulletChartProps.values.satisfactoryPercent,l.values.satisfactoryPercent),h.values.goodPercent=e.DataViewObjects.getValue(c,a.bulletChartProps.values.goodPercent,l.values.goodPercent),h.values.veryGoodPercent=e.DataViewObjects.getValue(c,a.bulletChartProps.values.veryGoodPercent,l.values.veryGoodPercent),h.values.maximumPercent=e.DataViewObjects.getValue(c,a.bulletChartProps.values.maximumPercent,l.values.maximumPercent),h.orientation.orientation=e.DataViewObjects.getValue(c,a.bulletChartProps.orientation.orientation,l.orientation.orientation),h.colors.badColor=e.DataViewObjects.getFillColor(c,a.bulletChartProps.colors.badColor,l.colors.badColor),h.colors.needsImprovementColor=e.DataViewObjects.getFillColor(c,a.bulletChartProps.colors.needsImprovementColor,l.colors.needsImprovementColor),h.colors.satisfactoryColor=e.DataViewObjects.getFillColor(c,a.bulletChartProps.colors.satisfactoryColor,l.colors.satisfactoryColor),h.colors.goodColor=e.DataViewObjects.getFillColor(c,a.bulletChartProps.colors.goodColor,l.colors.goodColor),h.colors.veryGoodColor=e.DataViewObjects.getFillColor(c,a.bulletChartProps.colors.veryGoodColor,l.colors.veryGoodColor),h.colors.bulletColor=e.DataViewObjects.getFillColor(c,a.bulletChartProps.colors.bulletColor,l.colors.bulletColor),h.axis.axis=e.DataViewObjects.getValue(c,a.bulletChartProps.axis.axis,l.axis.axis),h.axis.axisColor=e.DataViewObjects.getFillColor(c,a.bulletChartProps.axis.axisColor,l.axis.axisColor),h.axis.measureUnits=e.TextMeasurementService.getTailoredTextOrDefault(s.getTextProperties(e.DataViewObjects.getValue(c,a.bulletChartProps.axis.measureUnits,l.axis.measureUnits),s.DefaultSubtitleFontSizeInPt),s.MaxLabelWidth),h.axis.unitsColor=e.DataViewObjects.getFillColor(c,a.bulletChartProps.axis.unitsColor,l.axis.unitsColor),h.labelSettings.fontSize=e.DataViewObjects.getValue(c,a.bulletChartProps.labels.fontSize,l.labelSettings.fontSize),h.labelSettings.show=e.DataViewObjects.getValue(c,a.bulletChartProps.labels.show,l.labelSettings.show),h.labelSettings.labelColor=e.DataViewObjects.getFillColor(c,a.bulletChartProps.labels.labelColor,l.labelSettings.labelColor)),h.orientation.orientation!==r.HORIZONTALRIGHT&&h.orientation.orientation!==r.VERTICALBOTTOM||(h.orientation.reverse=!0),h.orientation.orientation!==r.VERTICALTOP&&h.orientation.orientation!==r.VERTICALBOTTOM||(h.orientation.vertical=!0);var u,d,p,g=1;i.categorical.categories&&(u=i.categorical.categories[0],d=u.values,g=d.length,p=t.valueFormatter.getFormatString(u.source,a.bulletChartProps.formatString)),n.bulletValueFormatString=t.valueFormatter.getFormatString(i.categorical.values[0].source,a.bulletChartProps.formatString);for(var m=0;g>m;m++){var y=[],f=void 0,v=void 0,x=void 0,b=void 0,S=void 0,w=void 0,C=void 0,D=void 0,P=void 0,A=void 0,N=!1,T=void 0;if(d){var V=d[m];f=t.valueFormatter.format(V,p),T=u.identity?u.identity[m]:null;var L=s.getTextProperties(f,h.labelSettings.fontSize);f=e.TextMeasurementService.getTailoredTextOrDefault(L,s.MaxLabelWidth-s.StartMarginHorizontal);var M=e.TextMeasurementService.measureSvgTextWidth(L),k=e.TextMeasurementService.estimateSvgTextHeight(L);s.BiggestLabelWidth=Math.max(s.BiggestLabelWidth,M),s.BiggestLabelHeight=Math.max(s.BiggestLabelHeight,k)}var j=i.categorical.values;x=h.values.targetValue,b=h.values.targetValue2;for(var I=0;I<j.length;I++){var O=j[I].source,G=j[I].values[m]||0;O&&O.roles&&(O.roles[a.bulletChartRoleNames.value]?(j[I].highlights&&(N=null!==j[I].highlights[m]),y.push({value:G,metadata:j[I]}),v=G):O.roles[a.bulletChartRoleNames.targetValue]?(y.push({value:G,metadata:j[I]}),x=G):O.roles[a.bulletChartRoleNames.targetValue2]?(y.push({value:G,metadata:j[I]}),b=G):O.roles[a.bulletChartRoleNames.minValue]?S=G:O.roles[a.bulletChartRoleNames.needsImprovementValue]?P=G:O.roles[a.bulletChartRoleNames.satisfactoryValue]?w=G:O.roles[a.bulletChartRoleNames.goodValue]?C=G:O.roles[a.bulletChartRoleNames.veryGoodValue]?A=G:O.roles[a.bulletChartRoleNames.maxValue]&&(D=G))}S||(S=h.values.minimumPercent*x/100),P||(P=h.values.needsImprovementPercent*x/100),w||(w=h.values.satisfactoryPercent*x/100),C||(C=h.values.goodPercent*x/100),A||(A=h.values.veryGoodPercent*x/100),D||(D=h.values.maximumPercent*x/100);var F=(h.orientation.vertical?o.viewport.height-s.MaxLabelHeight:o.viewport.width-s.MaxLabelWidth)-s.StartMarginHorizontal-s.ScrollBarSize,R=[S,P,w,C,A,D].sort(d3.descending),z=d3.scale.linear().clamp(!0).domain([S,Math.max(R[0],x,v)]).range(h.orientation.vertical?[F,0]:[0,F]),B=z(S),H=z(P),E=z(w),W=z(C),U=z(A),_=z(D),Y=z(v),K=h.colors.badColor,X=h.colors.needsImprovementColor,q=h.colors.satisfactoryColor,Z=h.colors.goodColor,Q=h.colors.veryGoodColor;s.addItemToBarArray(n.barRects,m,B,H,K,y,T),s.addItemToBarArray(n.barRects,m,H,E,X,y,T),s.addItemToBarArray(n.barRects,m,E,W,q,y,T),s.addItemToBarArray(n.barRects,m,W,U,Z,y,T),s.addItemToBarArray(n.barRects,m,U,_,Q,y,T),s.addItemToBarArray(n.valueRects,m,B,Y,h.colors.bulletColor,y,T),n.targetValues.push({barIndex:m,value:z(x),fill:h.colors.bulletColor,key:t.SelectionId.createWithIdAndMeasure(T,z(x).toString()).getKey(),value2:z(b)});var $=null;if(h.axis.axis){$=d3.svg.axis(),$.orient(h.orientation.vertical?"left":"bottom");var J=Math.round(Math.max(3,F/100)),ee=[v,x,C,w,D,S,P,A].filter(function(e){return!isNaN(e)});$.tickFormat(t.valueFormatter.create({format:n.bulletValueFormatString,value:ee.length?Math.max.apply(null,ee):0}).format),$.ticks(J),$.scale(z)}var te={scale:z,barIndex:m,categoryLabel:f,x:h.orientation.vertical?s.StartMarginVertical+s.SpaceRequiredForBarVertically*m:s.StartMarginHorizontal,y:h.orientation.vertical?s.StartMarginVertical:s.StartMarginHorizontal+s.SpaceRequiredForBar*m,axis:$,key:t.SelectionId.createWithIdAndMeasure(T,m.toString()).getKey()};n.bars.push(te)}return n},s.addItemToBarArray=function(e,i,r,s,o,l,n){e.push({barIndex:i,start:r,end:s,fill:o,tooltipInfo:t.TooltipBuilder.createTooltipInfo(a.bulletChartProps.formatString,null,null,null,null,l),selected:!1,identity:t.SelectionId.createWithId(n),key:t.SelectionId.createWithIdAndMeasure(n,r+" "+s).getKey()})},s.prototype.init=function(e){var a=d3.select(e.element.get(0));this.hostService=e.host,this.bulletBody=a.append("div").classed("bulletChart",!0),this.scrollContainer=this.bulletBody.append("svg").classed("bullet-scroll-region",!0),this.clearCatcher=t.appendClearCatcher(this.scrollContainer),this.labelGraphicsContext=this.scrollContainer.append("g"),this.bulletGraphicsContext=this.scrollContainer.append("g"),this.behavior=new l,this.interactivityService=t.createInteractivityService(e.host)},s.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){s.BiggestLabelHeight=s.BiggestLabelWidth=0;var t=e.dataViews[0];this.viewport=e.viewport,this.model=s.converter(t,e),this.baselineDelta=o.estimateSvgTextBaselineDelta(s.getTextProperties("1",this.model.bulletChartSettings.labelSettings.fontSize)),this.ClearViewport(),this.model&&(this.interactivityService&&this.interactivityService.applySelectionStateToData(this.model.barRects),this.bulletBody.style({height:this.viewportIn.height+"px",width:this.viewportIn.width+"px"}),this.vertical?this.scrollContainer.attr({width:this.model.bars.length*s.SpaceRequiredForBarVertically+"px",height:this.viewportScroll.height+"px"}):this.scrollContainer.attr({height:this.model.bars.length*s.SpaceRequiredForBar+"px",width:this.viewportScroll.width+"px"}),this.vertical?this.setUpBulletsVertically(this.bulletBody,this.model,this.reverse):this.setUpBulletsHorizontally(this.bulletBody,this.model,this.reverse))}},s.prototype.ClearViewport=function(){this.labelGraphicsContext.selectAll("text").remove(),this.bulletGraphicsContext.selectAll("rect").remove(),this.bulletGraphicsContext.selectAll("axis").remove(),this.bulletGraphicsContext.selectAll("path").remove(),this.bulletGraphicsContext.selectAll("line").remove(),this.bulletGraphicsContext.selectAll("tick").remove(),this.bulletGraphicsContext.selectAll("g").remove()},s.prototype.calculateLabelWidth=function(t,a,i){if(i)return s.StartMarginHorizontal+(a?a.start:0);var r=e.TextMeasurementService.measureSvgTextWidth(s.getTextProperties(t.categoryLabel,this.model.bulletChartSettings.labelSettings.fontSize));return r>s.BiggestLabelWidth?t.x+s.MaxLabelWidth+(a?a.start:0):t.x+s.BiggestLabelWidth+s.BarMargin+(a?a.start:0)},s.prototype.calculateLabelHeight=function(t,a,i){if(i)return s.StartMarginVertical+(a?a.end:0);var r=e.TextMeasurementService.measureSvgTextHeight(s.getTextProperties(t.categoryLabel,this.model.bulletChartSettings.labelSettings.fontSize));return r>s.BiggestLabelHeight?t.y+s.MaxLabelHeight+(a?a.end:0):t.y+r+s.BarMargin+(a?a.end:0)},s.prototype.setUpBulletsHorizontally=function(e,a,r){var o=this,l=a.bars,n=a.barRects,c=a.valueRects,h=a.targetValues,u=this.labelGraphicsContext.selectAll("text").data(l,function(e){return e.key}),d=this.bulletGraphicsContext.selectAll("rect.range").data(n,function(e){return e.key}),p=d.enter().append("rect").attr({x:function(e){return o.calculateLabelWidth(l[e.barIndex],e,r)},y:function(e){return l[e.barIndex].y-s.BulletSize/2},width:function(e){return e.end-e.start},height:s.BulletSize}).classed("range",!0).style({fill:function(e){return e.fill}});d.exit();var g=this.bulletGraphicsContext.selectAll("rect").data(c,function(e){return e.key});g.enter().append("rect").attr({x:function(e){return o.calculateLabelWidth(l[e.barIndex],e,r)},y:function(e){return l[e.barIndex].y-s.BulletSize/8},width:function(e){return e.end-e.start},height:1*s.BulletSize/4}).classed("value",!0).style({fill:function(e){return e.fill}}),g.exit();var m=this.bulletGraphicsContext.selectAll("values").data(h,function(e){return e.key});if(m.enter().append("line").attr({x1:function(e){return o.calculateLabelWidth(l[e.barIndex],null,r)+e.value},x2:function(e){return o.calculateLabelWidth(l[e.barIndex],null,r)+e.value},y1:function(e){return l[e.barIndex].y-s.MarkerMarginHorizontal},y2:function(e){return l[e.barIndex].y+s.MarkerMarginHorizontal}}).style({stroke:function(e){return e.fill},"stroke-width":2}),m.enter().append("line").attr({x1:function(e){return o.calculateLabelWidth(l[e.barIndex],null,r)+e.value2},x2:function(e){return o.calculateLabelWidth(l[e.barIndex],null,r)+e.value2},y1:function(e){return l[e.barIndex].y-s.MarkerMarginHorizontal},y2:function(e){return l[e.barIndex].y+s.MarkerMarginHorizontal}}).style({stroke:function(e){return e.fill},"stroke-width":2,transform:"rotate(45deg)","transform-origin":"50% 50% 0"}),m.enter().append("line").attr({x1:function(e){return o.calculateLabelWidth(l[e.barIndex],null,r)+e.value2},x2:function(e){return o.calculateLabelWidth(l[e.barIndex],null,r)+e.value2},y1:function(e){return l[e.barIndex].y-s.MarkerMarginHorizontal},y2:function(e){return l[e.barIndex].y+s.MarkerMarginHorizontal}}).style({stroke:function(e){return e.fill},"stroke-width":2,transform:"rotate(315deg)","transform-origin":"50% 50% 0"}),m.exit(),a.bulletChartSettings.axis.axis)for(var y=0;y<l.length;y++){var f=l[y];this.bulletGraphicsContext.append("g").attr({transform:function(){var e=o.calculateLabelWidth(f,null,r),t=f.y+s.BulletSize/2;return"translate("+e+","+t+")"}}).classed("axis",!0).call(f.axis.scale(f.scale)).style({fill:a.bulletChartSettings.axis.axisColor,"font-size":i.fromPoint(s.AxisFontSizeInPt)}).selectAll("line").style({stroke:a.bulletChartSettings.axis.axisColor})}if(a.bulletChartSettings.labelSettings.show&&u.enter().append("text").classed("title",!0).attr({x:function(e){return r?o.bulletGraphicsContext.node().getBoundingClientRect().width+s.StartMarginHorizontal:e.x},y:function(e){return e.y+o.baselineDelta},fill:a.bulletChartSettings.labelSettings.labelColor,"font-size":i.fromPoint(a.bulletChartSettings.labelSettings.fontSize)}).text(function(e){return e.categoryLabel}),a.bulletChartSettings.axis.measureUnits&&u.enter().append("text").attr({x:function(e){return r?o.bulletGraphicsContext.node().getBoundingClientRect().width-s.StartMarginHorizontal+s.SubtitleMargin:e.x-s.SubtitleMargin},y:function(e){return e.y+s.BulletSize},fill:a.bulletChartSettings.axis.unitsColor,"font-size":i.fromPoint(s.DefaultSubtitleFontSizeInPt)}).text(a.bulletChartSettings.axis.measureUnits),this.interactivityService){var v={rects:p,valueRects:g,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService,bulletChartSettings:this.model.bulletChartSettings,hasHighlights:!1},x=this.model.barRects.concat(this.model.valueRects);this.interactivityService.bind(x,this.behavior,v)}u.exit(),t.TooltipManager.addTooltip(g,function(e){return e.data.tooltipInfo},!0),t.TooltipManager.addTooltip(d,function(e){return e.data.tooltipInfo},!0)},s.prototype.setUpBulletsVertically=function(a,r,o){var l=this,n=r.bars,c=r.barRects,h=r.valueRects,u=r.targetValues,d=this.labelGraphicsContext.selectAll("text").data(n,function(e){return e.key}),p=this.bulletGraphicsContext.selectAll("rect.range").data(c,function(e){return e.key}),g=p.enter().append("rect").attr({x:function(e){return n[e.barIndex].x},y:function(e){return l.calculateLabelHeight(n[e.barIndex],e,o)},height:function(e){return e.start-e.end},width:s.BulletSize}).classed("range",!0).style({fill:function(e){return e.fill}});p.exit();var m=this.bulletGraphicsContext.selectAll("rect").data(h,function(e){return e.key});m.enter().append("rect").attr({x:function(e){return n[e.barIndex].x+s.BulletSize/3},y:function(e){return l.calculateLabelHeight(n[e.barIndex],e,o)},height:function(e){return e.start-e.end},width:1*s.BulletSize/4}).classed("value",!0).style({fill:function(e){return e.fill}}),m.exit();var y=this.bulletGraphicsContext.selectAll("values").data(u,function(e){return e.key});if(y.enter().append("line").attr({x2:function(e){return n[e.barIndex].x+3*s.MarkerMarginVertical},x1:function(e){return n[e.barIndex].x+s.MarkerMarginVertical},y2:function(e){return l.calculateLabelHeight(n[e.barIndex],null,o)+e.value},y1:function(e){return l.calculateLabelHeight(n[e.barIndex],null,o)+e.value}}).style({stroke:function(e){return e.fill},"stroke-width":2}),y.enter().append("line").attr({y1:function(e){return l.calculateLabelHeight(n[e.barIndex],null,o)+e.value2},y2:function(e){return l.calculateLabelHeight(n[e.barIndex],null,o)+e.value2},x1:function(e){return n[e.barIndex].x+s.MarkerMarginVertical},x2:function(e){return n[e.barIndex].x+3*s.MarkerMarginVertical}}).style({stroke:function(e){return e.fill},"stroke-width":2,transform:"rotate(45deg)","transform-origin":"50% 50% 0"}),y.enter().append("line").attr({y1:function(e){return l.calculateLabelHeight(n[e.barIndex],null,o)+e.value2},y2:function(e){return l.calculateLabelHeight(n[e.barIndex],null,o)+e.value2},x1:function(e){return n[e.barIndex].x+s.MarkerMarginVertical},x2:function(e){return n[e.barIndex].x+3*s.MarkerMarginVertical}}).style({stroke:function(e){return e.fill},"stroke-width":2,transform:"rotate(315deg)","transform-origin":"50% 50% 0"}),y.exit(),r.bulletChartSettings.axis.axis)for(var f=0;f<n.length;f++){var v=n[f];this.bulletGraphicsContext.append("g").attr({transform:function(){var e=v.x,t=l.calculateLabelHeight(v,null,o);return"translate("+e+","+t+")"}}).classed("axis",!0).call(v.axis.scale(v.scale)).style({fill:r.bulletChartSettings.axis.axisColor,"font-size":i.fromPoint(s.AxisFontSizeInPt)}).selectAll("line").style({stroke:r.bulletChartSettings.axis.axisColor})}if(r.bulletChartSettings.labelSettings.show&&d.enter().append("text").classed("title",!0).attr({x:function(e){return e.x},y:function(t){return o?l.bulletGraphicsContext.node().getBoundingClientRect().height+s.StartMarginVertical+s.BulletSize:t.y+e.TextMeasurementService.estimateSvgTextHeight(s.getTextProperties(t.categoryLabel,r.bulletChartSettings.labelSettings.fontSize))/2},fill:r.bulletChartSettings.labelSettings.labelColor,"font-size":i.fromPoint(r.bulletChartSettings.labelSettings.fontSize)}).text(function(e){return e.categoryLabel}),r.bulletChartSettings.axis.measureUnits&&d.enter().append("text").attr({x:function(e){return e.x+s.BulletSize},y:function(e){return o?l.bulletGraphicsContext.node().getBoundingClientRect().height+s.StartMarginVertical+s.SubtitleMargin:e.y+s.StartMarginVertical+s.SubtitleMargin},fill:r.bulletChartSettings.axis.unitsColor,"font-size":i.fromPoint(s.DefaultSubtitleFontSizeInPt)}).text(r.bulletChartSettings.axis.measureUnits),this.interactivityService){var x={rects:g,valueRects:m,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService,bulletChartSettings:this.model.bulletChartSettings,hasHighlights:!1},b=this.model.barRects.concat(this.model.valueRects);this.interactivityService.bind(b,this.behavior,x)}d.exit(),t.TooltipManager.addTooltip(m,function(e){return e.data.tooltipInfo},!0),t.TooltipManager.addTooltip(p,function(e){return e.data.tooltipInfo},!0)},s.prototype.destroy=function(){},s.prototype.enumerateObjectInstances=function(e){var t=this.model;if(t){var a=e.objectName;switch(a){case"labels":return this.enumerateLabels(t);case"values":return this.enumerateValues(t);case"orientation":return this.enumerateOrientation(t);case"axis":return this.enumerateAxis(t);case"colors":return this.enumerateColors(t)}}},s.prototype.enumerateLabels=function(e){return[{selector:null,objectName:"labels",properties:{show:this.model.bulletChartSettings.labelSettings.show,labelColor:this.model.bulletChartSettings.labelSettings.labelColor,fontSize:this.model.bulletChartSettings.labelSettings.fontSize}}]},s.prototype.enumerateValues=function(e){return[{selector:null,objectName:"values",properties:{targetValue:this.model.bulletChartSettings.values.targetValue,targetValue2:this.model.bulletChartSettings.values.targetValue2,minimumPercent:this.model.bulletChartSettings.values.minimumPercent,needsImprovementPercent:this.model.bulletChartSettings.values.needsImprovementPercent,satisfactoryPercent:this.model.bulletChartSettings.values.satisfactoryPercent,goodPercent:this.model.bulletChartSettings.values.goodPercent,veryGoodPercent:this.model.bulletChartSettings.values.veryGoodPercent,maximumPercent:this.model.bulletChartSettings.values.maximumPercent}}]},s.prototype.enumerateOrientation=function(e){return[{selector:null,objectName:"orientation",properties:{orientation:this.model.bulletChartSettings.orientation.orientation}}]},s.prototype.enumerateAxis=function(e){return[{selector:null,objectName:"axis",properties:{axis:this.model.bulletChartSettings.axis.axis,axisColor:this.model.bulletChartSettings.axis.axisColor,measureUnits:this.model.bulletChartSettings.axis.measureUnits,unitsColor:this.model.bulletChartSettings.axis.unitsColor}}]},s.prototype.enumerateColors=function(e){return[{selector:null,objectName:"colors",properties:{badColor:this.model.bulletChartSettings.colors.badColor,needsImprovementColor:this.model.bulletChartSettings.colors.needsImprovementColor,satisfactoryColor:this.model.bulletChartSettings.colors.satisfactoryColor,goodColor:this.model.bulletChartSettings.colors.goodColor,veryGoodColor:this.model.bulletChartSettings.colors.veryGoodColor,bulletColor:this.model.bulletChartSettings.colors.bulletColor}}]},s.ScrollBarSize=13,s.SpaceRequiredForBar=60,s.SpaceRequiredForBarVertically=100,s.StartMarginHorizontal=30,s.StartMarginVertical=50,s.BulletSize=25,s.DefaultSubtitleFontSizeInPt=9,s.BarMargin=10,s.MaxLabelWidth=80,s.MaxLabelHeight=60,s.SubtitleMargin=10,s.AxisFontSizeInPt=8,s.BiggestLabelWidth=0,s.BiggestLabelHeight=0,s.MarkerMarginHorizontal=s.BulletSize/3,s.MarkerMarginVertical=s.BulletSize/4,s.FontFamily="Segoe UI",s.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:"Category"},{name:"Value",kind:e.VisualDataRoleKind.Measure,displayName:"Value"},{name:"TargetValue",kind:e.VisualDataRoleKind.Measure,displayName:"Target Value"},{name:"Minimum",kind:e.VisualDataRoleKind.Measure,displayName:"Minimum"},{name:"NeedsImprovement",kind:e.VisualDataRoleKind.Measure,displayName:"Needs Improvement"},{name:"Satisfactory",kind:e.VisualDataRoleKind.Measure,displayName:"Satisfactory"},{name:"Good",kind:e.VisualDataRoleKind.Measure,displayName:"Good"},{name:"VeryGood",kind:e.VisualDataRoleKind.Measure,displayName:"Very Good"},{name:"Maximum",kind:e.VisualDataRoleKind.Measure,displayName:"Maximum"},{name:"TargetValue2",kind:e.VisualDataRoleKind.Measure,displayName:"Target Value 2"}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},values:{displayName:"Data values",properties:{targetValue:{displayName:"Target Value",type:{numeric:!0}},targetValue2:{displayName:"Target Value 2",type:{numeric:!0}},minimumPercent:{displayName:"Minimum %",type:{numeric:!0}},needsImprovementPercent:{displayName:"Needs Improvement %",type:{numeric:!0}},satisfactoryPercent:{displayName:"Satisfactory %",type:{numeric:!0}},goodPercent:{displayName:"Good %",type:{numeric:!0}},veryGoodPercent:{displayName:"Very Good %",type:{numeric:!0}},maximumPercent:{displayName:"Maximum %",type:{numeric:!0}}}},labels:{displayName:"Category labels",properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},labelColor:{displayName:e.data.createDisplayNameGetter("Visual_LabelsFill"),description:e.data.createDisplayNameGetter("Visual_LabelsFillDescription"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},orientation:{displayName:"Orientation",properties:{orientation:{displayName:"Orientation",type:{enumeration:r.type}}}},colors:{displayName:"Colors",properties:{badColor:{type:{fill:{solid:{color:!0}}},displayName:"Bad Color"},needsImprovementColor:{type:{fill:{solid:{color:!0}}},displayName:"Needs Improvement Color"},satisfactoryColor:{type:{fill:{solid:{color:!0}}},displayName:"Satisfactory Color"},goodColor:{type:{fill:{solid:{color:!0}}},displayName:"Good Color"},veryGoodColor:{type:{fill:{solid:{color:!0}}},displayName:"Very Good Color"},bulletColor:{type:{fill:{solid:{color:!0}}},displayName:"Bullet Color"}}},axis:{displayName:"Axis",properties:{axis:{displayName:"Axis",type:{bool:!0}},axisColor:{type:{fill:{solid:{color:!0}}},displayName:"Axis Color"},measureUnits:{type:{text:!0},displayName:"Measure Units "},unitsColor:{type:{fill:{solid:{color:!0}}},displayName:"Units Color"}}}},dataViewMappings:[{conditions:[{Category:{max:1},Value:{max:1},TargetValue:{max:1},Minimum:{max:1},NeedsImprovement:{max:1},Satisfactory:{max:1},Good:{max:1},VeryGood:{max:1},Maximum:{max:1},TargetValue2:{max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{select:[{bind:{to:"Value"}},{bind:{to:"TargetValue"}},{bind:{to:"TargetValue2"}},{bind:{to:"Minimum"}},{bind:{to:"NeedsImprovement"}},{bind:{to:"Satisfactory"}},{bind:{to:"Good"}},{bind:{to:"VeryGood"}},{bind:{to:"Maximum"}}]}}}],supportsHighlight:!0,sorting:{"default":{}},drilldown:{roles:["Category"]}},s}();a.BulletChart=s;var o;!function(e){function t(e){var t=r(e);return t.y+t.height}function a(){s||(s=$("<span/>"),$("body").append(s),o=d3.select($("body").get(0)).append("svg").style({height:"0px",width:"0px",position:"absolute"}).append("text"),l=$("<canvas/>").get(0).getContext("2d"))}function i(e){return a(),o.style(null),o.text(e.text).attr({visibility:"hidden","font-family":e.fontFamily,"font-size":e.fontSize,"font-weight":e.fontWeight,"font-style":e.fontStyle,"white-space":e.whiteSpace||"nowrap"}),o.node().getBBox()}function r(e){var t={fontFamily:e.fontFamily,fontSize:e.fontSize,text:"M"},a=i(t);return a}var s,o,l;e.estimateSvgTextBaselineDelta=t}(o=a.TextMeasurementHelper||(a.TextMeasurementHelper={}));var l=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.options=e;var a=e.clearCatcher;e.valueRects.on("click",function(e,a){d3.event.stopPropagation(),t.handleSelection(e,d3.event.ctrlKey)}),e.rects.on("click",function(e,a){d3.event.stopPropagation(),t.handleSelection(e,d3.event.ctrlKey)}),a.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var t=this.options;t.valueRects.style("opacity",function(t){return e?t.selected?"1":"0.4":"1"}),t.rects.style("opacity",function(t){return e?t.selected?"1":"0.4":"1"})},e}();a.BulletWebBehavior=l}(a=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a;!function(a){var i=e.visuals.valueFormatter,r=t.AnimatorCommon.GetAnimationDuration;!function(e){e[e.logn=0]="logn",e[e.sqrt=1]="sqrt",e[e.value=2]="value"}(a.WordCloudScaleType||(a.WordCloudScaleType={}));var s=a.WordCloudScaleType,o=function(){function e(e,t){this.defaultViewport=e||{width:0,height:0},this.defaultMargin=t||{top:0,bottom:0,right:0,left:0}}return Object.defineProperty(e.prototype,"margin",{get:function(){return this.marginValue||(this.margin=this.defaultMargin)},set:function(t){this.marginValue=e.restrictToMinMax(t),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this.viewportValue||(this.viewportValue=this.defaultViewport)},set:function(t){this.viewportValue=e.restrictToMinMax(t),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportIn",{get:function(){return this.viewportInValue||this.viewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportInIsZero",{get:function(){return 0===this.viewportIn.width||0===this.viewportIn.height},enumerable:!0,configurable:!0}),e.prototype.update=function(){this.viewportInValue=e.restrictToMinMax({width:this.viewport.width-(this.margin.left+this.margin.right),height:this.viewport.height-(this.margin.top+this.margin.bottom)})},e.restrictToMinMax=function(e){var t=$.extend({},e);return d3.keys(e).forEach(function(a){return t[a]=Math.max(0,e[a])}),t},e}(),l=function(){function a(e){this.durationAnimations=500,this.fakeViewport={width:1500,height:1e3},this.canvasViewport={width:128,height:2048},e&&(this.svg=e.svg||this.svg,this.layout=new o(null,e.margin||a.DefaultMargin),e.animator&&(this.animator=e.animator))}return a.prototype.init=function(e){var i=this;this.svg?this.root=this.svg:this.root=d3.select(e.element.get(0)).append("svg"),a.colors=e.style.colorPalette.dataColors,this.hostService=e.host,this.selectionManager=new t.utility.SelectionManager({hostServices:this.hostService}),this.layout||(this.layout=new o(null,a.DefaultMargin)),this.root.classed(a.ClassName,!0),this.root.on("click",function(){i.selectionManager.clear(),i.setSelection(i.wordsSelection)}),this.fontFamily=this.root.style("font-family"),this.main=this.root.append("g"),this.wordsContainerSelection=this.main.append("g").classed(a.Words["class"],!0),this.canvas=document.createElement("canvas")},a.prototype.converter=function(e){var i=this;if(!(e&&e.categorical&&e.categorical.categories&&e.categorical.categories[0]&&e.categorical.categories[0].values&&e.categorical.categories[0].values.length&&e.categorical.categories[0].values.length>0))return null;var r,s,o=e.categorical.categories[0].values,l=a.parseSettings(e,o[0]);return l?(_.isEmpty(e.categorical.values)||_.isEmpty(e.categorical.values[0])||_.isEmpty(e.categorical.values[0].values)||(r=e.categorical.values[0].values),s=o.map(function(s,o){var l,c=e.categorical.categories[0];return l=c.objects&&c.objects[o]?i.getColor(a.Properties.dataPoint.fill,n.util.getRandomColor(),c.objects[o]):i.wordCloudTexts&&i.wordCloudTexts[o]?i.wordCloudTexts[o].color:n.util.getRandomColor(),{text:s,count:r&&r[o]&&!isNaN(r[o])?r[o]:1,index:o,selectionId:t.SelectionId.createWithId(e.categorical.categories[0].identity[o]),color:l}}),{settings:l,texts:s}):null},a.prototype.getColor=function(e,i,r){var s;return s=new t.ColorHelper(a.colors,e,i),n.util.hexToRgb(s.getColorForMeasure(r,""))},a.parseSettings=function(t,r){if(!(t&&t.metadata&&t.metadata.columns&&t.metadata.columns[0]))return null;var s,o,l,n,c,h,u,d,p,g=t.metadata.objects,m=!1,y=!0,f=!0,v=!1;return p=a.getNumberFromObjects(g,a.Properties.general.maxNumberOfWords,a.DefaultSettings.maxNumberOfWords),o=a.getNumberFromObjects(g,a.Properties.general.minFontSize,a.DefaultSettings.minFontSize),l=a.getNumberFromObjects(g,a.Properties.general.maxFontSize,a.DefaultSettings.maxFontSize),n=a.getNumberFromObjects(g,a.Properties.rotateText.minAngle,a.DefaultSettings.minAngle),c=a.getNumberFromObjects(g,a.Properties.rotateText.maxAngle,a.DefaultSettings.maxAngle),m=e.DataViewObjects.getValue(g,a.Properties.rotateText.show,a.DefaultSettings.isRotateText),h=a.getNumberFromObjects(g,a.Properties.rotateText.maxNumberOfOrientations,a.DefaultSettings.maxNumberOfOrientations),s=i.create({format:i.getFormatString(t.categorical.categories[0].source,a.Properties.general.formatString),value:r}),y=e.DataViewObjects.getValue(g,a.Properties.general.isBrokenText,a.DefaultSettings.isBrokenText),f=e.DataViewObjects.getValue(g,a.Properties.stopWords.show,a.DefaultSettings.isRemoveStopWords),u=e.DataViewObjects.getValue(g,a.Properties.stopWords.words,a.DefaultSettings.stopWords),d="string"==typeof u?u.split(a.StopWordsDelemiter):a.DefaultSettings.stopWordsArray,v=e.DataViewObjects.getValue(g,a.Properties.stopWords.isDefaultStopWords,a.DefaultSettings.isDefaultStopWords),{minFontSize:o,maxFontSize:l,minAngle:n,maxAngle:c,maxNumberOfOrientations:h,valueFormatter:s,isRotateText:m,isBrokenText:y,isRemoveStopWords:f,stopWords:u,stopWordsArray:d,isDefaultStopWords:v,maxNumberOfWords:p}},a.getNumberFromObjects=function(t,a,i){return t?e.DataViewObjects.getValue(t,a,i):i},a.prototype.parseNumber=function(e,t,a,i){void 0===t&&(t=0),void 0===a&&(a=-Number.MAX_VALUE),void 0===i&&(i=Number.MAX_VALUE);var r=Number(e);return isNaN(r)||"string"==typeof e&&0===e.length?t:a>r?a:r>i?i:r},a.prototype.computePositions=function(e,t){var i,r=this,s=this.getCanvasContext(),o=[],l=null;if(!(e&&e.length>0))return null;i=Math.abs(this.parseNumber(this.settings.maxNumberOfWords,a.DefaultSettings.maxNumberOfWords,-1*e.length,e.length)),
e.length>i&&(e=e.slice(0,i));for(var n=void 0;n<(this.specialViewport.width>>5)*this.specialViewport.height;n++)o[n]=0;setTimeout(function(){return r.computeCycle(e,s,o,l,t,[],0)},0)},a.prototype.computeCycle=function(e,t,a,i,r,s,o){void 0===s&&(s=[]),void 0===o&&(o=0);var l=e[o],n=1;e.length<=10?n=5:e.length<=25?n=3:e.length<=75?n=1.5:e.length<=100&&(n=1.25),l.x=this.specialViewport.width/n*(Math.random()+.5)>>1,l.y=this.specialViewport.height/n*(Math.random()+.5)>>1,this.generateSprites(t,l,e,o),l.sprite&&this.findPosition(a,l,i)&&(s.push(l),i=this.updateBorders(l,i),l.x-=this.specialViewport.width>>1,l.y-=this.specialViewport.height>>1),++o<e.length&&this.root?this.computeCycle(e,t,a,i,r,s,o):r({data:s,leftBorder:i&&i[0],rightBorder:i&&i[1]})},a.prototype.updateBorders=function(e,t){if(t&&2===t.length){var a=t[0],i=t[1];e.x+e.x0<a.x&&(a.x=e.x+e.x0),e.y+e.y0<a.y&&(a.y=e.y+e.y0),e.x+e.x1>i.x&&(i.x=e.x+e.x1),e.y+e.y1>i.y&&(i.y=e.y+e.y1)}else t=[{x:e.x+e.x0,y:e.y+e.y0},{x:e.x+e.x1,y:e.y+e.y1}];return t},a.prototype.generateSprites=function(e,t,i,r){if(!t.sprite){e.clearRect(0,0,this.canvasViewport.width<<5,this.canvasViewport.height);for(var s,o=0,l=0,n=0,c=i.length,h=[],u=r;c>u;u++){var d=i[u],p=0,g=0;if(e.save(),e.font="normal normal "+(d.size+1)+a.Size+" "+this.fontFamily,p=e.measureText(d.text+"m").width,g=d.size<<1,d.rotate){var m=Math.sin(d.rotate*a.Radians),y=Math.cos(d.rotate*a.Radians),f=p*y,v=p*m,x=g*y,b=g*m;p=Math.max(Math.abs(f+b),Math.abs(f-b))+31>>5<<5,g=Math.floor(Math.max(Math.abs(v+x),Math.abs(v-x)))}else p=p+31>>5<<5;g>n&&(n=g),o+p>=this.canvasViewport.width<<5&&(o=0,l+=n,n=0),e.translate(o+(p>>1),l+(g>>1)),d.rotate&&e.rotate(d.rotate*a.Radians),e.fillText(d.text,0,0),d.padding&&(e.lineWidth=2*d.padding,e.strokeText(d.text,0,0)),e.restore(),d.width=p,d.height=g,d.xOff=o,d.yOff=l,d.x1=p>>1,d.y1=g>>1,d.x0=-d.x1,d.y0=-d.y1,o+=p}s=e.getImageData(0,0,this.canvasViewport.width<<5,this.canvasViewport.height).data,h=[];for(var u=c-1;u>=0;u--){var d=i[u],S=d.width,w=S>>5,C=d.y1-d.y0,D=0,P=0,A=0,N=0;if(d.xOff+S>=this.canvasViewport.width<<5||d.yOff+C>=this.canvasViewport.height)d.sprite=null;else{for(var T=0;C*w>T;T++)h[T]=0;if(null===d.xOff)return;D=d.xOff,P=d.yOff,A=0,N=-1;for(var T=0;C>T;T++){for(var V=0;S>V;V++){var L=w*T+(V>>5),M=(P+T)*(this.canvasViewport.width<<5)+(D+V)<<2,k=s[M]?1<<31-V%32:0;h[L]|=k,A|=k}A?N=T:(d.y0++,C--,T--,P++)}d.y1=d.y0+N,d.sprite=h.slice(0,(d.y1-d.y0)*w)}}}},a.prototype.findPosition=function(e,t,a){for(var i,r,s,o={x:t.x,y:t.y},l=Math.sqrt(this.specialViewport.width*this.specialViewport.width+this.specialViewport.height*this.specialViewport.height),n=Math.random()<.5?1:-1,c=-n;;){if(c+=n,i=this.archimedeanSpiral(c),r=Math.floor(i.x),s=Math.floor(i.y),Math.min(Math.abs(r),Math.abs(s))>=l)break;if(t.x=o.x+r,t.y=o.y+s,!(t.x+t.x0<0||t.y+t.y0<0||t.x+t.x1>this.specialViewport.width||t.y+t.y1>this.specialViewport.height)&&(!a||!this.checkIntersect(t,e))&&(!a||this.checkIntersectOfRectangles(t,a[0],a[1]))){for(var h=t.sprite,u=t.width>>5,d=this.specialViewport.width>>5,p=t.x-(u<<4),g=127&p,m=32-g,y=t.y1-t.y0,f=(t.y+t.y0)*d+(p>>5),v=0;y>v;v++){for(var x=0,b=0;u>=b;b++){var S=x<<m,w=void 0;u>b&&(x=h[v*u+b]),w=u>b?x>>>g:0,e[f+b]|=S|w}f+=d}return t.sprite=null,!0}}return!1},a.prototype.archimedeanSpiral=function(e){var t=this.specialViewport.width/this.specialViewport.height;return e=.1*e,{x:t*e*Math.cos(e),y:e*Math.sin(e)}},a.prototype.checkIntersect=function(e,t){for(var a=this.specialViewport.width>>5,i=e.sprite,r=e.width>>5,s=e.x-(r<<4),o=127&s,l=32-o,n=e.y1-e.y0,c=(e.y+e.y0)*a+(s>>5),h=0;n>h;h++){for(var u=0,d=0;r>=d;d++){var p=0,g=void 0,m=0;if(g=u<<l,r>d&&(u=i[h*r+d]),p=r>d?u>>>o:0,m=(g|p)&t[c+d])return!0}c+=a}return!1},a.prototype.checkIntersectOfRectangles=function(e,t,a){return e.x+e.x1>t.x&&e.x+e.x0<a.x&&e.y+e.y1>t.y&&e.y+e.y0<a.y},a.prototype.getCanvasContext=function(){if(!this.canvasViewport)return null;this.canvas.width=1,this.canvas.height=1;var e=this.canvas.getContext("2d");return this.canvas.width=this.canvasViewport.width<<5,this.canvas.height=this.canvasViewport.height,e=this.canvas.getContext("2d"),e.fillStyle=e.strokeStyle="red",e.textAlign="center",e},a.prototype.getReducedText=function(e){var t=[];return t=this.getBrokenWords(e),t.reduce(function(e,t){return e.some(function(e){return e.index!==t.index&&e.text===t.text?(e.count+=t.count,!0):!1})||e.push(t),e},[])},a.prototype.getBrokenWords=function(e){var t,i=this,r=[],s=/\s/;return this.settings.isBrokenText?(t=new RegExp("["+a.Punctuation.join("\\")+"]","gim"),e.forEach(function(e){if("string"==typeof e.text){var o;if(o=e.text.replace(t," ").split(s),i.settings.isRemoveStopWords){var l=i.settings.stopWordsArray;i.settings.isDefaultStopWords&&(l=l.concat(a.StopWords)),o=o.filter(function(e){return e.length>0&&!l.some(function(t){return e.toLocaleLowerCase()===t.toLocaleLowerCase()})})}o.forEach(function(t){t.length>0&&!s.test(t)&&r.push({text:t,count:e.count,index:e.index,selectionId:e.selectionId,color:e.color})})}else r.push(e)}),r):e},a.prototype.getWords=function(e){var t,a=this,i=0,r=0,s=this.settings.valueFormatter;if(!(e&&e.length>=1))return[];t=e.sort(function(e,t){return t.count-e.count}),i=t[t.length-1].count,r=t[0].count;var o=e.map(function(e){return{text:s.format(e.text),size:a.getFontSize(e.count,i,r),x:0,y:0,rotate:a.getAngle(),padding:1,width:0,height:0,xOff:0,yOff:0,x0:0,y0:0,x1:0,y1:0,color:e.color,selectionId:e.selectionId,wordIndex:e.index}});return this.dataBeforeRender=o,o},a.prototype.getFontSize=function(e,t,i,r){void 0===r&&(r=s.value);var o,l,n,c;if(c=Math.abs(this.parseNumber(this.settings.minFontSize,a.DefaultSettings.minFontSize)),n=Math.abs(this.parseNumber(this.settings.maxFontSize,a.DefaultSettings.maxFontSize)),c>n){var h=c;c=n,n=h}switch(r){case s.logn:o=Math.log(e);case s.sqrt:o=Math.sqrt(e);case s.value:o=e}return l=o>t?n*(o-t)/(i-t):0,l=100*l/n,l=l*(n-c)/100+c},a.prototype.getAngle=function(){if(!this.settings||!this.settings.isRotateText)return 0;var e,t,i,r;if(i=Math.abs(this.parseNumber(this.settings.maxNumberOfOrientations,0)),e=this.parseNumber(this.settings.minAngle,0,a.MinAngle,a.MaxAngle),t=this.parseNumber(this.settings.maxAngle,0,a.MinAngle,a.MaxAngle),e>t){var s=e;e=t,t=s}return r=Math.abs((t-e)/i*Math.floor(Math.random()*i)),0!==i?e+r:0},a.prototype.update=function(e){var t=this;if(e&&e.viewport&&e.dataViews&&e.dataViews[0]&&e.viewport&&e.viewport.height>=0&&e.viewport.width>=0){this.visualUpdateOptions=e,this.layout.viewport=this.visualUpdateOptions.viewport;var a=e.dataViews[0];this.layout.viewportInIsZero||(this.durationAnimations=r(this.animator,e.suppressAnimations),this.UpdateSize(),this.data=this.converter(a),this.data&&(this.settings=this.data.settings,this.wordCloudTexts=this.data.texts,this.computePositions(this.getWords(this.getReducedText(this.data.texts)),function(e){return t.render(e)}),e!==this.visualUpdateOptions&&this.update(this.visualUpdateOptions)))}},a.prototype.UpdateSize=function(){var e,t,a;a=Math.sqrt(this.fakeViewport.width*this.fakeViewport.height/(this.layout.viewportIn.width*this.layout.viewportIn.height)),isNaN(a)?t=e=1:(t=this.layout.viewportIn.height*a,e=this.layout.viewportIn.width*a),this.specialViewport={height:t,width:e},this.root.attr({height:this.layout.viewport.height,width:this.layout.viewport.width})},a.prototype.render=function(e){var i=this;if(e&&e.data){this.wordCloudDataView=e;var r,s=this.main.select(a.Words.selector).selectAll(a.Word.selector);this.wordsSelection=s.data(e.data),this.animation(this.wordsSelection,this.durationAnimations).attr("transform",function(e){return t.SVGUtil.translate(e.x,e.y)+"rotate("+e.rotate+")"}).style({"font-size":function(e){return""+e.size+a.Size},fill:function(e){return e.color}}),r=this.wordsSelection.enter().append("svg:text").attr("transform",function(e){return t.SVGUtil.translate(e.x,e.y)+"rotate("+e.rotate+")"}).style("font-size","1px"),this.wordsSelection.on("click",function(e){i.selectionManager.select(e.selectionId,d3.event.ctrlKey).then(function(){return i.setSelection(i.wordsSelection)}),d3.event.stopPropagation()}),this.animation(r,this.durationAnimations).style({"font-size":function(e){return""+e.size+a.Size},fill:function(e){return e.color}}),this.wordsSelection.text(function(e){return e.text}).classed(a.Word["class"],!0),this.wordsSelection.exit().remove(),this.setSelection(this.wordsSelection),setTimeout(function(){i.root&&i.scaleMainView(e,s[0].length&&i.durationAnimations)},this.durationAnimations+a.RenderDelay)}},a.prototype.setSelection=function(e){var t=this.selectionManager.getSelectionIds();if(t.some(function(t){return!e.data().some(function(e){return e.selectionId.getKey()===t.getKey()})})&&(this.selectionManager.clear(),t=[]),!t.length)return void this.setOpacity(e,a.MaxOpacity,!0);var i=e.filter(function(e){return t.some(function(t){return t.getKey()===e.selectionId.getKey()})});this.setOpacity(e,a.MinOpacity),this.setOpacity(i,a.MaxOpacity)},a.prototype.setOpacity=function(e,t,a){void 0===a&&(a=!1);var i=a?e:this.animation(e);i.style("fill-opacity",t)},a.prototype.scaleMainView=function(e,a){if(void 0===a&&(a=0),e&&e.leftBorder&&e.rightBorder){var i,r,s,o,l=1,n=this.main.node().getBBox(),c=e.leftBorder,h=e.rightBorder;s=this.layout.viewportIn.width/Math.abs(c.x-h.x),o=this.layout.viewportIn.height/Math.abs(c.y-h.y),l=Math.min(s,o),i=this.layout.margin.left+n.x*l*-1+(this.layout.viewportIn.width-n.width*l)/2,r=this.layout.margin.top+n.y*l*-1+(this.layout.viewportIn.height-n.height*l)/2,this.animation(this.main,a).attr("transform",t.SVGUtil.translate(i,r)+"scale("+l+")")}},a.prototype.enumerateObjectInstances=function(e){var i=this,r=[];if(!this.settings)return r;switch(e.objectName){case"general":var s={objectName:"general",displayName:"general",selector:null,properties:{maxNumberOfWords:this.settings.maxNumberOfWords,minFontSize:this.settings.minFontSize,maxFontSize:this.settings.maxFontSize,isBrokenText:this.settings.isBrokenText}};r.push(s);break;case"dataPoint":if(!this.wordCloudDataView||!this.wordCloudDataView.data)return;var o=this.dataBeforeRender,l=[];o.forEach(function(e){-1===l.indexOf(e.wordIndex)&&(l.push(e.wordIndex),r.push({objectName:"dataPoint",displayName:i.data.texts[e.wordIndex].text,selector:t.ColorHelper.normalizeSelector(e.selectionId.getSelector(),!1),properties:{fill:{solid:{color:e.color}}}}))});break;case"rotateText":var n={objectName:"rotateText",displayName:"Rotate Text",selector:null,properties:{show:this.settings.isRotateText,minAngle:this.settings.minAngle,maxAngle:this.settings.maxAngle,maxNumberOfOrientations:this.settings.maxNumberOfOrientations}};r.push(n);break;case"stopWords":var c={objectName:"stopWords",displayName:"Stop Words",selector:null,properties:{show:this.settings.isRemoveStopWords,isDefaultStopWords:this.settings.isDefaultStopWords,words:this.settings.stopWords||this.settings.stopWordsArray.join(a.StopWordsDelemiter)}};r.push(c)}return r},a.prototype.animation=function(e,t,a){return void 0===t&&(t=0),e.transition().duration(t).each("end",a)},a.prototype.destroy=function(){this.root=null,this.canvas=null},a.ClassName="wordCloud",a.Properties={general:{formatString:{objectName:"general",propertyName:"formatString"},maxNumberOfWords:{objectName:"general",propertyName:"maxNumberOfWords"},minFontSize:{objectName:"general",propertyName:"minFontSize"},maxFontSize:{objectName:"general",propertyName:"maxFontSize"},isBrokenText:{objectName:"general",propertyName:"isBrokenText"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}},stopWords:{show:{objectName:"stopWords",propertyName:"show"},isDefaultStopWords:{objectName:"stopWords",propertyName:"isDefaultStopWords"},words:{objectName:"stopWords",propertyName:"words"}},rotateText:{show:{objectName:"rotateText",propertyName:"show"},minAngle:{objectName:"rotateText",propertyName:"minAngle"},maxAngle:{objectName:"rotateText",propertyName:"maxAngle"},maxNumberOfOrientations:{objectName:"rotateText",propertyName:"maxNumberOfOrientations"}}},a.Words={"class":"words",selector:".words"},a.Word={"class":"word",selector:".word"},a.Size="px",a.StopWordsDelemiter=" ",a.Radians=Math.PI/180,a.MinAngle=-180,a.MaxAngle=180,a.MaxNumberOfWords=2500,a.MinOpacity=.2,a.MaxOpacity=1,a.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:"Category"},{name:"Values",kind:e.VisualDataRoleKind.Measure,displayName:"Values"}],dataViewMappings:[{conditions:[{Category:{min:1,max:1},Values:{min:0,max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{count:a.MaxNumberOfWords}}},values:{"for":{"in":"Values"}}}}],sorting:{implicit:{clauses:[{role:"Values",direction:2}]}},objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}},maxNumberOfWords:{displayName:"Max number of words",type:{numeric:!0}},minFontSize:{displayName:"Min Font",type:{numeric:!0}},maxFontSize:{displayName:"Max Font",type:{numeric:!0}},isBrokenText:{displayName:"Word-breaking",type:{bool:!0}},isRemoveStopWords:{displayName:"Stop Words",type:{bool:!0}}}},dataPoint:{displayName:"Data colors",properties:{fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}}}},stopWords:{displayName:"Stop Words",properties:{show:{displayName:"Show",type:{bool:!0}},isDefaultStopWords:{displayName:"Default Stop Words",type:{bool:!0}},words:{displayName:"Words",type:{text:!0}}}},rotateText:{displayName:"Rotate Text",properties:{show:{displayName:"Show",type:{bool:!0}},minAngle:{displayName:"Min Angle",type:{numeric:!0}},maxAngle:{displayName:"Max Angle",type:{numeric:!0}},maxNumberOfOrientations:{displayName:"Max number of orientations",type:{numeric:!0}}}}}},a.Punctuation=["!",".",":","'",";",",","!","@","#","$","%","^","&","*","(",")","[","]",'"',"\\","/","-","_","+","="],a.StopWords=["a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your"],a.DefaultSettings={minFontSize:20,maxFontSize:100,minAngle:-60,maxAngle:90,maxNumberOfOrientations:2,isRotateText:!1,isBrokenText:!0,isRemoveStopWords:!1,stopWordsArray:[],stopWords:void 0,isDefaultStopWords:!1,maxNumberOfWords:200},a.RenderDelay=50,a.DefaultMargin={top:10,right:10,bottom:10,left:10},a}();a.WordCloud=l;var n;!function(e){var t;!function(e){function t(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,a,i){return t+t+a+a+i+i});var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return a?"rgb("+parseInt(a[1],16)+","+parseInt(a[2],16)+","+parseInt(a[3],16)+")":null}function a(){var e=Math.floor(255*Math.random()),t=Math.floor(255*Math.random()),a=Math.floor(255*Math.random());return"rgb("+e+","+t+","+a+")"}e.hexToRgb=t,e.getRandomColor=a}(t=e.util||(e.util={}))}(n||(n={}))}(a=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a;!function(a){var i,r=jsCommon.CssConstants.createClassAndSelector,s=jsCommon.PixelConverter;!function(e){function t(e){return new o(e)}e.createTableView=t}(i=a.TableViewFactory||(a.TableViewFactory={}));var o=function(){function e(t){this.options=$.extend(!0,{},t),this.options.baseContainer.style("overflow-y","auto").attr("drag-resize-disabled",!0),this.scrollContainer=t.baseContainer.append("div").attr("class","scrollRegion"),this.visibleGroupContainer=this.scrollContainer.append("div").attr("class","visibleGroup"),e.SetDefaultOptions(t)}return e.SetDefaultOptions=function(t){t.rowHeight=t.rowHeight||e.defaultRowHeight},e.prototype.rowHeight=function(e){return this.options.rowHeight=Math.ceil(e),this},e.prototype.columnWidth=function(e){return this.options.columnWidth=Math.ceil(e),this},e.prototype.orientation=function(e){return this.options.orientation=e,this},e.prototype.rows=function(e){return this.options.rows=Math.ceil(e),this},e.prototype.columns=function(e){return this.options.columns=Math.ceil(e),this},e.prototype.data=function(e,t,a){return void 0===a&&(a=!1),this._data=e,this.getDatumIndex=t,this.setTotalRows(),a&&$(this.options.baseContainer.node()).scrollTop(0),this},e.prototype.viewport=function(e){return this.options.viewport=e,this},e.prototype.empty=function(){this._data=[],this.render()},e.prototype.setTotalRows=function(){var t=this._data.length,a=Math.min(this.options.rows,t),i=Math.min(this.options.columns,t);i>0&&a>0?(this._totalColumns=i,this._totalRows=a):a>0?(this._totalRows=a,this._totalColumns=Math.ceil(t/a)):i>0?(this._totalColumns=i,this._totalRows=Math.ceil(t/i)):(this._totalColumns=e.defaultColumns,this._totalRows=Math.ceil(t/e.defaultColumns))},e.prototype.render=function(){var t=this.options,a=this.visibleGroupContainer,i=t.rowHeight||e.defaultRowHeight,r=[],s=t.rows,o=t.columns,l=this._data.length,s=t.rows>l?l:t.rows,o=t.columns>l?l:t.columns;if(0===o&&0===s?t.orientation===c.HORIZONTAL?(o=l,s=1):(o=1,s=l):0===o&&s>0?o=Math.ceil(l/s):o>0&&0===s&&(s=Math.ceil(l/o)),this.options.orientation===c.VERTICAL){var n=s;s=o,o=n}else this.options.orientation===c.HORIZONTAL&&(0===s&&(s=this._totalRows),0===o&&(o=this._totalColumns));for(var h=0,u=0,d=0;s>d;d++)if(this.options.orientation===c.VERTICAL&&0===t.rows&&l%t.columns>0&&t.columns<=l)l%t.columns>d?(h=d*Math.ceil(l/t.columns),u=h+Math.ceil(l/t.columns),r.push(this._data.slice(h,u))):(r.push(this._data.slice(u,u+Math.floor(l/t.columns))),u+=Math.floor(l/t.columns));else if(this.options.orientation===c.HORIZONTAL&&0===t.columns&&l%t.rows>0&&t.rows<=l)l%t.rows>d?(h=d*Math.ceil(l/t.rows),u=h+Math.ceil(l/t.rows),r.push(this._data.slice(h,u))):(r.push(this._data.slice(u,u+Math.floor(l/t.rows))),u+=Math.floor(l/t.rows));else{var u=d*o;r.push(this._data.slice(u,u+o))}a.selectAll(".row").remove();var p=a.selectAll(".row").data(r).enter().append("div").classed("row",!0).selectAll(".cell").data(function(e){return e});p.enter().append("div").classed("cell",!0).call(function(e){return t.enter(e)}),p.order();var g=a.selectAll(".cell:not(.transitioning)");if(g.call(function(e){return t.update(e)}),g.style({height:i>0?i+"px":"auto"}),this.options.orientation===c.VERTICAL){for(var m=0,d=0;d<r.length;d++)0!==r[d].length&&(m=d+1);g.style({width:"100%"});var y=a.selectAll("div.row");y.style({width:t.columnWidth>0?t.columnWidth+"px":100/m+"%"})}else g.style({width:t.columnWidth>0?t.columnWidth+"px":100/o+"%"});p.exit().call(function(e){return t.exit(e)}).remove()},e.defaultRowHeight=0,e.defaultColumns=1,e}();a.chicletSlicerProps={general:{orientation:{objectName:"general",propertyName:"orientation"},columns:{objectName:"general",propertyName:"columns"},rows:{objectName:"general",propertyName:"rows"},showDisabled:{objectName:"general",propertyName:"showDisabled"},multiselect:{objectName:"general",propertyName:"multiselect"},selection:{objectName:"general",propertyName:"selection"}},header:{show:{objectName:"header",propertyName:"show"},title:{objectName:"header",propertyName:"title"},fontColor:{objectName:"header",propertyName:"fontColor"},background:{objectName:"header",propertyName:"background"},outline:{objectName:"header",propertyName:"outline"},textSize:{objectName:"header",propertyName:"textSize"},outlineColor:{objectName:"header",propertyName:"outlineColor"},outlineWeight:{objectName:"header",propertyName:"outlineWeight"}},rows:{fontColor:{objectName:"rows",propertyName:"fontColor"},textSize:{objectName:"rows",propertyName:"textSize"},height:{objectName:"rows",propertyName:"height"},width:{objectName:"rows",propertyName:"width"},background:{objectName:"rows",propertyName:"background"},transparency:{objectName:"rows",propertyName:"transparency"},selectedColor:{objectName:"rows",propertyName:"selectedColor"},unselectedColor:{objectName:"rows",propertyName:"unselectedColor"},disabledColor:{objectName:"rows",propertyName:"disabledColor"},outline:{objectName:"rows",propertyName:"outline"},outlineColor:{objectName:"rows",propertyName:"outlineColor"},outlineWeight:{objectName:"rows",propertyName:"outlineWeight"},borderStyle:{objectName:"rows",propertyName:"borderStyle"}},images:{imageSplit:{objectName:"images",propertyName:"imageSplit"},stretchImage:{objectName:"images",propertyName:"stretchImage"},bottomImage:{objectName:"images",propertyName:"bottomImage"}},selectedPropertyIdentifier:{objectName:"general",propertyName:"selected"},filterPropertyIdentifier:{objectName:"general",propertyName:"filter"},formatString:{objectName:"general",propertyName:"formatString"},hasSavedSelection:!0};var l;!function(t){t.ROUNDED="Rounded",t.CUT="Cut",t.SQUARE="Square",t.type=e.createEnumType([{value:t.ROUNDED,displayName:t.ROUNDED},{value:t.CUT,displayName:t.CUT},{value:t.SQUARE,displayName:t.SQUARE}])}(l||(l={}));var n;!function(t){t.INPLACE="Inplace",t.BOTTOM="Bottom",t.HIDE="Hide",t.type=e.createEnumType([{value:t.INPLACE,displayName:t.INPLACE},{value:t.BOTTOM,displayName:t.BOTTOM},{value:t.HIDE,displayName:t.HIDE}])}(n||(n={}));var c;!function(t){t.HORIZONTAL="Horizontal",t.VERTICAL="Vertical",t.type=e.createEnumType([{value:t.HORIZONTAL,displayName:t.HORIZONTAL},{value:t.VERTICAL,displayName:t.VERTICAL}])}(c||(c={}));var h=function(){function o(e){e&&e.behavior&&(this.behavior=e.behavior),this.behavior||(this.behavior=new p)}return o.DefaultStyleProperties=function(){return{general:{orientation:c.VERTICAL,columns:3,rows:0,multiselect:!0,showDisabled:n.INPLACE,selection:null},margin:{top:50,bottom:50,right:50,left:50},header:{borderBottomWidth:1,show:!0,outline:"BottomOnly",fontColor:"#a6a6a6",background:null,textSize:10,outlineColor:"#a6a6a6",outlineWeight:1,title:""},headerText:{marginLeft:8,marginTop:0},slicerText:{textSize:10,height:0,width:0,fontColor:"#666666",hoverColor:"#212121",selectedColor:"#BDD7EE",unselectedColor:"#ffffff",disabledColor:"grey",marginLeft:8,outline:"Frame",background:null,transparency:0,outlineColor:"#000000",outlineWeight:1,borderStyle:"Cut"},slicerItemContainer:{marginTop:5,marginLeft:0},images:{imageSplit:50,stretchImage:!1,bottomImage:!1}}},o.converter=function(i,r,s){if(i&&i.categorical&&i.categorical.categories&&i.categorical.categories[0]&&i.categorical.categories[0].values&&i.categorical.categories[0].values.length>0){var o=new u.ChicletSlicerConverter(i,s);o.convert();var l,n=this.DefaultStyleProperties(),c=i.metadata.objects;c&&(n.general.orientation=e.DataViewObjects.getValue(c,a.chicletSlicerProps.general.orientation,n.general.orientation),n.general.columns=e.DataViewObjects.getValue(c,a.chicletSlicerProps.general.columns,n.general.columns),n.general.rows=e.DataViewObjects.getValue(c,a.chicletSlicerProps.general.rows,n.general.rows),n.general.multiselect=e.DataViewObjects.getValue(c,a.chicletSlicerProps.general.multiselect,n.general.multiselect),n.general.showDisabled=e.DataViewObjects.getValue(c,a.chicletSlicerProps.general.showDisabled,n.general.showDisabled),n.general.selection=e.DataViewObjects.getValue(i.metadata.objects,a.chicletSlicerProps.general.selection,n.general.selection),n.header.show=e.DataViewObjects.getValue(c,a.chicletSlicerProps.header.show,n.header.show),n.header.title=e.DataViewObjects.getValue(c,a.chicletSlicerProps.header.title,n.header.title),n.header.fontColor=e.DataViewObjects.getFillColor(c,a.chicletSlicerProps.header.fontColor,n.header.fontColor),n.header.background=e.DataViewObjects.getFillColor(c,a.chicletSlicerProps.header.background,n.header.background),n.header.textSize=e.DataViewObjects.getValue(c,a.chicletSlicerProps.header.textSize,n.header.textSize),n.header.outline=e.DataViewObjects.getValue(c,a.chicletSlicerProps.header.outline,n.header.outline),n.header.outlineColor=e.DataViewObjects.getFillColor(c,a.chicletSlicerProps.header.outlineColor,n.header.outlineColor),n.header.outlineWeight=e.DataViewObjects.getValue(c,a.chicletSlicerProps.header.outlineWeight,n.header.outlineWeight),n.slicerText.textSize=e.DataViewObjects.getValue(c,a.chicletSlicerProps.rows.textSize,n.slicerText.textSize),n.slicerText.height=e.DataViewObjects.getValue(c,a.chicletSlicerProps.rows.height,n.slicerText.height),n.slicerText.width=e.DataViewObjects.getValue(c,a.chicletSlicerProps.rows.width,n.slicerText.width),n.slicerText.selectedColor=e.DataViewObjects.getFillColor(c,a.chicletSlicerProps.rows.selectedColor,n.slicerText.selectedColor),n.slicerText.unselectedColor=e.DataViewObjects.getFillColor(c,a.chicletSlicerProps.rows.unselectedColor,n.slicerText.unselectedColor),n.slicerText.disabledColor=e.DataViewObjects.getFillColor(c,a.chicletSlicerProps.rows.disabledColor,n.slicerText.disabledColor),n.slicerText.background=e.DataViewObjects.getFillColor(c,a.chicletSlicerProps.rows.background,n.slicerText.background),n.slicerText.transparency=e.DataViewObjects.getValue(c,a.chicletSlicerProps.rows.transparency,n.slicerText.transparency),n.slicerText.fontColor=e.DataViewObjects.getFillColor(c,a.chicletSlicerProps.rows.fontColor,n.slicerText.fontColor),n.slicerText.outline=e.DataViewObjects.getValue(c,a.chicletSlicerProps.rows.outline,n.slicerText.outline),n.slicerText.outlineColor=e.DataViewObjects.getFillColor(c,a.chicletSlicerProps.rows.outlineColor,n.slicerText.outlineColor),n.slicerText.outlineWeight=e.DataViewObjects.getValue(c,a.chicletSlicerProps.rows.outlineWeight,n.slicerText.outlineWeight),n.slicerText.borderStyle=e.DataViewObjects.getValue(c,a.chicletSlicerProps.rows.borderStyle,n.slicerText.borderStyle),n.images.imageSplit=e.DataViewObjects.getValue(c,a.chicletSlicerProps.images.imageSplit,n.images.imageSplit),n.images.stretchImage=e.DataViewObjects.getValue(c,a.chicletSlicerProps.images.stretchImage,n.images.stretchImage),n.images.bottomImage=e.DataViewObjects.getValue(c,a.chicletSlicerProps.images.bottomImage,n.images.bottomImage));var h=i.categorical.categories[0];return l={categorySourceName:h.source.displayName,formatString:t.valueFormatter.getFormatString(h.source,a.chicletSlicerProps.formatString),slicerSettings:n,slicerDataPoints:o.dataPoints},l.hasSelectionOverride=o.hasSelectionOverride,l}},o.prototype.init=function(e){this.element=e.element,this.currentViewport=e.viewport,this.behavior&&(this.interactivityService=t.createInteractivityService(e.host)),this.hostServices=e.host,this.settings=o.DefaultStyleProperties(),this.initContainer()},o.prototype.update=function(t){if(t&&t.dataViews&&t.dataViews[0]&&t.viewport){var a=this.dataView;this.dataView=t.dataViews[0];var i=!0;a&&(i=!e.DataViewAnalysis.hasSameCategoryIdentity(a,this.dataView)),t.viewport.height===this.currentViewport.height&&t.viewport.width===this.currentViewport.width?this.waitingForData=!1:this.currentViewport=t.viewport,this.updateInternal(i)}},o.prototype.onResizing=function(e){this.currentViewport=e,this.updateInternal(!1)},o.prototype.enumerateObjectInstances=function(e){var t=this.slicerData;if(t){var a=e.objectName;switch(a){case"rows":return this.enumerateRows(t);case"header":return this.enumerateHeader(t);case"general":return this.enumerateGeneral(t);case"images":return this.enumerateImages(t)}}},o.prototype.enumerateHeader=function(e){var t=this.settings;return[{selector:null,objectName:"header",properties:{show:t.header.show,title:t.header.title,fontColor:t.header.fontColor,background:t.header.background,textSize:t.header.textSize,outline:t.header.outline,outlineColor:t.header.outlineColor,outlineWeight:t.header.outlineWeight}}]},o.prototype.enumerateRows=function(e){var t=this.settings;return[{selector:null,objectName:"rows",properties:{textSize:t.slicerText.textSize,height:t.slicerText.height,width:t.slicerText.width,background:t.slicerText.background,transparency:t.slicerText.transparency,selectedColor:t.slicerText.selectedColor,unselectedColor:t.slicerText.unselectedColor,disabledColor:t.slicerText.disabledColor,outline:t.slicerText.outline,outlineColor:t.slicerText.outlineColor,outlineWeight:t.slicerText.outlineWeight,fontColor:t.slicerText.fontColor,borderStyle:t.slicerText.borderStyle}}]},o.prototype.enumerateGeneral=function(e){var t=this.settings;return[{selector:null,objectName:"general",properties:{orientation:t.general.orientation,columns:t.general.columns,rows:t.general.rows,showDisabled:t.general.showDisabled,multiselect:t.general.multiselect}}]},o.prototype.enumerateImages=function(e){var t=this.settings;return[{selector:null,objectName:"images",properties:{imageSplit:t.images.imageSplit,stretchImage:t.images.stretchImage,bottomImage:t.images.bottomImage}}]},o.prototype.updateInternal=function(t){var a=this;this.updateSlicerBodyDimensions();var i="Select All",r=o.converter(this.dataView,i,this.interactivityService);if(!r)return void this.tableView.empty();this.interactivityService&&this.interactivityService.applySelectionStateToData(r.slicerDataPoints),r.slicerSettings.header.outlineWeight=r.slicerSettings.header.outlineWeight<0?0:r.slicerSettings.header.outlineWeight,r.slicerSettings.slicerText.outlineWeight=r.slicerSettings.slicerText.outlineWeight<0?0:r.slicerSettings.slicerText.outlineWeight,r.slicerSettings.general.getSavedSelection=function(){try{return JSON.parse(a.slicerData.slicerSettings.general.selection)||[]}catch(e){return[]}},r.slicerSettings.general.setSavedSelection=function(e){a.isSelectionSaved=!0,a.hostServices.persistProperties({merge:[{objectName:"general",selector:null,properties:{selection:e&&JSON.stringify(e)||""}}]})},this.slicerData?this.isSelectionSaved?this.isSelectionLoaded=!0:this.isSelectionLoaded=this.slicerData.slicerSettings.general.selection===r.slicerSettings.general.selection:this.isSelectionLoaded=!1,this.slicerData=r,this.settings=this.slicerData.slicerSettings,this.settings.general.showDisabled===n.BOTTOM?r.slicerDataPoints.sort(function(e,t){return e.selectable===t.selectable?0:e.selectable&&!t.selectable?-1:1}):this.settings.general.showDisabled===n.HIDE&&(r.slicerDataPoints=r.slicerDataPoints.filter(function(e){return e.selectable}));var s=this.settings.slicerText.height;if(0===s){var l=o.cellTotalInnerPaddings+o.cellTotalInnerBorders,c=o.getChicletTextProperties(this.settings.slicerText.textSize);s=e.TextMeasurementService.estimateSvgTextHeight(c)+e.TextMeasurementService.estimateSvgTextBaselineDelta(c)+l;var h=_.any(r.slicerDataPoints,function(e){return""!==e.imageURL&&"undefined"!=typeof e.imageURL});h&&(s+=100)}this.tableView.rowHeight(s).columnWidth(this.settings.slicerText.width).orientation(this.settings.general.orientation).rows(this.settings.general.rows).columns(this.settings.general.columns).data(r.slicerDataPoints,function(e){return $.inArray(e,r.slicerDataPoints)},t).viewport(this.getSlicerBodyViewport(this.currentViewport)).render()},o.prototype.initContainer=function(){var a=this,r=this.settings,l=this.getSlicerBodyViewport(this.currentViewport),n=d3.select(this.element.get(0)).append("div").classed(o.Container["class"],!0);this.slicerHeader=n.append("div").classed(o.Header["class"],!0),this.slicerHeader.append("span").classed(o.Clear["class"],!0).attr("title","Clear"),this.slicerHeader.append("div").classed(o.HeaderText["class"],!0).style({"margin-left":s.toString(r.headerText.marginLeft),"margin-top":s.toString(r.headerText.marginTop),"border-style":this.getBorderStyle(r.header.outline),"border-color":r.header.outlineColor,"border-width":this.getBorderWidth(r.header.outline,r.header.outlineWeight),"font-size":s.fromPoint(r.header.textSize)}),this.slicerBody=n.append("div").classed(o.Body["class"],!0).classed("slicerBody-horizontal",r.general.orientation===c.HORIZONTAL).classed("slicerBody-vertical",r.general.orientation===c.VERTICAL).style({
height:s.toString(l.height),width:"100%"});var h=function(e){var t=a.settings,i=e.append("li").classed(o.ItemContainer["class"],!0).style({"margin-left":s.toString(t.slicerItemContainer.marginLeft)});i.append("div").classed("slicer-img-wrapper",!0),i.append("div").classed("slicer-text-wrapper",!0).append("span").classed(o.LabelText["class"],!0).style({"font-size":s.fromPoint(t.slicerText.textSize)})},u=function(i){var r=a.settings,l=a.slicerData;if(l&&r){a.slicerHeader.classed("hidden",!r.header.show),a.slicerHeader.select(o.HeaderText.selector).text(""!==r.header.title.trim()?r.header.title.trim():a.slicerData.categorySourceName).style({"border-style":a.getBorderStyle(r.header.outline),"border-color":r.header.outlineColor,"border-width":a.getBorderWidth(r.header.outline,r.header.outlineWeight),color:r.header.fontColor,"background-color":r.header.background,"font-size":s.fromPoint(r.header.textSize)}),a.slicerBody.classed("slicerBody-horizontal",r.general.orientation===c.HORIZONTAL).classed("slicerBody-vertical",r.general.orientation===c.VERTICAL);var n=i.selectAll(o.LabelText.selector),h=o.getChicletTextProperties(r.slicerText.textSize),u=l.formatString;n.text(function(i){var s=t.valueFormatter.format(i.category,u);return h.text=s,0===a.settings.slicerText.width?e.TextMeasurementService.getTailoredTextOrDefault(h,a.currentViewport.width/a.settings.general.columns-o.chicletTotalInnerRightLeftPaddings-o.cellTotalInnerBorders-r.slicerText.outlineWeight):e.TextMeasurementService.getTailoredTextOrDefault(h,a.settings.slicerText.width-o.chicletTotalInnerRightLeftPaddings-o.cellTotalInnerBorders-r.slicerText.outlineWeight)});var d=i.selectAll(".slicer-img-wrapper");if(d.style("height",r.images.imageSplit+"%").classed("hidden",function(e){return e.imageURL?r.images.imageSplit<10?!0:void 0:!0}).style("display",function(e){return e.imageURL?"flex":"none"}).classed("stretchImage",r.images.stretchImage).classed("bottomImage",r.images.bottomImage).style("background-image",function(e){return e.imageURL?"url("+e.imageURL+")":""}),i.selectAll(".slicer-text-wrapper").style("height",function(e){return e.imageURL?100-r.images.imageSplit+"%":"100%"}).classed("hidden",function(e){return r.images.imageSplit>90?!0:void 0}),i.selectAll(".slicerItemContainer").style({color:r.slicerText.fontColor,"border-style":a.getBorderStyle(r.slicerText.outline),"border-color":r.slicerText.outlineColor,"border-width":a.getBorderWidth(r.slicerText.outline,r.slicerText.outlineWeight),"font-size":s.fromPoint(r.slicerText.textSize),"border-radius":a.getBorderRadius(r.slicerText.borderStyle)}),r.slicerText.background?a.slicerBody.style("background-color",g.util.hexToRGBString(r.slicerText.background,(100-r.slicerText.transparency)/100)):a.slicerBody.style("background-color",null),a.interactivityService&&a.slicerBody){var p=a.slicerBody.attr("width",a.currentViewport.width),m=p.selectAll(o.ItemContainer.selector),y=p.selectAll(o.LabelText.selector),f=p.selectAll(o.Input.selector),v=a.slicerHeader.select(o.Clear.selector),x={dataPoints:l.slicerDataPoints,slicerItemContainers:m,slicerItemLabels:y,slicerItemInputs:f,slicerClear:v,interactivityService:a.interactivityService,slicerSettings:l.slicerSettings,isSelectionLoaded:a.isSelectionLoaded};a.interactivityService.bind(l.slicerDataPoints,a.behavior,x,{overrideSelectionFromData:!0,hasSelectionOverride:l.hasSelectionOverride}),a.behavior.styleSlicerInputs(i.select(o.ItemContainer.selector),a.interactivityService.hasSelection())}else a.behavior.styleSlicerInputs(i.select(o.ItemContainer.selector),!1)}},d=function(e){e.remove()},p={rowHeight:this.getRowHeight(),columnWidth:this.settings.slicerText.width,orientation:this.settings.general.orientation,rows:this.settings.general.rows,columns:this.settings.general.columns,enter:h,exit:d,update:u,loadMoreData:function(){return a.onLoadMoreData()},scrollEnabled:!0,viewport:this.getSlicerBodyViewport(this.currentViewport),baseContainer:this.slicerBody};this.tableView=i.createTableView(p)},o.prototype.onLoadMoreData=function(){!this.waitingForData&&this.dataView.metadata&&this.dataView.metadata.segment&&(this.hostServices.loadMoreData(),this.waitingForData=!0)},o.prototype.getSlicerBodyViewport=function(e){var t=this.settings,a=t.header.show?this.getHeaderHeight():0,i=e.height-(a+t.header.borderBottomWidth);return{height:i,width:e.width}},o.prototype.updateSlicerBodyDimensions=function(){var e=this.getSlicerBodyViewport(this.currentViewport);this.slicerBody.style({height:s.toString(e.height),width:"100%"})},o.getChicletTextProperties=function(e){return{fontFamily:o.DefaultFontFamily,fontSize:s.fromPoint(e||o.DefaultFontSizeInPt)}},o.prototype.getHeaderHeight=function(){return e.TextMeasurementService.estimateSvgTextHeight(o.getChicletTextProperties(this.settings.header.textSize))},o.prototype.getRowHeight=function(){var t=this.settings.slicerText;return 0!==t.height?t.height:e.TextMeasurementService.estimateSvgTextHeight(o.getChicletTextProperties(t.textSize))},o.prototype.getBorderStyle=function(e){return"0px"===e?"none":"solid"},o.prototype.getBorderWidth=function(e,t){switch(e){case"None":return"0px";case"BottomOnly":return"0px 0px "+t+"px 0px";case"TopOnly":return t+"px 0px 0px 0px";case"TopBottom":return t+"px 0px "+t+"px 0px";case"LeftRight":return"0px "+t+"px 0px "+t+"px";case"Frame":return t+"px";default:return e.replace("1",t.toString())}},o.prototype.getBorderRadius=function(e){switch(e){case l.ROUNDED:return"10px";case l.SQUARE:return"0px";default:return"5px"}},o.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Field")},{name:"Values",kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Values")},{name:"Image",kind:e.VisualDataRoleKind.Grouping,displayName:"Image"}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{selection:{displayName:"Selection",type:{text:!0}},orientation:{displayName:"Orientation",type:{enumeration:c.type}},columns:{displayName:"Columns",type:{numeric:!0}},rows:{displayName:"Rows",type:{numeric:!0}},showDisabled:{displayName:"Show Disabled",type:{enumeration:n.type}},multiselect:{displayName:"Multiple selection",type:{bool:!0}},selected:{type:{bool:!0}},filter:{type:{filter:{}},rule:{output:{property:"selected",selector:["Category"]}}},formatString:{type:{formatting:{formatString:!0}}}}},header:{displayName:e.data.createDisplayNameGetter("Visual_Header"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},title:{displayName:"Title",type:{text:!0}},fontColor:{displayName:e.data.createDisplayNameGetter("Visual_FontColor"),type:{fill:{solid:{color:!0}}}},background:{displayName:e.data.createDisplayNameGetter("Visual_Background"),type:{fill:{solid:{color:!0}}}},outline:{displayName:e.data.createDisplayNameGetter("Visual_Outline"),type:{formatting:{outline:!0}}},textSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{numeric:!0}},outlineColor:{displayName:"Outline Color",type:{fill:{solid:{color:!0}}}},outlineWeight:{displayName:"Outline Weight",type:{numeric:!0}}}},rows:{displayName:"Chiclets",properties:{fontColor:{displayName:"Text color",type:{fill:{solid:{color:!0}}}},textSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{numeric:!0}},height:{displayName:"Height",type:{numeric:!0}},width:{displayName:"Width",type:{numeric:!0}},selectedColor:{displayName:"Selected Color",type:{fill:{solid:{color:!0}}}},unselectedColor:{displayName:"Unselected Color",type:{fill:{solid:{color:!0}}}},disabledColor:{displayName:"Disabled Color",type:{fill:{solid:{color:!0}}}},background:{displayName:e.data.createDisplayNameGetter("Visual_Background"),type:{fill:{solid:{color:!0}}}},transparency:{displayName:"Transparency",description:"Set transparency for background color",type:{numeric:!0}},outline:{displayName:e.data.createDisplayNameGetter("Visual_Outline"),type:{formatting:{outline:!0}}},outlineColor:{displayName:"Outline Color",type:{fill:{solid:{color:!0}}}},outlineWeight:{displayName:"Outline Weight",type:{numeric:!0}},borderStyle:{displayName:"Outline Style",type:{enumeration:l.type}}}},images:{displayName:"Images",properties:{imageSplit:{displayName:"Image Split",type:{numeric:!0}},stretchImage:{displayName:"Stretch image",type:{bool:!0}},bottomImage:{displayName:"Bottom image",type:{bool:!0}}}}},dataViewMappings:[{conditions:[{Category:{max:1},Image:{min:0,max:1},Values:{min:0,max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{group:{by:"Image",select:[{bind:{to:"Values"}}],dataReductionAlgorithm:{top:{}}}},includeEmptyGroups:!0}}],supportsHighlight:!0,sorting:{"default":{}},suppressDefaultTitle:!0},o.DefaultFontFamily="Segoe UI, Tahoma, Verdana, Geneva, sans-serif",o.DefaultFontSizeInPt=11,o.cellTotalInnerPaddings=8,o.cellTotalInnerBorders=2,o.chicletTotalInnerRightLeftPaddings=14,o.ItemContainer=r("slicerItemContainer"),o.HeaderText=r("headerText"),o.Container=r("chicletSlicer"),o.LabelText=r("slicerText"),o.Header=r("slicerHeader"),o.Input=r("slicerCheckbox"),o.Clear=r("clear"),o.Body=r("slicerBody"),o}();a.ChicletSlicer=h;var u;!function(i){var r=function(){function i(e,i){var r=e.categorical;this.dataViewCategorical=r,this.dataViewMetadata=e.metadata,r.categories&&r.categories.length>0&&(this.category=r.categories[0],this.categoryIdentities=this.category.identity,this.categoryValues=this.category.values,this.categoryColumnRef=this.category.identityFields,this.categoryFormatString=t.valueFormatter.getFormatString(this.category.source,a.chicletSlicerProps.formatString)),this.dataPoints=[],this.interactivityService=i,this.hasSelectionOverride=!1}return i.prototype.convert=function(){if(this.dataPoints=[],this.numberOfCategoriesSelectedInData=0,this.categoryValues){var i,r=this.dataViewMetadata?this.dataViewMetadata.objects:void 0,s=void 0;if(r&&r.general&&r.general.filter){if(!this.categoryColumnRef)return;var o=r.general.filter,l=e.data.SQExprConverter.asScopeIdsContainer(o,this.categoryColumnRef);l?(s=l.isNot,i=l.scopeIds?l.scopeIds.length:0):s=!1}this.interactivityService&&(void 0===s?s=this.interactivityService.isSelectionModeInverted():this.interactivityService.setSelectionModeInverted(s));for(var n=void 0,c=0;c<this.categoryValues.length;c++){var h=t.isCategoryColumnSelected(a.chicletSlicerProps.selectedPropertyIdentifier,this.category,c);if(null!=h){n=h;break}}for(var u=this.dataViewCategorical,d=a.chicletSlicerProps.formatString,p=-(1/0),g="",m=0,y=this.categoryValues.length;y>m;m++){var f=this.category.identity?this.category.identity[m]:null,v=t.isCategoryColumnSelected(a.chicletSlicerProps.selectedPropertyIdentifier,this.category,m),x=!0;null!=n&&(s?(null==this.category.objects&&(v=void 0),null!=v?v=n:null==v&&(v=!n)):null==v&&(v=!n)),v&&this.numberOfCategoriesSelectedInData++;var b=this.categoryValues[m],S=t.valueFormatter.format(b,this.categoryFormatString);if(this.dataViewCategorical.values)for(var w=0;w<this.dataViewCategorical.values.length;w++){var C=u.values[w];null!=C.values[m]&&(p=C.values[m],C.highlights&&(x=!(null===C.highlights[m])),C.source.groupName&&""!==C.source.groupName&&(g=t.converterHelper.getFormattedLegendLabel(C.source,u.values,d),/^(ftp|http|https):\/\/[^ "]+$/.test(g)||(g=void 0)))}this.dataPoints.push({identity:t.SelectionId.createWithId(f),category:S,imageURL:g,value:p,selected:v,selectable:x})}null!=i&&i>this.numberOfCategoriesSelectedInData&&(this.hasSelectionOverride=!0)}},i}();i.ChicletSlicerConverter=r}(u||(u={}));var d;!function(e){function t(e){var t=r(e);return t.y+t.height}function a(){s||(s=$("<span/>"),$("body").append(s),o=d3.select($("body").get(0)).append("svg").style({height:"0px",width:"0px",position:"absolute"}).append("text"),l=$("<canvas/>").get(0).getContext("2d"))}function i(e){return a(),o.style(null),o.text(e.text).attr({visibility:"hidden","font-family":e.fontFamily,"font-size":e.fontSize,"font-weight":e.fontWeight,"font-style":e.fontStyle,"white-space":e.whiteSpace||"nowrap"}),o.node().getBBox()}function r(e){var t={fontFamily:e.fontFamily,fontSize:e.fontSize,text:"M"},a=i(t);return a}var s,o,l;e.estimateSvgTextBaselineDelta=t}(d=a.ChicletSlicerTextMeasurementHelper||(a.ChicletSlicerTextMeasurementHelper={}));var p=function(){function e(){}return e.prototype.bindEvents=function(e,t){var i=this,r=a.chicletSlicerProps.filterPropertyIdentifier,s=this.slicers=e.slicerItemContainers;this.slicerItemLabels=e.slicerItemLabels,this.slicerItemInputs=e.slicerItemInputs;var o=e.slicerClear;this.dataPoints=e.dataPoints,this.interactivityService=e.interactivityService,this.slicerSettings=e.slicerSettings,this.options=e,this.options.isSelectionLoaded||this.loadSelection(t),s.on("mouseover",function(e){e.selectable&&(e.mouseOver=!0,e.mouseOut=!1,i.renderMouseover())}),s.on("mouseout",function(e){e.selectable&&(e.mouseOver=!1,e.mouseOut=!0,i.renderMouseover())}),s.on("click",function(e,a){if(e.selectable){var s=i.slicerSettings;if(d3.event.preventDefault(),d3.event.altKey&&s.general.multiselect){var o=jQuery.map(i.dataPoints,function(e,t){return e.selected?t:void 0}),l=o.length>0?o[o.length-1]:0;if(l>a){var n=a;a=l,l=n}t.handleClearSelection();for(var c=l;a>=c;c++)t.handleSelection(i.dataPoints[c],!0)}else d3.event.ctrlKey&&s.general.multiselect?t.handleSelection(e,!0):t.handleSelection(e,!1);t.persistSelectionFilter(r),i.saveSelection(t)}}),o.on("click",function(e){t.handleClearSelection(),t.persistSelectionFilter(r),i.saveSelection(t)})},e.prototype.loadSelection=function(e){e.handleClearSelection();var t=this.slicerSettings.general.getSavedSelection();if(t.length){var i=this.dataPoints.filter(function(e){return t.some(function(t){return e.identity.getKey()===t})});i.forEach(function(t){return e.handleSelection(t,!0)}),e.persistSelectionFilter(a.chicletSlicerProps.filterPropertyIdentifier)}},e.prototype.saveSelection=function(e){var t=e.selectedIds.map(function(e){return e.getKey()});this.slicerSettings.general.setSavedSelection(t)},e.prototype.renderSelection=function(e){e||this.interactivityService.isSelectionModeInverted()?this.styleSlicerInputs(this.slicers,e):this.slicers.style("background",this.slicerSettings.slicerText.unselectedColor)},e.prototype.renderMouseover=function(){var e=this;this.slicerItemLabels.style({color:function(t){return t.mouseOver?e.slicerSettings.slicerText.hoverColor:t.mouseOut?t.selected?e.slicerSettings.slicerText.fontColor:e.slicerSettings.slicerText.fontColor:void 0}})},e.prototype.styleSlicerInputs=function(e,t){var a=this.slicerSettings,i=[];e.each(function(e){e.selectable&&e.selected&&i.push(e),d3.select(this).style({background:e.selectable?e.selected?a.slicerText.selectedColor:a.slicerText.unselectedColor:a.slicerText.disabledColor}),d3.select(this).classed("slicerItem-disabled",!e.selectable)})},e}();a.ChicletSlicerWebBehavior=p;var g;!function(e){var t;!function(e){function t(e,t){var a=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(a,function(e,t,a,i){return t+t+a+a+i+i});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),r=i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null;return null===r?"":t||0===t?"rgba("+r.r+","+r.g+","+r.b+","+t+")":"rgb("+r.r+","+r.g+","+r.b+")"}e.hexToRGBString=t}(t=e.util||(e.util={}))}(g||(g={}))}(a=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a;!function(a){var i=function(){function a(){}return a.converter=function(e,i,r){var s=e.categorical,o=a.getDefaultDataPointColor(e).solid.color,l=a.getLabelsColor(e),n=a.getLabelsFontSize(e);if(s&&s.categories&&s.categories.length>0&&s.values&&s.categories[0].values&&s.categories[0].values[0]){for(var c=s.categories[0],h=c.values,u=s.values,d=[],p={dataPoints:[],title:u[0]&&u[0].source?u[0].source.displayName:""},g=[],m=[],y=1e3,f=[],v=[],x=[],b=!1,S=[],w=new t.ColorHelper(i,a.chordChartProps.dataPoint.fill,o),C=0,D=h.length;D>C;C++)x[h[C]]=C;for(var C=0,D=u.length;D>C;C++){var P=t.converterHelper.getSeriesName(u[C].source);f.push(P),v[P]=C}var A=this.union_arrays(h,f);a.getValidArrayLength(A)===a.getValidArrayLength(h)+a.getValidArrayLength(f)&&(b=!0);for(var N=a.chordChartProps.general.formatString,T=t.valueFormatter.getFormatString(c.source,N),C=0,D=A.length;D>C;C++){var V=null,L="",M=!1;if(void 0!==x[A[C]]){var k=x[A[C]];V=t.SelectionIdBuilder.builder().withCategory(c,x[A[C]]).createSelectionId(),M=!0;var j=c.objects?c.objects[k]:void 0;L=w.getColorForSeriesValue(j,void 0,h[k])}else if(void 0!==v[A[C]]){var k=v[A[C]],I=u[k],O=I&&I.objects&&I.objects[0],P=t.converterHelper.getSeriesName(I.source);V=t.SelectionId.createWithId(I.identity),M=!1,L=w.getColorForSeriesValue(O,void 0,P)}S.push({label:A[C],labelColor:l,barColor:L,isCategory:M,identity:V,selected:!1}),d.push([]),g.push([]);for(var G=t.valueFormatter.format(h[C],T),F=0,R=A.length;R>F;F++){var z=0,B=[];if(void 0!==x[A[C]]&&void 0!==v[A[F]]){var H=x[A[C]],E=v[A[F]];null!==u[E].values[H]&&(z=u[E].values[H],z>y&&(y=z),B=t.TooltipBuilder.createTooltipInfo(N,s,G,z,null,null,E,H))}else if(b&&void 0!==x[A[F]]&&void 0!==v[A[C]]){var H=x[A[F]],E=v[A[C]];null!==u[E].values[H]&&(z=u[E].values[H])}d[C].push(z),g[C].push({tooltipInfo:B})}var W=d3.sum(d[C]);m.push({tooltipInfo:[{displayName:A[C],value:a.isInt(W)?W.toFixed(0):W.toFixed(2)}]})}var U=d3.layout.chord().padding(.1).matrix(d),_=Math.round(y/5).toString().length-1;return{dataMatrix:d,labelDataPoints:a.convertToChordArcDescriptor(U.groups(),S),legendData:p,tooltipData:g,sliceTooltipData:m,tickUnit:Math.pow(10,_),differentFromTo:b,defaultDataPointColor:o,prevAxisVisible:r,showAllDataPoints:a.getShowAllDataPoints(e),showLabels:a.getLabelsShow(e),showAxis:a.getAxisShow(e),labelFontSize:n}}return{dataMatrix:[],labelDataPoints:[],legendData:null,tooltipData:[],sliceTooltipData:[],tickUnit:1e3,differentFromTo:!1,defaultDataPointColor:o,prevAxisVisible:r,showAllDataPoints:a.getShowAllDataPoints(e),showLabels:a.getLabelsShow(e),showAxis:a.getAxisShow(e),labelFontSize:n}},a.getValidArrayLength=function(e){for(var t=0,a=0,i=e.length;i>a;a++)void 0!==e[a]&&t++;return t},a.convertToChordArcDescriptor=function(e,t){for(var a=[],i=0,r=e.length;r>i;i++){var s=e[i];s.data=t[i],a.push(s)}return a},a.prototype.calculateRadius=function(e){if(this.data&&this.data.showLabels){var t=e.height/e.width,a=2+1/(1+Math.exp(-5*(t-1)));return Math.min(e.height,e.width)/a}return Math.min(e.height,e.width)/2},a.drawDefaultCategoryLabels=function(e,i,r,s){var o=d3.svg.arc().innerRadius(0).outerRadius(r*a.InnerArcRadiusRatio),l=d3.svg.arc().innerRadius(r*a.OuterArcRadiusRatio).outerRadius(r*a.OuterArcRadiusRatio);if(i.showLabels){var n=a.getChordChartLabelLayout(r,l,s,i.labelFontSize);a.drawDefaultLabelsForChordChart(i.labelDataPoints,e,n,s,r,o,l)}else t.dataLabelUtils.cleanDataLabels(e,!0)},a.prototype.init=function(e){var i=this.element=e.element;this.selectionManager=new t.utility.SelectionManager({hostServices:e.host}),this.svg=d3.select(i.get(0)).append("svg").style("position","absolute").classed(a.VisualClassName,!0),this.mainGraphicsContext=this.svg.append("g"),this.mainGraphicsContext.append("g").classed("slices",!0),this.mainGraphicsContext.append("g").classed("ticks",!0),this.mainGraphicsContext.append("g").classed("chords",!0),this.colors=e.style.colorPalette.dataColors},a.prototype.update=function(e){var i=this;if(e.dataViews&&e.dataViews[0]){var r=e.suppressAnimations?0:t.AnimatorCommon.MinervaAnimationDuration,s=this.dataView=e.dataViews[0],o=this.data?this.data.showAxis:!a.getAxisShow(s),l=this.data=a.converter(s,this.colors,o),n=e.viewport,c=this.chordLayout=d3.layout.chord().padding(.1).matrix(l.dataMatrix),h=n.width,u=n.height,d=this.calculateRadius(n),p=this.selectionManager,g=d,m=d*a.InnerArcRadiusRatio,y=d3.svg.arc().innerRadius(g).outerRadius(m);this.svg.attr({width:h,height:u});var f=this.mainGraphicsContext.attr("transform",t.SVGUtil.translate(h/2,u/2)),v=this.svg.select(".slices").selectAll("path"+a.sliceClass.selector).data(c.groups);v.enter().insert("path").classed(a.sliceClass["class"],!0),v.style("fill",function(e,t){return l.labelDataPoints[t].data.barColor}).style("stroke",function(e,t){return l.labelDataPoints[t].data.barColor}).on("click",function(e,t){var a=this;p.select(l.labelDataPoints[t].data.identity).then(function(e){e.length>0?(f.selectAll(".chords path.chord").style("opacity",1),f.selectAll(".slices path.slice").style("opacity",.3),f.selectAll(".chords path.chord").filter(function(e){return e.source.index!==t&&e.target.index!==t}).style("opacity",.3),d3.select(a).style("opacity",1)):(v.style("opacity",1),f.selectAll(".chords path.chord").filter(function(e){return e.source.index!==t&&e.target.index!==t}).style("opacity",1))}),d3.event.stopPropagation()}).transition().duration(r).attr("d",y),v.exit().remove(),t.TooltipManager.addTooltip(v,function(e){return l.sliceTooltipData[e.data.index].tooltipInfo});var x=this.svg.select(".chords").selectAll("path"+a.chordClass.selector).data(c.chords);x.enter().insert("path").classed(a.chordClass["class"],!0),x.style("fill",function(e,t){return l.labelDataPoints[e.target.index].data.barColor}).style("opacity",1).transition().duration(r).attr("d",d3.svg.chord().radius(g)),x.exit().remove(),this.svg.on("click",function(){return i.selectionManager.clear().then(function(){v.style("opacity",1),x.style("opacity",1)})}),a.drawTicks(this.mainGraphicsContext,l,c,m,r,n),a.drawDefaultCategoryLabels(this.mainGraphicsContext,l,d,n),t.TooltipManager.addTooltip(x,function(e){var t=[];return l.differentFromTo?t=l.tooltipData[e.data.source.index][e.data.source.subindex].tooltipInfo:(t.push({displayName:l.labelDataPoints[e.data.source.index].data.label+"->"+l.labelDataPoints[e.data.source.subindex].data.label,value:l.dataMatrix[e.data.source.index][e.data.source.subindex].toString()}),t.push({displayName:l.labelDataPoints[e.data.target.index].data.label+"->"+l.labelDataPoints[e.data.target.subindex].data.label,value:l.dataMatrix[e.data.target.index][e.data.target.subindex].toString()})),t})}},a.prototype.destroy=function(){},a.cleanTicks=function(e){var t=[],i=e.selectAll(a.tickLineClass.selector).data(t);i.exit().remove();var r=e.selectAll(a.tickTextClass.selector).data(t);r.exit().remove(),e.selectAll(a.tickPairClass.selector).remove(),e.selectAll(a.sliceTicksClass.selector).remove()},a.drawTicks=function(e,t,i,r,s,o){if(t.showAxis){var l=e.select(".ticks").selectAll("g"+a.sliceTicksClass.selector).data(i.groups),n=t.prevAxisVisible===t.showAxis?s:0;l.enter().insert("g").classed(a.sliceTicksClass["class"],!0);var c=l.selectAll("g"+a.tickPairClass.selector).data(function(e){var a=(e.endAngle-e.startAngle)/e.value,i=d3.range(0,e.value,e.value-1<.15?.15:e.value-1),r=i.map(function(i,r){var s=1e3,o="k";t.tickUnit>=1e6?(s=1e6,o="m"):t.tickUnit>=1e3?(s=1e3,o="k"):(s=1,o="");var l={angle:i*a+e.startAngle,label:Math.floor(i/s)+o};return l});return r});c.enter().insert("g").classed(a.tickPairClass["class"],!0),c.transition().duration(n).attr("transform",function(e){return"rotate("+(180*e.angle/Math.PI-90)+")translate("+r+",0)"}),c.selectAll("line"+a.tickLineClass.selector).data(function(e){return[e]}).enter().insert("line").classed(a.tickLineClass["class"],!0).style("stroke","#000").attr("x1",1).attr("y1",0).attr("x2",5).attr("y2",0),c.selectAll("text"+a.tickTextClass.selector).data(function(e){return[e]}).enter().insert("text").classed(a.tickTextClass["class"],!0).style("text-anchor",function(e){return e.angle>Math.PI?"end":null}).text(function(e){return e.label}).attr("transform",function(e){return e.angle>Math.PI?"rotate(180)translate(-16)":null}).attr("x",8).attr("dy",".35em"),c.exit().remove(),l.exit().remove()}else a.cleanTicks(e)},a.getAxisShow=function(e){if(e&&e.metadata){var t=e.metadata.objects;if(t){var a=t.axis;if(a&&a.hasOwnProperty("show"))return a.show}}return!0},a.getLabelsShow=function(e){if(e&&e.metadata){var t=e.metadata.objects;if(t){var a=t.labels;if(a&&a.hasOwnProperty("show"))return a.show}}return!0},a.getLabelsColor=function(e){if(e&&e.metadata){var t=e.metadata.objects;if(t){var i=t.labels;if(i&&i.hasOwnProperty("color"))return i.color.solid.color}}return a.DefaultLabelColor},a.getLabelsFontSize=function(e){if(e&&e.metadata){var t=e.metadata.objects;if(t){var i=t.labels;if(i&&i.hasOwnProperty("fontSize"))return i.fontSize}}return a.DefaultLabelsFontSize},a.selectLabels=function(e,i,r,s){if(void 0===r&&(r=!1),void 0===s&&(s=!1),0===e.length)return t.dataLabelUtils.cleanDataLabels(i,!0),null;i.select(a.labelGraphicsContextClass.selector).empty()&&i.append("g").classed(a.labelGraphicsContextClass["class"],!0);var o=null!==e[0].key,l=null!==e[0].identity,n=o?function(e){return e.key}:l?function(e){return e.identity.getKey()}:void 0,c=r?i.select(a.labelGraphicsContextClass.selector).selectAll(a.labelsClass.selector).data(e,function(e){return e.data.identity.getKey()}):null!==n?i.select(a.labelGraphicsContextClass.selector).selectAll(a.labelsClass.selector).data(e,n):i.select(a.labelGraphicsContextClass.selector).selectAll(a.labelsClass.selector).data(e),h=c.enter().append("text").classed(a.labelsClass["class"],!0);return s&&h.style("opacity",0),c},a.drawDefaultLabelsForChordChart=function(t,i,r,s,o,l,n){var c=new e.DataLabelManager,h=c.hideCollidedLabels(s,t,r,!0),u=a.selectLabels(h,i,!0);if(u){u.attr({x:function(e){return e.labelX},y:function(e){return e.labelY},dy:".35em"}).text(function(e){return e.labeltext}).style(r.style),u.exit().remove(),i.select(a.linesGraphicsContextClass.selector).empty()&&i.append("g").classed(a.linesGraphicsContextClass["class"],!0);var d=i.select(a.linesGraphicsContextClass.selector).selectAll("polyline").data(h,function(e){return e.data.identity.getKey()}),p=2.05,g=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2};d.enter().append("polyline").classed(a.lineClass["class"],!0),d.attr("points",function(e){var t=n.centroid(e);t[0]=.95*o*(g(e)<Math.PI?1:-1);var a=n.centroid(e),i=l.centroid(e);return i[0]*=p,i[1]*=p,[i,a,t]}).style({opacity:function(e){return a.PolylineOpacity},stroke:function(e){return e.data.labelColor}}),d.exit().remove()}},a.getChordChartLabelLayout=function(e,a,i,r){var s=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2},o=i.width/2-e,l=Math.min(o,t.dataLabelUtils.maxLabelWidth),n=jsCommon.PixelConverter;return{labelText:function(e){return t.dataLabelUtils.getLabelFormattedText({label:e.data.label,maxWidth:l,fontSize:r})},labelLayout:{x:function(t){return e*(s(t)<Math.PI?1:-1)},y:function(e){var t=a.centroid(e);return t[1]}},filter:function(e){return null!==e&&null!==e.data&&null!==e.data.label},style:{fill:function(e){return e.data.labelColor},"text-anchor":function(e){return s(e)<Math.PI?"start":"end"},"font-size":function(e){return n.fromPointToPixel(r)}}}},a.getDefaultDataPointColor=function(e,t){if(e&&e.metadata){var a=e.metadata.objects;if(a){var i=a.dataPoint;if(i&&i.hasOwnProperty("defaultColor")){var r=i.defaultColor;if(r)return r}}}return{solid:{color:t}}},a.getShowAllDataPoints=function(e){if(!e||!e.metadata||!e.metadata.objects)return!1;var t=e.metadata.objects,a=t.dataPoint;return a&&a.hasOwnProperty("showAllDataPoints")?a.showAllDataPoints:!1},a.prototype.enumerateObjectInstances=function(e){var i,r=[];switch(e.objectName){case"axis":i={objectName:"axis",displayName:"Axis",selector:null,properties:{show:a.getAxisShow(this.dataView)}},r.push(i);break;case"labels":i={objectName:"labels",displayName:"Labels",selector:null,properties:{show:a.getLabelsShow(this.dataView),color:a.getLabelsColor(this.dataView),fontSize:a.getLabelsFontSize(this.dataView)}},r.push(i);break;case"dataPoint":var s={objectName:"dataPoint",selector:null,properties:{defaultColor:{solid:{color:this.data&&this.data.defaultDataPointColor?this.data.defaultDataPointColor:this.colors.getColorByIndex(0).value}}}};r.push(s);var o={objectName:"dataPoint",selector:null,properties:{showAllDataPoints:this.data?!!this.data.showAllDataPoints:!1}};if(r.push(o),this.data&&this.data.labelDataPoints)for(var l=0,n=this.data.labelDataPoints.length;n>l;l++){var c=this.data.labelDataPoints[l].data;if(c.isCategory){var h={objectName:"dataPoint",displayName:c.label,selector:t.ColorHelper.normalizeSelector(c.identity.getSelector()),properties:{fill:{solid:{color:c.barColor}}}};r.push(h)}}}return r},a.isInt=function(e){return e%1===0},a.union_arrays=function(e,t){for(var a={},i=0;i<e.length;i++)a[e[i]]=e[i];for(var i=0;i<t.length;i++)a[t[i]]=t[i];var r=[];for(var s in a)a.hasOwnProperty(s)&&r.push(a[s]);return r},a.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:"From"},{name:"Series",kind:e.VisualDataRoleKind.Grouping,displayName:"To"},{name:"Y",kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Values")}],dataViewMappings:[{conditions:[{Category:{max:1},Series:{max:0}},{Category:{max:1},Series:{min:1,max:1},Y:{max:1}},{Category:{max:1},Series:{max:0},Y:{min:0,max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{group:{by:"Series",select:[{bind:{to:"Y"}}],dataReductionAlgorithm:{top:{}}}},rowCount:{preferred:{min:2},supported:{min:1}}}}],objects:{dataPoint:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint"),properties:{defaultColor:{displayName:e.data.createDisplayNameGetter("Visual_DefaultColor"),type:{fill:{solid:{color:!0}}}},showAllDataPoints:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint_Show_All"),type:{bool:!0}},fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}},axis:{displayName:"Axis",properties:{show:{type:{bool:!0}}}},labels:{displayName:"Labels",properties:{show:{type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_Reference_Line_Data_Label_Color"),description:e.data.createDisplayNameGetter("Visual_Reference_Line_Data_Label_Color_Description"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}}}},a.chordChartProps={general:{formatString:{objectName:"general",propertyName:"formatString"}},dataPoint:{defaultColor:{objectName:"dataPoint",propertyName:"defaultColor"},fill:{objectName:"dataPoint",propertyName:"fill"},showAllDataPoints:{objectName:"dataPoint",propertyName:"showAllDataPoints"}},axis:{show:{objectName:"axis",propertyName:"show"}},labels:{show:{objectName:"labels",propertyName:"show"},color:{objectName:"labels",propertyName:"color"},fontSize:{objectName:"labels",propertyName:"fontSize"}}},a.PolylineOpacity=.5,a.OuterArcRadiusRatio=.9,a.InnerArcRadiusRatio=.8,a.DefaultLabelColor="#777777",a.DefaultLabelsFontSize=12,a.VisualClassName="chordChart",a.sliceClass={"class":"slice",selector:".slice"},a.chordClass={"class":"chord",selector:".chord"},a.sliceTicksClass={"class":"slice-ticks",selector:".slice-ticks"},a.tickPairClass={"class":"tick-pair",selector:".tick-pair"},a.tickLineClass={"class":"tick-line",selector:".tick-line"},a.tickTextClass={"class":"tick-text",selector:".tick-text"},a.labelGraphicsContextClass={"class":"labels",selector:".labels"},a.labelsClass={"class":"data-labels",selector:".data-labels"},a.linesGraphicsContextClass={"class":"lines",selector:".lines"},a.lineClass={"class":"line-label",selector:".line-label"},a}();a.ChordChart=i}(a=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a;!function(a){var i=e.data.DataRoleHelper,r=function(){function a(){this.AxisGraphicsContextClassName="axisGraphicsContext",this.ScrollBarWidth=10,this.textProperties={fontFamily:"wf_segoe-ui_normal",fontSize:jsCommon.PixelConverter.toString(a.AxisFontSize)}}return Object.defineProperty(a.prototype,"margin",{get:function(){return this._margin||{left:0,right:0,top:0,bottom:0}},set:function(e){
this._margin=$.extend({},e),this._viewportIn=a.substractMargin(this.viewport,this.margin)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"viewport",{get:function(){return this._viewport||{width:0,height:0}},set:function(e){this._viewport=$.extend({},e),this._viewportIn=a.substractMargin(this.viewport,this.margin)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"viewportIn",{get:function(){return this._viewportIn||this.viewport},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"legendViewport",{get:function(){return this.legend.getMargins()},enumerable:!0,configurable:!0}),a.substractMargin=function(e,t){return{width:Math.max(e.width-(t.left+t.right),0),height:Math.max(e.height-(t.top+t.bottom),0)}},a.getCustomSymbolType=function(e){var t=d3.map({circle:function(e){var t=Math.sqrt(e/Math.PI);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"},cross:function(e){var t=Math.sqrt(e/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(e){var t=Math.sqrt(e/(2*Math.tan(Math.PI/6))),a=t*Math.tan(Math.PI/6);return"M0,"+-t+"L"+a+",0 0,"+t+" "+-a+",0Z"},square:function(e){var t=Math.sqrt(e)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-up":function(e){var t=Math.sqrt(e/Math.sqrt(3)),a=t*Math.sqrt(3)/2;return"M0,"+-a+"L"+t+","+a+" "+-t+","+a+"Z"},"triangle-down":function(e){var t=Math.sqrt(e/Math.sqrt(3)),a=t*Math.sqrt(3)/2;return"M0,"+a+"L"+t+","+-a+" "+-t+","+-a+"Z"},star:function(e){for(var t=Math.sqrt(e/2),a=Math.sqrt(e/10),i="",r=Math.PI/5,s=0;10>s;s++){var o=0===(1&s)?t:a,l=Math.cos(s*r)*o,n=Math.sin(s*r)*o;0===s?i="M"+l+","+n+"L":i+=" "+l+","+n}return i+"Z"},hexagon:function(e){var t=Math.sqrt(e/(6*Math.sqrt(3))),a=Math.sqrt(e/(2*Math.sqrt(3)));return"M0,"+2*t+"L"+-a+","+t+" "+-a+","+-t+" 0,"+-2*t+" "+a+","+-t+" "+a+","+t+"Z"},x:function(e){var t=Math.sqrt(e/10);return"M0,"+t+"L"+-t+","+2*t+" "+-2*t+","+t+" "+-t+",0 "+-2*t+","+-t+" "+-t+","+-2*t+" 0,"+-t+" "+t+","+-2*t+" "+2*t+","+-t+" "+t+",0 "+2*t+","+t+" "+t+","+2*t+"Z"},uparrow:function(e){var t=Math.sqrt(e/12);return"M"+t+","+3*t+"L"+-t+","+3*t+" "+-t+","+-t+" "+-2*t+","+-t+" 0,"+-3*t+" "+2*t+","+-t+" "+t+","+-t+"Z"},downarrow:function(e){var t=Math.sqrt(e/12);return"M0,"+3*t+"L"+-2*t+","+t+" "+-t+","+t+" "+-t+","+-3*t+" "+t+","+-3*t+" "+t+","+t+" "+2*t+","+t+"Z"}}),a=t.entries()[0].value;if(e){if(isNaN(e))return t[e&&e.toString().toLowerCase()]||a;var i=t.entries()[Math.floor(e)];return i?i.value:a}return a},a.prototype.init=function(e){this.options=e,this.animator=new t.BaseAnimator,this.behavior=new t.CartesianChartBehavior([new t.ScatterChartWebBehavior]);var i=this.element=e.element;this.viewport=_.clone(e.viewport),this.style=e.style,this.hostServices=e.host,this.colors=this.style.colorPalette.dataColors,this.interactivity=e.interactivity,this.margin={top:1,right:1,bottom:1,left:1},this.yAxisOrientation=t.yAxisPosition.left,this.adjustMargins();var r=this.scrollY=!0,s=this.scrollX=!0,o=this.svg=d3.select(i.get(0)).append("svg").style("position","absolute").classed(a.ClassName,!0),l=this.axisGraphicsContext=o.append("g").classed(this.AxisGraphicsContextClassName,!0);this.svgScrollable=o.append("svg").classed("svgScrollable",!0).style("overflow","hidden");var n=this.axisGraphicsContextScrollable=this.svgScrollable.append("g").classed(this.AxisGraphicsContextClassName,!0);this.clearCatcher=t.appendClearCatcher(this.axisGraphicsContextScrollable);var c=r?n:l;this.backgroundGraphicsContext=l.append("svg:image"),this.xAxisGraphicsContext=r?l.append("g").attr("class","x axis"):n.append("g").attr("class","x axis"),this.y1AxisGraphicsContext=c.append("g").attr("class","y axis"),this.xAxisGraphicsContext.classed("showLinesOnAxis",r),this.y1AxisGraphicsContext.classed("showLinesOnAxis",s),this.xAxisGraphicsContext.classed("hideLinesOnAxis",!r),this.y1AxisGraphicsContext.classed("hideLinesOnAxis",!s),this.interactivityService=t.createInteractivityService(this.hostServices),this.legend=t.createLegend(i,this.interactivity&&this.interactivity.isInteractiveLegend,this.interactivityService,!0),this.mainGraphicsG=this.axisGraphicsContextScrollable.append("g").classed(a.MainGraphicsContextClassName,!0),this.mainGraphicsContext=this.mainGraphicsG.append("svg"),this.svgDefaultImage="http://svg-edit.googlecode.com/svn-history/r1771/trunk/clipart/sun.svg",this.keyArray=[]},a.prototype.adjustMargins=function(){var e=this.element.find(".x.axis");0===t.AxisHelper.getRecommendedNumberOfTicksForXAxis(this.viewportIn.width)&&0===t.AxisHelper.getRecommendedNumberOfTicksForYAxis(this.viewportIn.height)?(this.margin={top:0,right:0,bottom:0,left:0},e.hide()):e.show()},a.prototype.getValueAxisProperties=function(e,t){var a={};if(!e)return a;var i=e.objects;if(i){var r=i.valueAxis;r&&(a={show:r.show,position:r.position,axisScale:r.axisScale,start:r.start,end:r.end,showAxisTitle:null==r.showAxisTitle?t:r.showAxisTitle,axisStyle:r.axisStyle,axisColor:r.axisColor,secShow:r.secShow,secPosition:r.secPosition,secAxisScale:r.secAxisScale,secStart:r.secStart,secEnd:r.secEnd,secShowAxisTitle:r.secShowAxisTitle,secAxisStyle:r.secAxisStyle,labelDisplayUnits:r.labelDisplayUnits})}return a},a.prototype.getCategoryAxisProperties=function(e,t){var a={};if(!e)return a;var i=e.objects;if(i){var r=i.categoryAxis;r&&(a={show:r.show,axisType:r.axisType,axisScale:r.axisScale,axisColor:r.axisColor,start:r.start,end:r.end,showAxisTitle:null==r.showAxisTitle?t:r.showAxisTitle,axisStyle:r.axisStyle,labelDisplayUnits:r.labelDisplayUnits})}return a},a.converter=function(r,s,o,l,n,c){var h,u,d,p,g,m=r.categorical,y=r.metadata;m.categories&&m.categories.length>0?(h=m.categories[0].values,u=t.valueFormatter.create({format:t.valueFormatter.getFormatString(m.categories[0].source,t.scatterChartProps.general.formatString),value:h[0],value2:h[h.length-1]}),p=m.categories[0].identity,d=m.categories[0].objects,g=m.categories[0].source.queryName):(h=[null],u=t.valueFormatter.createDefaultFormatter(null));var f=m.categories,v=m.values,x=!!v.source,b=v.grouped(),S=!(i.getMeasureIndexOfRole(b,"Image")>=0),w=i.getMeasureIndexOfRole(b,"ColorFill")>=0,C=v.source,D=a.getMetadata(b,C),P=t.dataLabelUtils.getDefaultPointLabelSettings(),A=!1,N={show:!1,url:""},T=!1,V=!1,L="",M=!0;if(y&&y.objects){var k=y.objects;L=e.DataViewObjects.getFillColor(k,t.columnChartProps.dataPoint.defaultColor),M=e.DataViewObjects.getValue(k,t.columnChartProps.dataPoint.showAllDataPoints);var j=k.categoryLabels;j&&(P.show=void 0!==j.show?j.show:P.show,P.fontSize=void 0!==j.fontSize?j.fontSize:P.fontSize,void 0!==j.color&&(P.labelColor=j.color.solid.color)),A=e.DataViewObjects.getValue(k,t.scatterChartProps.fillPoint.show,A);var I=k.backdrop;void 0!==I&&(N.show=I.show,N.show&&(N.url=I.url));var O=k.crosshair;void 0!==O&&(T=O.show);var G=k.outline;void 0!==G&&(V=G.show)}var F=a.createDataPoints(v,D,f,h,u,p,d,o,x,P,L,g);l&&l.applySelectionStateToData(F);var R=x?a.createSeriesLegend(v,o,v,t.valueFormatter.getFormatString(C,t.scatterChartProps.general.formatString),L):[],z=v&&C?C.displayName:"";z||(z=f&&f[0].source.displayName?f[0].source.displayName:"");var B={title:z,dataPoints:R},H=a.getSizeRangeForGroups(b,D.idx.size);if(n&&null!==n.showAxisTitle&&n.showAxisTitle===!1&&(D.axesLabels.x=null),c&&null!==c.showAxisTitle&&c.showAxisTitle===!1&&(D.axesLabels.y=null),F&&F[0]){var E=F[0];null!=E.backdrop&&(N.show=!0,N.url=E.backdrop),null!=E.xStart&&(n.start=E.xStart),null!=E.xEnd&&(n.end=E.xEnd),null!=E.yStart&&(c.start=E.yStart),null!=E.yEnd&&(c.end=E.yEnd)}return{xCol:D.cols.x,yCol:D.cols.y,dataPoints:F,legendData:B,axesLabels:D.axesLabels,selectedIds:[],size:D.cols.size,sizeRange:H,dataLabelsSettings:P,defaultDataPointColor:L,hasDynamicSeries:x,showAllDataPoints:M,fillPoint:A,useShape:S,useCustomColor:w,backdrop:N,crosshair:T,outline:V}},a.createSeriesLegend=function(e,a,i,r,s){for(var o=e.grouped(),l=new t.ColorHelper(a,t.scatterChartProps.dataPoint.fill,s),n=[],c=0,h=o.length;h>c;c++){var u=o[c],d=l.getColorForSeriesValue(u.objects,e.identityFields,u.name);n.push({color:d,icon:t.LegendIcon.Circle,label:t.valueFormatter.format(u.name,r),identity:u.identity?t.SelectionId.createWithId(u.identity):t.SelectionId.createNull(),selected:!1})}return n},a.getSizeRangeForGroups=function(e,a){var i={};return e&&e.forEach(function(e){var r=t.ScatterChart.getMeasureValue(a,e.values),s=t.AxisHelper.getRangeForColumn(r);(null==i.min||i.min>s.min)&&(i.min=s.min),(null==i.max||i.max<s.max)&&(i.max=s.max)}),i},a.getMetadata=function(e,t){var r,s,o,l,n,c,h,u,d,p,g,m,y=i.getMeasureIndexOfRole(e,"X"),f=i.getMeasureIndexOfRole(e,"Y"),v=i.getMeasureIndexOfRole(e,"Size"),x=i.getMeasureIndexOfRole(e,"Gradient"),b=i.getMeasureIndexOfRole(e,"ColorFill"),S=i.getMeasureIndexOfRole(e,"Shape"),w=i.getMeasureIndexOfRole(e,"Image"),C=i.getMeasureIndexOfRole(e,"Rotation"),D=i.getMeasureIndexOfRole(e,"Backdrop"),P=i.getMeasureIndexOfRole(e,"X Start"),A=i.getMeasureIndexOfRole(e,"X End"),N=i.getMeasureIndexOfRole(e,"Y Start"),T=i.getMeasureIndexOfRole(e,"Y End"),V="",L="";if(e&&e.length){var M=e[0],k=M.values.length;y>=0||(y=a.getDefaultMeasureIndex(k,[f,v,x,b,S,w,C,D,P,A,N,T])),f>=0||(f=a.getDefaultMeasureIndex(k,[y,v,x,b,S,w,C,D,P,A,N,T])),v>=0||(v=a.getDefaultMeasureIndex(k,[y,f,x,b,S,w,C,D,P,A,N,T])),b>=0||(b=a.getDefaultMeasureIndex(k,[y,f,v,x,S,w,C,D,P,A,N,T])),S>=0||(S=a.getDefaultMeasureIndex(k,[y,f,v,x,b,w,C,D,P,A,N,T])),w>=0||(w=a.getDefaultMeasureIndex(k,[y,f,v,x,b,S,C,D,P,A,N,T])),C>=0||(C=a.getDefaultMeasureIndex(k,[y,f,v,x,b,S,w,D,P,A,N,T])),D>=0||(D=a.getDefaultMeasureIndex(k,[y,f,v,x,b,S,w,C,P,A,N,T])),P>=0||(P=a.getDefaultMeasureIndex(k,[y,f,v,x,b,S,w,C,D,A,N,T])),A>=0||(A=a.getDefaultMeasureIndex(k,[y,f,v,x,b,S,w,C,D,P,N,T])),N>=0||(N=a.getDefaultMeasureIndex(k,[y,f,v,x,b,S,w,C,D,P,A,T])),T>=0||(T=a.getDefaultMeasureIndex(k,[y,f,v,x,b,S,w,C,D,P,A,N])),y>=0&&(r=M.values[y].source,V=M.values[y].source.displayName),f>=0&&(s=M.values[f].source,L=M.values[f].source.displayName),v>=0&&(o=M.values[v].source),b>=0&&(l=M.values[b].source),S>=0&&(n=M.values[S].source),w>=0&&(c=M.values[w].source),C>=0&&(h=M.values[C].source),D>=0&&(u=M.values[D].source),P>=0&&(d=M.values[P].source),A>=0&&(p=M.values[A].source),N>=0&&(g=M.values[N].source),T>=0&&(m=M.values[T].source)}return{idx:{x:y,y:f,size:v,colorFill:b,shape:S,image:w,rotation:C,backdrop:D,xStart:P,xEnd:A,yStart:N,yEnd:T},cols:{x:r,y:s,size:o,colorFill:l,shape:n,image:c,rotation:h,backdrop:u,xStart:d,xEnd:p,yStart:g,yEnd:m},axesLabels:{x:V,y:L}}},a.getDefaultMeasureIndex=function(e,t){for(var a=0;e>a;a++){for(var i=!0,r=0;r<t.length;r++)if(a===t[r]){i=!1;break}if(i===!0)return a}return-1},a.createLazyFormattedCategory=function(e,t){return new jsCommon.Lazy(function(){return e.format(t)})},a.createDataPoints=function(e,i,r,s,o,l,n,c,h,u,d,p){for(var g=[],m=i.idx,y=t.scatterChartProps.general.formatString,f=e.source,v=e.grouped(),x=new t.ColorHelper(c,t.scatterChartProps.dataPoint.fill,d),b=0,S=s.length;S>b;b++)for(var w=s[b],C=0,D=v.length;D>C;C++){var P=v[C],A=P.values,N=t.ScatterChart.getMeasureValue(m.x,A),T=t.ScatterChart.getMeasureValue(m.y,A),V=t.ScatterChart.getMeasureValue(m.size,A),L=t.ScatterChart.getMeasureValue(m.colorFill,A),M=t.ScatterChart.getMeasureValue(m.shape,A),k=t.ScatterChart.getMeasureValue(m.image,A),j=t.ScatterChart.getMeasureValue(m.rotation,A),I=t.ScatterChart.getMeasureValue(m.backdrop,A),O=t.ScatterChart.getMeasureValue(m.xStart,A),G=t.ScatterChart.getMeasureValue(m.xEnd,A),F=t.ScatterChart.getMeasureValue(m.yStart,A),R=t.ScatterChart.getMeasureValue(m.yEnd,A),z=N&&N.values&&!isNaN(N.values[b])?N.values[b]:null,B=T&&T.values&&!isNaN(T.values[b])?T.values[b]:0,H=V&&V.values?V.values[b]:null,E=L&&L.values?L.values[b]:null,W=a.getCustomSymbolType(M&&M.values&&M.values[b]),U=k&&k.values?k.values[b]:null,_=j&&j.values?j.values[b]:0,Y=I&&I.values?I.values[b]:null,K=O&&O.values?O.values[b]:null,X=G&&G.values?G.values[b]:null,q=F&&F.values?F.values[b]:null,Z=R&&R.values?R.values[b]:null,Q=null==z||null==B;if(!Q){var $=void 0;if(h)$=x.getColorForSeriesValue(P.objects,e.identityFields,P.name);else{var J=null!=V?V.source.queryName:"";$=x.getColorForMeasure(n&&n[b],J)}var ee=r&&r.length>0?r[0]:null,te=t.SelectionIdBuilder.builder().withCategory(ee,b).withSeries(e,P).createSelectionId(),ae=[];f&&ae.push({value:P.name,metadata:{source:f,values:[]}}),N&&ae.push({value:z,metadata:N}),T&&ae.push({value:B,metadata:T}),V&&V.values&&V.values.length>0&&ae.push({value:V.values[b],metadata:V}),L&&L.values&&L.values.length>0&&ae.push({value:L.values[b],metadata:L}),M&&M.values&&M.values.length>0&&ae.push({value:M.values[b],metadata:M}),k&&k.values&&k.values.length>0&&ae.push({value:k.values[b],metadata:k}),j&&j.values&&j.values.length>0&&ae.push({value:j.values[b],metadata:j}),I&&I.values&&I.values.length>0&&ae.push({value:I.values[b],metadata:I}),O&&O.values&&O.values.length>0&&ae.push({value:O.values[b],metadata:O}),G&&G.values&&G.values.length>0&&ae.push({value:G.values[b],metadata:G}),F&&F.values&&F.values.length>0&&ae.push({value:F.values[b],metadata:F}),R&&R.values&&R.values.length>0&&ae.push({value:R.values[b],metadata:R});var ie=t.TooltipBuilder.createTooltipInfo(y,null,w,null,r,ae),re={x:z,y:B,size:H,radius:{sizeMeasure:V,index:b},fill:$,formattedCategory:this.createLazyFormattedCategory(o,w),selected:!1,identity:te,tooltipInfo:ie,labelFill:u.labelColor,labelFontSize:u.fontSize,colorFill:E,shapeSymbolType:W,svgurl:U,rotation:_,backdrop:Y,xStart:K,xEnd:X,yStart:q,yEnd:Z};g.push(re)}}return g},a.prototype.setData=function(e){if(this.data={xCol:void 0,yCol:void 0,dataPoints:[],legendData:{dataPoints:[]},axesLabels:{x:"",y:""},selectedIds:[],sizeRange:[],dataLabelsSettings:t.dataLabelUtils.getDefaultPointLabelSettings(),defaultDataPointColor:null,hasDynamicSeries:!1,useShape:!0,useCustomColor:!1},e.length>0){var i=e[0];i&&(this.categoryAxisProperties=this.getCategoryAxisProperties(i.metadata,!0),this.valueAxisProperties=this.getValueAxisProperties(i.metadata,!0),this.dataView=i,i.categorical&&i.categorical.values&&(this.data=a.converter(i,this.viewport,this.colors,this.interactivityService,this.categoryAxisProperties,this.valueAxisProperties)))}},a.prototype.update=function(e){var a=this.dataViews=e.dataViews;if(this.viewport=_.clone(e.viewport),a){if(a&&a.length>0){var i=t.getInvalidValueWarnings(a,!1,!1,!1);i&&i.length>0&&this.hostServices.setWarnings(i),this.populateObjectProperties(a)}this.setData(a),this.options.interactivity&&this.options.interactivity.isInteractiveLegend||this.renderLegend(),this.render(e.suppressAnimations)}},a.prototype.populateObjectProperties=function(a){if(a&&a.length>0){var i=a[0].metadata;i?this.legendObjectProperties=e.DataViewObjects.getObject(i.objects,"legend",{}):this.legendObjectProperties={},this.categoryAxisProperties=this.getCategoryAxisProperties(i),this.valueAxisProperties=this.getValueAxisProperties(i);var r=this.valueAxisProperties.position;this.yAxisOrientation=r?r.toString():t.yAxisPosition.left}},a.prototype.renderLegend=function(){var e={title:"",dataPoints:[]},i=this.legend;this.layerLegendData=this.data.legendData,this.layerLegendData&&(e.title=this.layerLegendData.title||"",e.dataPoints=e.dataPoints.concat(this.layerLegendData.dataPoints||[]),e.fontSize=this.legendLabelFontSize?this.legendLabelFontSize:a.LegendLabelFontSizeDefault,this.layerLegendData.grouped&&(e.grouped=!0));var r=this.legendObjectProperties;if(r){t.LegendData.update(e,r);var s=r[t.legendProps.position];s&&i.changeOrientation(t.LegendPosition[s])}else i.changeOrientation(t.LegendPosition.Top);(1===e.dataPoints.length&&!e.grouped||this.hideLegends())&&(e.dataPoints=[]);var o=this.viewport;i.drawLegend(e,{height:o.height,width:o.width}),t.Legend.positionChartArea(this.svg,i)},a.prototype.hideLegends=function(){return!!(this.cartesianSmallViewPortProperties&&this.cartesianSmallViewPortProperties.hideLegendOnSmallViewPort&&this.viewport.height<this.cartesianSmallViewPortProperties.MinHeightLegendVisible)},a.prototype.shouldRenderAxis=function(e,t){return void 0===t&&(t="show"),e?(!e.isCategoryAxis||this.categoryAxisProperties&&null!=this.categoryAxisProperties[t]&&!this.categoryAxisProperties[t])&&(e.isCategoryAxis||this.valueAxisProperties&&null!=this.valueAxisProperties[t]&&!this.valueAxisProperties[t])?!1:e.values&&e.values.length>0:!1},a.prototype.getMaxMarginFactor=function(){return this.options.style.maxMarginFactor||.25},a.prototype.adjustViewportbyBackdrop=function(){var e=new Image,t=this;if(e.src=this.data.backdrop.url,e.onload=function(){t.oldBackdrop!==this.src&&(t.render(!0),t.oldBackdrop=this.src)},e.width>0&&e.height>0)if(e.width*this.viewportIn.height<this.viewportIn.width*e.height){var a=this.viewportIn.width-this.viewportIn.height*e.width/e.height;this.viewport={width:this.viewport.width-a,height:this.viewport.height}}else{var i=this.viewportIn.height-this.viewportIn.width*e.height/e.width;this.viewport={width:this.viewport.width,height:this.viewport.height-i}}},a.prototype.render=function(i){if(this.viewport.height-=this.legendViewport.height,this.viewport.width-=this.legendViewport.width,0!==this.viewportIn.width&&0!==this.viewportIn.height){var r=this.getMaxMarginFactor();this.leftRightMarginLimit=this.viewport.width*r;var s=this.bottomMarginLimit=Math.max(25,Math.ceil(this.viewport.height*r));this.margin.top=8,this.margin.bottom=s,this.margin.right=0,this.calculateAxes(this.categoryAxisProperties,this.valueAxisProperties,this.textProperties,!0),this.yAxisIsCategorical=this.yAxisProperties.isCategoryAxis,this.hasCategoryAxis=this.yAxisIsCategorical?this.yAxisProperties&&this.yAxisProperties.values.length>0:this.xAxisProperties&&this.xAxisProperties.values.length>0;var o,l=this.shouldRenderAxis(this.xAxisProperties),n=this.shouldRenderAxis(this.yAxisProperties);this.isXScrollBarVisible=!1,this.isYScrollBarVisible=!1;var c,h,u,d=this.yAxisOrientation,p=d===t.yAxisPosition.right;this.calculateAxes(this.categoryAxisProperties,this.valueAxisProperties,this.textProperties,!0);for(var g=!1,m=2,y=0;!g&&m>y;){y++,c=t.AxisHelper.getTickLabelMargins({width:this.viewportIn.width,height:this.viewport.height},this.leftRightMarginLimit,e.TextMeasurementService.measureSvgTextWidth,e.TextMeasurementService.measureSvgTextHeight,{x:this.xAxisProperties,y1:this.yAxisProperties},this.bottomMarginLimit,this.textProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,p,l,n,!1);var f=p?c.yRight:c.yLeft,v=p?c.yLeft:c.yRight,x=c.xMax;f+=10,v+=10,x+=12,p&&n&&(v+=20),!p&&n&&(f+=20),this.hideAxisLabels()&&(this.xAxisProperties.axisLabel=null,this.yAxisProperties.axisLabel=null),this.addUnitTypeToAxisLabel(this.xAxisProperties,this.yAxisProperties),h={x:this.xAxisProperties.axisLabel,y:this.yAxisProperties.axisLabel,y2:null},u=null!=h.x||null!=h.y||null!=h.y2,null!=h.x&&(x+=18),null!=h.y&&(f+=20),null!=h.y2&&(v+=20),this.margin.left=p?v:f,this.margin.right=p?f:v,this.margin.bottom=x;var b=this.yAxisProperties.values.length;this.calculateAxes(this.categoryAxisProperties,this.valueAxisProperties,this.textProperties,!0),this.yAxisProperties.values.length===b&&(g=!0)}if(this.data.backdrop&&this.data.backdrop.show&&void 0!==this.data.backdrop.url)for(this.adjustViewportbyBackdrop(),g=!1,m=2,y=0;!g&&m>y;){y++,c=t.AxisHelper.getTickLabelMargins({width:this.viewportIn.width,height:this.viewport.height},this.leftRightMarginLimit,e.TextMeasurementService.measureSvgTextWidth,e.TextMeasurementService.measureSvgTextHeight,{x:this.xAxisProperties,y1:this.yAxisProperties},this.bottomMarginLimit,this.textProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,p,l,n,!1);var f=p?c.yRight:c.yLeft,v=p?c.yLeft:c.yRight,x=c.xMax;f+=10,p&&n&&(v+=15),x+=12,this.hideAxisLabels()&&(this.xAxisProperties.axisLabel=null,this.yAxisProperties.axisLabel=null),this.addUnitTypeToAxisLabel(this.xAxisProperties,this.yAxisProperties),h={x:this.xAxisProperties.axisLabel,y:this.yAxisProperties.axisLabel,y2:null},u=null!=h.x||null!=h.y||null!=h.y2,null!=h.x&&(x+=18),null!=h.y&&(f+=20),null!=h.y2&&(v+=20),this.margin.left=p?v:f,this.margin.right=p?f:v,this.margin.bottom=x;var b=this.yAxisProperties.values.length;this.calculateAxes(this.categoryAxisProperties,this.valueAxisProperties,this.textProperties,!0),this.yAxisProperties.values.length===b&&(g=!0)}if(this.renderChart(o,this.xAxisProperties,this.yAxisProperties,c,u,h,i),this.updateAxis(),this.data){var S=this.data,w=this.data.dataPoints,C=this.interactivityService&&this.interactivityService.hasSelection();this.mainGraphicsContext.attr("width",this.viewportIn.width).attr("height",this.viewportIn.height);var D=w.sort(function(e,t){return t.radius.sizeMeasure?t.radius.sizeMeasure.values[t.radius.index]-e.radius.sizeMeasure.values[e.radius.index]:0}),P=t.AnimatorCommon.GetAnimationDuration(this.animator,i),A=this.drawScatterMarkers(D,C,S.sizeRange,P),N=this.data.dataLabelsSettings;if(N.show){var T=this.getEnhanchedScatterChartLabelLayout(N,this.viewportIn,S.sizeRange),V=this.cloneDataPoints(w);t.dataLabelUtils.drawDefaultLabelsForDataPointChart(V,this.mainGraphicsG,T,this.viewportIn);var L=N.fontSize*a.DataLabelsOffset;this.mainGraphicsG.select(".labels").attr("transform",t.SVGUtil.translate(L,0))}else t.dataLabelUtils.cleanDataLabels(this.mainGraphicsG);var M=void 0;if(this.interactivityService&&(M={dataPointsSelection:A,data:this.data,plotContext:this.mainGraphicsContext}),t.TooltipManager.addTooltip(A,function(e){return e.data.tooltipInfo}),t.SVGUtil.flushAllD3TransitionsIfNeeded(this.options),this.behavior){var k=[];if(k.push(M),this.interactivityService){var j={layerOptions:k,clearCatcher:this.clearCatcher};this.interactivityService.bind(w,this.behavior,j)}}}}},a.prototype.cloneDataPoints=function(e){for(var t=new Array,a=0,i=e;a<i.length;a++){var r=i[a],s=_.clone(r);t.push(s)}return t},a.prototype.darkenZeroLine=function(e){var t=e.selectAll("g.tick").filter(function(e){return 0===e}).node();t&&d3.select(t).select("line").classed("zero-line",!0)},a.prototype.getCategoryAxisFill=function(){if(this.dataView&&this.dataView.metadata.objects){var e=this.dataView.metadata.objects.categoryAxis;if(e)return e.axisColor}return{solid:{color:"#333"}}},a.prototype.getEnhanchedScatterChartLabelLayout=function(e,i,r){var s=this.xAxisProperties.scale,o=this.yAxisProperties.scale,l=jsCommon.PixelConverter.fromPoint(e.fontSize),n=e.fontSize*a.DataLabelsOffset;return{labelText:function(a){return t.dataLabelUtils.getLabelFormattedText({label:a.formattedCategory.getValue(),fontSize:e.fontSize,maxWidth:i.width})},labelLayout:{x:function(e){return s(e.x)-n},y:function(a){var s=t.ScatterChart.getBubbleRadius(a.radius,r,i)+t.dataLabelUtils.labelMargin;return 0===e.position?o(a.y)-s:o(a.y)+s}},filter:function(e){return null!=e&&null!=e.formattedCategory.getValue()},style:{fill:function(e){return e.labelFill},"font-size":l}}},a.prototype.getValueAxisFill=function(){if(this.dataView&&this.dataView.metadata.objects){var e=this.dataView.metadata.objects.valueAxis;if(e)return e.axisColor}return{solid:{color:"#333"}}},a.prototype.renderCrossHair=function(){var t=this,a=this.xAxisProperties.scale,i=this.yAxisProperties.scale,r=this.mainGraphicsContext;if(r.selectAll(".crosshairCanvas").remove(),this.data.crosshair){var s=r.append("g").attr("class","crosshairCanvas").attr("id","crosshairCanvas"),o=s.append("g").attr("class","crosshair"),l=o.append("line").attr("id","h_crosshair").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",0).style("stroke","gray").style("stroke-width","1px").style("stroke-dasharray","5,5").style("display","none"),n=o.append("line").attr("id","v_crosshair").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",0).style("stroke","gray").style("stroke-width","1px").style("stroke-dasharray","5,5").style("display","none"),c=o.append("text").attr("id","crosshair_text").style("font-size","10px").style("stroke","gray").style("stroke-width","0.5px"),h=function(e,r){l.attr("x1",0).attr("y1",r).attr("x2",t.viewportIn.width).attr("y2",r).style("display","block"),n.attr("x1",e).attr("y1",0).attr("x2",e).attr("y2",t.viewportIn.height).style("display","block"),c.attr("transform","translate("+(e+5)+","+(r-5)+")").text("("+Math.round(100*a.invert(e))/100+" , "+Math.round(100*i.invert(r))/100+")")};this.axisGraphicsContextScrollable.on("mousemove",function(){var t=d3.mouse(this),a=this.viewportElement,i=a.getBoundingClientRect(),r=a.getBBox(),s=i.width/r.width,o=i.height/r.height;r.width>0&&!e.Double.equalWithPrecision(s,1,1e-5)&&(t[0]=t[0]/s),r.height>0&&!e.Double.equalWithPrecision(o,1,1e-5)&&(t[1]=t[1]/o),h(t[0],t[1])}).on("mouseover",function(){d3.selectAll(".crosshair").style("display","block")}).on("mouseout",function(){d3.selectAll(".crosshair").style("display","none")})}},a.prototype.renderBackground=function(){this.data.backdrop&&this.data.backdrop.show&&void 0!==this.data.backdrop.url?this.backgroundGraphicsContext.attr("xlink:href",this.data.backdrop.url).attr("x",0).attr("y",0).attr("width",this.viewportIn.width).attr("height",this.viewportIn.height):this.backgroundGraphicsContext.attr("width",0).attr("height",0)},a.prototype.renderChart=function(a,i,r,s,o,l,n,c,h){var u=this.bottomMarginLimit,d=this.leftRightMarginLimit,p=t.AnimatorCommon.GetAnimationDuration(this.animator,n);if(this.renderBackground(),this.shouldRenderAxis(i)){i.axis.orient("bottom"),i.willLabelsFit||i.axis.tickPadding(5);var g=this.xAxisGraphicsContext;p?g.transition().duration(p).call(i.axis).call(this.darkenZeroLine):g.call(i.axis).call(this.darkenZeroLine);var m=g.selectAll("g.tick").filter(function(e){return 0===e});if(m){var y=this.getValueAxisFill();y&&m.selectAll("line").style({stroke:y.solid.color})}var f=g.selectAll("text");i.willLabelsWordBreak?f.call(t.AxisHelper.LabelLayoutStrategy.wordBreak,i,u):f.call(t.AxisHelper.LabelLayoutStrategy.rotate,u,e.TextMeasurementService.getTailoredTextOrDefault,t.CartesianChart.AxisTextProperties,!i.willLabelsFit,u===s.xMax,i,this.margin,this.isXScrollBarVisible||this.isYScrollBarVisible)}else this.xAxisGraphicsContext.selectAll("*").remove();if(this.shouldRenderAxis(r)){var v=this.yAxisOrientation;r.axis.tickSize(-this.viewportIn.width).tickPadding(10).orient(v.toLowerCase());var x=this.y1AxisGraphicsContext;p?x.transition().duration(p).call(r.axis).call(this.darkenZeroLine):x.call(r.axis).call(this.darkenZeroLine);var b=x.selectAll("g.tick").filter(function(e){return 0===e});if(b){var S=this.getCategoryAxisFill();S&&b.selectAll("line").style({stroke:S.solid.color})}s.yLeft>=d&&x.selectAll("text").call(t.AxisHelper.LabelLayoutStrategy.clip,d-10,e.TextMeasurementService.svgEllipsis)}else this.y1AxisGraphicsContext.selectAll("*").remove();if(o){var w=!this.shouldRenderAxis(i,"showAxisTitle"),C=!this.shouldRenderAxis(r,"showAxisTitle"),D=this.valueAxisProperties&&null!=this.valueAxisProperties.secShowAxisTitle&&this.valueAxisProperties.secShowAxisTitle===!1;this.renderAxesLabels(l,this.legendViewport.height,w,C,D)}else this.axisGraphicsContext.selectAll(".xAxisLabel").remove(),this.axisGraphicsContext.selectAll(".yAxisLabel").remove();this.renderCrossHair()},a.prototype.renderAxesLabels=function(i,r,s,o,l){this.axisGraphicsContext.selectAll(".xAxisLabel").remove(),this.axisGraphicsContext.selectAll(".yAxisLabel").remove();var n=this.margin,c=this.viewportIn.width,h=this.viewport.height,u=a.AxisFontSize,d=this.yAxisOrientation,p=d===t.yAxisPosition.right;if(!s){var g=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(i.x).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"xAxisLabel",transform:t.SVGUtil.translate(c/2,h-u-2)})})});g.call(t.AxisHelper.LabelLayoutStrategy.clip,c,e.TextMeasurementService.svgEllipsis)}if(!o){var m=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(i.y).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"yAxisLabel",transform:"rotate(-90)",y:p?c+n.right-u:-n.left,x:-((h-n.top-r)/2),dy:"1em"})})});m.call(t.AxisHelper.LabelLayoutStrategy.clip,h-(n.bottom+n.top),e.TextMeasurementService.svgEllipsis)}if(!l&&i.y2){var y=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(i.y2).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"yAxisLabel",transform:"rotate(-90)",y:p?-n.left:c+n.right-u,x:-((h-n.top-r)/2),dy:"1em"})})});y.call(t.AxisHelper.LabelLayoutStrategy.clip,h-(n.bottom+n.top),e.TextMeasurementService.svgEllipsis)}},a.prototype.updateAxis=function(){this.adjustMargins();var e=this.yAxisOrientation,a=e===t.yAxisPosition.right;this.xAxisGraphicsContext.attr("transform",t.SVGUtil.translate(0,this.viewportIn.height)),this.y1AxisGraphicsContext.attr("transform",t.SVGUtil.translate(a?this.viewportIn.width:0,0)),this.svg.attr({width:this.viewport.width,height:this.viewport.height}),this.svgScrollable.attr({width:this.viewport.width,height:this.viewport.height}),this.svgScrollable.attr({x:0});var i=this.margin.left,r=this.margin.top;this.axisGraphicsContext.attr("transform",t.SVGUtil.translate(i,r)),this.axisGraphicsContextScrollable.attr("transform",t.SVGUtil.translate(i,r)),this.clearCatcher.attr("transform",t.SVGUtil.translate(-i,-r)),this.isXScrollBarVisible?(this.svgScrollable.attr({x:i}),this.axisGraphicsContextScrollable.attr("transform",t.SVGUtil.translate(0,r)),this.svgScrollable.attr("width",this.viewportIn.width),this.svg.attr("width",this.viewport.width).attr("height",this.viewport.height+this.ScrollBarWidth)):this.isYScrollBarVisible&&(this.svgScrollable.attr("height",this.viewportIn.height+r),this.svg.attr("width",this.viewport.width+this.ScrollBarWidth).attr("height",this.viewport.height))},a.prototype.getUnitType=function(e){return e.formatter&&e.formatter.displayUnit&&e.formatter.displayUnit.value>1?e.formatter.displayUnit.title:null},a.prototype.addUnitTypeToAxisLabel=function(e,a){var i=this.getUnitType(e);e.isCategoryAxis?this.categoryAxisHasUnitType=null!==i:this.valueAxisHasUnitType=null!==i,e.axisLabel&&i&&(e.isCategoryAxis?e.axisLabel=t.AxisHelper.createAxisLabel(this.categoryAxisProperties,e.axisLabel,i):e.axisLabel=t.AxisHelper.createAxisLabel(this.valueAxisProperties,e.axisLabel,i)),i=this.getUnitType(a),a.isCategoryAxis?this.categoryAxisHasUnitType=null!==i:this.valueAxisHasUnitType=null!==i,a.axisLabel&&i&&(a.isCategoryAxis?a.axisLabel=t.AxisHelper.createAxisLabel(this.categoryAxisProperties,a.axisLabel,i):a.axisLabel=t.AxisHelper.createAxisLabel(this.valueAxisProperties,a.axisLabel,i))},a.prototype.hideAxisLabels=function(){return!(!(this.cartesianSmallViewPortProperties&&this.cartesianSmallViewPortProperties.hideAxesOnSmallViewPort&&this.viewport.height+this.legendViewport.height<this.cartesianSmallViewPortProperties.MinHeightAxesVisible)||this.options.interactivity.isInteractiveLegend)},a.prototype.drawScatterMarkers=function(e,i,r,s){var o,l=this,n=this.xAxisProperties.scale,c=this.yAxisProperties.scale,h=(!r||!r.min)&&this.data.fillPoint,u=this.data.useCustomColor;this.data.useShape?(this.mainGraphicsContext.selectAll(a.ImageClasses.selector).remove(),o=this.mainGraphicsContext.classed("ScatterMarkers",!0).selectAll(a.DotClasses.selector).data(e,function(e){return e.identity.getKey()}),o.enter().append("path").classed(a.DotClasses["class"],!0).attr("id","markershape"),o.style({"stroke-opacity":function(e){return t.ScatterChart.getBubbleOpacity(e,i)},"stroke-width":"1px",stroke:function(e){var t=u?e.colorFill:e.fill;return l.data.outline?d3.rgb(t).darker():d3.rgb(t)},fill:function(e){return d3.rgb(u?e.colorFill:e.fill)},"fill-opacity":function(e){return null!=e.size||h?t.ScatterChart.getBubbleOpacity(e,i):0}}).attr("d",function(e){var a=t.ScatterChart.getBubbleRadius(e.radius,r,l.viewport),i=4*a*a;return e.shapeSymbolType(i)}).transition().duration(function(e){return l.keyArray.indexOf(e.identity.getKey())>=0?s:0}).attr("transform",function(e){return"translate("+n(e.x)+","+c(e.y)+") rotate("+e.rotation+")"})):(this.mainGraphicsContext.selectAll(a.DotClasses.selector).remove(),
o=this.mainGraphicsContext.classed("ScatterMarkers",!0).selectAll(a.ImageClasses.selector).data(e,function(e){return e.identity.getKey()}),o.enter().append("svg:image").classed(a.ImageClasses["class"],!0).attr("id","markerimage"),o.attr("xlink:href",function(e){return void 0!==e.svgurl&&null!=e.svgurl&&""!==e.svgurl?e.svgurl:l.svgDefaultImage}).attr("width",function(e){return 2*t.ScatterChart.getBubbleRadius(e.radius,r,l.viewport)}).attr("height",function(e){return 2*t.ScatterChart.getBubbleRadius(e.radius,r,l.viewport)}).transition().duration(function(e){return l.keyArray.indexOf(e.identity.getKey())>=0?s:0}).attr("transform",function(e){var a=t.ScatterChart.getBubbleRadius(e.radius,r,l.viewport);return"translate("+(n(e.x)-a)+","+(c(e.y)-a)+") rotate("+e.rotation+","+a+","+a+")"})),o.exit().remove(),this.keyArray=[];for(var d=0;d<e.length;d++)this.keyArray.push(e[d].identity.getKey());return o},a.prototype.calculateAxes=function(i,r,s,o){var l={viewport:this.viewport,margin:this.margin,forcedXDomain:[i?i.start:null,i?i.end:null],forceMerge:r&&r.secShow===!1,showCategoryAxisLabel:!1,showValueAxisLabel:!1,categoryAxisScaleType:i&&null!=i.axisScale?i.axisScale:null,valueAxisScaleType:r&&null!=r.axisScale?r.axisScale:null,valueAxisDisplayUnits:r&&null!=r.labelDisplayUnits?r.labelDisplayUnits:a.LabelDisplayUnitsDefault,categoryAxisDisplayUnits:i&&null!=i.labelDisplayUnits?i.labelDisplayUnits:a.LabelDisplayUnitsDefault,trimOrdinalDataOnOverflow:!1};r&&(l.forcedYDomain=t.AxisHelper.applyCustomizedDomain([r.start,r.end],l.forcedYDomain)),l.showCategoryAxisLabel=!!i&&!!i.showAxisTitle,l.showValueAxisLabel=!0;var n=this.viewport.width-(this.margin.left+this.margin.right),c=this.calculateAxesProperties(l);return c[0].willLabelsFit=t.AxisHelper.LabelLayoutStrategy.willLabelsFit(c[0],n,e.TextMeasurementService.measureSvgTextWidth,s),c[0].willLabelsWordBreak=!c[0].willLabelsFit&&!o&&t.AxisHelper.LabelLayoutStrategy.willLabelsWordBreak(c[0],this.margin,n,e.TextMeasurementService.measureSvgTextWidth,e.TextMeasurementService.estimateSvgTextHeight,e.TextMeasurementService.getTailoredTextOrDefault,s),c},a.prototype.calculateAxesProperties=function(e){var a=this.data,i=a.dataPoints;this.margin=e.margin,this.viewport=e.viewport;var r=0,s=10,o=0,l=10;i.length>0&&(r=d3.min(i,function(e){return e.y}),s=d3.max(i,function(e){return e.y}),o=d3.min(i,function(e){return e.x}),l=d3.max(i,function(e){return e.x}));var n=[o,l],c=t.AxisHelper.combineDomain(e.forcedXDomain,n);this.xAxisProperties=t.AxisHelper.createAxis({pixelSpan:this.viewportIn.width,dataDomain:c,metaDataColumn:a.xCol,formatString:t.valueFormatter.getFormatString(a.xCol,t.scatterChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!1,forcedTickCount:e.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!0,scaleType:e.categoryAxisScaleType,axisDisplayUnits:e.categoryAxisDisplayUnits}),this.xAxisProperties.axis.tickSize(-this.viewportIn.height,0),this.xAxisProperties.axisLabel=this.data.axesLabels.x;var h=t.AxisHelper.combineDomain(e.forcedYDomain,[r,s]);return this.yAxisProperties=t.AxisHelper.createAxis({pixelSpan:this.viewportIn.height,dataDomain:h,metaDataColumn:a.yCol,formatString:t.valueFormatter.getFormatString(a.yCol,t.scatterChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:e.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:e.valueAxisScaleType,axisDisplayUnits:e.valueAxisDisplayUnits}),this.yAxisProperties.axisLabel=this.data.axesLabels.y,[this.xAxisProperties,this.yAxisProperties]},a.prototype.enumerateDataPoints=function(e){var a=this.data;if(a){var i=a.dataPoints.length;if(a.hasDynamicSeries)for(var r=a.legendData.dataPoints.length,s=0;r>s;s++){var o=a.legendData.dataPoints[s];e.pushInstance({objectName:"dataPoint",displayName:o.label,selector:t.ColorHelper.normalizeSelector(o.identity.getSelector()),properties:{fill:{solid:{color:o.color}}}})}else{e.pushInstance({objectName:"dataPoint",selector:null,properties:{defaultColor:{solid:{color:a.defaultDataPointColor||this.colors.getColorByIndex(0).value}}}}).pushInstance({objectName:"dataPoint",selector:null,properties:{showAllDataPoints:!!a.showAllDataPoints}});for(var s=0;i>s;s++){var l=a.dataPoints[s];e.pushInstance({objectName:"dataPoint",displayName:l.formattedCategory.getValue(),selector:t.ColorHelper.normalizeSelector(l.identity.getSelector(),!0),properties:{fill:{solid:{color:l.fill}}}})}}}},a.prototype.enumerateObjectInstances=function(e){var a=new t.ObjectEnumerationBuilder;switch(e.objectName){case"dataPoint":var i=this.dataView&&this.dataView.categorical?this.dataView.categorical:null;t.GradientUtils.hasGradientRole(i)||this.enumerateDataPoints(a);break;case"categoryAxis":this.getCategoryAxisValues(a);break;case"valueAxis":this.getValueAxisValues(a);break;case"categoryLabels":this.data?t.dataLabelUtils.enumerateCategoryLabels(a,this.data.dataLabelsSettings,!0):t.dataLabelUtils.enumerateCategoryLabels(a,null,!0);break;case"fillPoint":var r=this.data.sizeRange;if(r&&r.min)break;a.pushInstance({objectName:"fillPoint",selector:null,properties:{show:this.data.fillPoint}});break;case"backdrop":a.pushInstance({objectName:"backdrop",displayName:"Backdrop",selector:null,properties:{show:this.data.backdrop?this.data.backdrop.show:!1,url:this.data.backdrop?this.data.backdrop.url:null}});break;case"crosshair":a.pushInstance({objectName:"crosshair",selector:null,properties:{show:this.data.crosshair}});break;case"outline":a.pushInstance({objectName:"outline",selector:null,properties:{show:this.data.outline}});break;case"legend":this.getLegendValue(a)}return a.complete()},a.prototype.hasLegend=function(){return this.data&&this.data.hasDynamicSeries},a.prototype.getLegendValue=function(i){if(this.hasLegend()){var r=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.show,this.legend.isVisible()),s=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.showTitle,!0),o=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.titleText,this.layerLegendData?this.layerLegendData.title:""),l=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.labelColor,t.LegendData.DefaultLegendLabelFillColor);this.legendLabelFontSize=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.fontSize,a.LegendLabelFontSizeDefault),i.pushInstance({selector:null,properties:{show:r,position:t.LegendPosition[this.legend.getOrientation()],showTitle:s,titleText:o,labelColor:l,fontSize:this.legendLabelFontSize},objectName:"legend"})}},a.prototype.getCategoryAxisValues=function(e){var i=t.axisType.both,r=!0,s=!1,o=[t.axisScale.log,t.axisScale.linear];r||this.categoryAxisProperties&&(this.categoryAxisProperties.start=null,this.categoryAxisProperties.end=null);var l={selector:null,properties:{},objectName:"categoryAxis",validValues:{axisScale:o}};l.properties.show=this.categoryAxisProperties&&null!=this.categoryAxisProperties.show?this.categoryAxisProperties.show:!0,this.yAxisIsCategorical&&(l.properties.position=this.valueAxisProperties&&null!=this.valueAxisProperties.position?this.valueAxisProperties.position:t.yAxisPosition.left),i===t.axisType.both&&(l.properties.axisType=r?t.axisType.scalar:t.axisType.categorical),r&&(l.properties.axisScale=this.categoryAxisProperties&&null!=this.categoryAxisProperties.axisScale&&s?this.categoryAxisProperties.axisScale:t.axisScale.linear,l.properties.start=this.categoryAxisProperties?this.categoryAxisProperties.start:null,l.properties.end=this.categoryAxisProperties?this.categoryAxisProperties.end:null,l.properties.labelDisplayUnits=this.categoryAxisProperties&&null!=this.categoryAxisProperties.labelDisplayUnits?this.categoryAxisProperties.labelDisplayUnits:a.LabelDisplayUnitsDefault),l.properties.showAxisTitle=this.categoryAxisProperties&&null!=this.categoryAxisProperties.showAxisTitle?this.categoryAxisProperties.showAxisTitle:!0,e.pushInstance(l).pushInstance({selector:null,properties:{axisStyle:this.categoryAxisProperties&&this.categoryAxisProperties.axisStyle?this.categoryAxisProperties.axisStyle:t.axisStyle.showTitleOnly,labelColor:this.categoryAxisProperties?this.categoryAxisProperties.labelColor:null},objectName:"categoryAxis",validValues:{axisStyle:this.categoryAxisHasUnitType?[t.axisStyle.showTitleOnly,t.axisStyle.showUnitOnly,t.axisStyle.showBoth]:[t.axisStyle.showTitleOnly]}})},a.prototype.getValueAxisValues=function(e){var i=[t.axisScale.log,t.axisScale.linear],r=!1,s={selector:null,properties:{},objectName:"valueAxis",validValues:{axisScale:i,secAxisScale:i}};s.properties.show=this.valueAxisProperties&&null!=this.valueAxisProperties.show?this.valueAxisProperties.show:!0,this.yAxisIsCategorical||(s.properties.position=this.valueAxisProperties&&null!=this.valueAxisProperties.position?this.valueAxisProperties.position:t.yAxisPosition.left),s.properties.axisScale=this.valueAxisProperties&&null!=this.valueAxisProperties.axisScale&&r?this.valueAxisProperties.axisScale:t.axisScale.linear,s.properties.start=this.valueAxisProperties?this.valueAxisProperties.start:null,s.properties.end=this.valueAxisProperties?this.valueAxisProperties.end:null,s.properties.showAxisTitle=this.valueAxisProperties&&null!=this.valueAxisProperties.showAxisTitle?this.valueAxisProperties.showAxisTitle:!0,s.properties.labelDisplayUnits=this.valueAxisProperties&&null!=this.valueAxisProperties.labelDisplayUnits?this.valueAxisProperties.labelDisplayUnits:a.LabelDisplayUnitsDefault,e.pushInstance(s).pushInstance({selector:null,properties:{axisStyle:this.valueAxisProperties&&null!=this.valueAxisProperties.axisStyle?this.valueAxisProperties.axisStyle:t.axisStyle.showTitleOnly,labelColor:this.valueAxisProperties?this.valueAxisProperties.labelColor:null},objectName:"valueAxis",validValues:{axisStyle:this.valueAxisHasUnitType?[t.axisStyle.showTitleOnly,t.axisStyle.showUnitOnly,t.axisStyle.showBoth]:[t.axisStyle.showTitleOnly]}})},a.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},a.DefaultBubbleOpacity=.85,a.DimmedBubbleOpacity=.4,a.DataLabelsOffset=5,a.ClassName="enhancedScatterChart",a.MainGraphicsContextClassName="mainGraphicsContext",a.LegendLabelFontSizeDefault=9,a.LabelDisplayUnitsDefault=0,a.AxisFontSize=11,a.DotClasses={"class":"dot",selector:".dot"},a.ImageClasses={"class":"img",selector:".img"},a.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Details")},{name:"Series",kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Legend")},{name:"X",kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_X")},{name:"Y",kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Y")},{name:"Size",kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Size")},{name:"Gradient",kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Gradient")},{name:"ColorFill",kind:e.VisualDataRoleKind.Measure,displayName:"Customized Color"},{name:"Shape",kind:e.VisualDataRoleKind.Measure,displayName:"Shape"},{name:"Image",kind:e.VisualDataRoleKind.Measure,displayName:"Image"},{name:"Rotation",kind:e.VisualDataRoleKind.Measure,displayName:"Rotation"},{name:"Backdrop",kind:e.VisualDataRoleKind.Measure,displayName:"Backdrop"},{name:"X Start",kind:e.VisualDataRoleKind.Measure,displayName:"X Start"},{name:"X End",kind:e.VisualDataRoleKind.Measure,displayName:"X End"},{name:"Y Start",kind:e.VisualDataRoleKind.Measure,displayName:"Y Start"},{name:"Y End",kind:e.VisualDataRoleKind.Measure,displayName:"Y End"}],dataViewMappings:[{conditions:[{Category:{max:1},Series:{max:1},X:{max:1},Y:{max:1},Size:{max:1},Gradient:{max:0},ColorFill:{max:1},Shape:{max:1},Image:{max:0},Rotation:{max:1},Backdrop:{max:1},"X Start":{max:1},"X End":{max:1},"Y Start":{max:1},"Y End":{max:1}},{Category:{max:1},Series:{max:0},X:{max:1},Y:{max:1},Size:{max:1},Gradient:{max:1},ColorFill:{max:1},Shape:{max:1},Image:{max:0},Rotation:{max:1},Backdrop:{max:1},"X Start":{max:1},"X End":{max:1},"Y Start":{max:1},"Y End":{max:1}},{Category:{max:1},Series:{max:1},X:{max:1},Y:{max:1},Size:{max:1},Gradient:{max:0},ColorFill:{max:0},Shape:{max:0},Image:{max:1},Rotation:{max:1},Backdrop:{max:1},"X Start":{max:1},"X End":{max:1},"Y Start":{max:1},"Y End":{max:1}},{Category:{max:1},Series:{max:0},X:{max:1},Y:{max:1},Size:{max:1},Gradient:{max:1},ColorFill:{max:0},Shape:{max:0},Image:{max:1},Rotation:{max:1},Backdrop:{max:1},"X Start":{max:1},"X End":{max:1},"Y Start":{max:1},"Y End":{max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{sample:{}}},values:{group:{by:"Series",select:[{bind:{to:"X"}},{bind:{to:"Y"}},{bind:{to:"Size"}},{bind:{to:"Gradient"}},{bind:{to:"ColorFill"}},{bind:{to:"Shape"}},{bind:{to:"Image"}},{bind:{to:"Rotation"}},{bind:{to:"Backdrop"}},{bind:{to:"X Start"}},{bind:{to:"X End"}},{bind:{to:"Y Start"}},{bind:{to:"Y End"}}],dataReductionAlgorithm:{top:{}}}},rowCount:{preferred:{min:2}}}}],objects:{dataPoint:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint"),properties:{defaultColor:{displayName:e.data.createDisplayNameGetter("Visual_DefaultColor"),type:{fill:{solid:{color:!0}}}},showAllDataPoints:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint_Show_All"),type:{bool:!0}},useShape:{displayName:e.data.createDisplayNameGetter("Visual_UseImage"),type:{bool:!0}},fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},fillRule:{displayName:e.data.createDisplayNameGetter("Visual_Gradient"),type:{fillRule:{}},rule:{inputRole:"Gradient",output:{property:"fill",selector:["Category"]}}}}},general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},categoryAxis:{displayName:e.data.createDisplayNameGetter("Visual_XAxis"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},axisScale:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Scale"),type:{formatting:{axisScale:!0}}},start:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Start"),type:{numeric:!0}},end:{displayName:e.data.createDisplayNameGetter("Visual_Axis_End"),type:{numeric:!0}},showAxisTitle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Title"),type:{bool:!0}},axisStyle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Style"),type:{formatting:{axisStyle:!0}}},axisColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}}}},valueAxis:{displayName:e.data.createDisplayNameGetter("Visual_YAxis"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_YAxis_Position"),type:{formatting:{yAxisPosition:!0}}},axisScale:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Scale"),type:{formatting:{axisScale:!0}}},start:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Start"),type:{numeric:!0}},end:{displayName:e.data.createDisplayNameGetter("Visual_Axis_End"),type:{numeric:!0}},showAxisTitle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Title"),type:{bool:!0}},axisStyle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Style"),type:{formatting:{axisStyle:!0}}},axisColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}}}},legend:{displayName:e.data.createDisplayNameGetter("Visual_Legend"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_LegendPosition"),description:e.data.createDisplayNameGetter("Visual_LegendPositionDescription"),type:{enumeration:t.legendPosition.type}},showTitle:{displayName:e.data.createDisplayNameGetter("Visual_LegendShowTitle"),description:e.data.createDisplayNameGetter("Visual_LegendShowTitleDescription"),type:{bool:!0}},titleText:{displayName:"Legend Name",description:e.data.createDisplayNameGetter("Visual_LegendNameDescription"),type:{text:!0}},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},categoryLabels:{displayName:e.data.createDisplayNameGetter("Visual_CategoryLabels"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_LabelsFill"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},fillPoint:{displayName:e.data.createDisplayNameGetter("Visual_FillPoint"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{bool:!0}}}},backdrop:{displayName:"Backdrop",properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},url:{displayName:"Image URL",type:{text:!0}}}},crosshair:{displayName:"Crosshair",properties:{show:{displayName:"Crosshair",type:{bool:!0}}}},outline:{displayName:"Outline",properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Outline"),type:{bool:!0}}}}}},a}();a.EnhancedScatterChart=r}(a=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var THREE,WebGLHeatmap,GlobeMapCanvasLayers,powerbi;!function(e){var t;!function(t){var a;!function(a){var i=e.data.DataRoleHelper,r=function(){function a(){this.renderData=[],this.locationsToLoad=0,this.locationsLoaded=0,this.renderLoopEnabled=!0,this.needsRender=!1}return a.converter=function(e){return{}},a.prototype.init=function(e){this.container=e.element,this.viewport=e.viewport,this.readyToRender=!1,this.globeMapLocationCache||(this.globeMapLocationCache={}),THREE||loadGlobeMapLibs(),THREE&&this.setup()},a.prototype.setup=function(){this.initSettings(),this.initTextures(),this.initMercartorSphere(),this.initZoomControl(),this.initScene(),this.initHeatmap(),this.readyToRender=!0,this.composeRenderData(),this.initRayCaster()},a.prototype.initSettings=function(){var e=this.settings={};e.autoRotate=!1,e.earthRadius=30,e.cameraRadius=100,e.earthSegments=100,e.heatmapSize=1e3,e.heatPointSize=7,e.heatIntensity=10,e.heatmapScaleOnZoom=.95,e.barWidth=.3,e.barHeight=5,e.rotateSpeed=.5,e.zoomSpeed=.8,e.cameraAnimDuration=1e3,e.clickInterval=200},a.prototype.initScene=function(){var e=this.viewport,t=this.settings,a=new THREE.Clock,i=this.renderer=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});this.container.append(i.domElement),this.domElement=i.domElement;var r=this.camera=new THREE.PerspectiveCamera(35,e.width/e.height,.1,1e4),s=this.orbitControls=new THREE.OrbitControls(r,this.domElement),o=this.scene=new THREE.Scene;i.setSize(e.width,e.height),i.setClearColor(12240082,1),r.position.z=t.cameraRadius,s.maxDistance=t.cameraRadius,s.minDistance=t.earthRadius+1,s.rotateSpeed=t.rotateSpeed,s.zoomSpeed=t.zoomSpeed,s.autoRotate=t.autoRotate;var l=new THREE.AmbientLight(0),n=new THREE.DirectionalLight(16777215,.4),c=new THREE.DirectionalLight(16777215,.4),h=this.earth=this.createEarth();o.add(l),o.add(n),o.add(c),o.add(h),n.position.set(20,20,20),c.position.set(0,0,-20);var u=this;requestAnimationFrame(function d(){try{if(u.renderLoopEnabled&&requestAnimationFrame(d),!u.shouldRender())return;s.update(a.getDelta()),u.setEarthTexture(),u.intersectBars(),u.heatmap.display(),i.render(o,r),u.needsRender=!1}catch(e){}})},a.prototype.shouldRender=function(){return this.readyToRender&&this.needsRender},a.prototype.createEarth=function(){var e=new a.MercartorSphere(this.settings.earthRadius,this.settings.earthSegments,this.settings.earthSegments),t=new THREE.MeshPhongMaterial({map:this.mapTextures[0],side:THREE.DoubleSide,shininess:1,emissive:11184810});return new THREE.Mesh(e,t)},a.prototype.zoomClicked=function(e){this.orbitControls.enabled!==!1&&this.orbitControls.enableZoom!==!1&&(-1===e?this.orbitControls.constraint.dollyOut(Math.pow(.95,this.settings.zoomSpeed)):1===e&&this.orbitControls.constraint.dollyIn(Math.pow(.95,this.settings.zoomSpeed)),this.orbitControls.update(),this.animateCamera(this.camera.position))},a.prototype.rotateCam=function(e,t){this.orbitControls.enabled!==!1&&this.orbitControls.enableRotate!==!1&&(this.orbitControls.constraint.rotateLeft(2*Math.PI*e/this.domElement.offsetHeight*this.settings.rotateSpeed),this.orbitControls.constraint.rotateUp(2*Math.PI*t/this.domElement.offsetHeight*this.settings.rotateSpeed),this.orbitControls.update(),this.animateCamera(this.camera.position))},a.prototype.initZoomControl=function(){var e=this,t=17,a=8.5*t,i=8.5*t,r=3*t,s=t+3,o=2*t,l={position:"absolute",left:"calc(100% - "+a+"px)",top:"calc(100% - "+i+"px)",zIndex:"1000"},n=d3.select(this.container[0]).append("div").style(l);this.zoomControl=n.append("svg").attr({width:a,height:i});var c=this.zoomControl.append("g").on("click",function(){return e.rotateCam(0,-5)});c.append("circle").attr({cx:r+o,cy:s+2*o,r:t,fill:"white",opacity:.5,stroke:"gray"}),c.append("path").attr({d:"M"+(r+2*t)+" "+(s+4.7*t)+" l12 -20 a40,70 0 0,1 -24,0z",fill:"gray"});var h=this.zoomControl.append("g").on("click",function(){return e.rotateCam(5,0)});h.append("circle").attr({cx:r,cy:s+o,r:t,fill:"white",stroke:"gray",opacity:.5}),h.append("path").attr({d:"M"+(r-t/1.5)+" "+(s+2*t)+" l20 -12 a70,40 0 0,0 0,24z",fill:"gray"});var u=this.zoomControl.append("g").on("click",function(){return e.rotateCam(0,5)});u.append("circle").attr({cx:r+o,cy:s,r:t,fill:"white",stroke:"gray",opacity:.5}),u.append("path").attr({d:"M"+(r+2*t)+" "+(s-t/1.5)+" l12 20 a40,70 0 0,0 -24,0z",fill:"gray"});var d=this.zoomControl.append("g").on("click",function(){return e.rotateCam(-5,0)});d.append("circle").attr({cx:r+2*o,cy:s+o,r:t,fill:"white",stroke:"gray",opacity:.5}),d.append("path").attr({d:"M"+(r+4.7*t)+" "+(s+2*t)+" l-20 -12 a70,40 0 0,1 0,24z",fill:"gray"});var p=this.zoomControl.append("g").on("click",function(){return e.zoomClicked(-1)});p.append("circle").attr({cx:r+4*t,cy:s+6*t,r:t,fill:"white",stroke:"gray",opacity:.5}),p.append("rect").attr({x:r+3.5*t,y:s+5.9*t,width:t,height:t/3,fill:"gray"}),p.append("rect").attr({x:r+4*t-t/6,y:s+5.55*t,width:t/3,height:t,fill:"gray"});var g=this.zoomControl.append("g").on("click",function(){return e.zoomClicked(1)});g.append("circle").attr({cx:r,cy:s+6*t,r:t,fill:"white",stroke:"gray",opacity:"0.50"}),g.append("rect").attr({x:r-t/2,y:s+5.9*t,width:t,height:t/3,fill:"gray"})},a.prototype.initTextures=function(){var e=this;if(!GlobeMapCanvasLayers){GlobeMapCanvasLayers=[];for(var t=2;5>=t;++t){var a=this.getBingMapCanvas(t);GlobeMapCanvasLayers.push(a)}}var i=function(t){var a=new THREE.Texture(t.get(0));return a.needsUpdate=!0,t.on("ready",function(t,i){a.needsUpdate=!0,e.needsRender=!0}),a};this.mapTextures=[];for(var r=0;r<GlobeMapCanvasLayers.length;++r)this.mapTextures.push(i(GlobeMapCanvasLayers[r]))},a.prototype.initHeatmap=function(){var e=this.settings;try{var t=this.heatmap=new WebGLHeatmap({width:e.heatmapSize,height:e.heatmapSize,intensityToAlpha:!0})}catch(a){}var i=this.heatTexture=new THREE.Texture(t.canvas);i.needsUpdate=!0;var r=new THREE.MeshBasicMaterial({map:i,transparent:!0}),s=new THREE.SphereGeometry(e.earthRadius+.01,e.earthSegments,e.earthSegments),o=new THREE.Mesh(s,r);window.heatmap=t,window.heatmapTexture=i,this.scene.add(o)},a.prototype.setEarthTexture=function(){if(this.camera){var e,t=this.settings.cameraRadius-this.settings.earthRadius,a=(this.camera.position.length()-this.settings.earthRadius)/t;e=.2>=a?this.mapTextures[3]:.4>=a?this.mapTextures[2]:.6>=a?this.mapTextures[1]:this.mapTextures[0],this.earth.material.map!==e&&(this.earth.material.map=e),this.selectedBar?this.orbitControls.rotateSpeed=this.settings.rotateSpeed:this.orbitControls.rotateSpeed=this.settings.rotateSpeed*a}},a.prototype.update=function(e){if(this.needsRender=!0,this.cleanHeatAndBar(),e.viewport.height!==this.viewport.height||e.viewport.width!==this.viewport.width){var t=this.viewport=e.viewport;return void(this.camera&&this.renderer&&(this.camera.aspect=t.width/t.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(t.width,t.height)))}e.dataViews[0]&&e.dataViews[0].categorical&&this.composeRenderData(e.dataViews[0].categorical)},a.prototype.cleanHeatAndBar=function(){this.heatmap.clear(),this.heatTexture.needsUpdate=!0,this.barsGroup&&this.scene.remove(this.barsGroup)},a.prototype.renderMagic=function(){if(!this.readyToRender)return void this.defferedRender();var e=this.renderData,t=this.heatmap,a=this.settings;t.clear(),this.barsGroup&&this.scene.remove(this.barsGroup),this.barsGroup=new THREE.Object3D,this.scene.add(this.barsGroup);var i=[new THREE.MeshPhongMaterial({color:16711935,side:THREE.DoubleSide,shading:THREE.FlatShading,transparent:!0}),new THREE.MeshPhongMaterial({color:16776986,side:THREE.DoubleSide,shading:THREE.FlatShading,transparent:!0}),new THREE.MeshPhongMaterial({color:16711680,side:THREE.DoubleSide,shading:THREE.FlatShading,transparent:!0}),new THREE.MeshPhongMaterial({color:65535,side:THREE.DoubleSide,shading:THREE.FlatShading,transparent:!0}),new THREE.MeshPhongMaterial({color:10046720,side:THREE.DoubleSide,shading:THREE.FlatShading,transparent:!0}),new THREE.MeshPhongMaterial({color:11783372,side:THREE.DoubleSide,shading:THREE.FlatShading,transparent:!0}),new THREE.MeshPhongMaterial({color:11331072,side:THREE.DoubleSide,shading:THREE.FlatShading,transparent:!0}),new THREE.MeshPhongMaterial({color:5395066,side:THREE.DoubleSide,shading:THREE.FlatShading,transparent:!0})];this.averageBarVector=new THREE.Vector3;for(var r=0,s=e.length;s>r;++r){var o=e[r];if(o.lat&&o.lng){if(o.heat>.001){o.heat<.1&&(o.heat=.1);var l=(180+o.lng)/360*a.heatmapSize,n=(1-(90+o.lat)/180)*a.heatmapSize;t.addPoint(l,n,a.heatPointSize,o.heat*a.heatIntensity)}if(o.height>=0){o.height<.01&&(o.height=.01);var c=o.lat/180*Math.PI,h=o.lng/180*Math.PI,l=Math.cos(h)*Math.cos(c),u=-Math.sin(h)*Math.cos(c),n=Math.sin(c),d=new THREE.Vector3(l,n,u);this.averageBarVector.add(d);var p=a.barHeight*o.height,g=[],m=[];if(o.heightBySeries)for(var y=0;y<o.heightBySeries.length;y++)o.heightBySeries[y]&&g.push(o.heightBySeries[y]),m.push(o.seriesToolTipData[y]);else g.push(1);for(var f=0,v=0;v<g.length;v++){f+=g[v];var x=new THREE.CubeGeometry(a.barWidth,a.barWidth,p*g[v]),b=new THREE.Mesh(x,i[v%(i.length-1)]);b.position=d.clone().multiplyScalar(a.earthRadius+p/2*f),b.lookAt(d),b.toolTipData=0===m.length?o.toolTipData:this.getToolTipDataForSeries(o.toolTipData,m[v]),this.barsGroup.add(b),f+=g[v]}}}}this.barsGroup.children.length>0&&this.camera&&(this.averageBarVector.multiplyScalar(1/this.barsGroup.children.length),this.locationsLoaded===this.locationsToLoad&&this.animateCamera(this.averageBarVector)),t.update(),t.blur(),this.heatTexture.needsUpdate=!0,this.needsRender=!0},a.prototype.getToolTipDataForSeries=function(e,t){var a=jQuery.extend(!0,{series:{displayName:t.displayName,value:t.value}},e);return a.height.value=t.dataPointValue,a},a.prototype.composeRenderData=function(e){e?this.categoricalView=e:e=this.categoricalView,this.renderData=[];var a=[],r=this.globeMapLocationCache;if(e){var s=e.categories,o=e.values.grouped(),l=0,n=0;try{l=i.getMeasureIndexOfRole(o,"Height"),n=i.getMeasureIndexOfRole(o,"Heat");var c=i.getMeasureIndexOfRole(o,"X"),h=i.getMeasureIndexOfRole(o,"Y")}catch(u){}var d,p,g,m,y,f,v,x,b,S,w,C;if(void 0!==l&&e.values[l]&&void 0!==e.values){var D=s[0];a=D.values,x=D.source.displayName,d=D.source.type.category?D.source.type.category.toLowerCase():""}else a=[];if(void 0!==l&&e.values[l])if(b=e.values[l].source.displayName,w=e.values[l].source.format,o.length>1){p=new Array(a.length),g=new Array(a.length),m=new Array(a.length);for(var P=0;P<o.length;P++)for(var A=o[P].values[l].values,N=0;N<A.length;N++)p[N]||(p[N]=0),p[N]+=A[N]?A[N]:0,g[N]||(g[N]=[]),g[N][P]=A[N],m[N]||(m[N]=[]),m[N][P]={displayName:e.values.source.displayName,value:o[P].name,dataPointValue:A[N]};for(var P=0;P<o.length;P++)for(var A=o[P].values[l].values,N=0;N<A.length;N++)g[N][P]=A[N]/p[N]}else p=e.values[l].values,g=new Array(o.length);else g=new Array(a.length),p=new Array(a.length);if(void 0!==n&&e.values[n]){if(o.length>1){y=new Array(a.length);for(var P=0;P<o.length;P++)for(var A=o[P].values[n].values,N=0;N<A.length;N++)y[N]||(y[N]=0),y[N]+=A[N]?A[N]:0}else y=e.values[n].values;S=e.values[n].source.displayName,C=e.values[n].source.format}else y=new Array(a.length);void 0!==c&&e.values[c]&&void 0!==h&&e.values[h]?(v=e.values[c].values,f=e.values[h].values):(v=null,f=null);for(var T=Math.max.apply(null,p)||1,V=Math.max.apply(null,y)||1,L=t.valueFormatter.create({format:C,value:y[0],value2:y[1]}),M=t.valueFormatter.create({format:w,value:p[0],value2:p[1]}),P=0,k=a.length;k>P;++P){var j,I,O,G,F,R=a[P];if(R&&"string"==typeof R){R=R.toLowerCase();var z=R+"/"+d;!v&&r[z]?(O=r[z],j=O.latitude,I=O.longitude):v&&(j=f[P],I=v[P]),G=p[P]/T,F=y[P]/V;var B={lat:j,lng:I,height:G?G||.01:void 0,heightBySeries:g[P],seriesToolTipData:m?m[P]:void 0,heat:F||0,toolTipData:{location:{displayName:x,value:a[P]},height:{displayName:b,value:M.format(p[P])},heat:{displayName:S,value:L.format(y[P])}}};this.renderData.push(B),v||O||this.geocodeRenderDatum(B,R,d)}}try{this.renderMagic()}catch(u){}}},a.prototype.geocodeRenderDatum=function(a,i,r){var s=this,o=i+"/"+r;this.globeMapLocationCache[o]={},this.locationsToLoad++;try{var l=e.visuals.BI.Services.GeocodingManager.geocode}catch(n){l=t.services.geocode}l&&l(i,r).always(function(e){s.globeMapLocationCache[o]=e,s.locationsLoaded++,e.latitude&&e.longitude&&(a.lat=e.latitude,a.lng=e.longitude,s.defferedRender())})},a.prototype.defferedRender=function(){var e=this;this.deferredRenderTimerId||(this.deferredRenderTimerId=setTimeout(function(){e.deferredRenderTimerId=null,e.composeRenderData()},500))},a.prototype.initRayCaster=function(){var e=this;this.rayCaster=new THREE.Raycaster;var t,a=this.settings,i=this.mousePosNormalized=new THREE.Vector2,r=this.mousePos=new THREE.Vector2,s=this.container.get(0);$(this.domElement).on("mousemove",function(t){var a=s.getBoundingClientRect();r.x=t.clientX,r.y=t.clientY,i.x=(t.clientX-a.left)/a.width*2-1,i.y=2*-((t.clientY-a.top)/a.height)+1,e.needsRender=!0}).on("mousedown",function(e){t=Date.now()}).on("mouseup",function(i){Date.now()-t>a.clickInterval||(e.hoveredBar&&i.shiftKey?(e.selectedBar=e.hoveredBar,e.animateCamera(e.selectedBar.position,function(){e.selectedBar&&(e.orbitControls.center.copy(e.selectedBar.position.clone().normalize().multiplyScalar(a.earthRadius)),e.orbitControls.minDistance=1)})):e.selectedBar&&(e.animateCamera(e.selectedBar.position,function(){e.orbitControls.center.set(0,0,0),e.orbitControls.minDistance=a.earthRadius+1}),e.selectedBar=null))}).on("mousewheel DOMMouseScroll",function(t){if(e.needsRender=!0,e.orbitControls.enabled&&e.orbitControls.enableZoom){e.heatTexture.needsUpdate=!0,t=t.originalEvent;var a=t.wheelDelta>0||t.detail<0?1:-1,i=a>0?e.settings.heatmapScaleOnZoom:1/e.settings.heatmapScaleOnZoom;e.heatmap.multiply(i),e.heatmap.update()}})},a.prototype.intersectBars=function(){if(this.rayCaster&&this.barsGroup){var e=this.rayCaster;e.setFromCamera(this.mousePosNormalized,this.camera);var a=e.intersectObjects(this.barsGroup.children);if(a&&a.length>0){var i=a[0].object;if(!i||!i.toolTipData)return;var r=i.toolTipData,s=[];r.location.displayName&&s.push(r.location),r.series&&s.push(r.series),r.height.displayName&&s.push(r.height),r.heat.displayName&&s.push(r.heat),this.hoveredBar=i,t.TooltipManager.ToolTipInstance.show(s,{x:this.mousePos.x,y:this.mousePos.y,width:0,height:0})}else this.hoveredBar=null,t.TooltipManager.ToolTipInstance.hide()}},a.prototype.animateCamera=function(e,t){var a=this;
if(this.camera){var i=Date.now(),r=this.settings.cameraAnimDuration,s=i+r,o=this.camera.position.clone().normalize(),l=e.clone().normalize(),n=this.camera.position.length(),c=function(e){return e*=2,1>e?e*e*e/2:(e-=2,(e*e*e+2)/2)},h=function(){var e=Date.now(),u=(e-i)/r;u>1&&(u=1),u=c(u);var d=(new THREE.Vector3).add(o.clone().multiplyScalar(1-u)).add(l.clone().multiplyScalar(u)).normalize().multiplyScalar(n);a.camera.position=d,s>e?requestAnimationFrame(h):t&&t(),a.needsRender=!0};requestAnimationFrame(h)}},a.prototype.destroy=function(){if(clearTimeout(this.deferredRenderTimerId),this.renderLoopEnabled=!1,this.scene=null,this.heatmap=null,this.heatTexture=null,this.camera=null,this.renderer){if(this.renderer.context){var e=this.renderer.context.getExtension("WEBGL_lose_context");e&&e.loseContext(),this.renderer.context=null}this.renderer.domElement=null}this.renderer=null,this.renderData=null,this.barsGroup=null,this.orbitControls&&this.orbitControls.dispose(),this.orbitControls=null,this.domElement&&$(this.domElement).off("mousemove mouseup mousedown mousewheel DOMMouseScroll"),this.domElement=null,this.container&&this.container.empty()},a.prototype.initMercartorSphere=function(){if(!a.MercartorSphere){var e=function(e,t,a){function i(e,t,a){return(1-a)*e+a*t}function r(e,t,a){var r=2*Math.PI,s=Math.PI,o=this.radius,l=-o*Math.cos(e*r)*Math.sin(t*s),n=-o*Math.cos(t*s),c=o*Math.sin(e*r)*Math.sin(t*s),h=e*o*2-o,u=t*o*2-o,d=0,p=i(l,h,a),g=i(n,u,a),m=i(c,d,a);return new THREE.Vector3(p,g,m)}function s(e,t,a){var i=90*(t-.5)*2/180*Math.PI,r=Math.sin(i),s=.5+.25*Math.log((1+r)/(1-r))/Math.PI;return new THREE.Vector2(e,s)}THREE.Geometry.call(this),this.radius=e,this.widthSegments=t,this.heightSegments=a,this.t=0;var o,l,n=[],c=[];for(l=0;a>=l;l++){var h=[],u=[];for(o=0;t>=o;o++){var d=o/t,p=l/a;this.vertices.push(r.call(this,d,p,this.t)),u.push(s.call(this,d,p,this.t)),h.push(this.vertices.length-1)}n.push(h),c.push(u)}for(l=0;l<this.heightSegments;l++)for(o=0;o<this.widthSegments;o++){var g=n[l][o+1],m=n[l][o],y=n[l+1][o],f=n[l+1][o+1],v=this.vertices[g].clone().normalize(),x=this.vertices[m].clone().normalize(),b=this.vertices[y].clone().normalize(),S=this.vertices[f].clone().normalize(),w=c[l][o+1].clone(),C=c[l][o].clone(),D=c[l+1][o].clone(),P=c[l+1][o+1].clone(),A=[v,x,b,S];this.faces.push(new THREE.Face4(g,m,y,f,A)),this.faceVertexUvs[0].push([w,C,D,P])}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)};e.prototype=Object.create(THREE.Geometry.prototype),a.MercartorSphere=e}},a.prototype.getBingMapCanvas=function(e){function t(i,r){e>=i&&(i===e&&a(r),t(i+1,r+"0"),t(i+1,r+"1"),t(i+1,r+"2"),t(i+1,r+"3"))}function a(t){var a="https://t{server}.tiles.virtualearth.net/tiles/r{quad}.jpeg?g=0&mkt={language}",s=7,n=Math.round(Math.random()*s),h=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language,d=a.replace("{server}",n).replace("{quad}",t).replace("{language}",h),p=i(t),g=new Image;g.onload=function(){l++,u.drawImage(g,p.x*r,p.y*r,r,r),l===o&&c.trigger("ready",e)},g.crossOrigin="",g.src=d}function i(e){for(var t=0,a=0,i=e.length-1,r=i;r>=0;r--){var s=e.charAt(r),o=Math.pow(2,i-r);"1"===s?t+=o:"2"===s?a+=o:"3"===s&&(t+=o,a+=o)}return{x:t,y:a}}var r=256,s=Math.pow(2,e),o=s*s,l=0,n=r*s,c=$("<canvas/>").attr({width:n,height:n}),h=c.get(0),u=h.getContext("2d");return t(0,""),c},a.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Location"),preferredTypes:[{geography:{address:!0}},{geography:{city:!0}},{geography:{continent:!0}},{geography:{country:!0}},{geography:{county:!0}},{geography:{place:!0}},{geography:{postalCode:!0}},{geography:{region:!0}},{geography:{stateOrProvince:!0}}]},{name:"Series",kind:e.VisualDataRoleKind.Grouping,displayName:"Legend"},{name:"X",kind:e.VisualDataRoleKind.Measure,displayName:"Longitude",description:"Use to override the longitude of locations",preferredTypes:[{geography:{longitude:!0}}]},{name:"Y",kind:e.VisualDataRoleKind.Measure,displayName:"Latitude",description:"Use to override the latitude of locations",preferredTypes:[{geography:{latitude:!0}}]},{name:"Height",kind:e.VisualDataRoleKind.Measure,displayName:"Bar Height"},{name:"Heat",kind:e.VisualDataRoleKind.Measure,displayName:"Heat Intensity"}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},legend:{displayName:e.data.createDisplayNameGetter("Visual_Legend"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_LegendPosition"),type:{formatting:{legendPosition:!0}}},showTitle:{displayName:e.data.createDisplayNameGetter("Visual_LegendShowTitle"),type:{bool:!0}},titleText:{displayName:e.data.createDisplayNameGetter("Visual_LegendTitleText"),type:{text:!0}}}},dataPoint:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint"),properties:{defaultColor:{displayName:e.data.createDisplayNameGetter("Visual_DefaultColor"),type:{fill:{solid:{color:!0}}}},showAllDataPoints:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint_Show_All"),type:{bool:!0}},fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},fillRule:{displayName:e.data.createDisplayNameGetter("Visual_Gradient"),type:{fillRule:{}},rule:{inputRole:"Gradient",output:{property:"fill",selector:["Category"]}}}}},categoryLabels:{displayName:e.data.createDisplayNameGetter("Visual_CategoryLabels"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_LabelsFill"),type:{fill:{solid:{color:!0}}}}}}},dataViewMappings:[{conditions:[{Category:{max:1},Series:{max:1},Height:{max:1},Heat:{max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{group:{by:"Series",select:[{bind:{to:"Height"}},{bind:{to:"Heat"}},{bind:{to:"X"}},{bind:{to:"Y"}}],dataReductionAlgorithm:{top:{}}}},rowCount:{preferred:{min:2}}}}],sorting:{custom:{}}},a}();a.GlobeMap=r}(a=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a;!function(a){var i=t.utility.SelectionManager,r=jsCommon.CssConstants.createClassAndSelector,s=jsCommon.PixelConverter,o=function(){function e(){}return e.prototype.bindEvents=function(e,t){var a=this.selection=e.selection,i=e.clearCatcher;a.on("click",function(e){t.handleSelection(e,d3.event.ctrlKey),d3.event.stopPropagation()}),i.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){this.selection.style("opacity",function(t){return e&&!t.selected?l.DimmedAreaFillOpacity:l.AreaFillOpacity})},e}();a.RadarChartWebBehavior=o;var l=function(){function a(e){e&&(e.svg&&(this.svg=e.svg),e.animator&&(this.animator=e.animator),e.margin&&(this.margin=e.margin))}return a.converter=function(e,i){if(!(e&&e.categorical&&e.categorical.categories&&e.categorical.categories.length>0&&e.categorical.categories[0]&&e.categorical.values&&e.categorical.values.length>0))return{legendData:{dataPoints:[]},settings:{showLegend:!0},series:[],dataLabelsSettings:t.dataLabelUtils.getDefaultPointLabelSettings()};for(var r=e.categorical,s=r.values,o=[],l=new t.ColorHelper(i,a.Properties.dataPoint.fill),n={fontSize:8.25,dataPoints:[],title:""},c=a.parseSettings(e),h=a.parseLabelSettings(e),u=0,d=s.length;d>u;u++){var p=i.getColorByIndex(u).value,g=void 0,m=void 0,y=void 0,f=[];if(s[u].source){var v=s[u].source;if(v.queryName&&(m=v.queryName,g=t.SelectionId.createWithMeasure(m)),v.displayName&&(y=v.displayName),v.objects){var x=v.objects;p=l.getColorForMeasure(x,m)}}n.dataPoints.push({label:y,color:p,icon:t.LegendIcon.Box,selected:!1,identity:g});for(var b=0,S=s[u].values.length;S>b;b++){var w=t.SelectionIdBuilder.builder().withMeasure(m).withCategory(r.categories[0],b).withSeries(e.categorical.values,e.categorical.values[u]).createSelectionId(),C=t.TooltipBuilder.createTooltipInfo(a.formatStringProp,r,r.categories[0].values[b],s[u].values[b],null,null,u),D=t.valueFormatter.getFormatString(r.values[u].source,a.formatStringProp),P=jsCommon.PixelConverter.fromPoint(h.fontSize);f.push({x:b,y:s[u].values[b],color:p,identity:w,selected:!1,tooltipInfo:C,value:s[u].values[b],labelFormatString:D,labelFontSize:P})}f.length>0&&o.push({fill:p,name:y,data:f,identity:g})}return{legendData:n,settings:c,series:o,dataLabelsSettings:h}},a.prototype.init=function(e){var r=e.element;this.selectionManager=new i({hostServices:e.host}),this.svg||(this.svg=d3.select(r.get(0)).append("svg"),this.svg.style("position","absolute")),this.margin||(this.margin=a.DefaultMargin),this.svg.classed(a.VisualClassName,!0),this.interactivityService=t.createInteractivityService(e.host),this.isInteractiveChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.legend=t.createLegend(r,this.isInteractiveChart,this.interactivityService,!0,t.LegendPosition.Top),this.colors=e.style.colorPalette.dataColors,this.mainGroupElement=this.svg.append("g"),this.segments=this.mainGroupElement.append("g").classed(a.Segments["class"],!0),this.axis=this.mainGroupElement.append("g").classed(a.Axis["class"],!0),this.chart=this.mainGroupElement.append("g").classed(a.Chart["class"],!0)},a.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){var i=e.dataViews[0];this.radarChartData=a.converter(i,this.colors);var r,s=[],o=this.radarChartData.series,l=t.AnimatorCommon.GetAnimationDuration(this.animator,e.suppressAnimations);i.categorical&&i.categorical.categories&&i.categorical.categories[0]&&i.categorical.categories[0].values&&(s=i.categorical.categories[0].values),i.metadata&&i.metadata.columns&&i.metadata.columns.length>0&&(r=i.metadata.columns[0]),this.viewport={height:e.viewport.height>0?e.viewport.height:0,width:e.viewport.width>0?e.viewport.width:0},this.parseLegendProperties(i),this.renderLegend(this.radarChartData),this.updateViewport(),this.svg.attr({height:this.viewport.height,width:this.viewport.width});var n=this.mainGroupElement;n.attr("transform",t.SVGUtil.translate(this.viewport.width/2,this.viewport.height/2));var c=this.viewport.width-this.margin.left-this.margin.right,h=this.viewport.height-this.margin.top-this.margin.bottom;this.angle=a.Radians/s.length,this.radius=a.SegmentFactor*a.Scale*Math.min(c,h)/2,this.drawCircularSegments(s),this.drawAxes(s),this.drawAxesLabels(s,r),this.drawChart(o,l),this.drawDataLabels(o)}},a.prototype.getRadarChartLabelLayout=function(e,a){var i=t.dataLabelUtils.createColumnFormatterCacheManager(),r=this.angle,o=this.radius,l=this.getDataPoints(this.radarChartData.series),n=d3.layout.stack(),c=n(l),h=this.viewport,u=this.viewport.height/2,d=this.viewport.width/2,p=d3.scale.linear().domain([0,d3.max(c,function(e){return d3.max(e,function(e){return e.y0+e.y})})]).range([0,o]);return{labelText:function(r){var s=i.getOrCreate(r.labelFormatString,e);if(0===e.displayUnits){var o=_.max(a,function(e){return e.value}),l=o.value>0?o.value:0;s=i.getOrCreate(r.labelFormatString,e,l)}return t.dataLabelUtils.getLabelFormattedText({label:s.format(r.value),maxWidth:h.width,fontSize:e.fontSize})},labelLayout:{x:function(e){return-1*p(e.y)*Math.sin(e.x*r)+d},y:function(e){return-1*p(e.y)*Math.cos(e.x*r)+u-10}},filter:function(e){return null!=e&&null!=e.value},style:{fill:e.labelColor,"font-size":function(t){return s.fromPoint(e.fontSize)}}}},a.prototype.drawCircularSegments=function(e){for(var i=[],r=this.angle,s=a.SegmentFactor,o=a.SegmentLevels,l=this.radius,n=0;o-1>n;n++)for(var c=l*((n+1)/o),h=-1*c,u=0;u<e.length;u++)i.push({x1:c*(1-s*Math.sin(u*r)),y1:c*(1-s*Math.cos(u*r)),x2:c*(1-s*Math.sin((u+1)*r)),y2:c*(1-s*Math.cos((u+1)*r)),translate:t.SVGUtil.translate(h,h)});var d=this.mainGroupElement.select(a.Segments.selector).selectAll(a.SegmentNode.selector).data(i);d.enter().append("svg:line").classed(a.SegmentNode["class"],!0),d.attr({x1:function(e){return e.x1},y1:function(e){return e.y1},x2:function(e){return e.x2},y2:function(e){return e.y2},transform:function(e){return e.translate}}),d.exit().remove()},a.prototype.drawDataLabels=function(e){var a=this.getAllDataPointsList(e);if(this.radarChartData.dataLabelsSettings.show){var i=this.getRadarChartLabelLayout(this.radarChartData.dataLabelsSettings,a),r=this.viewport,s=t.dataLabelUtils.drawDefaultLabelsForDataPointChart(a,this.mainGroupElement,i,r);s&&s.attr("transform",t.SVGUtil.translate(-(r.width/2),-(r.height/2)))}else t.dataLabelUtils.cleanDataLabels(this.mainGroupElement)},a.prototype.drawAxes=function(e){var t=this.angle,i=-1*this.radius,r=this.mainGroupElement.select(a.Axis.selector).selectAll(a.AxisNode.selector),s=r.data(e);s.enter().append("svg:line"),s.attr({x1:0,y1:0,x2:function(e,a){return i*Math.sin(a*t)},y2:function(e,a){return i*Math.cos(a*t)}}).classed(a.AxisNode["class"],!0),s.exit().remove()},a.prototype.drawAxesLabels=function(e,i){var r=this.angle,s=-1*this.radius,o=e.length,l=t.valueFormatter.create({format:t.valueFormatter.getFormatString(i,a.formatStringProp,!0),value:e[0],value2:e[o-1]}),n=this.mainGroupElement.select(a.Axis.selector).selectAll(a.AxisLabel.selector),c=n.data(e);c.enter().append("svg:text"),c.attr({"text-anchor":"middle",dy:"1.5em",transform:t.SVGUtil.translate(0,-10),x:function(e,t){return(s-20)*Math.sin(t*r)},y:function(e,t){return(s-10)*Math.cos(t*r)}}).text(function(e){return l.format(e)}).classed(a.AxisLabel["class"],!0),c.exit().remove()},a.prototype.drawChart=function(e,i){var r=this.angle,s=this.radius,l=5,n=this.getDataPoints(e),c=d3.layout.stack(),h=c(n),u=d3.scale.linear().domain([0,d3.max(h,function(e){return d3.max(e,function(e){return e.y0+e.y})})]).range([0,s]),d=function(e){return e.map(function(e){var t=-1*u(e.y)*Math.sin(e.x*r),a=-1*u(e.y)*Math.cos(e.x*r);return t+","+a}).join(" ")},p=this.chart.selectAll(a.ChartNode.selector).data(h);p.enter().append("g").classed(a.ChartNode["class"],!0);var g=p.selectAll(a.ChartPolygon.selector).data(function(e){return e&&e.length>0?[e]:[]});g.enter().append("polygon").classed(a.ChartPolygon["class"],!0),g.style("fill",function(e){return e[0].color}).style("opacity",a.DimmedAreaFillOpacity).on("mouseover",function(e){d3.select(this).transition().duration(i).style("opacity",a.AreaFillOpacity)}).on("mouseout",function(e){d3.select(this).transition().duration(i).style("opacity",a.DimmedAreaFillOpacity)}).attr("points",d),g.exit().remove();var m=p.selectAll(a.ChartDot.selector).data(function(e){return e.filter(function(e){return null!=e.y})});m.enter().append("svg:circle").classed(a.ChartDot["class"],!0),m.attr("r",l).attr({cx:function(e){return-1*u(e.y)*Math.sin(e.x*r)},cy:function(e){return-1*u(e.y)*Math.cos(e.x*r)}}).style("fill",function(e){return e.color}),m.exit().remove(),t.TooltipManager.addTooltip(m,function(e){return e.data.tooltipInfo},!0),p.exit().remove();var y=void 0;if(this.interactivityService){var f=this.getAllDataPointsList(e);y={selection:m,clearCatcher:this.svg},this.interactivityService.bind(f,new o,y)}},a.prototype.renderLegend=function(e){if(e.legendData){var a=e.legendData;if(this.legendObjectProperties){t.LegendData.update(a,this.legendObjectProperties);var i=this.legendObjectProperties[t.legendProps.position];i&&this.legend.changeOrientation(t.LegendPosition[i])}else this.legend.changeOrientation(t.LegendPosition.Top);var r=this.viewport;this.legend.drawLegend(a,{height:r.height,width:r.width}),t.Legend.positionChartArea(this.svg,this.legend)}},a.prototype.getDataPoints=function(e){for(var t=[],a=0,i=e;a<i.length;a++){var r=i[a];t.push(r.data)}return t},a.prototype.getAllDataPointsList=function(e){for(var t=[],a=0,i=e;a<i.length;a++){var r=i[a];t=t.concat(r.data)}return t},a.prototype.parseLegendProperties=function(t){return t&&t.metadata?void(this.legendObjectProperties=e.DataViewObjects.getObject(t.metadata.objects,"legend",{})):void(this.legendObjectProperties={})},a.parseSettings=function(t){var i;return i=t&&t.metadata&&t.metadata.columns&&t.metadata.objects?t.metadata.objects:null,{showLegend:e.DataViewObjects.getValue(i,a.Properties.legend.show,!0)}},a.parseLabelSettings=function(i){var r;r=i&&i.metadata&&i.metadata.objects?i.metadata.objects:null;var s=t.dataLabelUtils.getDefaultPointLabelSettings(),o={show:e.DataViewObjects.getValue(r,a.Properties.labels.show,s.show),labelColor:e.DataViewObjects.getFillColor(r,a.Properties.labels.color,s.labelColor),displayUnits:e.DataViewObjects.getValue(r,a.Properties.labels.displayUnits,s.displayUnits),precision:e.DataViewObjects.getValue(r,a.Properties.labels.precision,s.precision),fontSize:e.DataViewObjects.getValue(r,a.Properties.labels.fontSize,s.fontSize),position:s.position};return o},a.prototype.enumerateObjectInstances=function(e){var a,i=new t.ObjectEnumerationBuilder;if(!this.radarChartData||!this.radarChartData.settings)return[];switch(a=this.radarChartData.settings,e.objectName){case"legend":i.pushInstance(this.enumerateLegend(a));break;case"dataPoint":this.enumerateDataPoint(i);break;case"labels":this.enumerateDataLabels(i)}return i.complete()},a.prototype.getLabelSettingsOptions=function(e,t){return{enumeration:e,dataLabelsSettings:t,show:!0,displayUnits:!0,precision:!0,fontSize:!0}},a.prototype.enumerateDataLabels=function(e){var a=this.radarChartData.dataLabelsSettings;t.dataLabelUtils.enumerateDataLabels(this.getLabelSettingsOptions(e,a))},a.prototype.enumerateLegend=function(a){var i,r,s=!0,o="",l=8;return s=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.showTitle,s),o=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.titleText,o),r=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.labelColor,r),l=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.fontSize,l),i={objectName:"legend",displayName:"legend",selector:null,properties:{show:a.showLegend,position:t.LegendPosition[this.legend.getOrientation()],showTitle:s,titleText:o,labelColor:r,fontSize:l}}},a.prototype.enumerateDataPoint=function(e){if(this.radarChartData&&this.radarChartData.series)for(var a=this.radarChartData.series,i=0,r=a;i<r.length;i++){var s=r[i];e.pushInstance({objectName:"dataPoint",displayName:s.name,selector:t.ColorHelper.normalizeSelector(s.identity.getSelector(),!1),properties:{fill:{solid:{color:s.fill}}}})}},a.prototype.updateViewport=function(){var e,a=this.legend.getMargins();switch(e=t.LegendPosition[this.legendObjectProperties[t.legendProps.position]]){case t.LegendPosition.Top:case t.LegendPosition.TopCenter:case t.LegendPosition.Bottom:case t.LegendPosition.BottomCenter:this.viewport.height-=a.height;break;case t.LegendPosition.Left:case t.LegendPosition.LeftCenter:case t.LegendPosition.Right:case t.LegendPosition.RightCenter:this.viewport.width-=a.width}},a.capabilities={dataRoles:[{displayName:"Category",name:"Category",kind:e.VisualDataRoleKind.Grouping},{displayName:"Y Axis",name:"Y",kind:e.VisualDataRoleKind.Measure}],dataViewMappings:[{conditions:[{Category:{min:1,max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{select:[{bind:{to:"Y"}}]}}}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},legend:{displayName:e.data.createDisplayNameGetter("Visual_Legend"),description:e.data.createDisplayNameGetter("Visual_LegendDescription"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_LegendPosition"),description:e.data.createDisplayNameGetter("Visual_LegendPositionDescription"),type:{enumeration:t.legendPosition.type}},showTitle:{displayName:e.data.createDisplayNameGetter("Visual_LegendShowTitle"),description:e.data.createDisplayNameGetter("Visual_LegendShowTitleDescription"),type:{bool:!0}},titleText:{displayName:e.data.createDisplayNameGetter("Visual_LegendName"),description:e.data.createDisplayNameGetter("Visual_LegendNameDescription"),type:{text:!0},suppressFormatPainterCopy:!0},labelColor:{displayName:e.data.createDisplayNameGetter("Visual_LegendTitleColor"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},dataPoint:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint"),description:e.data.createDisplayNameGetter("Visual_DataPointDescription"),properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}},labels:{displayName:e.data.createDisplayNameGetter("Visual_DataPointsLabels"),description:e.data.createDisplayNameGetter("Visual_DataPointsLabelsDescription"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_LabelsFill"),description:e.data.createDisplayNameGetter("Visual_LabelsFillDescription"),type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:e.data.createDisplayNameGetter("Visual_DisplayUnits"),description:e.data.createDisplayNameGetter("Visual_DisplayUnitsDescription"),type:{formatting:{labelDisplayUnits:!0}},suppressFormatPainterCopy:!0},labelPrecision:{displayName:e.data.createDisplayNameGetter("Visual_Precision"),description:e.data.createDisplayNameGetter("Visual_PrecisionDescription"),placeHolderText:e.data.createDisplayNameGetter("Visual_Precision_Auto"),type:{numeric:!0},suppressFormatPainterCopy:!0},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}}}},a.formatStringProp={objectName:"general",propertyName:"formatString"},a.Properties={legend:{show:{objectName:"legend",propertyName:"show"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}},labels:{show:{objectName:"labels",propertyName:"show"},color:{objectName:"labels",propertyName:"color"},displayUnits:{objectName:"labels",propertyName:"labelDisplayUnits"},precision:{objectName:"labels",propertyName:"labelPrecision"},fontSize:{objectName:"labels",propertyName:"fontSize"}}},a.VisualClassName="radarChart",a.Segments=r("segments"),a.SegmentNode=r("segmentNode"),a.Axis=r("axis"),a.AxisNode=r("axisNode"),a.AxisLabel=r("axisLabel"),a.Chart=r("chart"),a.ChartNode=r("chartNode"),a.ChartPolygon=r("chartPolygon"),a.ChartDot=r("chartDot"),a.DefaultMargin={top:50,bottom:50,right:100,left:100},a.SegmentLevels=6,a.SegmentFactor=1,a.Radians=2*Math.PI,a.Scale=1,a.AreaFillOpacity=1,a.DimmedAreaFillOpacity=.4,a}();a.RadarChart=l}(a=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a;!function(a){var i=t.utility.SelectionManager,r=e.visuals.valueFormatter,s=t.AnimatorCommon.GetAnimationDuration,o=function(){function e(e){this.message=e}return Object.defineProperty(e.prototype,"code",{get:function(){return"BulletChartWarning"},enumerable:!0,configurable:!0}),e.prototype.getMessages=function(e){return{message:this.message,title:e.get(""),detail:e.get("")}},e.ErrorInvalidDataValues="Some data values are invalid or too big",e}();a.HistogramChartWarning=o;var l=function(){function a(e){this.ColumnPadding=1,this.MinColumnHeight=1,this.MinOpacity=.3,this.MaxOpacity=1,this.NumberOfLabelsOnAxisY=5,this.MinNumberOfBins=0,this.MaxNumberOfBins=100,this.MinPrecision=0,this.MaxPrecision=17,this.TooltipDisplayName="Range",this.SeparatorNumbers=", ",this.LegendSize=50,this.AxisSize=30,this.ExcludeBrackets={left:"(",right:")"},this.IncludeBrackets={left:"[",right:"]"},this.margin={top:10,right:10,bottom:10,left:10},this.durationAnimations=200,e&&(e.svg&&(this.svg=e.svg),e.animator&&(this.animator=e.animator),this.margin=e.margin||this.margin)}return Object.defineProperty(a.prototype,"columnsSelection",{get:function(){return this.main.select(a.Columns.selector).selectAll(a.Column.selector)},enumerable:!0,configurable:!0}),a.prototype.init=function(e){this.hostService=e.host,this.svg?this.root=this.svg:this.root=d3.select(e.element.get(0)).append("svg");var r=e.style;this.colors=r&&r.colorPalette?r.colorPalette.dataColors:new t.DataColorPalette,this.root.classed(a.ClassName,!0),this.main=this.root.append("g"),this.axes=this.main.append("g").classed(a.Axes["class"],!0),this.axisX=this.axes.append("g").classed(a.Axis["class"],!0),this.axisY=this.axes.append("g").classed(a.Axis["class"],!0),this.legend=this.main.append("g").classed(a.Legends["class"],!0),this.columns=this.main.append("g").classed(a.Columns["class"],!0),this.selectionManager=new i({hostServices:e.host})},a.prototype.converter=function(e){var t=this;if(!(e&&e.categorical&&e.categorical.categories&&e.categorical.categories[0]&&e.categorical.categories[0].values&&e.categorical.categories[0].values.length>0))return null;var i,s,o,l,n,c,h,u=[],d=[],p=[],g=0,m=0;return e.categorical.values&&e.categorical.values[0]&&e.categorical.values[0].values&&(d=e.categorical.values[0].values),e.categorical.categories[0].identity&&e.categorical.categories[0].identity.length>0&&(p=e.categorical.categories[0].identity),(i=this.parseSettings(e))?(o=this.getValuesByFrequencies(e.categorical.categories[0].values,d,p),o.forEach(function(e){u.push(e.value),m+=e.frequency}),s=d3.layout.histogram(),i.bins&&i.bins>this.MinNumberOfBins&&(s=s.bins(i.bins)),l=s.frequency(i.frequency)(u),l.forEach(function(e,a){var r,s;r=o.filter(function(i){return t.isValueContainedInRange(i,e,a)}),s=r.reduce(function(e,t){return e+t.frequency},0),e.y=i.frequency?s:s/m,g+=e.length}),n=d3.scale.linear().domain([d3.min(l,function(e){return d3.min(e)}),d3.max(l,function(e){return d3.max(e)})]).range([0,this.viewport.width-this.LegendSize-this.AxisSize]),c=d3.scale.linear().domain([0,d3.max(l,function(e){return e.y})]).range([this.viewport.height-this.LegendSize,0]),h=r.create({format:r.getFormatString(e.categorical.categories[0].source,a.Properties.general.formatString),value:o[0].value,value2:o[o.length-1].value,precision:i.precision}),{xScale:n,yScale:c,settings:i,data:this.getData(o,u,l,i,h),formatter:h}):null},a.prototype.getValuesByFrequencies=function(e,a,i){var r=[];return e.forEach(function(e,s){var o=1,l=Number(e);l=isNaN(l)?0:l,a&&a[s]&&!isNaN(a[s])&&a[s]>1&&(o=a[s]),r.push({value:l,frequency:o,selectionId:t.SelectionId.createWithId(i[s])})}),r},a.prototype.getData=function(e,t,a,i,r){var s=this,o=d3.min(t),l=d3.max(t);return a.map(function(t,a){return t.range=s.getRange(o,l,t.dx,a),t.tooltipInfo=s.getTooltipData(t.y,t.range,i,0===a,r),t.selectionIds=s.getSelectionIds(e,t,a),t})},a.prototype.getRange=function(e,t,a,i){var r=e+i*a,s=r+a;return[r,s]},a.prototype.getTooltipData=function(e,t,a,i,r){return[{displayName:this.getLegendText(a),value:r.format(e)},{displayName:this.TooltipDisplayName,value:this.rangeToString(t,i,r)}]},a.prototype.getSelectionIds=function(e,t,a){var i=this,r=[];return e.forEach(function(e){i.isValueContainedInRange(e,t,a)&&r.push(e.selectionId)}),r},a.prototype.isValueContainedInRange=function(e,t,a){return(0===a&&e.value>=t.x||e.value>t.x)&&e.value<=t.x+t.dx},a.prototype.parseSettings=function(e){if(!(e&&e.metadata&&e.metadata.columns&&e.metadata.columns[0]))return null;var i,r,s={};return r=new t.ColorHelper(this.colors,a.Properties.dataPoint.fill,a.DefaultHistogramSettings.fillColor),s.displayName=a.DefaultHistogramSettings.displayName,s.fillColor=a.DefaultHistogramSettings.fillColor,s.bins=a.DefaultHistogramSettings.bins,s.frequency=a.DefaultHistogramSettings.frequency,s.displayName=e.metadata.columns[0].displayName||a.DefaultHistogramSettings.displayName,i=this.getObjectsFromDataView(e),i&&(s.fillColor=r.getColorForMeasure(i,""),s.bins=this.getBins(i),s.frequency=this.getFrequency(i),s.precision=this.getPrecision(i)),s},a.prototype.getBins=function(t){var i;return i=Number(e.DataViewObjects.getValue(t,a.Properties.general.bins,a.DefaultHistogramSettings.bins)),!i||isNaN(i)||i<=this.MinNumberOfBins?a.DefaultHistogramSettings.bins:i>this.MaxNumberOfBins?this.MaxNumberOfBins:i},a.prototype.getFrequency=function(t){return e.DataViewObjects.getValue(t,a.Properties.general.frequency,a.DefaultHistogramSettings.frequency)},a.prototype.getPrecision=function(t){var i=e.DataViewObjects.getValue(t,a.Properties.labels.labelPrecision,a.DefaultHistogramSettings.precision);return i<=this.MinPrecision?this.MinPrecision:i>=this.MaxPrecision?this.MaxPrecision:i},a.prototype.validateData=function(e){return e&&e.data.some(function(e){return e.range.some(function(e){return isNaN(e)||e===1/0||e===-(1/0)})})?(this.hostService.setWarnings([new o(o.ErrorInvalidDataValues)]),!1):!0},a.prototype.update=function(e){if(e&&e.dataViews&&e.dataViews[0]){var t=e.dataViews[0];this.durationAnimations=s(this.animator,e.suppressAnimations),this.setSize(e.viewport),this.histogramDataView=this.converter(t),this.validateData(this.histogramDataView)||(this.histogramDataView.data=[]),this.render()}},a.prototype.setSize=function(e){var t,a;t=e.height-this.margin.top-this.margin.bottom,a=e.width-this.margin.left-this.margin.right,this.viewport={height:t,width:a},this.updateElements(e.height,e.width)},a.prototype.updateElements=function(e,a){var i=this.margin.left+this.LegendSize;this.root.attr({height:e,width:a}),this.main.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top)),this.legend.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top)),this.columns.attr("transform",t.SVGUtil.translate(i,0)),this.axes.attr("transform",t.SVGUtil.translate(i,0)),this.axisX.attr("transform",t.SVGUtil.translate(0,this.viewport.height-this.LegendSize))},a.prototype.render=function(){if(this.histogramDataView&&this.histogramDataView.settings){this.renderAxes();var e=this.renderColumns();this.renderLegend(),this.bindSelectionHandler(e)}},a.prototype.renderColumns=function(){var e,i,r=this,s=this.histogramDataView.data,o=this.histogramDataView.yScale,l=s.length;return e=l&&(this.viewport.width-this.AxisSize-this.LegendSize)/l-this.ColumnPadding,0>e&&(e=0),i=this.columnsSelection.data(s),i.enter().append("svg:rect"),i.attr("x",this.ColumnPadding/2).attr("width",e).attr("height",function(e){return r.getColumnHeight(e,o)}).style("fill",this.histogramDataView.settings.fillColor).attr("class",a.Column["class"]).attr("transform",function(a,i){return t.SVGUtil.translate(e*i+r.ColumnPadding*i,o(a.y)-r.ColumnPadding/2.5)}),l&&i.classed(a.Column["class"]),i.exit().remove(),this.renderTooltip(i),i},a.prototype.renderTooltip=function(e){t.TooltipManager.addTooltip(e,function(e){return e.data.tooltipInfo})},a.prototype.getColumnHeight=function(e,t){var a=this.viewport.height-this.LegendSize-t(e.y);return a>0?a:this.MinColumnHeight},a.prototype.renderAxes=function(){var e,t,a=this.histogramDataView.xScale,i=this.histogramDataView.yScale,r=this.histogramDataView.formatter;e=d3.svg.axis().scale(a).orient("bottom").tickValues(this.rangesToArray(this.histogramDataView.data)).tickFormat(function(e){return r.format(e)}),t=d3.svg.axis().scale(i).orient("left").ticks(this.NumberOfLabelsOnAxisY),this.axisX.call(e),this.axisY.call(t)},a.prototype.rangesToArray=function(e){return e.reduce(function(e,t,a){var i;return i=0===a?t.range:t.range.slice(1),e.concat(i)},[])},a.prototype.rangeToString=function(e,t,a){var i,r=this.IncludeBrackets.right,s=a.format(e[0]),o=a.format(e[1]);return i=t?this.IncludeBrackets.left:this.ExcludeBrackets.left,""+i+s+this.SeparatorNumbers+o+r},a.prototype.renderLegend=function(){var e,t,i=this.getDataLegends(this.histogramDataView.settings);e=this.main.select(a.Legends.selector).selectAll(a.Legend.selector),t=e.data(i),t.enter().append("svg:text"),t.attr("x",0).attr("y",0).attr("dx",function(e){return e.dx}).attr("dy",function(e){return e.dy}).attr("transform",function(e){return e.transform}).attr("class",a.Legend["class"]).text(function(e){return e.text}).classed(a.Legend["class"],!0),
t.exit().remove()},a.prototype.getDataLegends=function(e){var a=this.getLegendText(e);return[{transform:t.SVGUtil.translate(this.viewport.width/2,this.viewport.height),text:e.displayName,dx:"1em",dy:"-1em"},{transform:t.SVGUtil.translateAndRotate(0,this.viewport.height/2,0,0,270),text:a,dx:"3em"}]},a.prototype.getLegendText=function(e){return e.frequency?a.FrequencyText:a.DensityText},a.prototype.bindSelectionHandler=function(e){var t=this;this.setSelection(e),e.on("click",function(a){t.selectionManager.clear(),a.selectionIds.forEach(function(i){t.selectionManager.select(i,!0).then(function(i){i.length>0?t.setSelection(e,a):t.setSelection(e)})}),d3.event.stopPropagation()}),this.root.on("click",function(){t.selectionManager.clear(),t.setSelection(e)})},a.prototype.setSelection=function(e,t){e.transition().duration(this.durationAnimations).style("fill-opacity",this.MaxOpacity),t&&e.filter(function(e){return e!==t}).transition().duration(this.durationAnimations).style("fill-opacity",this.MinOpacity)},a.prototype.enumerateObjectInstances=function(e){var t,a=[];if(!this.histogramDataView||!this.histogramDataView.settings)return a;switch(t=this.histogramDataView.settings,e.objectName){case"general":var i={objectName:"general",displayName:"general",selector:null,properties:{bins:t.bins,frequency:t.frequency}};a.push(i);break;case"dataPoint":var r={objectName:"dataPoint",displayName:"dataPoint",selector:null,properties:{fill:t.fillColor}};a.push(r);break;case"labels":var s={objectName:"labels",displayName:"labels",selector:null,properties:{labelPrecision:t.precision}};a.push(s)}return a},a.prototype.getObjectsFromDataView=function(e){return e&&e.metadata&&e.metadata.columns&&e.metadata.objects?e.metadata.objects:null},a.prototype.destroy=function(){this.root=null},a.ClassName="histogram",a.FrequencyText="Frequency",a.DensityText="Density",a.Properties={general:{bins:{objectName:"general",propertyName:"bins"},frequency:{objectName:"general",propertyName:"frequency"},formatString:{objectName:"general",propertyName:"formatString"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}},labels:{labelPrecision:{objectName:"labels",propertyName:"labelPrecision"}}},a.DefaultHistogramSettings={frequency:!0,displayName:"Histogram",bins:null,fillColor:"cadetblue",precision:2},a.Axes={"class":"axes",selector:".axes"},a.Axis={"class":"axis",selector:".axis"},a.Columns={"class":"columns",selector:".columns"},a.Column={"class":"column",selector:".column"},a.Legends={"class":"legends",selector:".legends"},a.Legend={"class":"legend",selector:".legend"},a.capabilities={dataRoles:[{name:"Values",kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Values")},{name:"Frequency",kind:e.VisualDataRoleKind.Measure,displayName:"Frequency"}],dataViewMappings:[{conditions:[{Values:{min:1,max:1},Frequency:{min:0,max:1}}],categorical:{categories:{bind:{to:"Values"},dataReductionAlgorithm:{top:{}}},values:{"for":{"in":"Frequency"}}}}],sorting:{implicit:{clauses:[{role:"Values",direction:1}]}},objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}},bins:{displayName:"Bins",type:{numeric:!0}},frequency:{displayName:"Frequency",type:{bool:!0}}}},dataPoint:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint"),properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}},labels:{displayName:e.data.createDisplayNameGetter("Visual_DataPointsLabels"),properties:{labelPrecision:{displayName:e.data.createDisplayNameGetter("Visual_Precision"),type:{numeric:!0}}}}}},a}();a.Histogram=l}(a=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a;!function(a){var i=t.AnimatorCommon.GetAnimationDuration,r=jsCommon.CssConstants.createClassAndSelector,s=e.visuals.axisScale,o=jsCommon.PixelConverter,l=40,n=15,c=5,h=1,u="#00B8AA",d=0,p=17;a.DotPlotProperties={general:{formatString:{objectName:"general",propertyName:"formatString"}},labels:{show:{objectName:"labels",propertyName:"show"},fontSize:{objectName:"labels",propertyName:"fontSize"},labelPrecision:{objectName:"labels",propertyName:"labelPrecision"},labelDisplayUnits:{objectName:"labels",propertyName:"labelDisplayUnits"},labelColor:{objectName:"labels",propertyName:"labelColor"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}},categories:{show:{objectName:"categories",propertyName:"show"},fontColor:{objectName:"categories",propertyName:"fontColor"},fontSize:{objectName:"categories",propertyName:"fontSize"}}};var g=function(){function g(e){this.DefaultMargin={top:10,bottom:10,right:20,left:20},this.durationAnimations=200,this.scaleType=s.linear,this.textProperties={fontFamily:"wf_segoe-ui_normal",fontSize:jsCommon.PixelConverter.toString(9)},this.dotPlotSelectors={svgPlotSelector:r("dotplot"),plotSelector:r("dotplotSelector"),plotGroupSelector:r("dotplotGroup"),axisSelector:r("axisGraphicsContext"),xAxisSelector:r("x axis"),circleSeletor:r("circleSelector")},this.DefaultDotPlotSettings={labelSettings:{show:!0,precision:2,fontSize:t.dataLabelUtils.DefaultFontSizeInPt,displayUnits:0,labelColor:t.dataLabelUtils.defaultLabelColor},categorySettings:{show:!0,fontColor:t.LegendData.DefaultLegendLabelFillColor},defaultDataPointColor:u},e&&(e.svg&&(this.svg=e.svg),e.animator&&(this.animator=e.animator),this.radius=e.radius||c,this.strokeWidth=e.strokeWidth||h)}return g.getTooltipData=function(e){return[{displayName:"Value",value:e.toString()}]},g.converter=function(i,r,s,n,c,h,u){var d,p=i.categorical.values,m=[],y=i.categorical.categories[0].source.displayName,f=this.getObjectsFromDataView(i),v=e.DataViewObjects.getFillColor(f,a.DotPlotProperties.dataPoint.fill,c.getColorByIndex(0).value),x=i.categorical.categories[0].values.map(function(e,a){return{value:e,selectionId:t.SelectionId.createWithId(i.categorical.categories[0].identity[a])}});d={categorySettings:this.getCategorySettings(f,n),defaultDataPointColor:v,labelSettings:this.parseSettings(f,n)};for(var b=i.categorical.categories[0],S=2*u+1,w=h.height-u-l,C=Math.floor((w-s.top)/S)-1,D=o.fromPoint(d.labelSettings.fontSize),P=d3.scale.linear().domain([0,C]).range([w-s.bottom,s.top+s.bottom]),A=0,N=p;A<N.length;A++)for(var T=N[A],V=_.min(T.values),L=_.max(T.values),M=e.DataViewObjects.getFillColor(f,a.DotPlotProperties.dataPoint.fill,c.getColorByIndex(0).value),k=T.values.length,j=V/(L/C),I=d3.scale.log().domain([V,L]).range([0===j?1:j,C]).clamp(!0),O=0;k>O;O++){for(var G=I(T.values[O]),F=[],R=0;G>R;R++)F.push({x:r(x[O].value)+r.rangeBand()/2,y:P(R),tooltipInfo:g.getTooltipData(T.values[O])});var z=t.SelectionIdBuilder.builder().withCategory(b,O).createSelectionId(),B=g.getTooltipData(T.values[O]);m.push({selected:!1,value:T.values[O],label:T.values[O],color:M,identity:z,tooltipInfo:B,dataPoints:F,labelFontSize:D})}return{dataPoints:m,values:i.categorical.categories[0].values,displayName:y,categories:x,settings:d}},g.prototype.init=function(e){var a=e.element;this.behavior=new m,this.interactivityService=t.createInteractivityService(e.host),this.radius=c,this.strokeWidth=h,this.colors=e.style.colorPalette.dataColors,this.svg=d3.select(a.get(0)).append("svg").classed(this.dotPlotSelectors.svgPlotSelector["class"],!0).style("position","absolute"),this.clearCatcher=t.appendClearCatcher(this.svg);var i=this.svg.append("g").classed(this.dotPlotSelectors.axisSelector["class"],!0);this.dotPlot=this.svg.append("g").classed(this.dotPlotSelectors.plotSelector["class"],!0),this.xAxis=i.append("g").classed(this.dotPlotSelectors.xAxisSelector["class"],!0)},g.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){this.durationAnimations=i(this.animator,e.suppressAnimations);var a=this.dataView=e.dataViews[0],r=e.viewport;if(!a||!a.categorical||!a.categorical.values||a.categorical.values.length<1||!a.categorical||!a.categorical.categories||!a.categorical.categories[0])return void this.clearData();var s={height:r.height-this.DefaultMargin.top,width:r.width-this.DefaultMargin.left};this.svg.style({height:o.toString(r.height),width:o.toString(r.width)});var n=this.calculateAxes(s,this.textProperties,!1),c=g.converter(a,n.scale,this.DefaultMargin,this.DefaultDotPlotSettings,this.colors,r,this.radius);this.dotPlotDataView=c;var h=c.dataPoints;this.interactivityService&&this.interactivityService.applySelectionStateToData(h),this.renderAxis(s.height-l,n,c,this.durationAnimations),this.drawDotPlot(h,c.settings);var u=c.settings.labelSettings;if(u.show){var d=this.getEnhanchedDotplotLayout(u,s);t.dataLabelUtils.drawDefaultLabelsForDataPointChart(h,this.svg,d,s,!e.suppressAnimations,this.durationAnimations)}else t.dataLabelUtils.cleanDataLabels(this.svg)}},g.prototype.enumerateObjectInstances=function(e){var a=new t.ObjectEnumerationBuilder;switch(e.objectName){case"dataPoint":this.enumerateDataPoints(a,this.dataView);break;case"labels":this.enumerateDataLabels(a,this.dataView);break;case"categories":this.enumerateCategories(a,this.dataView)}return a.complete()},g.getObjectsFromDataView=function(e){return e&&e.metadata&&e.metadata.columns&&e.metadata.objects?e.metadata.objects:null},g.parseSettings=function(t,i){var r=this.getPrecision(t,i);return{show:e.DataViewObjects.getValue(t,a.DotPlotProperties.labels.show,i.labelSettings.show),precision:r,fontSize:e.DataViewObjects.getValue(t,a.DotPlotProperties.labels.fontSize,i.labelSettings.fontSize),displayUnits:e.DataViewObjects.getValue(t,a.DotPlotProperties.labels.labelDisplayUnits,i.labelSettings.displayUnits),labelColor:e.DataViewObjects.getFillColor(t,a.DotPlotProperties.labels.labelColor,i.labelSettings.labelColor)}},g.getCategorySettings=function(t,i){return{show:e.DataViewObject.getValue(t,a.DotPlotProperties.categories.show,i.categorySettings.show),fontColor:e.DataViewObjects.getFillColor(t,a.DotPlotProperties.categories.fontColor,i.categorySettings.fontColor)}},g.getPrecision=function(t,i){var r=e.DataViewObjects.getValue(t,a.DotPlotProperties.labels.labelPrecision,i.labelSettings.precision);return d>=r?d:r>=p?p:r},g.prototype.drawDotPlot=function(e,a){var i=this.dotPlot.selectAll(this.dotPlotSelectors.plotGroupSelector.selector).data(e),r=this.interactivityService&&this.interactivityService.hasSelection();i.enter().append("g").attr({stroke:"black","stroke-width":this.strokeWidth}).style("fill-opacity",function(e){return t.ColumnUtil.getFillOpacity(e.selected,e.highlight,r,!1)}).classed(this.dotPlotSelectors.plotGroupSelector["class"],!0);var s=i.selectAll(this.dotPlotSelectors.circleSeletor.selector).data(function(e){return e.dataPoints});s.enter().append("circle").classed(this.dotPlotSelectors.circleSeletor["class"],!0),s.attr({cx:function(e){return e.x},cy:function(e){return e.y},r:this.radius,fill:a.defaultDataPointColor}),this.renderTooltip(i),s.exit().remove(),i.exit().remove();var o=this.interactivityService;if(o){o.applySelectionStateToData(e);var l={columns:i,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService};o.bind(e,this.behavior,l)}},g.prototype.getEnhanchedDotplotLayout=function(e,i){var r=jsCommon.PixelConverter.fromPoint(e.fontSize),s=t.valueFormatter.create({format:t.valueFormatter.getFormatString(this.dataView.categorical.categories[0].source,a.DotPlotProperties.general.formatString),precision:e.precision,value:e.displayUnits});return{labelText:function(a){return t.dataLabelUtils.getLabelFormattedText({label:s.format(a.label),fontSize:e.fontSize,maxWidth:i.width})},labelLayout:{x:function(e){return e&&e.dataPoints&&e.dataPoints[e.dataPoints.length-1]?e.dataPoints[e.dataPoints.length-1].x:0},y:function(e){return e&&e.dataPoints&&e.dataPoints[e.dataPoints.length-1]?e.dataPoints[e.dataPoints.length-1].y-n:0}},filter:function(e){return null!=e&&null!=e.label},style:{fill:e.categoryLabelColor,"font-size":r}}},g.prototype.enumerateDataLabels=function(t,i){var r=i&&i.metadata?i.metadata.objects:void 0;t.pushInstance({objectName:"labels",displayName:"Labels",selector:null,properties:{show:e.DataViewObjects.getValue(r,a.DotPlotProperties.labels.show,this.DefaultDotPlotSettings.labelSettings.show),fontSize:e.DataViewObjects.getValue(r,a.DotPlotProperties.labels.fontSize,this.DefaultDotPlotSettings.labelSettings.fontSize),labelPrecision:e.DataViewObjects.getValue(r,a.DotPlotProperties.labels.labelPrecision,this.DefaultDotPlotSettings.labelSettings.precision),labelDisplayUnits:e.DataViewObjects.getValue(r,a.DotPlotProperties.labels.labelDisplayUnits,this.DefaultDotPlotSettings.labelSettings.displayUnits),labelColor:e.DataViewObjects.getFillColor(r,a.DotPlotProperties.labels.labelColor,this.DefaultDotPlotSettings.labelSettings.labelColor)}})},g.prototype.enumerateDataPoints=function(t,i){var r=i&&i.metadata?i.metadata.objects:void 0,s=e.DataViewObjects.getFillColor(r,a.DotPlotProperties.dataPoint.fill,this.DefaultDotPlotSettings.defaultDataPointColor);t.pushInstance({objectName:"dataPoint",displayName:"Data Points",selector:null,properties:{fill:{solid:{color:s}}}})},g.prototype.enumerateCategories=function(e,t){var a=t&&t.metadata?t.metadata.objects:void 0,i=g.getCategorySettings(a,this.DefaultDotPlotSettings);e.pushInstance({objectName:"categories",displayName:"Categories",selector:null,properties:{show:i.show,fontSize:i.fontSize,fontColor:i.fontColor}})},g.prototype.clearData=function(){this.dotPlot.selectAll("*").remove(),this.xAxis.selectAll("*").remove(),t.dataLabelUtils.cleanDataLabels(this.svg)},g.prototype.renderTooltip=function(e){t.TooltipManager.addTooltip(e,function(e){return e.data.tooltipInfo})},g.prototype.calculateAxes=function(a,i,r){var s=this.dataView.categorical.categories&&this.dataView.categorical.categories.length>0?this.dataView.categorical.categories[0]:{source:void 0,values:[t.valueFormatter.format(null)],identity:void 0},o={viewport:a,margin:this.DefaultMargin,forcedXDomain:this.dataView.categorical.categories[0].values,forceMerge:!1,showCategoryAxisLabel:!1,showValueAxisLabel:!1,categoryAxisScaleType:this.scaleType,valueAxisScaleType:null,valueAxisDisplayUnits:0,categoryAxisDisplayUnits:0,trimOrdinalDataOnOverflow:!1},l=a.width,n=this.calculateAxesProperties(a,o,s.source);return n.willLabelsFit=t.AxisHelper.LabelLayoutStrategy.willLabelsFit(n,l,e.TextMeasurementService.measureSvgTextWidth,i),n.willLabelsWordBreak=!n.willLabelsFit&&!r&&t.AxisHelper.LabelLayoutStrategy.willLabelsWordBreak(n,this.DefaultMargin,l,e.TextMeasurementService.measureSvgTextWidth,e.TextMeasurementService.estimateSvgTextHeight,e.TextMeasurementService.getTailoredTextOrDefault,i),n},g.prototype.calculateAxesProperties=function(e,i,r){var s=t.AxisHelper.createAxis({pixelSpan:e.width,dataDomain:i.forcedXDomain,metaDataColumn:r,formatString:t.valueFormatter.getFormatString(r,a.DotPlotProperties.general.formatString),outerPadding:0,isScalar:!1,isVertical:!1,forcedTickCount:i.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!0,getValueFn:function(e,t){return e},scaleType:i.categoryAxisScaleType,axisDisplayUnits:i.categoryAxisDisplayUnits});return s.axisLabel="New Label",s},g.prototype.renderAxis=function(e,a,i,r){this.xAxis.attr({transform:t.SVGUtil.translate(0,e)});var s=a.axis;s.orient("bottom"),this.xAxis.transition().duration(r).call(s)},g.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:"Category"},{name:"Values",kind:e.VisualDataRoleKind.Measure,displayName:"Values"}],dataViewMappings:[{conditions:[{Category:{max:1},Values:{max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{group:{by:"Series",select:[{"for":{"in":"Values"}}],dataReductionAlgorithm:{top:{}}}}}}],objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}}}},dataPoint:{displayName:"Data colors",properties:{fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}}}},labels:{displayName:"Data labels",description:"Display data label options",properties:{show:{displayName:"Show",type:{bool:!0}},showSeries:{displayName:"Show",type:{bool:!0}},color:{displayName:"Color",description:"Select color for data labels",type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:"Display units",description:"Select the units (millions, billions, etc.)",type:{formatting:{labelDisplayUnits:!0}},suppressFormatPainterCopy:!0},labelPrecision:{displayName:"Decimal places",description:"Select the number of decimal places to display",placeHolderText:"Auto",type:{numeric:!0},suppressFormatPainterCopy:!0},showAll:{displayName:"Customize series",type:{bool:!0}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}}}},g}();a.DotPlot=g;var m=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.columns=e.columns,this.clearCatcher=e.clearCatcher,this.interactivityService=e.interactivityService,this.columns.on("click",function(e,a){t.handleSelection(e,d3.event.ctrlKey)}),e.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var a=this.interactivityService.hasSelection();this.columns.style("fill-opacity",function(i){return t.ColumnUtil.getFillOpacity(i.selected,i.highlight,!i.highlight&&e,!i.selected&&a)})},e}();a.DotplotBehavior=m}(a=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a;!function(a){var i,r=jsCommon.PixelConverter;!function(t){t.byWeight="ByWeight",t.byLinkType="ByLinkType",t.interactive="Interactive",t.type=e.createEnumType([{value:t.byWeight,displayName:"ByWeight"},{value:t.byLinkType,displayName:"ByLinkType"},{value:t.interactive,displayName:"Interactive"}])}(i||(i={})),a.forceProps={general:{formatString:{objectName:"general",propertyName:"formatString"}},labels:{show:{objectName:"labels",propertyName:"show"},color:{objectName:"labels",propertyName:"color"},fontSize:{objectName:"labels",propertyName:"fontSize"}},links:{showArrow:{objectName:"links",propertyName:"showArrow"},showLabel:{objectName:"links",propertyName:"showLabel"},colorLink:{objectName:"links",propertyName:"colorLink"},thickenLink:{objectName:"links",propertyName:"thickenLink"}},nodes:{displayImage:{objectName:"nodes",propertyName:"displayImage"},defaultImage:{objectName:"nodes",propertyName:"defaultImage"},imageUrl:{objectName:"nodes",propertyName:"imageUrl"},imageExt:{objectName:"nodes",propertyName:"imageExt"},nameMaxLength:{objectName:"nodes",propertyName:"nameMaxLength"},highlightReachableLinks:{objectName:"nodes",propertyName:"highlightReachableLinks"}},size:{charge:{objectName:"size",propertyName:"charge"}}};var s=function(){function s(){}return Object.defineProperty(s.prototype,"margin",{get:function(){return this.marginValue||{left:0,right:0,top:0,bottom:0}},set:function(e){this.marginValue=$.extend({},e),this.viewportInValue=s.substractMargin(this.viewport,this.margin)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"viewport",{get:function(){return this.viewportValue||{width:0,height:0}},set:function(e){this.viewportValue=$.extend({},e),this.viewportInValue=s.substractMargin(this.viewport,this.margin)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"viewportIn",{get:function(){return this.viewportInValue||this.viewport},enumerable:!0,configurable:!0}),s.substractMargin=function(e,t){return{width:Math.max(e.width-(t.left+t.right),0),height:Math.max(e.height-(t.top+t.bottom),0)}},s.prototype.scale1to10=function(e){var t=d3.scale.linear().domain([this.data.minFiles,this.data.maxFiles]).rangeRound([1,10]).clamp(!0);return t(e)},s.prototype.getLinkColor=function(e){switch(this.options.colorLink){case i.byWeight:return this.colors.getColorByIndex(this.scale1to10(e.filecount)).value;case i.byLinkType:return e.type&&this.data.linkTypes[e.type]?this.data.linkTypes[e.type].color:this.options.defaultLinkColor}return this.options.defaultLinkColor},s.prototype.getDefaultOptions=function(){return{showDataLabels:!0,labelColor:t.dataLabelUtils.defaultLabelColor,fontSize:t.dataLabelUtils.DefaultFontSizeInPt,showArrow:!1,showLabel:!1,colorLink:i.interactive,thickenLink:!0,displayImage:!1,defaultImage:"Home",imageUrl:"",imageExt:".png",nameMaxLength:10,highlightReachableLinks:!1,charge:-15,defaultLinkColor:"#bbb",defaultLinkHighlightColor:"#f00",defaultLinkThickness:"1.5px"}},s.prototype.updateOptions=function(t){this.options.showDataLabels=e.DataViewObjects.getValue(t,a.forceProps.labels.show,this.options.showDataLabels),this.options.labelColor=e.DataViewObjects.getFillColor(t,a.forceProps.labels.color,this.options.labelColor),this.options.fontSize=e.DataViewObjects.getValue(t,a.forceProps.labels.fontSize,this.options.fontSize),this.options.showArrow=e.DataViewObjects.getValue(t,a.forceProps.links.showArrow,this.options.showArrow),this.options.showLabel=e.DataViewObjects.getValue(t,a.forceProps.links.showLabel,this.options.showLabel),this.options.colorLink=e.DataViewObjects.getValue(t,a.forceProps.links.colorLink,this.options.colorLink),this.options.thickenLink=e.DataViewObjects.getValue(t,a.forceProps.links.thickenLink,this.options.thickenLink),this.options.displayImage=e.DataViewObjects.getValue(t,a.forceProps.nodes.displayImage,this.options.displayImage),this.options.defaultImage=e.DataViewObjects.getValue(t,a.forceProps.nodes.defaultImage,this.options.defaultImage),this.options.imageUrl=e.DataViewObjects.getValue(t,a.forceProps.nodes.imageUrl,this.options.imageUrl),this.options.imageExt=e.DataViewObjects.getValue(t,a.forceProps.nodes.imageExt,this.options.imageExt),this.options.nameMaxLength=e.DataViewObjects.getValue(t,a.forceProps.nodes.nameMaxLength,this.options.nameMaxLength),this.options.highlightReachableLinks=e.DataViewObjects.getValue(t,a.forceProps.nodes.highlightReachableLinks,this.options.highlightReachableLinks),this.options.charge=e.DataViewObjects.getValue(t,a.forceProps.size.charge,this.options.charge),(this.options.charge>=0||this.options.charge<-100)&&(this.options.charge=this.getDefaultOptions().charge)},s.prototype.enumerateObjectInstances=function(e){var a=new t.ObjectEnumerationBuilder;switch(e.objectName){case"labels":this.enumerateLabels(a);break;case"links":this.enumerateLinks(a);break;case"nodes":this.enumerateNodes(a);break;case"size":this.enumerateSize(a)}return a.complete()},s.prototype.enumerateLabels=function(e){var t,a;this.options&&this.options&&(a=this.options,t={objectName:"labels",displayName:"Labels",selector:null,properties:{show:a.showDataLabels,fontSize:a.fontSize,color:a.labelColor}},e.pushInstance(t))},s.prototype.enumerateLinks=function(e){var t,a;this.options&&(a=this.options,t={objectName:"links",displayName:"Links",selector:null,properties:{showArrow:a.showArrow,colorLink:a.colorLink,showLabel:a.showLabel,thickenLink:a.thickenLink}},e.pushInstance(t))},s.prototype.enumerateNodes=function(e){var t,a;this.options&&(a=this.options,t={objectName:"nodes",displayName:"Nodes",selector:null,properties:{displayImage:a.displayImage,defaultImage:a.defaultImage,imageUrl:a.imageUrl,imageExt:a.imageExt,nameMaxLength:a.nameMaxLength,highlightReachableLinks:a.highlightReachableLinks}},e.pushInstance(t))},s.prototype.enumerateSize=function(e){var t,a;this.options&&(a=this.options,t={objectName:"size",displayName:"Size",selector:null,properties:{charge:a.charge}},e.pushInstance(t))},s.converter=function(e,i){var r,s=e.categorical,o={},l=Number.MAX_VALUE,n=0,c={},h=[],u={},d=0,p=-1,g=-1,m=-1,y=-1,f=-1,v=-1,x=[],b=a.forceProps.general.formatString;if(e&&e.categorical&&e.categorical.categories&&e.metadata&&e.metadata.columns)for(var S=e.metadata.columns,w=0;w<S.length;w++){var C=S[w];C.roles&&(C.roles.Source?p=w:C.roles.Target?g=w:C.roles.Weight?m=w:C.roles.LinkType?y=w:C.roles.SourceType?f=w:C.roles.TargetType&&(v=w))}if(e&&e.table&&(r=e.table.rows),0>p||0>g)return{nodes:{},links:[],minFiles:0,maxFiles:0,linkedByName:{},linkTypes:{}};var D=t.valueFormatter.getFormatString(s.categories[0].source,b),P=t.valueFormatter.getFormatString(s.categories[1].source,b),A=t.valueFormatter.getFormatString(s.values?s.values[0].source:null,b,!0);return r.forEach(function(a){c[a[p]+","+a[g]]=1;var r=o[a[p]]||(o[a[p]]={name:a[p],image:f>0?a[f]:"",adj:{}}),s=o[a[g]]||(o[a[g]]={name:a[g],image:v>0?a[v]:"",adj:{}});r.adj[s.name]=1,s.adj[r.name]=1,x=[{displayName:e.metadata.columns[0].displayName,value:t.valueFormatter.format(r.name,D)},{displayName:e.metadata.columns[1].displayName,value:t.valueFormatter.format(s.name,P)}],m>0&&x.push({displayName:e.metadata.columns[2].displayName,value:t.valueFormatter.format(a[m],A)});var b={source:r,target:s,filecount:m>0?a[m]:0,type:y>0?a[y]:"",tooltipInfo:x};y>0&&(u[a[y]]||(u[a[y]]={label:a[y],color:i.getColorByIndex(d++).value})),b.filecount<l&&(l=b.filecount),b.filecount>n&&(n=b.filecount),h.push(b)}),{nodes:o,links:h,minFiles:l,maxFiles:n,linkedByName:c,linkTypes:u}},s.prototype.init=function(e){this.root=d3.select(e.element.get(0)),this.forceLayout=d3.layout.force(),this.colors=e.style.colorPalette.dataColors,this.options=this.getDefaultOptions()},s.prototype.update=function(e){var a=this;if(e.dataViews&&!(e.dataViews.length<1)&&(this.data=s.converter(this.dataView=e.dataViews[0],this.colors),this.data)){e.dataViews[0].metadata&&e.dataViews[0].metadata.objects&&this.updateOptions(e.dataViews[0].metadata.objects),this.viewport=e.viewport;var o=Math.sqrt(Object.keys(this.data.nodes).length/(this.viewport.width*this.viewport.height));this.root.selectAll("svg").remove();var l=this.root.append("svg").attr("width",this.viewport.width).attr("height",this.viewport.height).classed(s.VisualClassName,!0);this.forceLayout.gravity(100*o).links(this.data.links).size([this.viewport.width,this.viewport.height]).linkDistance(100).charge(this.options.charge/o).on("tick",this.tick()),this.updateNodes(),this.forceLayout.start(),this.paths=l.selectAll(".link").data(this.forceLayout.links()).enter().append("path").attr("class","link").attr("id",function(e,t){return"linkid_"+t}).attr("stroke-width",function(e){return a.options.thickenLink?a.scale1to10(e.filecount):a.options.defaultLinkThickness}).style("stroke",function(e){return a.getLinkColor(e)}).style("fill",function(e){return a.options.showArrow?a.getLinkColor(e):void 0}).on("mouseover",this.fadePath(.3,this.options.defaultLinkHighlightColor)).on("mouseout",this.fadePath(1,this.options.defaultLinkColor)),t.TooltipManager.addTooltip(this.paths,function(e){return e.data.tooltipInfo}),this.options.showLabel&&l.selectAll(".linklabelholder").data(this.forceLayout.links()).enter().append("g").attr("class","linklabelholder").append("text").attr("class","linklabel").attr("y","-12").attr("text-anchor","middle").style("fill","#000").append("textPath").attr("xlink:href",function(e,t){return"#linkid_"+t}).attr("startOffset","25%").text(function(e){return a.options.colorLink===i.byLinkType?e.type:e.filecount}),this.nodes=l.selectAll(".node").data(this.forceLayout.nodes()).enter().append("g").attr("class","node").call(this.forceLayout.drag).on("mouseover",this.fadeNode(.3,this.options.defaultLinkHighlightColor)).on("mouseout",this.fadeNode(1,this.options.defaultLinkColor)).on("mousedown",function(){return d3.event.stopPropagation()}).attr("drag-resize-disabled",!0),this.options.displayImage?this.nodes.append("image").attr("xlink:href",function(e){return e.image&&""!==e.image?a.options.imageUrl+e.image+a.options.imageExt:a.options.defaultImage&&""!==a.options.defaultImage?a.options.imageUrl+a.options.defaultImage+a.options.imageExt:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAbCAMAAAHNDTTxAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACuUExURQAAAMbGxvLy8sfHx/Hx8fLy8vHx8cnJycrKyvHx8fHx8cvLy/Ly8szMzM3NzfHx8dDQ0PHx8fLy8vHx8e/v79LS0tPT0/Ly8tTU1NXV1dbW1vHx8fHx8fDw8NjY2PT09PLy8vLy8vHx8fLy8vHx8fHx8enp6fDw8PLy8uPj4+Tk5OXl5fHx8b+/v/Pz8+bm5vHx8ejo6PLy8vHx8fLy8sTExPLy8vLy8sXFxfHx8YCtMbUAAAA6dFJOUwD/k/+b7/f///+r/////0z/w1RcEP//ZP///4fj/v8Yj3yXn/unDEhQ////YP9Y/8//aIMU/9+L/+fzC4s1AAAACXBIWXMAABcRAAAXEQHKJvM/AAABQElEQVQoU5WS61LCMBCFFymlwSPKVdACIgWkuNyL+P4v5ibZ0jKjP/xm0uw5ySa7mRItAhnMoIC5TwQZdCZiZjcoC8WU6EVsmZgzoqGdxafgvJAvjUXCb2M+0cXNsd/GDarZqSf7av3M2P1E3xhfLkPUvLD5joEYwVVJQXM6+9McWUwLf4nDTCQZAy96UoDjNI/jhl3xPLbQamu8xD7iaIsPKw7GJ7KZEnWLY3Gi8EFj5nqibXnwD5VEGjJXk5sbpLppfvvo1RazQVrhSopPK4TODrtnjS3dY4ic8KurruWQYF+UG60BacexTMyT2jlNg41dOmKvTpkUd/Jevy7ZxQ61ULRUpoododx8GeDPvIrktbFVdUsK6f8Na5VlVpjZJtowTXVy7kfXF5wCaV1tqXAFuIdWJu+JviaQzNzfQvQDGKRXXEmy83cAAAAASUVORK5CYII="}).attr("x","-12px").attr("y","-12px").attr("width","24px").attr("height","24px"):this.nodes.append("circle").attr("r",function(e){return e.weight<5?5:e.weight}),this.options.showDataLabels&&this.nodes.append("text").attr({x:12,dy:".35em"}).style({fill:this.options.labelColor,"font-size":r.fromPoint(this.options.fontSize)}).text(function(e){return e.name?e.name.length>a.options.nameMaxLength?e.name.substr(0,a.options.nameMaxLength):e.name:""})}},s.prototype.updateNodes=function(){var e=this.forceLayout.nodes();this.forceLayout.nodes(d3.values(this.data.nodes)),this.forceLayout.nodes().forEach(function(t,a){e[a]&&(t.x=e[a].x,t.y=e[a].y,t.px=e[a].px,t.py=e[a].py,t.weight=e[a].weight)})},s.prototype.tick=function(){var e=this,t=this.viewportIn,a=20*t.width,i=20*t.height,r=function(e){return Math.max((t.width-a)/2,Math.min((t.width+a)/2,e))},s=function(e){return Math.max((t.height-i)/2,Math.min((t.height+i)/2,e))},o=this.options.showArrow?function(e){e.source.x=r(e.source.x),e.source.y=s(e.source.y),e.target.x=r(e.target.x),e.target.y=s(e.target.y);var t=e.target.x-e.source.x,a=e.target.y-e.source.y,i=Math.sqrt(t*t+a*a),o=Math.atan2(a,t)+Math.PI/7.85,l=Math.PI/2,n=e.target.x-6*Math.cos(o),c=e.target.y-6*Math.sin(o);return"M"+e.source.x+","+e.source.y+"A"+i+","+i+" 0 0 1,"+e.target.x+","+e.target.y+"A"+i+","+i+" 0 0 0,"+e.source.x+","+e.source.y+"M"+n+","+c+"l"+(3.5*Math.cos(l-o)-10*Math.cos(o))+","+(-3.5*Math.sin(l-o)-10*Math.sin(o))+"L"+(n-3.5*Math.cos(l-o)-10*Math.cos(o))+","+(c+3.5*Math.sin(l-o)-10*Math.sin(o))+"z"}:function(e){e.source.x=r(e.source.x),e.source.y=s(e.source.y),e.target.x=r(e.target.x),e.target.y=s(e.target.y);var t=e.target.x-e.source.x,a=e.target.y-e.source.y,i=Math.sqrt(t*t+a*a);return"M"+e.source.x+","+e.source.y+"A"+i+","+i+" 0 0,1 "+e.target.x+","+e.target.y};return function(){e.paths.each(function(){this.parentNode.insertBefore(this,this)}),e.paths.attr("d",o),e.nodes.attr("transform",function(e){return"translate("+r(e.x)+","+s(e.y)+")"})}},s.prototype.fadePath=function(e,t){var a=this;if(this.options.colorLink===i.interactive)return function(i){a.paths.style("stroke-opacity",function(t){return t.source===i.source&&t.target===i.target?1:e}),a.paths.style("stroke",function(e){return e.source===i.source&&e.target===i.target?t:a.options.defaultLinkColor})}},s.prototype.isReachable=function(e,t){if(e.name===t.name)return!0;if(this.data.linkedByName[e.name+","+t.name])return!0;var a={};for(var i in this.data.nodes)a[i]=!1;a[e.name]=!0;var r=[];for(r.push(e.name);r.length>0;){var s=r.pop(),o=this.data.nodes[s];for(var l in o.adj){if(l===t.name)return!0;a[l]||(a[l]=!0,r.push(l))}}return!1},s.prototype.fadeNode=function(e,t){var a=this;if(this.options.colorLink===i.interactive){var r=function(e,t){return a.data.linkedByName[e.name+","+t.name]||a.data.linkedByName[t.name+","+e.name]||e.name===t.name};return function(i){var s=a;a.nodes.style("stroke-opacity",function(t){var a=(s.options.highlightReachableLinks?s.isReachable(i,t):r(i,t))?1:e;return this.setAttribute("fill-opacity",a),a}),a.paths.style("stroke-opacity",function(t){return(a.options.highlightReachableLinks?a.isReachable(i,t.source):t.source===i||t.target===i)?1:e}),a.paths.style("stroke",function(e){return(a.options.highlightReachableLinks?a.isReachable(i,e.source):e.source===i||e.target===i)?t:a.options.defaultLinkColor})}}},s.prototype.destroy=function(){this.root=null},s.VisualClassName="forceGraph",s.capabilities={dataRoles:[{name:"Source",kind:e.VisualDataRoleKind.Grouping,
displayName:"Source"},{name:"Target",kind:e.VisualDataRoleKind.Grouping,displayName:"Target"},{name:"Weight",kind:e.VisualDataRoleKind.Measure,displayName:"Weight"},{name:"LinkType",kind:e.VisualDataRoleKind.Grouping,displayName:"LinkType",description:"Links can be colored by link types"},{name:"SourceType",kind:e.VisualDataRoleKind.Grouping,displayName:"SourceType",description:"Source type represents the image name for source entities"},{name:"TargetType",kind:e.VisualDataRoleKind.Grouping,displayName:"TargetType",description:"Target type represents the image name for target entities"}],objects:{general:{properties:{formatString:{type:{formatting:{formatString:!0}}}}},labels:{displayName:"Data labels",properties:{show:{displayName:"Show",type:{bool:!0}},color:{displayName:"Fill",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},links:{displayName:"Links",properties:{showArrow:{type:{bool:!0},displayName:"Arrow"},showLabel:{type:{bool:!0},displayName:"Label",description:"Displays weight on links"},colorLink:{type:{enumeration:i.type},displayName:"Color"},thickenLink:{type:{bool:!0},displayName:"Thickness",description:"Thickenss of links represents weight"}}},nodes:{displayName:"Nodes",properties:{displayImage:{type:{bool:!0},displayName:"Image",description:"Images are loaded from image url + source or target type + image extension"},defaultImage:{type:{text:!0},displayName:"Default image"},imageUrl:{type:{text:!0},displayName:"Image url"},imageExt:{type:{text:!0},displayName:"Image extension"},nameMaxLength:{type:{numeric:!0},displayName:"Max name length",description:"Max length of the name of entities displayed"},highlightReachableLinks:{type:{bool:!0},displayName:"Highlight all reachable links",description:"In interactive mode, whether a node's all reachable links will be highlighted"}}},size:{displayName:"Size",properties:{charge:{type:{numeric:!0},displayName:"Charge",description:"The larger the negative charge the more apart the entities, must be negative but greater than -100"}}}},dataViewMappings:[{conditions:[{Source:{max:1},Target:{max:1},Weight:{max:1},LinkType:{max:1},SourceType:{max:1},TargetType:{max:1}}],categorical:{categories:{"for":{"in":"Source"},dataReductionAlgorithm:{top:{}}},values:{select:[{bind:{to:"Target"}},{bind:{to:"Weight"}},{bind:{to:"LinkType"}},{bind:{to:"SourceType"}},{bind:{to:"TargetType"}}]},rowCount:{preferred:{min:1}}}}],suppressDefaultTitle:!0},s}();a.ForceGraph=s}(a=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a;!function(a){var i=t.utility.SelectionManager,r=jsCommon.PixelConverter,s="0.00 %;-0.00 %;0.00 %",o=864e5,l=6048e5,n=2629746e3,c=31556952e3;a.DefaultDateType="Week";var h,u=40,d=5;!function(t){t.day="Day",t.week="Week",t.month="Month",t.year="Year",t.type=e.createEnumType([{value:t.day,displayName:"Day"},{value:t.week,displayName:"Week"},{value:t.month,displayName:"Month"},{value:t.year,displayName:"Year"}])}(h=a.dateTypeSelector||(a.dateTypeSelector={})),a.GanttChartProps={legend:{show:{objectName:"legend",propertyName:"show"},position:{objectName:"legend",propertyName:"position"},showTitle:{objectName:"legend",propertyName:"showTitle"},titleText:{objectName:"legend",propertyName:"titleText"},labelColor:{objectName:"legend",propertyName:"labelColor"},fontSize:{objectName:"legend",propertyName:"fontSize"}},taskCompletion:{fill:{objectName:"taskCompletion",propertyName:"fill"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}},taskLabels:{show:{objectName:"taskLabels",propertyName:"show"},fill:{objectName:"taskLabels",propertyName:"fill"},fontSize:{objectName:"taskLabels",propertyName:"fontSize"},width:{objectName:"taskLabels",propertyName:"width"}},taskResource:{show:{objectName:"taskResource",propertyName:"show"},fill:{objectName:"taskResource",propertyName:"fill"},fontSize:{objectName:"taskResource",propertyName:"fontSize"}},ganttDateType:{type:{objectName:"ganttDateType",propertyName:"type"}}};var p;!function(e){var t=jsCommon.CssConstants.createClassAndSelector;e.ClassName=t("gantt"),e.Chart=t("chart"),e.ChartLine=t("chart-line"),e.Body=t("gantt-body"),e.AxisGroup=t("axis"),e.Domain=t("domain"),e.AxisTick=t("tick"),e.Tasks=t("tasks"),e.SingleTask=t("task"),e.TaskRect=t("task-rect"),e.TaskProgress=t("task-progress"),e.TaskResource=t("task-resource"),e.SingleMilestone=t("milestone"),e.TaskLabels=t("task-labels"),e.TaskLines=t("task-lines"),e.SingleTaskLine=t("task-line"),e.Label=t("label"),e.LegendItems=t("legendItem"),e.LegendTitle=t("legendTitle")}(p||(p={}));var g=function(){function g(){this.textProperties={fontFamily:"wf_segoe-ui_normal",fontSize:jsCommon.PixelConverter.toString(9)},this.margin={top:50,right:40,bottom:40,left:10}}return g.getMaxTaskOpacity=function(){return g.DefaultValues.MaxTaskOpacity},g.getMinTaskOpacity=function(){return g.DefaultValues.MinTaskOpacity},g.prototype.init=function(e){var a=e.element;this.style=e.style,this.body=d3.select(a.get(0)),this.hostServices=e.host,this.selectionManager=new i({hostServices:e.host}),this.isInteractiveChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.interactivityService=t.createInteractivityService(this.hostServices),this.createViewport(a),this.updateChartSize(e.viewport),this.behavior=new m,this.colors=e.style.colorPalette.dataColors,this.data={legendData:null,series:null,showLegend:null}},g.prototype.createViewport=function(e){this.ganttDiv=this.body.append("div").classed(p.Body["class"],!0),this.ganttSvg=this.ganttDiv.append("svg").classed(p.ClassName["class"],!0),this.clearCatcher=t.appendClearCatcher(this.ganttSvg),this.axisGroup=this.ganttSvg.append("g").classed(p.AxisGroup["class"],!0),this.lineGroup=this.ganttSvg.append("g").classed(p.TaskLines["class"],!0),this.chartGroup=this.ganttSvg.append("g").classed(p.Chart["class"],!0),this.taskGroup=this.chartGroup.append("g").classed(p.Tasks["class"],!0),this.legend=t.createLegend(e.children(p.Body.selector),this.isInteractiveChart,this.interactivityService,!0,t.LegendPosition.Top)},g.prototype.clearViewport=function(){this.body.selectAll(p.LegendItems.selector).remove(),this.body.selectAll(p.LegendTitle.selector).remove(),this.axisGroup.selectAll(p.AxisTick.selector).remove(),this.axisGroup.selectAll(p.Domain.selector).remove(),this.lineGroup.selectAll("*").remove(),this.chartGroup.selectAll(p.ChartLine.selector).remove(),this.chartGroup.selectAll(p.SingleTask.selector).remove()},g.prototype.updateChartSize=function(e){this.ganttDiv.style({height:r.toString(e.height),width:r.toString(e.width)})},g.prototype.createSeries=function(e,i){var r=new t.ColorHelper(this.colors,a.GanttChartProps.dataPoint.fill),s=_.groupBy(i,function(e){return e.taskType}),o=g.getAllTasksTypes(this.dataView),l=_.map(o.types,function(a){return{tasks:s[a],fill:r.getColorForMeasure(e,a),name:a,identity:t.SelectionId.createWithMeasure(a),selected:!1}});return l},g.converter=function(i,r){var s=e.DataViewObjects.getValue(i.metadata.objects,a.GanttChartProps.taskLabels.show,!0),o=e.DataViewObjects.getFillColor(i.metadata.objects,a.GanttChartProps.taskLabels.fill,g.DefaultValues.TaskLabelColor),l=e.DataViewObjects.getValue(i.metadata.objects,a.GanttChartProps.taskLabels.fontSize,g.DefaultValues.LabelFontSize),n=e.DataViewObjects.getValue(i.metadata.objects,a.GanttChartProps.taskLabels.width,s?g.DefaultValues.TaskLabelWidth:0),c=e.DataViewObjects.getFillColor(i.metadata.objects,a.GanttChartProps.taskCompletion.fill,g.DefaultValues.ProgressColor),h=e.DataViewObjects.getFillColor(i.metadata.objects,a.GanttChartProps.taskResource.fill,g.DefaultValues.TaskResourceColor),u=e.DataViewObjects.getValue(i.metadata.objects,a.GanttChartProps.taskResource.fontSize,g.DefaultValues.ResourceFontSize),d=e.DataViewObjects.getValue(i.metadata.objects,a.GanttChartProps.taskResource.show,!0),p=e.DataViewObjects.getValue(i.metadata.objects,a.GanttChartProps.ganttDateType.type,a.DefaultDateType),m=g.getAllTasksTypes(i),y=new t.ColorHelper(r,a.GanttChartProps.dataPoint.fill),f={fontSize:g.DefaultValues.LegendFontSize,dataPoints:[],title:m.typeName};f.dataPoints=_.map(m.types,function(e){return{label:e,color:y.getColorForMeasure(i.metadata.objects,e),icon:t.LegendIcon.Circle,selected:!1,identity:t.SelectionId.createWithMeasure(e)}});var v={taskLabelsShow:s,taskLabelsColor:o,taskLabelsFontSize:l,taskLabelsWidth:n,taskProgressColor:c,taskResourceShow:d,taskResourceColor:h,taskResourceFontSize:u,legendData:f,taskTypes:m,dateType:p};return v},g.prototype.parseSettings=function(e){if(!e||!e.metadata||!e.metadata.columns)return null;for(var a="d",i="#",r=0,o=e.metadata.columns;r<o.length;r++){var l=o[r];if(e.categorical.categories)for(var n=0,c=e.categorical.categories;n<c.length;n++){var h=c[n];this.hasRole(h.source,"StartDate")&&(a=l.format)}}return{startDateFormatter:t.valueFormatter.create({format:a}),durationFormatter:t.valueFormatter.create({format:i}),completionFormatter:t.valueFormatter.create({format:s,value:1,allowFormatBeautification:!0})}},g.prototype.isValidDate=function(e){return"[object Date]"!==Object.prototype.toString.call(e)?!1:!isNaN(e.getTime())},g.prototype.convertToDecimal=function(e){return e>=0&&1>=e?e:e/100},g.prototype.createTasks=function(e,i){var r=this,s=e.table.columns,o=e.table.rows,l=e.categorical.categories[0],n=new t.ColorHelper(this.colors,a.GanttChartProps.dataPoint.fill);return o.map(function(a,o){var c=r.getTaskProperty(s,a,"StartDate");c=r.isValidDate(c)?c:new Date(Date.now());var h=r.getTaskProperty(s,a,"Duration"),u=r.getTaskProperty(s,a,"Completion"),d=r.convertToDecimal(u);d=1>=d?d:1;var p=r.getTaskProperty(s,a,"Legend"),m=n.getColorForMeasure(e.metadata.objects,p),y={id:o,name:r.getTaskProperty(s,a,"Task"),start:c?c:new Date(Date.now()),duration:h>0?h:1,end:null,completion:d>0?d:0,resource:r.getTaskProperty(s,a,"Resource"),taskType:p,color:m?m:g.DefaultValues.TaskColor,tooltipInfo:null,description:"",identity:t.SelectionId.createWithIdAndMeasure(l.identity[o],p),selected:!1};return y.end=d3.time.day.offset(y.start,y.duration),y.tooltipInfo=r.getTooltipInfo(y,i),y})},g.getAllTasksTypes=function(e){var t,a=[],i="",r=e.table.rows,s=_.findIndex(e.table.columns,function(e){return e.roles.hasOwnProperty("Legend")});return-1!==s&&(i=e.table.columns[s].displayName,a=_.unique(r,function(e){return e[s]}).map(function(e){return e[s]})),t={typeName:i,types:a}},g.prototype.getTooltipInfo=function(e,t,a){void 0===a&&(a="Days");var i=[];return e.taskType&&i.push({displayName:g.capabilities.dataRoles[0].name,value:e.taskType}),i.push({displayName:g.capabilities.dataRoles[1].name,value:e.name}),isNaN(e.start.getDate())||i.push({displayName:g.capabilities.dataRoles[2].name,value:t.startDateFormatter.format(e.start.toLocaleDateString())}),i.push({displayName:g.capabilities.dataRoles[3].name,value:t.durationFormatter.format(e.duration)+" "+a}),i.push({displayName:g.capabilities.dataRoles[4].name,value:t.completionFormatter.format(e.completion)}),e.resource&&i.push({displayName:g.capabilities.dataRoles[5].name,value:e.resource}),i},g.prototype.getTaskProperty=function(e,t,a){if(!(t&&e&&e.length>0&&e[0].roles))return null;var i=e.indexOf(e.filter(function(e){return e.roles[a]})[0]);return-1!==i?t[i]:null},g.prototype.hasRole=function(e,t){var a=e.roles;return a&&a[t]},g.prototype.isChartHasTask=function(e){if(e.table&&e.table.columns)for(var t=0,a=e.table.columns;t<a.length;t++){var i=a[t];if(this.hasRole(i,"Task"))return!0}return!1},g.prototype.renderLegend=function(e){if(e){if(this.legendObjectProperties){t.LegendData.update(e,this.legendObjectProperties);var a;a=this.legendObjectProperties[t.legendProps.position],a&&this.legend.changeOrientation(t.LegendPosition[a])}var i=this.viewport;this.legend.drawLegend(e,{height:i.height,width:i.width}),t.Legend.positionChartArea(this.ganttSvg,this.legend)}},g.prototype.parseLegendProperties=function(t){return t&&t.metadata?void(this.legendObjectProperties=e.DataViewObjects.getObject(t.metadata.objects,"legend",{})):void(this.legendObjectProperties={})},g.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){var t=e.dataViews[0];if(!this.isChartHasTask(t)||0===e.dataViews[0].table.rows.length)return void this.clearViewport();this.dataView=t;var a=e.viewport;this.viewport=a,this.updateChartSize(a);var i=g.converter(t,this.colors),s=this.parseSettings(t),o=this.createTasks(t,s);if(this.parseLegendProperties(t),this.renderLegend(i.legendData),this.data.series=this.createSeries(t.metadata.objects,o),this.viewModel=i,this.interactivityService&&(this.interactivityService.applySelectionStateToData(o),this.interactivityService.applySelectionStateToData(this.data.series)),o.length>0){var l=_.sortBy(o,function(e){return e.start}),n=_.sortBy(o,function(e){return e.end}),c=this.getDateType(),h=l[0].start,d=n[o.length-1].end,m=Math.ceil(Math.round(d.valueOf()-h.valueOf())/c);m=0===m||1===m?2:m;var y=50*m;this.ganttSvg.attr({height:r.toString(o.length*u+this.margin.top),width:r.toString(this.margin.left+this.viewModel.taskLabelsWidth+y+g.DefaultValues.ResourceWidth)});var f={height:a.height,width:y},v=this.calculateAxes(f,this.textProperties,h,d,y,m,!1);if(this.timeScale=v.scale,this.renderAxis(v,200),this.renderTasks(o),this.createMilestoneLine(o),this.updateTaskLabels(o,i.taskLabelsWidth),this.updateElementsPositions(a,this.margin),this.interactivityService){var x={clearCatcher:this.clearCatcher,taskSelection:this.taskGroup.selectAll(p.SingleTask.selector),legendSelection:this.body.selectAll(p.LegendItems.selector),interactivityService:this.interactivityService};this.interactivityService.bind(o,this.behavior,x)}}}},g.prototype.getDateType=function(){var e=l;switch(this.viewModel.dateType){case"Day":e=o;break;case"Week":e=l;break;case"Month":e=n;break;case"Year":e=c}return e},g.prototype.calculateAxes=function(a,i,r,s,o,l,n){var c=e.ValueType.fromPrimitiveTypeAndCategory(e.PrimitiveType.Date),h={displayName:"StartDate",queryName:"StartDate",type:c,index:0},u={viewport:a,margin:this.margin,forcedXDomain:[r,s],forceMerge:!1,showCategoryAxisLabel:!1,showValueAxisLabel:!1,categoryAxisScaleType:e.visuals.axisScale.linear,valueAxisScaleType:null,valueAxisDisplayUnits:0,categoryAxisDisplayUnits:0,trimOrdinalDataOnOverflow:!1,forcedTickCount:l},d=a.width,p=this.calculateAxesProperties(a,u,o,h);return p.willLabelsFit=t.AxisHelper.LabelLayoutStrategy.willLabelsFit(p,d,e.TextMeasurementService.measureSvgTextWidth,i),p.willLabelsWordBreak=!p.willLabelsFit&&!n&&t.AxisHelper.LabelLayoutStrategy.willLabelsWordBreak(p,this.margin,d,e.TextMeasurementService.measureSvgTextWidth,e.TextMeasurementService.estimateSvgTextHeight,e.TextMeasurementService.getTailoredTextOrDefault,i),p},g.prototype.calculateAxesProperties=function(e,a,i,r){var s=t.AxisHelper.createAxis({pixelSpan:e.width,dataDomain:a.forcedXDomain,metaDataColumn:r,formatString:g.DefaultValues.ganttFormatString,outerPadding:0,isScalar:!0,isVertical:!1,forcedTickCount:a.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!0,getValueFn:function(e,a){return t.valueFormatter.format(new Date(e),g.DefaultValues.ganttFormatString)},scaleType:a.categoryAxisScaleType,axisDisplayUnits:a.categoryAxisDisplayUnits});return s.axisLabel=r.displayName,s},g.prototype.renderAxis=function(e,t){var a=e.axis;a.orient("bottom"),this.axisGroup.transition().duration(t).call(a)},g.prototype.updateTaskLabels=function(a,i){var s,o=this,l=15,n=this.viewModel?this.viewModel.taskLabelsShow:!0,c=this.viewModel?this.viewModel.taskLabelsColor:g.DefaultValues.TaskLabelColor,h=this.viewModel?this.viewModel.taskLabelsFontSize:g.DefaultValues.LabelFontSize;n?(s=this.lineGroup.selectAll(p.Label.selector).data(a),s.enter().append("text").classed(p.Label["class"],!0),s.attr({x:l,y:function(e,t){return o.getTaskLabelCoordinateY(e.id)},fill:c,"stroke-width":1}).style("font-size",r.fromPoint(h)).text(function(e){return e.name}),s.call(t.AxisHelper.LabelLayoutStrategy.clip,i-20,e.TextMeasurementService.svgEllipsis),s.append("title").text(function(e){return e.name}),s.exit().remove()):this.lineGroup.selectAll(p.Label.selector).remove()},g.prototype.renderTasks=function(a){var i=this,s=this.taskGroup.selectAll(p.SingleTask.selector).data(a),o=this.viewModel?this.viewModel.taskProgressColor:g.DefaultValues.ProgressColor,l=this.viewModel?this.viewModel.taskResourceShow:!0,n=4,c=this.viewModel?this.viewModel.taskResourceColor:g.DefaultValues.TaskResourceColor,h=this.viewModel?this.viewModel.taskResourceFontSize:g.DefaultValues.ResourceFontSize;s.enter().append("g").classed(p.SingleTask["class"],!0);var u=s.selectAll(p.TaskRect.selector).data(function(e){return[e]});u.enter().append("rect").classed(p.TaskRect["class"],!0),u.classed(p.TaskRect["class"],!0).attr({x:function(e){return i.timeScale(e.start)},y:function(e){return i.getBarYCoordinate(e.id)},width:function(e){return i.taskDurationToWidth(e)},height:function(){return i.getBarHeight()}}).style("fill",function(e){return e.color}),u.exit().remove();var d=s.selectAll(p.TaskProgress.selector).data(function(e){return[e]});if(d.enter().append("rect").classed(p.TaskProgress["class"],!0),d.attr({x:function(e){return i.timeScale(e.start)},y:function(e){return i.getBarYCoordinate(e.id)+i.getBarHeight()/2-g.DefaultValues.ProgressBarHeight/2},width:function(e){return i.setTaskProgress(e)},height:g.DefaultValues.ProgressBarHeight}).style("fill",o),d.exit().remove(),l){var m=s.selectAll(p.TaskResource.selector).data(function(e){return[e]});m.enter().append("text").classed(p.TaskResource["class"],!0),m.attr({x:function(e){return i.timeScale(e.end)+n},y:function(e){return i.getBarYCoordinate(e.id)+i.getBarHeight()/2+n}}).text(function(e){return e.resource}).style({fill:c,"font-size":r.fromPoint(h)}).call(t.AxisHelper.LabelLayoutStrategy.clip,g.DefaultValues.ResourceWidth-10,e.TextMeasurementService.svgEllipsis),m.exit().remove()}else s.selectAll(p.TaskResource.selector).remove();t.TooltipManager.addTooltip(s,function(e){return e.data.tooltipInfo}),s.exit().remove()},g.prototype.onClearSelection=function(){this.selectionManager.clear()},g.prototype.getTaskLabelCoordinateY=function(e){var t=+this.getTaskLabelFontSize();return u*e+(this.getBarHeight()+5-(40-t)/4)},g.prototype.setTaskProgress=function(e){var t=e.completion/1,a=this.timeScale,i=(a(e.end)-a(e.start))*t;return i},g.prototype.getBarYCoordinate=function(e){return u*e+d},g.prototype.getBarHeight=function(){return u/1.5},g.prototype.taskDurationToWidth=function(e){return this.timeScale(e.end)-this.timeScale(e.start)},g.prototype.getTooltipForMilstoneLine=function(e,t){var a=new Date(e).toDateString(),i=[{displayName:t,value:a}];return i},g.prototype.createMilestoneLine=function(e,a,i){void 0===a&&(a="Today"),void 0===i&&(i=Date.now());var r=[{x1:this.timeScale(i),y1:0,x2:this.timeScale(i),y2:this.getMilestoneLineLength(e.length),tooltipInfo:this.getTooltipForMilstoneLine(i,a)}],s=this.chartGroup.selectAll(p.ChartLine.selector).data(r);s.enter().append("line").classed(p.ChartLine["class"],!0),s.attr({x1:function(e){return e.x1},y1:function(e){return e.y1},x2:function(e){return e.x2},y2:function(e){return e.y2},tooltipInfo:function(e){return e.tooltipInfo}}),t.TooltipManager.addTooltip(s,function(e){return e.data.tooltipInfo}),s.exit().remove()},g.prototype.updateElementsPositions=function(e,a){var i=this.viewModel;this.axisGroup.attr("transform",t.SVGUtil.translate(i.taskLabelsWidth+a.left,15)),this.chartGroup.attr("transform",t.SVGUtil.translate(i.taskLabelsWidth+a.left,a.top)),this.lineGroup.attr("transform",t.SVGUtil.translate(0,a.top))},g.prototype.getMilestoneLineLength=function(e){return e*u},g.prototype.getTaskLabelFontSize=function(){return e.DataViewObjects.getValue(this.dataView.metadata.objects,a.GanttChartProps.taskLabels.fontSize,g.DefaultValues.LabelFontSize)},g.prototype.enumerateLegendOptions=function(t,i){t.pushInstance({displayName:a.GanttChartProps.legend.show.objectName,selector:null,properties:{show:e.DataViewObjects.getValue(i,a.GanttChartProps.legend.show,!0),position:e.DataViewObjects.getValue(i,a.GanttChartProps.legend.position,!0),showTitle:e.DataViewObjects.getValue(i,a.GanttChartProps.legend.showTitle,!0),titleText:e.DataViewObjects.getValue(i,a.GanttChartProps.legend.titleText,""),labelColor:e.DataViewObjects.getFillColor(i,a.GanttChartProps.legend.labelColor,g.DefaultValues.LegendLabelColor),fontSize:e.DataViewObjects.getValue(i,a.GanttChartProps.legend.fontSize,g.DefaultValues.LegendFontSize)},objectName:a.GanttChartProps.legend.show.objectName})},g.prototype.enumerateDataPoints=function(e,a){var i=this.data.series;i.forEach(function(a){e.pushInstance({objectName:"dataPoint",displayName:a.name,selector:t.ColorHelper.normalizeSelector(a.identity.getSelector(),!1),properties:{fill:{solid:{color:a.fill}}}})})},g.prototype.enumerateTaskCompletion=function(t,i){t.pushInstance({selector:null,properties:{fill:e.DataViewObjects.getFillColor(i,a.GanttChartProps.taskCompletion.fill,g.DefaultValues.ProgressColor)},objectName:a.GanttChartProps.taskCompletion.fill.objectName})},g.prototype.enumerateTaskLabels=function(t,i){t.pushInstance({selector:null,properties:{show:e.DataViewObjects.getValue(i,a.GanttChartProps.taskLabels.show,!0),fill:e.DataViewObjects.getFillColor(i,a.GanttChartProps.taskLabels.fill,g.DefaultValues.TaskLabelColor),fontSize:e.DataViewObjects.getValue(i,a.GanttChartProps.taskLabels.fontSize,g.DefaultValues.LabelFontSize),width:e.DataViewObjects.getValue(i,a.GanttChartProps.taskLabels.width,g.DefaultValues.TaskLabelWidth)},objectName:a.GanttChartProps.taskLabels.show.objectName})},g.prototype.enumerateDataLabels=function(t,i){t.pushInstance({selector:null,properties:{show:e.DataViewObjects.getValue(i,a.GanttChartProps.taskResource.show,!0),fill:e.DataViewObjects.getFillColor(i,a.GanttChartProps.taskResource.fill,g.DefaultValues.TaskResourceColor),fontSize:e.DataViewObjects.getValue(i,a.GanttChartProps.taskResource.fontSize,g.DefaultValues.ResourceFontSize)},objectName:a.GanttChartProps.taskResource.show.objectName})},g.prototype.enumerateDateType=function(t,i){t.pushInstance({selector:null,properties:{type:e.DataViewObjects.getValue(i,a.GanttChartProps.ganttDateType.type,a.DefaultDateType)},objectName:a.GanttChartProps.ganttDateType.type.objectName})},g.prototype.enumerateObjectInstances=function(e){var a=this.dataView;if(a){var i=new t.ObjectEnumerationBuilder;switch(e.objectName){case"legend":this.enumerateLegendOptions(i,a.metadata.objects);break;case"dataPoint":this.enumerateDataPoints(i,a.metadata.objects);break;case"taskLabels":this.enumerateTaskLabels(i,a.metadata.objects);break;case"taskCompletion":this.enumerateTaskCompletion(i,a.metadata.objects);break;case"taskResource":this.enumerateDataLabels(i,a.metadata.objects);break;case"ganttDateType":this.enumerateDateType(i,a.metadata.objects)}return i.complete()}},g.DefaultValues={AxisTickSize:6,LabelFontSize:9,LegendFontSize:8,LegendLabelColor:"#000000",MaxTaskOpacity:1,MinTaskOpacity:.4,ProgressBarHeight:4,ProgressColor:"#000000",ResourceFontSize:9,ResourceWidth:100,TaskColor:"#00B099",TaskLabelColor:"#000000",TaskLabelWidth:110,TaskLineWidth:15,TaskResourceColor:"#000000",ganttFormatString:"MMM dd"},g.capabilities={dataRoles:[{name:"Legend",kind:e.VisualDataRoleKind.Grouping,displayName:"Legend"},{name:"Task",kind:e.VisualDataRoleKind.Grouping,displayName:"Task"},{name:"StartDate",kind:e.VisualDataRoleKind.Grouping,displayName:"Start Date"},{name:"Duration",kind:e.VisualDataRoleKind.Measure,displayName:"Duration",requiredTypes:[{numeric:!0},{integer:!0}]},{name:"Completion",kind:e.VisualDataRoleKind.Measure,displayName:"% Completion",requiredTypes:[{numeric:!0},{integer:!0}]},{name:"Resource",kind:e.VisualDataRoleKind.Grouping,displayName:"Resource"}],dataViewMappings:[{conditions:[{Legend:{min:0,max:1},Task:{min:1,max:1},StartDate:{min:0,max:0},Duration:{min:0,max:0},Completion:{min:0,max:0},Resource:{min:0,max:0}},{Legend:{min:0,max:1},Task:{min:1,max:1},StartDate:{min:0,max:1},Duration:{min:0,max:0},Completion:{min:0,max:0},Resource:{min:0,max:0}},{Legend:{min:0,max:1},Task:{min:0,max:1},StartDate:{min:0,max:1},Duration:{min:0,max:1},Completion:{min:0,max:1},Resource:{min:0,max:1}}],table:{rows:{select:[{"for":{"in":"Legend"}},{"for":{"in":"Task"}},{"for":{"in":"StartDate"}},{"for":{"in":"Duration"}},{"for":{"in":"Completion"}},{"for":{"in":"Resource"}}]}}}],sorting:{"default":{}},objects:{legend:{displayName:"Legend",description:"Display legend options",properties:{show:{displayName:"Show",type:{bool:!0}},position:{displayName:"Position",description:"Select the location for the legend",type:{enumeration:t.legendPosition.type}},showTitle:{displayName:"Title",description:"Display a title for legend symbols",type:{bool:!0}},titleText:{displayName:"Legend Name",description:"Title text",type:{text:!0},suppressFormatPainterCopy:!0},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},taskLabels:{displayName:"Category Labels",properties:{show:{displayName:"Show",type:{bool:!0}},fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Font Size",type:{formatting:{fontSize:!0}}},width:{displayName:"Width",type:{numeric:!0}}}},taskCompletion:{displayName:"Task Completion",properties:{show:{type:{bool:!0}},fill:{displayName:"Completion Color",type:{fill:{solid:{color:!0}}}}}},taskResource:{displayName:"Data Labels",properties:{show:{displayName:"Show",type:{bool:!0}},fill:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Font Size",type:{formatting:{fontSize:!0}}}}},ganttDateType:{displayName:"Gantt Date Type",properties:{type:{displayName:"Type",type:{enumeration:h.type}}}}}},g}();a.Gantt=g;var m=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.options=e;var a=e.clearCatcher;e.taskSelection.on("click",function(e){t.handleSelection(e,d3.event.ctrlKey),d3.event.stopPropagation()}),a.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var t=this.options,a=g.getMaxTaskOpacity(),i=g.getMinTaskOpacity();t.taskSelection.style("opacity",function(t){return e&&!t.selected?i:a})},e}();a.GanttChartBehavior=m;var y=function(){function e(){}return Object.defineProperty(e.prototype,"code",{get:function(){return"GanttChartWarning"},enumerable:!0,configurable:!0}),e.prototype.getMessages=function(e){var t,a="This visual requires task value",i="",r="";return t={message:a,title:e.get(i),detail:e.get(r)}},e}();a.GanttChartWarning=y}(a=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a;!function(a){var i=jsCommon.CssConstants.createClassAndSelector,r=t.utility.SelectionManager,s=jsCommon.PixelConverter.toString,o=jsCommon.PixelConverter.fromPoint,l=jsCommon.PixelConverter.fromPointToPixel;a.Months=e.createEnumType([{value:1,displayName:"January"},{value:2,displayName:"February"},{value:3,displayName:"March"},{value:4,displayName:"April"},{value:5,displayName:"May"},{value:6,displayName:"June"},{value:7,displayName:"July"},{value:8,displayName:"August"},{value:9,displayName:"September"},{value:10,displayName:"October"},{value:11,displayName:"November"},{value:12,displayName:"December"}]),a.WeekDays=e.createEnumType([{value:0,displayName:"Sunday"},{value:1,displayName:"Monday"},{value:2,displayName:"Tuesday"},{value:3,displayName:"Wednesday"},{value:4,displayName:"Thursday"},{value:5,displayName:"Friday"},{value:6,displayName:"Saturday"}]),function(e){e[e.year=0]="year",e[e.quarter=1]="quarter",e[e.month=2]="month",e[e.week=3]="week",e[e.day=4]="day"}(a.GranularityType||(a.GranularityType={}));var n=a.GranularityType,c={objectName:"cells",propertyName:"fillSelected"},h={objectName:"cells",propertyName:"fillUnselected"},u={objectName:"rangeHeader",propertyName:"fontColor"},d={objectName:"rangeHeader",propertyName:"textSize"},p={objectName:"rangeHeader",propertyName:"show"},g={objectName:"labels",propertyName:"fontColor"},m={objectName:"labels",propertyName:"textSize"},y={objectName:"labels",propertyName:"show"},f={objectName:"calendar",propertyName:"month"},v={objectName:"calendar",propertyName:"day"},x={objectName:"weekDay",propertyName:"day"},b=[{granularityType:n.year,name:"year"},{granularityType:n.quarter,name:"quarter"},{granularityType:n.month,name:"month"},{granularityType:n.week,name:"week"},{granularityType:n.day,name:"day"}],S=function(){function e(){this.datePeriods=[]}return e.prototype.shortMonthName=function(e){return e.toString().split(" ")[1]},e.prototype.resetDatePeriods=function(){this.datePeriods=[]},e.prototype.getDatePeriods=function(){return this.datePeriods},e.prototype.getExtendedLabel=function(){return this.extendedLabel},e.prototype.setExtendedLabel=function(e){this.extendedLabel=e},e.prototype.createLabels=function(e){var t,a=[];return _.map(this.datePeriods,function(i){!_.isEmpty(a)&&e.sameLabel(i,t)||(t=i,a.push(e.generateLabel(i)))}),a},e.prototype.addDate=function(e,t){var a=this.getDatePeriods(),i=a[a.length-1];0!==a.length&&_.isEqual(i.identifierArray,t)?i.endDate=e:(a.length>0&&(i.endDate=e),a.push({identifierArray:t,startDate:e,endDate:e,week:this.determineWeek(e),year:this.determineYear(e),fraction:1,index:a.length}))},e.prototype.setNewEndDate=function(e){_.last(this.datePeriods).endDate=e},e.prototype.splitPeriod=function(e,t,a){var i=this.datePeriods[e];i.fraction-=t;var r={identifierArray:i.identifierArray,startDate:a,endDate:i.endDate,week:this.determineWeek(a),year:this.determineYear(a),fraction:t,index:i.index+i.fraction};i.endDate=a,this.datePeriods.splice(e+1,0,r)},e.prototype.previousMonth=function(e){return e>0?e-1:11},e.prototype.nextMonth=function(e){return 11>e?e+1:0},e.prototype.countWeeks=function(e,t){var a;if(t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()>=e.getDate())a=t.getDate()-e.getDate();else{a=t.getDate()-1;for(var i=this.nextMonth(e.getMonth()),r=t.getMonth();r!==i;)a+=new Date(t.getFullYear(),r,0).getDate(),r=this.previousMonth(r);a+=new Date(t.getFullYear(),i,0).getDate()-e.getDate()}return 1+Math.floor(a/7)},e.prototype.determineWeek=function(e){var t=e.getFullYear();this.inPreviousYear(e)&&t--;var a=L.calendar.getDateOfFirstWeek(t),i=this.countWeeks(a,e);return[i,t]},e.prototype.inPreviousYear=function(e){var t=L.calendar.getDateOfFirstWeek(e.getFullYear());return t>e},e.prototype.determineYear=function(e){var t=new Date(e.getFullYear(),L.calendar.getFirstMonthOfYear(),L.calendar.getFirstDayOfYear());return e.getFullYear()-(e>=t?0:1)},e}();a.TimelineGranularity=S;var w=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.getType=function(){return n.day},t.prototype.splitDate=function(e){return[this.shortMonthName(e),e.getDate(),e.getFullYear()]},t.prototype.sameLabel=function(e,t){return e.startDate.getTime()===t.startDate.getTime()},t.prototype.generateLabel=function(e){return{title:this.shortMonthName(e.startDate)+" "+e.startDate.getDate()+" - "+e.year,text:e.startDate.getDate().toString(),id:e.index}},t}(S);a.DayGranularity=w;var C=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.getType=function(){return n.month},t.prototype.splitDate=function(e){return[this.shortMonthName(e),e.getFullYear()]},t.prototype.sameLabel=function(e,t){return this.shortMonthName(e.startDate)===this.shortMonthName(t.startDate)},t.prototype.generateLabel=function(e){var t=this.shortMonthName(e.startDate);return{title:t,text:t,id:e.index}},t}(S);a.MonthGranularity=C;var D=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.getType=function(){return n.week},t.prototype.splitDate=function(e){return this.determineWeek(e)},t.prototype.sameLabel=function(e,t){return _.isEqual(e.week,t.week)},t.prototype.generateLabel=function(e){return{title:"Week "+e.week[0]+" - "+e.week[1],
text:"W"+e.week[0],id:e.index}},t}(S);a.WeekGranularity=D;var P=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.quarterText=function(e){for(var t=3,a=e.getFullYear();e<L.calendar.getQuarterStartDate(a,t);)t>0?t--:(t=3,a--);return t++,"Q"+t},t.prototype.getType=function(){return n.quarter},t.prototype.splitDate=function(e){return[this.quarterText(e),e.getFullYear()]},t.prototype.sameLabel=function(e,t){return this.quarterText(e.startDate)===this.quarterText(t.startDate)&&e.year===t.year},t.prototype.generateLabel=function(e){var t=this.quarterText(e.startDate);return{title:t+" "+e.year,text:t,id:e.index}},t}(S);a.QuarterGranularity=P;var A=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.getType=function(){return n.year},t.prototype.splitDate=function(e){return[e.getFullYear()]},t.prototype.sameLabel=function(e,t){return e.year===t.year},t.prototype.generateLabel=function(e){return{title:"Year "+e.year,text:e.year.toString(),id:e.index}},t}(S);a.YearGranularity=A;var N=function(){function e(t,a){this.granularities=[],this.setDatesRange(t,a);var i=this.dates[this.dates.length-1];this.endingDate=e.nextDay(i)}return e.previousDay=function(e){var t=new Date(e.getTime());return t.setDate(t.getDate()-1),t},e.nextDay=function(e){var t=new Date(e.getTime());return t.setDate(t.getDate()+1),t},e.prototype.setDatesRange=function(t,a){this.dates=[];for(var i=t;a>=i;)this.dates.push(i),i=e.nextDay(i)},e.prototype.addGranularity=function(e){e.resetDatePeriods();for(var t=0,a=this.dates;t<a.length;t++){var i=a[t],r=e.splitDate(i);e.addDate(i,r)}e.setNewEndDate(this.endingDate),this.granularities.push(e)},e.prototype.getGranularity=function(e){return this.granularities[e]},e.prototype.createGranularities=function(){this.granularities=[],this.addGranularity(new A),this.addGranularity(new P),this.addGranularity(new C),this.addGranularity(new D),this.addGranularity(new w)},e.prototype.createLabels=function(){var e=this;this.granularities.forEach(function(t){t.setExtendedLabel({dayLabels:t.getType()>=n.day?t.createLabels(e.granularities[n.day]):[],weekLabels:t.getType()>=n.week?t.createLabels(e.granularities[n.week]):[],monthLabels:t.getType()>=n.month?t.createLabels(e.granularities[n.month]):[],quarterLabels:t.getType()>=n.quarter?t.createLabels(e.granularities[n.quarter]):[],yearLabels:t.getType()>=n.year?t.createLabels(e.granularities[n.year]):[]})})},e}();a.TimelineGranularityData=N;var T=function(){function e(){}return e.getStartSelectionDate=function(e){return e.currentGranularity.getDatePeriods()[e.selectionStartIndex].startDate},e.getEndSelectionDate=function(e){return e.currentGranularity.getDatePeriods()[e.selectionEndIndex].endDate},e.getEndSelectionPeriod=function(e){return e.currentGranularity.getDatePeriods()[e.selectionEndIndex]},e.getCellColor=function(t,a,i){var r=t.datePeriod.startDate>=e.getStartSelectionDate(a)&&t.datePeriod.endDate<=e.getEndSelectionDate(a);return r?i.colorInProperty:i.colorOutProperty},e.getGranularityType=function(e){var t=_.findIndex(b,function(t){return t.name===e});return b[t].granularityType},e.getGranularityName=function(e){var t=_.findIndex(b,function(t){return t.granularityType===e});return b[t].name},e.separateSelection=function(t,a,i){var r=t.currentGranularity.getDatePeriods(),s=_.findIndex(r,function(e){return a<e.endDate}),o=_.findIndex(r,function(e){return i<=e.endDate});t.selectionStartIndex=s,t.selectionEndIndex=o;var l=e.getDateRatio(r[s],a,!0),n=e.getDateRatio(r[o],i,!1);if(n>0&&t.currentGranularity.splitPeriod(o,n,i),l>0){var c=r[s].fraction-l;t.currentGranularity.splitPeriod(s,c,a),t.selectionStartIndex++,t.selectionEndIndex++}},e.getDateRatio=function(e,t,a){var i=a?t.getTime()-e.startDate.getTime():e.endDate.getTime()-t.getTime(),r=e.endDate.getTime()-e.startDate.getTime();return 0===r?0:i/r},e.timeRangeText=function(t){var a=t.currentGranularity.splitDate(e.getStartSelectionDate(t)),i=t.currentGranularity.splitDate(e.getEndSelectionPeriod(t).startDate);return a.join(" ")+" - "+i.join(" ")},e.dateRangeText=function(e){return e.startDate.toDateString()+" - "+N.previousDay(e.endDate).toDateString()},e.unseparateSelection=function(e){var t=_.findIndex(e,function(e){return e.fraction<1});return t>=0?(e[t].endDate=e[t+1].endDate,e[t].fraction+=e[t+1].fraction,e.splice(t+1,1),!0):!1},e}();a.Utils=T;var V=function(){function e(e){var t=this;this.firstDayOfWeek=e.weekDayProperty,this.firstMonthOfYear=e.firstMonthProperty-1,this.firstDayOfYear=e.firstDayProperty,this.dateOfFirstWeek={},this.quarterFirstMonths=[0,3,6,9].map(function(e){return e+t.firstMonthOfYear})}return e.prototype.getFirstDayOfWeek=function(){return this.firstDayOfWeek},e.prototype.getFirstMonthOfYear=function(){return this.firstMonthOfYear},e.prototype.getFirstDayOfYear=function(){return this.firstDayOfYear},e.prototype.getQuarterStartDate=function(e,t){return new Date(e,this.quarterFirstMonths[t],this.firstDayOfYear)},e.prototype.isChanged=function(e){return this.firstMonthOfYear!==e.firstMonthProperty-1||this.firstDayOfYear!==e.firstDayProperty||this.firstDayOfWeek!==e.weekDayProperty},e.prototype.calculateDateOfFirstWeek=function(e){for(var t=new Date(e,this.firstMonthOfYear,this.firstDayOfYear);t.getDay()!==this.firstDayOfWeek;)t=N.nextDay(t);return t},e.prototype.getDateOfFirstWeek=function(e){return this.dateOfFirstWeek[e]||(this.dateOfFirstWeek[e]=this.calculateDateOfFirstWeek(e)),this.dateOfFirstWeek[e]},e}();a.Calendar=V;var L=function(){function S(){var e=this;this.requiresNoUpdate=!1,this.foreignSelection=!1,this.selector=["Y","Q","M","W","D"],this.timelineMargins={LeftMargin:15,RightMargin:15,TopMargin:15,BottomMargin:10,CellWidth:40,CellHeight:25,StartXpoint:10,StartYpoint:20,ElementWidth:30,MinCellWidth:30,MaxCellHeight:60,PeriodSlicerRectWidth:15,PeriodSlicerRectHeight:23},this.defaultTimelineProperties={DefaultLabelsShow:!0,TimelineDefaultTextSize:9,TimelineDefaultCellColor:"#ADD8E6",TimelineDefaultCellColorOut:"#FFFFFF",TimelineDefaultTimeRangeShow:!0,DefaultTimeRangeColor:"#777777",DefaultLabelColor:"#777777",DefaultGranularity:n.month,DefaultFirstMonth:1,DefaultFirstDay:1,DefaultFirstWeekDay:0},this.timelineSelectors={TimelineVisual:i("Timeline"),SelectionRangeContainer:i("selectionRangeContainer"),textLabel:i("label"),LowerTextCell:i("lowerTextCell"),UpperTextCell:i("upperTextCell"),UpperTextArea:i("upperTextArea"),LowerTextArea:i("lowerTextArea"),RangeTextArea:i("rangeTextArea"),CellsArea:i("cellsArea"),CursorsArea:i("cursorsArea"),MainArea:i("mainArea"),SelectionCursor:i("selectionCursor"),Cell:i("cell"),CellRect:i("cellRect"),VertLine:i("timelineVertLine"),TimelineSlicer:i("timelineSlicer"),PeriodSlicerGranularities:i("periodSlicerGranularities"),PeriodSlicerSelection:i("periodSlicerSelection"),PeriodSlicerSelectionRect:i("periodSlicerSelectionRect"),PeriodSlicerRect:i("periodSlicerRect")},this.drag=d3.behavior.drag().origin(function(t){return t.x=t.selectionIndex*e.timelineProperties.cellWidth,t}).on("dragstart",function(){e.dragstarted()}).on("drag",function(t){e.dragged(t)}).on("dragend",function(){e.dragended()})}return S.prototype.changeGranularity=function(e,t,a){T.unseparateSelection(this.timelineData.currentGranularity.getDatePeriods())&&T.unseparateSelection(this.timelineData.currentGranularity.getDatePeriods()),this.timelineData.currentGranularity=this.timelineGranularityData.getGranularity(e),T.separateSelection(this.timelineData,t,a)},S.prototype.init=function(e){this.hostServices=e.host,this.initialized=!1;var a=e.element;this.selectionManager=new r({hostServices:e.host}),this.timelineProperties={element:a,textYPosition:50,cellsYPosition:3*this.timelineMargins.TopMargin+65,topMargin:this.timelineMargins.TopMargin,bottomMargin:this.timelineMargins.BottomMargin,leftMargin:this.timelineMargins.LeftMargin,startXpoint:this.timelineMargins.StartXpoint,startYpoint:this.timelineMargins.StartYpoint,cellWidth:this.timelineMargins.CellWidth,cellHeight:this.timelineMargins.CellHeight,elementWidth:this.timelineMargins.ElementWidth,rightMargin:this.timelineMargins.RightMargin},this.body=d3.select(a.get(0)),this.timelineDiv=this.body.append("div"),this.svg=this.timelineDiv.append("svg").attr("width",s(e.viewport.width)).classed(this.timelineSelectors.TimelineVisual["class"],!0),this.clearCatcher=t.appendClearCatcher(this.svg),this.clearCatcher.data([this]).on("click",function(e){return e.clear()}).on("touchstart",function(e){return e.clear()}),this.rangeText=this.svg.append("g").classed(this.timelineSelectors.RangeTextArea["class"],!0).append("text"),this.mainGroupElement=this.svg.append("g").classed(this.timelineSelectors.MainArea["class"],!0),this.yearLabelsElement=this.mainGroupElement.append("g"),this.quarterLabelsElement=this.mainGroupElement.append("g"),this.monthLabelsElement=this.mainGroupElement.append("g"),this.weekLabelsElement=this.mainGroupElement.append("g"),this.dayLabelsElement=this.mainGroupElement.append("g"),this.cellsElement=this.mainGroupElement.append("g").classed(this.timelineSelectors.CellsArea["class"],!0),this.cursorGroupElement=this.svg.append("g").classed(this.timelineSelectors.CursorsArea["class"],!0)},S.prototype.clear=function(){this.selectionManager.clear(),this.timelineData&&(this.timelineData.selectionStartIndex=0,this.timelineData.selectionEndIndex=this.timelineData.currentGranularity.getDatePeriods().length-1,_.any(this.timelineData.timelineDatapoints,function(e){return e.index%1!==0})?this.selectPeriod(this.timelineData.currentGranularity.getType()):(S.updateCursors(this.timelineData,this.timelineProperties.cellWidth),this.fillCells(this.timelineFormat.cellFormat),this.renderCursors(this.timelineData,this.timelineFormat,this.timelineProperties.cellHeight,this.timelineProperties.cellsYPosition),this.renderTimeRangeText(this.timelineData,this.timelineFormat.rangeTextFormat)),this.setSelection(this.timelineData))},S.prototype.drawGranular=function(e){var t=this,a=!1,i=e.startXpoint,r=e.startYpoint,o=e.elementWidth;this.selectorContainer=this.svg.append("g").classed(this.timelineSelectors.TimelineSlicer["class"],!0),this.selectorContainer.on("mouseleave",function(e){return a=!1});var l=this.selectorContainer.append("rect"),n=this.selector;l.attr({height:s(1),x:s(i),y:s(r+2),width:s((n.length-1)*o)});var c=this.selectorContainer.selectAll("vertLines").data(n).enter().append("rect");c.classed(this.timelineSelectors.VertLine["class"],!0).attr({x:function(e,t){return s(i+t*o)},y:s(r),width:s(2),height:s(3)}).style({cursor:"pointer"});var h,u=this.selectorContainer.selectAll(this.timelineSelectors.PeriodSlicerGranularities.selector).data(n).enter().append("text").classed(this.timelineSelectors.PeriodSlicerGranularities["class"],!0);h=u.text(function(e){return e}).attr({x:function(e,t){return s(i-3+t*o)},y:s(r-3)}),this.selectedText=this.selectorContainer.append("text").classed(this.timelineSelectors.PeriodSlicerSelection["class"],!0),this.selectedText.text(T.getGranularityName(this.defaultTimelineProperties.DefaultGranularity)).attr({x:s(i+2*o),y:s(r+17)});var d=this.selectorContainer.selectAll(this.timelineSelectors.PeriodSlicerSelectionRect.selector).data(n).enter().append("rect").classed(this.timelineSelectors.PeriodSlicerSelectionRect["class"],!0),p=function(e,i){t.selectPeriod(i),a=!0};d.attr({x:function(e,t){return s(i-o/2+t*o)},y:s(3),width:s(o),height:s(23)}).style({cursor:"pointer"}).on("mousedown",p).on("touchstart",p).on("mouseup",function(){return a=!1}).on("touchend",function(){return a=!1}).on("mouseover",function(e,i){a&&t.selectPeriod(i)});var g=d3.behavior.drag().on("dragstart",function(e,t){a=!0}).on("dragend",function(e,t){a=!1});this.periodSlicerRect=this.selectorContainer.append("rect").classed(this.timelineSelectors.PeriodSlicerRect["class"],!0).attr({x:s(i-6+this.defaultTimelineProperties.DefaultGranularity*o),y:s(r-16),rx:s(4),width:s(15),height:s(23)}).on("mouseup",function(e){return a=!1}),this.periodSlicerRect.call(g)},S.prototype.redrawPeriod=function(e){var t=this.timelineMargins.StartXpoint+e*this.timelineMargins.ElementWidth;this.periodSlicerRect.transition().attr("x",s(t-7)),this.selectedText.text(T.getGranularityName(e));var a=T.getStartSelectionDate(this.timelineData),i=T.getEndSelectionDate(this.timelineData);this.changeGranularity(e,a,i)},S.setMeasures=function(e,t,a,i,r,s){r.cellsYPosition=r.textYPosition;var o=l(e.sizeProperty);e.showProperty&&(r.cellsYPosition+=1.5*o*(t+1));var n=Math.max(0,i.height-s.TopMargin),c=i.width-s.RightMargin-s.MinCellWidth*a,h=Math.max(s.MinCellWidth,Math.min(s.MaxCellHeight,c,n-r.cellsYPosition-20)),u=Math.max(s.MinCellWidth,(i.width-h-s.RightMargin)/a);r.cellHeight=h,r.cellWidth=u},S.prototype.visualChangeOnly=function(e){if(e&&e.dataViews&&e.dataViews[0]&&e.dataViews[0].metadata&&this.options&&this.options.dataViews&&this.options.dataViews[0]&&this.options.dataViews[0].metadata){var t=e.dataViews[0].metadata.objects,a=this.options.dataViews[0].metadata.objects,i=["rangeHeader","cells","labels"],r=!i.every(function(e){return _.isEqual(t?t[e]:void 0,a?a[e]:void 0)});return e.suppressAnimations||r}return!1},S.prototype.unavailableType=function(e){return!(e.categories&&1===e.categories.length&&e.categories[0].values&&0!==e.categories[0].values.length&&e.categories[0].source&&e.categories[0].source.type)},S.prototype.unavailableChildIdentityField=function(e){return!e.root||!e.root.childIdentityFields||0===e.root.childIdentityFields.length},S.prototype.createTimelineOptions=function(e){if(this.dataView=e,!e.categorical||!e.metadata||this.unavailableType(e.categorical)||!e.tree||this.unavailableChildIdentityField(e.tree))return!1;var t=e.tree.root.childIdentityFields[0];return this.valueType=t?t.ref:null,e.categorical.categories[0].source.type.dateTime||e.categorical.categories[0].source.type.numeric&&("Year"===this.valueType||"Date"===this.valueType)?(this.values=this.prepareValues(this.dataView.categorical.categories[0].values),!0):!1},S.prototype.prepareValues=function(e){e=e.filter(Boolean);for(var t in e){var a=e[t];if("String"==typeof a&&"Invalid Date"!==String(new Date(a)))return e[t]=new Date(a)}return e},S.prototype.createTimelineData=function(){var e,t;if("Year"===this.valueType){var a=this.values;e=new Date(_.min(a),0),t=new Date(_.max(a),11)}else{var i=this.values;e=_.min(i),t=_.max(i)}if(this.initialized||this.drawGranular(this.timelineProperties),this.initialized){var r=N.nextDay(t),s=this.timelineGranularityData.getGranularity(n.day).getDatePeriods(),o=s[0].startDate,l=s[s.length-1].endDate,c=e.getTime()>=o.getTime()&&r.getTime()<=l.getTime();this.newGranularity=this.timelineData.currentGranularity.getType(),c?(this.foreignSelection=!0,this.changeGranularity(this.newGranularity,e,r),this.timelineFormat=S.fillTimelineFormat(this.options.dataViews[0].metadata.objects,this.defaultTimelineProperties)):(l>r&&(t=s[s.length-1].startDate),e>o&&(e=o),this.initialized=!1)}this.initialized||(this.timelineGranularityData=new N(e,t),this.timelineData={elementsCount:0,timelineDatapoints:[],cursorDataPoints:new Array})},S.prototype.update=function(e){var t=this.visualChangeOnly(e);if(this.requiresNoUpdate=this.requiresNoUpdate&&!t,this.requiresNoUpdate)return void(this.foreignSelection?this.foreignSelection=!1:this.requiresNoUpdate=!1);if(this.options=e,e.dataViews&&e.dataViews[0]){var a=this.createTimelineOptions(e.dataViews[0]);if(!a)return void this.clearData();this.newGranularity=this.defaultTimelineProperties.DefaultGranularity,t||this.createTimelineData(),this.timelineFormat=S.converter(this.timelineData,this.timelineProperties,this.defaultTimelineProperties,this.timelineGranularityData,e.dataViews[0],this.initialized,this.newGranularity,e.viewport,this.timelineMargins),this.render(this.timelineData,this.timelineFormat,this.timelineProperties,e),this.initialized=!0}},S.prototype.selectPeriod=function(e){this.redrawPeriod(e),this.timelineFormat=S.converter(this.timelineData,this.timelineProperties,this.defaultTimelineProperties,this.timelineGranularityData,this.options.dataViews[0],this.initialized,this.timelineData.currentGranularity.getType(),this.options.viewport,this.timelineMargins),this.render(this.timelineData,this.timelineFormat,this.timelineProperties,this.options)},S.isDataNotMatch=function(e){return e.categorical.categories.length<=0||void 0===e.categorical.categories[0]||void 0===e.categorical.categories[0].identityFields||e.categorical.categories[0].identityFields.length<=0},S.converter=function(e,t,a,i,r,s,o,l,n){var c=S.fillTimelineFormat(r.metadata.objects,a);if(s||(e.cursorDataPoints.push({x:0,selectionIndex:0,cursorIndex:0}),e.cursorDataPoints.push({x:0,selectionIndex:0,cursorIndex:1})),s&&!S.calendar.isChanged(c.calendarFormat)||(S.calendar=new V(c.calendarFormat),i.createGranularities(),i.createLabels(),e.currentGranularity=i.getGranularity(o),e.selectionStartIndex=0,e.selectionEndIndex=e.currentGranularity.getDatePeriods().length-1),e.categorySourceName=r.categorical.categories[0].source.displayName,e.columnIdentity=r.categorical.categories[0].identityFields[0],r.categorical.categories[0].source.type.numeric&&(e.columnIdentity.ref="Date"),!this.isDataNotMatch(r)){var h=e.currentGranularity.getDatePeriods();e.elementsCount=h.length,e.timelineDatapoints=[];for(var u=0,d=h;u<d.length;u++){var p=d[u],g={index:p.index,datePeriod:p};e.timelineDatapoints.push(g)}var m=e.currentGranularity.getDatePeriods().filter(function(e){return e.index%1===0}).length;return S.setMeasures(c.labelFormat,e.currentGranularity.getType(),m,l,t,n),S.updateCursors(e,t.cellWidth),c}},S.prototype.render=function(e,a,i,r){var o=this.timelineData.timelineDatapoints.filter(function(e){return e.index%1===0}).length;this.svgWidth=1+this.timelineProperties.cellHeight+i.cellWidth*o,this.renderTimeRangeText(e,a.rangeTextFormat),this.timelineDiv.attr({height:s(r.viewport.height),width:s(r.viewport.width),"drag-resize-disabled":!0}).style({"overflow-x":"auto","overflow-y":"auto"}),this.svg.attr({height:s(Math.max(0,r.viewport.height-this.timelineMargins.TopMargin)),width:s(Math.max(0,this.svgWidth))});var l=t.SVGUtil.translate(i.leftMargin,i.topMargin),n=t.SVGUtil.translate(i.cellHeight/2,i.topMargin);this.mainGroupElement.attr("transform",n),this.selectorContainer.attr("transform",l),this.cursorGroupElement.attr("transform",n);var c=this.timelineData.currentGranularity.getExtendedLabel(),h=this.timelineData.currentGranularity.getType(),u=0,d=1.5;this.renderLabels(c.yearLabels,this.yearLabelsElement,u,0===h),u+=d,this.renderLabels(c.quarterLabels,this.quarterLabelsElement,u,1===h),u+=d,this.renderLabels(c.monthLabels,this.monthLabelsElement,u,2===h),u+=d,this.renderLabels(c.weekLabels,this.weekLabelsElement,u,3===h),u+=d,this.renderLabels(c.dayLabels,this.dayLabelsElement,u,4===h),this.renderCells(e,a,i,r.suppressAnimations),this.renderCursors(e,a,i.cellHeight,i.cellsYPosition)},S.prototype.renderLabels=function(a,i,r,s){var n=this,c=i.selectAll(this.timelineSelectors.textLabel.selector);if(!this.timelineFormat.labelFormat.showProperty)return void c.remove();var h=c.data(a);h.enter().append("text").classed(this.timelineSelectors.textLabel["class"],!0),h.text(function(i,r){if(!s&&0===r&&a.length>1){var l=o(n.timelineFormat.labelFormat.sizeProperty),c={text:a[0].text,fontFamily:"arial",fontSize:l},h=e.TextMeasurementService.measureSvgTextWidth(c)/2;c={text:a[1].text,fontFamily:"arial",fontSize:l};var u=e.TextMeasurementService.measureSvgTextWidth(c)/2,d=n.timelineProperties.cellWidth*(a[1].id-a[0].id);if(h+u>d)return""}var p={label:i.text,maxWidth:n.timelineProperties.cellWidth*(s?.9:3),fontSize:n.timelineFormat.labelFormat.sizeProperty};return t.dataLabelUtils.getLabelFormattedText(p)}).style("font-size",o(this.timelineFormat.labelFormat.sizeProperty)).attr({x:function(e){return(e.id+.5)*n.timelineProperties.cellWidth},y:this.timelineProperties.textYPosition+(1+r)*l(this.timelineFormat.labelFormat.sizeProperty),fill:this.timelineFormat.labelFormat.colorProperty}).append("title").text(function(e){return e.title}),h.exit().remove()},S.prototype.clearData=function(){this.initialized=!1,this.mainGroupElement.selectAll(this.timelineSelectors.CellRect.selector).remove(),this.mainGroupElement.selectAll(this.timelineSelectors.textLabel.selector).remove(),this.rangeText.text(""),this.cursorGroupElement.selectAll(this.timelineSelectors.SelectionCursor.selector).remove(),this.svg.select(this.timelineSelectors.TimelineSlicer.selector).remove()},S.updateCursors=function(e,t){var a=e.timelineDatapoints[e.selectionStartIndex].datePeriod;e.cursorDataPoints[0].selectionIndex=a.index;var i=e.timelineDatapoints[e.selectionEndIndex].datePeriod;e.cursorDataPoints[1].selectionIndex=i.index+i.fraction},S.fillTimelineFormat=function(t,a){var i={rangeTextFormat:{showProperty:e.DataViewObjects.getValue(t,p,a.TimelineDefaultTimeRangeShow),colorProperty:e.DataViewObjects.getFillColor(t,u,a.DefaultTimeRangeColor),sizeProperty:e.DataViewObjects.getValue(t,d,a.TimelineDefaultTextSize)},cellFormat:{colorInProperty:e.DataViewObjects.getFillColor(t,c,a.TimelineDefaultCellColor),colorOutProperty:e.DataViewObjects.getFillColor(t,h,a.TimelineDefaultCellColorOut)},labelFormat:{showProperty:e.DataViewObjects.getValue(t,y,a.DefaultLabelsShow),colorProperty:e.DataViewObjects.getFillColor(t,g,a.DefaultLabelColor),sizeProperty:e.DataViewObjects.getValue(t,m,a.TimelineDefaultTextSize)},calendarFormat:{firstMonthProperty:e.DataViewObjects.getValue(t,f,1),firstDayProperty:Math.max(1,Math.min(31,e.DataViewObjects.getValue(t,v,a.DefaultFirstDay))),weekDayProperty:Math.max(0,Math.min(6,e.DataViewObjects.getValue(t,x,a.DefaultFirstWeekDay)))}};return i},S.prototype.fillCells=function(e){var t=this,a=this.timelineData.timelineDatapoints,i=this.mainGroupElement.selectAll(this.timelineSelectors.CellRect.selector).data(a);i.attr("fill",function(a){return T.getCellColor(a,t.timelineData,e)})},S.prototype.renderCells=function(e,t,a,i){var r=this,o=e.timelineDatapoints,l=0,n=this.cellsElement.selectAll(this.timelineSelectors.CellRect.selector).data(o);n.enter().append("rect").classed(this.timelineSelectors.CellRect["class"],!0),n.attr({height:s(a.cellHeight),width:function(e){return s(e.datePeriod.fraction*a.cellWidth)},x:function(e){var t=l;return l+=e.datePeriod.fraction*a.cellWidth,s(t)},y:s(a.cellsYPosition),id:function(e){return e.index}});var c=function(i,s){d3.event.preventDefault();var o=r.timelineData.cursorDataPoints,l=d3.event;l.altKey||l.shiftKey?r.timelineData.selectionEndIndex<s?(o[1].selectionIndex=i.datePeriod.index+i.datePeriod.fraction,e.selectionEndIndex=s):(o[0].selectionIndex=i.datePeriod.index,e.selectionStartIndex=s):(e.selectionStartIndex=s,e.selectionEndIndex=s,o[0].selectionIndex=i.datePeriod.index,o[1].selectionIndex=i.datePeriod.index+i.datePeriod.fraction),r.fillCells(t.cellFormat),r.renderCursors(e,t,a.cellHeight,a.cellsYPosition),r.renderTimeRangeText(e,t.rangeTextFormat),r.setSelection(e)};n.on("click",c).on("touchstart",c),this.fillCells(t.cellFormat),n.exit().remove()},S.prototype.dragstarted=function(){this.timelineData.dragging=!0},S.prototype.dragged=function(e){if(this.timelineData.dragging===!0){var t=1,a=d3.select(this.timelineSelectors.TimelineVisual.selector);if(a){var i=a.style("transform");if(void 0!==i&&"none"!==i){var r=i.split("(")[1];t=Number(r.split(", ")[0])}}var s=this.findCursorOverElement(d3.event.x);if(!s)return;var o=s.datapoint,l=s.index;0===e.cursorIndex&&l<=this.timelineData.selectionEndIndex&&(this.timelineData.selectionStartIndex=l,this.timelineData.cursorDataPoints[0].selectionIndex=o.datePeriod.index),1===e.cursorIndex&&l>=this.timelineData.selectionStartIndex&&(this.timelineData.selectionEndIndex=l,this.timelineData.cursorDataPoints[1].selectionIndex=o.datePeriod.index+o.datePeriod.fraction),this.fillCells(this.timelineFormat.cellFormat),this.renderCursors(this.timelineData,this.timelineFormat,this.timelineProperties.cellHeight,this.timelineProperties.cellsYPosition),this.renderTimeRangeText(this.timelineData,this.timelineFormat.rangeTextFormat)}},S.prototype.findCursorOverElement=function(e){var t=this.timelineData.timelineDatapoints||[],a=t.length,i=this.timelineProperties.cellWidth;if(t[0]&&t[1]&&e<=t[1].index*i)return{index:0,datapoint:t[0]};if(t[a-1]&&e>=t[a-1].index*i)return{index:a-1,datapoint:t[a-1]};for(var r=1;a>r;r++){var s=t[r].index*i,o=t[r+1].index*i;if(e>=s&&o>=e)return{index:r,datapoint:t[r]}}return null},S.prototype.dragended=function(){this.setSelection(this.timelineData)},S.prototype.renderCursors=function(e,a,i,r){var s=this,o=this.cursorGroupElement.selectAll(this.timelineSelectors.SelectionCursor.selector).data(e.cursorDataPoints);return o.enter().append("path").classed(this.timelineSelectors.SelectionCursor["class"],!0),o.attr("transform",function(e){return t.SVGUtil.translate(e.selectionIndex*s.timelineProperties.cellWidth,i/2+r)}).attr({d:d3.svg.arc().innerRadius(0).outerRadius(i/2).startAngle(function(e){return e.cursorIndex*Math.PI+Math.PI}).endAngle(function(e){return e.cursorIndex*Math.PI+2*Math.PI})}).call(this.drag),o.exit().remove(),o},S.prototype.renderTimeRangeText=function(e,a){var i=(b.length+2)*this.timelineProperties.elementWidth,r=this.svgWidth-i-this.timelineProperties.leftMargin;if(a.showProperty&&r>0){var s=T.timeRangeText(e),l={label:s,maxWidth:r,fontSize:a.sizeProperty},n=t.dataLabelUtils.getLabelFormattedText(l);this.rangeText.classed(this.timelineSelectors.SelectionRangeContainer["class"],!0),this.rangeText.attr({x:b.length*(this.timelineProperties.elementWidth+this.timelineProperties.leftMargin),y:40,fill:a.colorProperty}).style({"font-size":o(a.sizeProperty)}).text(n).append("title").text(s)}else this.rangeText.text("")},S.prototype.setSelection=function(t){this.requiresNoUpdate=!0;var a=e.data.SQExprBuilder.dateTime(T.getStartSelectionDate(t)),i=e.data.SQExprBuilder.dateTime(new Date(T.getEndSelectionDate(t).getTime()-1)),r=e.data.SQExprBuilder.between(t.columnIdentity,a,i),s=e.data.SemanticFilter.fromSQExpr(r),o={merge:[{objectName:"general",selector:void 0,properties:{filter:s}}]};this.hostServices.persistProperties(o),this.hostServices.onSelect({data:[]})},S.prototype.enumerateObjectInstances=function(e){var a=new t.ObjectEnumerationBuilder;switch(e.objectName){case"rangeHeader":this.enumerateRangeHeader(a,this.dataView);break;case"cells":this.enumerateCells(a,this.dataView);break;case"labels":this.enumerateLabels(a,this.dataView);break;case"calendar":this.enumerateCalendar(a,this.dataView);break;case"weekDay":this.enumerateWeekDay(a,this.dataView)}return a.complete()},S.prototype.enumerateRangeHeader=function(t,a){var i=a&&a.metadata?a.metadata.objects:void 0;t.pushInstance({objectName:"rangeHeader",displayName:"Selection Color",selector:null,properties:{show:e.DataViewObjects.getValue(i,p,this.defaultTimelineProperties.TimelineDefaultTimeRangeShow),fontColor:e.DataViewObjects.getFillColor(i,u,this.defaultTimelineProperties.DefaultTimeRangeColor),textSize:e.DataViewObjects.getValue(i,d,this.defaultTimelineProperties.TimelineDefaultTextSize)}})},S.prototype.enumerateCells=function(t,a){var i=a&&a.metadata?a.metadata.objects:void 0;t.pushInstance({objectName:"cells",selector:null,properties:{fillSelected:e.DataViewObjects.getFillColor(i,c,this.defaultTimelineProperties.TimelineDefaultCellColor),fillUnselected:e.DataViewObjects.getFillColor(i,h,this.defaultTimelineProperties.TimelineDefaultCellColorOut)}})},S.prototype.enumerateLabels=function(t,a){var i=a&&a.metadata?a.metadata.objects:void 0;t.pushInstance({objectName:"labels",selector:null,properties:{show:e.DataViewObjects.getValue(i,y,this.defaultTimelineProperties.DefaultLabelsShow),fontColor:e.DataViewObjects.getFillColor(i,g,this.defaultTimelineProperties.DefaultLabelColor),textSize:e.DataViewObjects.getValue(i,m,this.defaultTimelineProperties.TimelineDefaultTextSize)}})},S.prototype.enumerateCalendar=function(t,a){var i=a&&a.metadata?a.metadata.objects:void 0;t.pushInstance({objectName:"calendar",selector:null,properties:{month:Math.max(1,Math.min(12,e.DataViewObjects.getValue(i,f,1))),day:Math.max(1,Math.min(31,e.DataViewObjects.getValue(i,v,1)))}})},S.prototype.enumerateWeekDay=function(t,a){var i=a&&a.metadata?a.metadata.objects:void 0;t.pushInstance({objectName:"weekDay",selector:null,properties:{day:Math.max(0,Math.min(6,e.DataViewObjects.getValue(i,x,0)))}})},S.capabilities={dataRoles:[{name:"Time",kind:e.VisualDataRoleKind.Grouping,displayName:"Time"}],dataViewMappings:[{conditions:[{Time:{max:1}}],categorical:{categories:{"for":{"in":"Time"},dataReductionAlgorithm:{sample:{}}},values:{select:[{bind:{to:"Time"}}]}}}],objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}},selected:{type:{bool:!0}},filter:{type:{filter:{}},rule:{output:{property:"selected",selector:["Time"]}}}}},calendar:{displayName:"Fiscal Year Start",properties:{month:{displayName:"Month",type:{enumeration:a.Months}},day:{displayName:"Day",type:{numeric:!0}}}},weekDay:{displayName:"First Day of Week",properties:{day:{displayName:"Day",type:{enumeration:a.WeekDays}}}},rangeHeader:{displayName:"Range Header",properties:{show:{displayName:"Show",type:{bool:!0}},fontColor:{displayName:"Font color",type:{fill:{solid:{color:!0}}}},textSize:{displayName:"Text Size",type:{numeric:!0}}}},cells:{displayName:"Cells",properties:{fillSelected:{displayName:"Selected cell color",type:{fill:{solid:{color:!0}}}},fillUnselected:{displayName:"Unselected cell color",type:{fill:{solid:{color:!0}}}}}},labels:{displayName:"Labels",properties:{show:{displayName:"Show",type:{bool:!0}},fontColor:{displayName:"Font color",type:{fill:{solid:{color:!0}}}},textSize:{displayName:"Text Size",type:{numeric:!0}}}}}},S}();a.Timeline=L}(a=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a;!function(a){var i=e.visuals.valueFormatter,r=t.utility.SelectionManager,s="axisGraphicsContext",o="x axis",l="y axis",n="#777",c=8,h=8,u="#666666",d="wf_segoe-ui_normal",p="normal",g={legendSettings:{show:!0,showTitle:!0,labelColor:u,titleText:"",fontSize:h},categoryAxisSettings:{show:!0,axisColor:n,showAxisTitle:!1},valueAxisSettings:{show:!0,axisColor:n,showAxisTitle:!1}},m=function(){function a(){this.margin={left:45,right:20,bottom:20,top:20}}return a.prototype.converter=function(e,r){if(!(e&&e.categorical&&e.categorical.values&&e.categorical.categories))return null;for(var s,o,l=e.categorical,n=l.values,h=[],u={dataPoints:[],title:n[0].source.displayName,fontSize:c},d=0,p=0;p<n.length;p++){h.push([]),n[p].source.groupName&&u.dataPoints.push({label:n[p].source.groupName,color:r.getColorByIndex(p).value,icon:t.LegendIcon.Box,selected:!1,identity:t.SelectionId.createWithId(n[p].identity)});for(var g=0;g<n[p].values.length;g++){var m=t.SelectionIdBuilder.builder().withSeries(e.categorical.values,e.categorical.values[p]).createSelectionId(),y=n[p].values[g];y>d&&(d=y),h[p].push({x:g,y:y,identity:m})}}var f=this.parseSettings(e);return s=i.create({format:"g",value:d}),o=i.create({format:i.getFormatString(l.categories[0].source,a.Properties.general.formatString),value:l.categories[0].values}),{dataPoints:h,legendData:u,valueFormatter:s,categoryFormatter:o,streamGraphSettings:f}},a.prototype.parseSettings=function(t){if(!t||!t.metadata)return g;var i=t.metadata.objects,r=_.clone(g),s=r.categoryAxisSettings;s.show=e.DataViewObjects.getValue(i,a.Properties.categoryAxis.show,s.show),s.axisColor=e.DataViewObjects.getFillColor(i,a.Properties.categoryAxis.axisColor,s.axisColor),s.showAxisTitle=e.DataViewObjects.getValue(i,a.Properties.categoryAxis.showAxisTitle,s.showAxisTitle);var o=r.valueAxisSettings;return o.show=e.DataViewObjects.getValue(i,a.Properties.valueAxis.show,o.show),o.axisColor=e.DataViewObjects.getFillColor(i,a.Properties.valueAxis.axisColor,o.axisColor),o.showAxisTitle=e.DataViewObjects.getValue(i,a.Properties.valueAxis.showAxisTitle,o.showAxisTitle),
r},a.prototype.init=function(e){var i=e.element;this.selectionManager=new r({hostServices:e.host}),this.svg=d3.select(i.get(0)).append("svg").classed(a.VisualClassName,!0).style("position","absolute"),this.axisGraphicsContext=this.svg.append("g").classed(s,!0),this.xAxis=this.axisGraphicsContext.append("g").classed(o,!0),this.yAxis=this.axisGraphicsContext.append("g").classed(l,!0),this.colors=e.style.colorPalette.dataColors,this.legend=t.createLegend(i,!1,null,!0)},a.prototype.update=function(e){var t=this;if(!e.dataViews||!e.dataViews[0]||!e.dataViews[0].categorical)return void this.clearData();this.viewport={width:Math.max(0,e.viewport.width),height:Math.max(0,e.viewport.height)};var i=e.suppressAnimations?0:250,r=this.dataView=e.dataViews[0],s=this.data=this.converter(r,this.colors);if(!s||!s.dataPoints||!s.dataPoints.length)return void this.clearData();var o=s.dataPoints;this.renderLegend(s),this.updateViewPort(),this.renderXAxisLabels(),this.renderYAxisLabels();var l=Math.max(0,this.viewport.height-this.margin.top);this.svg.attr({width:this.viewport.width,height:l});var n=d3.layout.stack();this.getWiggle(r)&&n.offset("wiggle");var c=n(o),h=d3.scale.linear().domain([0,o[0].length-1]).range([this.margin.left,this.viewport.width-this.margin.right]),u=d3.scale.linear().domain([0,d3.max(c,function(e){return d3.max(e,function(e){return e.y0+e.y})})]).range([l-this.margin.bottom,this.margin.top]),d=d3.svg.area().interpolate("basis").x(function(e){return h(e.x)}).y0(function(e){return u(e.y0)}).y1(function(e){return u(e.y0+e.y)}),p=this.selectionManager,g=this.svg.selectAll(a.Layer.selector).data(c);g.enter().append("path").classed(a.Layer["class"],!0),g.style("fill",function(e,a){return t.colors.getColorByIndex(a).value}).on("click",function(e){var t=this;p.select(e[0].identity).then(function(e){e.length>0?(g.style("opacity",.5),d3.select(t).style("opacity",1)):g.style("opacity",1)})}).transition().duration(i).attr("d",d),g.exit().remove(),this.drawAxis(s,h,u)},a.prototype.drawAxis=function(i,r,s){var o=this,l=this.viewport.height-this.margin.bottom-this.margin.top,n=this.viewport.width-this.margin.left-this.margin.right,c=d3.svg.axis();c.scale(r).orient("bottom").tickFormat(function(t,r){return i.categoryFormatter&&(t=i.categoryFormatter.format(t)),null==r||!c.tickValues()||0!==r&&r!==c.tickValues().length-1||(t=e.TextMeasurementService.getTailoredTextOrDefault(a.getTextPropertiesFunction(t),2*(r?o.margin.right:o.margin.left))),t}.bind(c));var h=d3.svg.axis().scale(s).orient("left").tickFormat(function(e){return i.valueFormatter?i.valueFormatter.format(e):e});this.setMaxTicks(c,n,a.MaxNumberOfAxisXValues),this.setMaxTicks(h,l);var u=this.data.streamGraphSettings.valueAxisSettings;if(u.show){var d=u.axisColor;this.yAxis.attr("transform",t.SVGUtil.translate(this.margin.left,0)).call(h),this.yAxis.selectAll("text").style("fill",d)}else this.yAxis.selectAll("*").remove();var p=this.data.streamGraphSettings.categoryAxisSettings;if(p.show){var d=p.axisColor;this.xAxis.attr("transform",t.SVGUtil.translate(0,l)).call(c),this.xAxis.selectAll("text").style("fill",d)}else this.xAxis.selectAll("*").remove()},a.prototype.renderYAxisLabels=function(){this.yAxis.selectAll(a.YAxisLabel.selector).remove();var i=this.data.streamGraphSettings.valueAxisSettings;if(i.show){if(this.margin.left=45,i.showAxisTitle)if(this.dataView.categorical.values.source){var r=this.margin.left=65,s=this.data.streamGraphSettings.categoryAxisSettings,o=s.show===!0,l=s.showAxisTitle===!0,n=o?l?this.viewport.height-this.margin.bottom:this.viewport.height-this.margin.top:this.viewport.height,c=this.dataView.categorical.values.source.displayName,h=a.YAxisLabel["class"],u=this.yAxis.append("text").style("text-anchor","middle").text(c).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":h,transform:"rotate(-90)",y:-r+5,x:-(n/2),dy:"1em"})})});u.call(t.AxisHelper.LabelLayoutStrategy.clip,n,e.TextMeasurementService.svgEllipsis)}else i.showAxisTitle=!1}else this.margin.left=20},a.prototype.renderXAxisLabels=function(){this.xAxis.selectAll(a.XAxisLabel.selector).remove();var i=this.data.streamGraphSettings.categoryAxisSettings;if(i.show){if(this.margin.bottom=20,i.showAxisTitle)if(this.dataView.categorical.categories[0].source){var r=this.margin.bottom=40,s=this.data.streamGraphSettings.valueAxisSettings,o=s.show===!0,l=s.showAxisTitle===!0,n=o?l?this.viewport.width+this.margin.left:this.viewport.width+this.margin.right:this.viewport.width,c=this.dataView.categorical.categories[0].source.displayName,h=a.XAxisLabel["class"],u=this.xAxis.append("text").style("text-anchor","middle").text(c).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":h,transform:t.SVGUtil.translate(n/2,r-5)})})});u.call(t.AxisHelper.LabelLayoutStrategy.clip,n,e.TextMeasurementService.svgEllipsis)}else i.showAxisTitle=!1}else this.margin.bottom=10},a.prototype.renderLegend=function(a){var i=a.legendData;if(i&&this.dataView&&this.dataView.metadata){if(this.legendObjectProperties=e.DataViewObjects.getObject(this.dataView.metadata.objects,"legend",{}),this.legendObjectProperties){t.LegendData.update(i,this.legendObjectProperties);var r=this.legendObjectProperties[t.legendProps.position];r&&this.legend.changeOrientation(t.LegendPosition[r])}this.legend.drawLegend(i,_.clone(this.viewport)),t.Legend.positionChartArea(this.svg,this.legend)}},a.prototype.updateViewPort=function(){var e=this.legend.getMargins(),a=t.LegendPosition[this.legendObjectProperties[t.legendProps.position]];switch(a){case t.LegendPosition.Top:case t.LegendPosition.TopCenter:case t.LegendPosition.Bottom:case t.LegendPosition.BottomCenter:this.viewport.height-=e.height;break;case t.LegendPosition.Left:case t.LegendPosition.LeftCenter:case t.LegendPosition.Right:case t.LegendPosition.RightCenter:this.viewport.width-=e.width}},a.prototype.setMaxTicks=function(e,t,a){var i=void 0===a?this.getTicksByAxis(e).length:Math.min(a,this.getTicksByAxis(e).length);e.scale().domain.toString()===d3.scale.linear().domain.toString()?e.ticks(this.getFittedTickLength(e,t,i)):e.tickValues(this.getFittedTickValues(e,t,i))},a.prototype.getFittedTickLength=function(e,t,a){for(var i=this.getTicksByAxis(e),r=this.getMeasureTickFunction(e,i);a>0&&t>0&&(this.measureTicks(i,r)>t||e.scale().ticks([a]).length>a);a--,i=this.getTicksByAxis(e))e.ticks(a);return a},a.prototype.getFittedTickValues=function(e,t,a){for(var i,r=this.getTicksByAxis(e),s=[],o=this.getMeasureTickFunction(e,r),l=a,n=[];a>0&&t>0;l--,n=[]){switch(l){case 0:return[];case 1:n=[0];break;case 2:n=[0,r.length-1];break;default:for(var c=r.length/(l-1),h=0;l-1>h;h++)n.push(Math.round(c*h));n.push(r.length-1)}var u=n.map(function(e){return[r[e],e]});if(i=t/r.length*2,u.reduce(function(e,t){return s.push([o(e[0])+o(t[0]),(t[1]-e[1])*i]),t}),!s.some(function(e){return e[0]>e[1]}))return u.map(function(e){return e[0]})}return[]},a.prototype.measureTicks=function(e,t){return e.map(function(e){return t(e)}).reduce(function(e,t){return e+t})},a.prototype.getTicksByAxis=function(e){var t=e.scale(),a=null===e.tickValues()?t.ticks?t.ticks.apply(t,e.ticks()):t.domain():e.tickValues();return void 0===a.length?[a]:a},a.prototype.getMeasureTickFunction=function(t,i){var r="top"===t.orient()||"bottom"===t.orient()?e.TextMeasurementService.measureSvgTextWidth:e.TextMeasurementService.measureSvgTextHeight,s={};return function(e){return s[e]?s[e]:s[e]=r(a.getTextPropertiesFunction(t.tickFormat()(e)))+t.tickPadding()}},a.getTextPropertiesFunction=function(e){var t=d,a=jsCommon.PixelConverter.fromPoint(c),i=p;return{text:e,fontFamily:t,fontSize:a,fontWeight:i}},a.prototype.getWiggle=function(t){if(t&&t.metadata){var a=t.metadata.objects;if(a){var i=e.DataViewObjects.getObject(a,"general",void 0);if(i)return i.wiggle}}return!0},a.prototype.enumerateValueAxisValues=function(e){var t=this.data&&this.data.streamGraphSettings?this.data.streamGraphSettings.valueAxisSettings:g.valueAxisSettings;e.pushInstance({selector:null,objectName:"valueAxis",displayName:"Y-Axis",properties:{show:t.show,showAxisTitle:t.showAxisTitle,axisColor:t.axisColor}})},a.prototype.enumerateCategoryAxisValues=function(e){var t=this.data&&this.data.streamGraphSettings?this.data.streamGraphSettings.categoryAxisSettings:g.categoryAxisSettings;e.pushInstance({selector:null,objectName:"categoryAxis",displayName:"X-Axis",properties:{show:t.show,showAxisTitle:t.showAxisTitle,axisColor:t.axisColor}})},a.prototype.enumerateLegend=function(a){var i=this.legendObjectProperties?this.legendObjectProperties:{};a.pushInstance({selector:null,objectName:"legend",displayName:"Legend",properties:{show:this.data&&this.data.streamGraphSettings?this.data.streamGraphSettings.legendSettings.show:!0,position:t.LegendPosition[this.legend.getOrientation()],showTitle:e.DataViewObject.getValue(i,t.legendProps.showTitle,!0),titleText:e.DataViewObject.getValue(i,t.legendProps.titleText,""),labelColor:e.DataViewObject.getValue(i,t.legendProps.labelColor,u),fontSize:e.DataViewObject.getValue(i,t.legendProps.fontSize,h)}})},a.prototype.clearData=function(){this.svg.selectAll(a.Layer.selector).remove(),this.legend.drawLegend({dataPoints:[]},this.viewport),this.yAxis.selectAll("*").remove(),this.xAxis.selectAll("*").remove()},a.prototype.enumerateObjectInstances=function(e){var a=new t.ObjectEnumerationBuilder,i=this.dataView;switch(e.objectName){case"legend":i&&i.categorical&&i.categorical.values&&i.categorical.values.source&&this.enumerateLegend(a);break;case"categoryAxis":this.enumerateCategoryAxisValues(a);break;case"valueAxis":this.enumerateValueAxisValues(a);break;case"general":var r={objectName:"general",displayName:"General",selector:null,properties:{wiggle:this.getWiggle(i)}};a.pushInstance(r)}return a.complete()},a.VisualClassName="streamGraph",a.Properties={general:{formatString:{objectName:"general",propertyName:"formatString"}},legend:{show:{objectName:"legend",propertyName:"show"}},categoryAxis:{show:{objectName:"categoryAxis",propertyName:"show"},axisColor:{objectName:"categoryAxis",propertyName:"axisColor"},showAxisTitle:{objectName:"categoryAxis",propertyName:"showAxisTitle"}},valueAxis:{show:{objectName:"valueAxis",propertyName:"show"},axisColor:{objectName:"valueAxis",propertyName:"axisColor"},showAxisTitle:{objectName:"valueAxis",propertyName:"showAxisTitle"}}},a.Layer={"class":"layer",selector:".layer"},a.XAxisLabel={"class":"xAxisLabel",selector:".xAxisLabel"},a.YAxisLabel={"class":"yAxisLabel",selector:".yAxisLabel"},a.MaxNumberOfAxisXValues=5,a.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:"Category"},{name:"Series",kind:e.VisualDataRoleKind.Grouping,displayName:"Series"},{name:"Y",kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Values")}],dataViewMappings:[{conditions:[{Category:{max:1},Series:{max:0}},{Category:{max:1},Series:{min:1,max:1},Y:{max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{bottom:{}}},values:{group:{by:"Series",select:[{"for":{"in":"Y"}}],dataReductionAlgorithm:{bottom:{}}}}}}],objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}},wiggle:{type:{bool:!0},displayName:"Wiggle"}}},categoryAxis:{displayName:"X-Axis",properties:{show:{displayName:"show",type:{bool:!0}},showAxisTitle:{displayName:"Title",type:{bool:!0}},axisColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}}}},valueAxis:{displayName:"Y-Axis",properties:{show:{displayName:"show",type:{bool:!0}},showAxisTitle:{displayName:"Title",type:{bool:!0}},axisColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}}}},legend:{displayName:"Legend",properties:{show:{displayName:"show",type:{bool:!0}},position:{displayName:"Position",type:{enumeration:t.legendPosition.type}},showTitle:{displayName:"Title",type:{bool:!0}},titleText:{displayName:"Legend Name",type:{text:!0},suppressFormatPainterCopy:!0},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}}}},a}();a.StreamGraph=m}(a=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a;!function(a){var i=t.utility.SelectionManager;a.sunburstRoleNames={nodes:"Nodes",values:"Values"};var r=function(){function a(){this.total=0}return a.prototype.init=function(e){var t=this;this.arc=d3.svg.arc().startAngle(function(e){return e.x}).endAngle(function(e){return e.x+e.dx}).innerRadius(function(e){return Math.sqrt(e.y)}).outerRadius(function(e){return Math.sqrt(e.y+e.dy)}),this.colors=e.style.colorPalette.dataColors,this.selectionManager=new i({hostServices:e.host}),this.svg=d3.select(e.element.get(0)).append("svg"),this.svg.classed("mainDrawArea",!0),this.g=this.svg.append("g"),this.g.classed("container",!0),this.svg.append("text").classed("sunBurstPercentageFixed",!0),this.svg.on("mousedown",function(e){t.svg.selectAll("path").style("opacity",1),t.svg.select(".sunBurstPercentageFixed").style("opacity",0),t.selectionManager.clear()})},a.setAllUnhide=function(e){e.attr("setUnHide","true")},a.prototype.update=function(e){if(e.dataViews.length>0){var t=this.converter(e.dataViews[0],this.colors);this.viewport=e.viewport,this.updateInternal(t)}},a.prototype.updateInternal=function(e){var i=this;this.svg.attr({height:this.viewport.height,width:this.viewport.width}),this.g.attr("transform",t.SVGUtil.translate(this.viewport.width/2,this.viewport.height/2));var r=Math.min(this.viewport.width,this.viewport.height)/2,s=d3.layout.partition().size([2*Math.PI,r*r]).value(function(e){return e.value}),o=this.g.datum(e).selectAll("path").data(s.nodes);o.enter().append("path"),o.attr("display",function(e){return e.depth?null:"none"}).attr("d",this.arc).style("stroke","#fff").style("fill",function(e){return e.color}).style("fill-rule","evenodd").on("mousedown",function(e){e.selector&&i.selectionManager.select(e.selector),d3.selectAll("path").call(a.setAllUnhide).attr("setUnHide",null),i.highlightPath(e,i,!0);var t=i.svg.select(".sunBurstPercentageFixed"),r=0===i.total?0:(100*e.total/i.total).toPrecision(3);t.text(e?r+"%":""),t.style("fill",e.color),i.onResize(),event.stopPropagation()}),this.renderTooltip(o),o.exit().remove(),this.onResize()},a.getTreePath=function(e){for(var t=[],a=e;a.parent;)t.unshift(a),a=a.parent;return t},a.prototype.onResize=function(){var t=this.viewport.width,a=this.viewport.height,i=this.svg.select(".sunBurstPercentageFixed"),r=e.TextMeasurementService.measureSvgTextElementWidth(i[0][0]);i.style("opacity",1),i.attr("y",a/2+4),i.attr("x",t/2-r/2)},a.prototype.highlightPath=function(e,t,i){var r=e?a.getTreePath(e):[];t.svg.selectAll("path").each(function(){"true"!==d3.select(this).attr("setUnHide")&&d3.select(this).style("opacity",a.minOpacity)}),t.svg.selectAll("path").filter(function(e){return r.indexOf(e)>=0}).each(function(){d3.select(this).style("opacity",1),i===!0&&d3.select(this).attr("setUnHide","true")})},a.prototype.renderTooltip=function(e){t.TooltipManager.addTooltip(e,function(e){return e.data.tooltipInfo})},a.getTooltipData=function(e,t){return[{displayName:e,value:0>t?"":t.toString()}]},a.prototype.covertTreeNodeToSunBurstNode=function(e,i,r,s,o){var l;e.identity&&(s=s.concat([e.identity]),l={data:s});var n=0===s.length?null:new t.SelectionId(l,!1),c=e.values?e.values[0].value:0,h={name:e.name,value:Math.max(c,0),selector:n,total:c};if(e.value&&(h.color=o?o:r.getColor(e.value).value),this.total+=h.value,e.children&&e.children.length>0){h.tooltipInfo=a.getTooltipData(e.value,-1),h.children=[];for(var u=0;u<e.children.length;u++){var d=this.covertTreeNodeToSunBurstNode(e.children[u],h,r,s,h.color);h.children.push(d),h.total+=d.total}}else h.tooltipInfo=a.getTooltipData(e.value,c);return i&&(h.parent=i),h},a.prototype.converter=function(e,t){var a=t.getNewColorScale();this.total=0;var i=this.covertTreeNodeToSunBurstNode(e.matrix.rows.root,null,a,[],void 0);return i},a.minOpacity=.2,a.roleNames={nodes:"Nodes",values:"Values"},a.capabilities={dataRoles:[{name:a.roleNames.nodes,kind:e.VisualDataRoleKind.Grouping,displayName:"Groups"},{name:a.roleNames.values,kind:e.VisualDataRoleKind.Measure,displayName:"Values"}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}}},dataViewMappings:[{conditions:[{Groups:{min:0},Values:{max:1}}],matrix:{rows:{"for":{"in":a.roleNames.nodes}},values:{"for":{"in":a.roleNames.values}}}}]},a}();a.Sunburst=r}(a=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a;!function(a){var i=t.utility.SelectionManager,r=function(){function a(){this.margin={top:10,right:30,bottom:10,left:10},this.LegendSize=50,this.AxisSize=30}return a.prototype.init=function(e){var r=this;this.hostServices=e.host,this.selectionManager=new i({hostServices:this.hostServices}),this.root=d3.select(e.element.get(0)).append("svg").classed(a.Identity["class"],!0),this.root.on("click",function(e){r.clearSelection()}),this.main=this.root.append("g"),this.axes=this.main.append("g").classed(a.Axes["class"],!0),this.axisX=this.axes.append("g").classed(a.Axis["class"],!0),this.axisY=this.axes.append("g").classed(a.Axis["class"],!0),this.axisY2=this.axes.append("g").classed(a.Axis["class"],!0),this.legends=this.main.append("g").classed(a.Legends["class"],!0),this.line=this.main.append("g").classed(a.Values["class"],!0),this.colors=e.style&&e.style.colorPalette?e.style.colorPalette.dataColors:new t.DataColorPalette},a.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){var t=e.viewport,a=this.model=this.converter(e.dataViews[0],t);this.clearSelection(),this.resize(t),this.draw(a)}},a.prototype.destroy=function(){this.root=null},a.prototype.setIsStopped=function(e){var t={merge:[{objectName:"misc",selector:void 0,properties:{isstopped:e}}]};this.hostServices.persistProperties(t),this.hostServices.onSelect({data:[]})},a.prototype.enumerateObjectInstances=function(e){var t=[];if(!this.model||!this.model.settings)return t;var a=this.model.settings;switch(e.objectName){case"lineoptions":var i={objectName:"lineoptions",displayName:"lineoptions",selector:null,properties:{fill:a.lineFill,lineThickness:a.lineThickness}};t.push(i);break;case"dotoptions":var r={objectName:"dotoptions",displayName:"dotoptions",selector:null,properties:{color:a.dotFill,dotSizeMin:a.dotSizeMin,dotSizeMax:a.dotSizeMax}};t.push(r);break;case"counteroptions":var s={objectName:"counteroptions",displayName:"counteroptions",selector:null,properties:{counterTitle:a.counterTitle}};t.push(s);break;case"misc":var o={objectName:"misc",displayName:"misc",selector:null,properties:{isanimated:a.isanimated,isstopped:a.isstopped,duration:a.duration}};t.push(o)}return t},a.prototype.selectDot=function(e,t){var a=d3.select(e);a.classed("point_selected")?this.clearSelection():(t&&this.selectionManager.select(t),this.root.classed("filtered",!0),this.line.selectAll("circle.point").classed("point_selected",!1),d3.select(e).classed("point_selected",!0)),d3.event.stopPropagation()},a.prototype.clearSelection=function(){this.root.classed("filtered",!1),this.root.selectAll("circle.point").classed("point_selected",!1),this.selectionManager.clear()},a.prototype.converter=function(e,a){if(!(e.categorical&&e.categorical.categories&&e.categorical.categories[0]&&e.categorical.categories[0].values&&e.categorical.categories[0].values.length>0&&e.categorical&&e.categorical.values&&e.categorical.values[0]&&e.categorical.values[0].values&&e.categorical.values[0].values.length>0))return null;var i,r,s,o,l=[],n=this,c=t.AxisHelper.getCategoryValueType(e.categorical.categories[0].source,!0);this.isDateTime=t.AxisHelper.isDateTime(c);var h,u=!0,d=this.parseSettings(e),p=Math.max(0,a.width-this.margin.left-this.margin.right-this.LegendSize-this.AxisSize),g=Math.max(0,a.height-this.margin.top-this.margin.bottom-this.LegendSize),m="";l=e.categorical.categories[0].values,i=e.categorical.categories[0].source,r=d3.extent(l),this.isDateTime?(s=r[0].getTime(),o=r[1].getTime(),s=new Date(s),o=new Date(o+.05*(o-s)),m="MMM dd yyyy",h=t.valueFormatter.create({format:m})):(s=r[0],o=r[1],o+=.05*(o-s),h=t.valueFormatter.create({value:0}));var y=t.AxisHelper.createAxis({pixelSpan:p,dataDomain:[s,o],metaDataColumn:i,formatString:null,outerPadding:0,isCategoryAxis:!0,isScalar:u,isVertical:!1,forcedTickCount:void 0,useTickIntervalForDisplayUnits:!0,getValueFn:function(e,t){return n.isDateTime?h.format(new Date(e)):e}});y.formatter=h,i=e.categorical.values[0].source,l=e.categorical.values[0].values,r=d3.extent(l),s=r[0],o=r[1];for(var f,v=[],x=0,b=0,S=0,w=0;w<e.categorical.categories[0].values.length;w++)b=e.categorical.values[0].values[w],S=e.categorical.categories[0].values[w],x+=b,f=t.SelectionId.createWithId(e.categorical.categories[0].identity[w]),v.push({dot:(b-s)/(o-s),value:b,sum:x,time:S,selector:f});x+=.1*(x-s);var C=t.AxisHelper.createAxis({pixelSpan:g,dataDomain:[s,x],metaDataColumn:i,formatString:null,outerPadding:0,isCategoryAxis:!1,isScalar:!0,isVertical:!0,useTickIntervalForDisplayUnits:!0}),D=t.AxisHelper.createAxis({pixelSpan:g,dataDomain:[s,x],metaDataColumn:i,formatString:null,outerPadding:0,isCategoryAxis:!1,isScalar:!0,isVertical:!0,useTickIntervalForDisplayUnits:!0});return D.axis.orient("right"),{points:v,settings:d,xAxis:y,yAxis:C,yAxis2:D,legends:this.generateAxisLabels(a,d)}},a.prototype.parseSettings=function(i){if(!(i&&i.metadata&&i.metadata.columns&&i.metadata.columns[0]))return null;var r=i.metadata.objects,s=new t.ColorHelper(this.colors,a.Properties.lineoptions.fill,a.DefaultSettings.lineFill),o=new t.ColorHelper(this.colors,a.Properties.dotoptions.color,a.DefaultSettings.dotFill),l=a.DefaultSettings.xAxisTitle,n=a.DefaultSettings.yAxisTitle;i.categorical.categories[0]&&i.categorical.categories[0].source&&i.categorical.categories[0].source.displayName&&i.categorical.values[0]&&i.categorical.values[0].source&&i.categorical.values[0].source.displayName&&(l=i.categorical.categories[0].source.displayName,n=i.categorical.values[0].source.displayName);var c=a.DefaultSettings.lineThickness,h=a.DefaultSettings.dotSizeMin,u=a.DefaultSettings.dotSizeMax,d=a.DefaultSettings.counterTitle,p=a.DefaultSettings.isanimated,g=a.DefaultSettings.isstopped,m=a.DefaultSettings.duration;return r&&(c=e.DataViewObjects.getValue(r,a.Properties.lineoptions.lineThickness,a.DefaultSettings.lineThickness),h=e.DataViewObjects.getValue(r,a.Properties.dotoptions.dotSizeMin,a.DefaultSettings.dotSizeMin),u=e.DataViewObjects.getValue(r,a.Properties.dotoptions.dotSizeMax,a.DefaultSettings.dotSizeMax),d=e.DataViewObjects.getValue(r,a.Properties.counteroptions.counterTitle,a.DefaultSettings.counterTitle),p=e.DataViewObjects.getValue(r,a.Properties.misc.isanimated,a.DefaultSettings.isanimated),g=e.DataViewObjects.getValue(r,a.Properties.misc.isstopped,a.DefaultSettings.isstopped),m=e.DataViewObjects.getValue(r,a.Properties.misc.duration,a.DefaultSettings.duration)),{xAxisTitle:l,yAxisTitle:n,lineFill:s.getColorForMeasure(r,""),lineThickness:c,dotFill:o.getColorForMeasure(r,""),dotSizeMin:h,dotSizeMax:u,counterTitle:d,isstopped:g,isanimated:p,duration:m}},a.prototype.generateAxisLabels=function(e,a){return[{transform:t.SVGUtil.translate((e.width-this.margin.left-this.margin.right)/2,e.height-this.margin.top-this.margin.bottom),text:a.xAxisTitle,dx:"1em",dy:"-1em"},{transform:t.SVGUtil.translateAndRotate(0,(e.height-this.margin.top-this.margin.bottom)/2,0,0,270),text:a.yAxisTitle,dx:"3em"}]},a.prototype.resize=function(e){this.root.attr({height:Math.max(0,e.height),width:Math.max(0,e.width)}),this.main.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top)),this.legends.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top)),this.line.attr("transform",t.SVGUtil.translate(this.margin.left+this.LegendSize,0)),this.axes.attr("transform",t.SVGUtil.translate(this.margin.left+this.LegendSize,0)),this.axisX.attr("transform",t.SVGUtil.translate(0,e.height-this.margin.top-this.margin.bottom-this.LegendSize)),this.axisY2.attr("transform",t.SVGUtil.translate(e.width-this.margin.left-this.margin.right-this.LegendSize-this.AxisSize,0))},a.prototype.draw=function(e){var t=this,a=this;if(this.line.selectAll("*").remove(),this.legends.selectAll("*").remove(),this.axisX.selectAll("*").remove(),this.axisY.selectAll("*").remove(),this.axisY2.selectAll("*").remove(),e&&(this.renderLegends(e),e&&e.points&&e.points.length)){if(this.axisX.call(e.xAxis.axis),this.axisY.call(e.yAxis.axis),this.axisY2.call(e.yAxis2.axis),e.settings.isanimated){var i=this.line.append("g").classed("lineDotChart__playBtn",!0).attr("transform","translate(40, 20)");if(i.append("circle").attr("r",17),e.settings.isstopped)return i.append("path").attr("d","M0 2l10 6-10 6z").attr("transform","translate(-4,-8)"),void i.on("click.lineDotChart__playBt",function(){a.setIsStopped(!1)});i.append("path").attr("d","M0 2l10 6-10 6z").attr("transform-origin","center").attr("transform","translate(6, 8) rotate(180)"),i.append("rect").attr("width","2").attr("height","12").attr("transform","translate(-7,-6)"),i.on("click.lineDotChart__playBt",function(){a.setIsStopped(!0)})}var r=this.line.append("clipPath").attr("id","lineClip").append("rect").attr("x",0).attr("y",0).attr("width",1).attr("height",1e4),s=d3.svg.line().x(function(t){return e.xAxis.scale(t.time)}).y(function(t){return e.yAxis.scale(t.sum)}),o=this.line.selectAll("path.plot").data([e.points]);o.enter().append("path"),o.classed("plot",!0).attr("stroke",function(t,a){return e.settings.lineFill}).attr("stroke-width",e.settings.lineThickness).attr("d",s);var l=o.node().getTotalLength(),n=o.node().getPointAtLength(0).x,c=o.node().getPointAtLength(l).x;o.attr("clip-path","url("+location.href+"#lineClip)"),e.settings.isanimated?r.attr("x",n).interrupt().transition().ease("linear").duration(1e3*e.settings.duration).attr("width",c-n):r.interrupt().attr("x",n).attr("width",c-n),o.exit().remove();var h=300,u=0,d=this.line.selectAll("circle.point").data(e.points),a=this;d.enter().append("circle").attr("fill",e.settings.dotFill).attr("opacity",.77).attr("r",function(t){return e.settings.dotSizeMin+t.dot*(e.settings.dotSizeMax-e.settings.dotSizeMin)}).classed("point",!0).on("mouseover.point",this.showDataPoint).on("mouseout.point",this.hideDataPoint).on("click.point",function(e){a.selectDot(this,e.selector)}),e.settings.isanimated?d.interrupt().attr("transform",function(t){return"translate("+e.xAxis.scale(t.time)+" "+e.yAxis.scale(t.sum)+") scale(0.005)"}).transition().duration(h).delay(function(a,i){return t.pointDelay(e.points,i,e.settings.duration)}).ease("linear").attr("transform",function(t){return"translate("+e.xAxis.scale(t.time)+" "+e.yAxis.scale(t.sum)+") scale(3.4)"}).transition().duration(h).delay(function(a,i){return t.pointDelay(e.points,i,e.settings.duration)+h}).ease("elastic").attr("transform",function(t){return"translate("+e.xAxis.scale(t.time)+" "+e.yAxis.scale(t.sum)+") scale(1)"}):d.interrupt().attr("transform",function(t){return"translate("+e.xAxis.scale(t.time)+" "+e.yAxis.scale(t.sum)+") scale(1)"}),d.exit().remove();for(var p=0;p<d[0].length;p++)this.addTooltip(e,d[0][p]);var g=this.line.selectAll("text").data(e.points);g.enter().append("text").classed("text",!0).text(function(t,a){return e.settings.counterTitle+" "+(a+1)}).attr("x",c-260).attr("y",30),e.settings.isanimated?g.attr("opacity",0).interrupt().transition().duration(u).delay(function(a,i){return t.pointDelay(e.points,i,e.settings.duration)}).attr("transform","translate(0 0)").attr("opacity",1).transition().duration(u).delay(function(a,i){return e.points[i+1]?t.pointDelay(e.points,i+1,e.settings.duration):Number.POSITIVE_INFINITY}).attr("opacity",0):g.interrupt().attr("transform","translate(0 0)").attr("opacity",function(t,a){return Number(a===e.points.length-1)}),g.exit().remove()}},a.prototype.pointDelay=function(e,t,a){if(!e.length||!e[t]||0===t)return 0;if(this.isDateTime)var i=e[t].time,r=e[0].time.getTime(),s=e[e.length-1].time.getTime(),o=i.getTime();else var i=e[t].time,r=e[0].time,s=e[e.length-1].time,o=i;return 1e3*a*(o-r)/(s-r)},a.prototype.showDataPoint=function(e,t){d3.select(this).classed("show",!0)},a.prototype.hideDataPoint=function(e,t){d3.select(this).classed("show",!1)},a.prototype.addTooltip=function(e,a){var i=d3.select(a),r=i.datum();t.TooltipManager.addTooltip(i,function(t){return[{displayName:e.settings.xAxisTitle,value:e.xAxis.formatter.format(r.time)},{displayName:e.settings.yAxisTitle,value:r.value.toString()}]})},a.prototype.renderLegends=function(e){var t=this.legends.selectAll(a.Legend.selector).data(e.legends);t.enter().append("svg:text"),t.attr("x",0).attr("y",0).attr("dx",function(e){return e.dx}).attr("dy",function(e){return e.dy}).attr("transform",function(e){return e.transform}).text(function(e){return e.text}).classed(a.Legend["class"],!0),t.exit().remove()},a.DefaultSettings={lineFill:"rgb(102, 212, 204)",lineThickness:3,dotFill:"#005c55",dotSizeMin:4,dotSizeMax:38,counterTitle:"Total features",xAxisTitle:"",yAxisTitle:"",duration:20,isanimated:!0,isstopped:!0},a.capabilities={dataRoles:[{name:"Date",kind:e.VisualDataRoleKind.Grouping,displayName:"Date"},{name:"Values",kind:e.VisualDataRoleKind.Measure,displayName:"Values"}],dataViewMappings:[{conditions:[{Date:{min:0,max:1},Values:{min:0,max:1},Labels:{min:0,max:1}}],categorical:{categories:{"for":{"in":"Date"},dataReductionAlgorithm:{sample:{}}},values:{"for":{"in":"Values"}}}}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},lineoptions:{displayName:"Line",properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},lineThickness:{displayName:"Thickness",type:{numeric:!0}}}},dotoptions:{displayName:"Dot",properties:{color:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},dotSizeMin:{displayName:"Min size",type:{numeric:!0}},dotSizeMax:{displayName:"Min size",type:{numeric:!0}}}},counteroptions:{displayName:"Counter",properties:{counterTitle:{displayName:"Title",type:{text:!0}}}},misc:{displayName:"Animation",properties:{isanimated:{displayName:"Animated",type:{bool:!0}},isstopped:{displayName:"Stop on load",type:{bool:!0}},duration:{displayName:"Time",type:{numeric:!0}}}}}},a.Identity={"class":"lineDotChart",selector:".lineDotChart"},a.Axes={"class":"axes",selector:".axes"},a.Axis={"class":"axis",selector:".axis"},a.Legends={"class":"legends",selector:".legends"},a.Legend={"class":"legend",selector:".legend"},a.Values={"class":"line",selector:".line"},a.Properties={general:{formatString:{objectName:"general",propertyName:"formatString"}},lineoptions:{fill:{objectName:"lineoptions",propertyName:"fill"},lineThickness:{objectName:"lineoptions",propertyName:"lineThickness"}},dotoptions:{color:{objectName:"dotoptions",propertyName:"color"},dotSizeMin:{objectName:"dotoptions",propertyName:"dotSizeMin"},dotSizeMax:{objectName:"dotoptions",propertyName:"dotSizeMax"}},counteroptions:{counterTitle:{objectName:"counteroptions",propertyName:"counterTitle"}},misc:{isanimated:{objectName:"misc",propertyName:"isanimated"},isstopped:{objectName:"misc",propertyName:"isstopped"},duration:{objectName:"misc",propertyName:"duration"}}},a}();a.LineDotChart=r}(a=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(t){t.sunburstCustom={name:"sunburstCustom",watermarkKey:"defaultWatermark",capabilities:e.samples.Sunburst.capabilities,create:function(){return new e.samples.Sunburst}},t.asterPlot={name:"asterPlot",capabilities:e.samples.AsterPlot.capabilities,create:function(){return new e.samples.AsterPlot}},t.tornadoChart={name:"tornadoChart",
capabilities:e.samples.TornadoChart.capabilities,create:function(){return new e.samples.TornadoChart}},t.sankeyDiagram={name:"sankeyDiagram",capabilities:e.samples.SankeyDiagram.capabilities,create:function(){return new e.samples.SankeyDiagram}},t.mekkoChart={name:"mekkoChart",watermarkKey:"mekko",capabilities:e.samples.MekkoChart.capabilities,create:function(){return new e.samples.MekkoChart({chartType:0})},customizeQuery:e.ColumnChart.customizeQuery,getSortableRoles:function(t){return e.ColumnChart.getSortableRoles(t)}},t.bulletChart={name:"bulletChart",capabilities:e.samples.BulletChart.capabilities,create:function(){return new e.samples.BulletChart}},t.wordCloud={name:"wordCloud",capabilities:e.samples.WordCloud.capabilities,create:function(){return new e.samples.WordCloud}},t.chicletSlicer={name:"chicletSlicer",capabilities:e.samples.ChicletSlicer.capabilities,create:function(){return new e.samples.ChicletSlicer}},t.chordChart={name:"chordChart",capabilities:e.samples.ChordChart.capabilities,create:function(){return new e.samples.ChordChart}},t.enhancedScatterChart={name:"enhancedScatterChart",capabilities:e.samples.EnhancedScatterChart.capabilities,create:function(){return new e.samples.EnhancedScatterChart}},t.radarChart={name:"radarChart",capabilities:e.samples.RadarChart.capabilities,create:function(){return new e.samples.RadarChart}},t.dotPlot={name:"dotPlot",capabilities:e.samples.DotPlot.capabilities,create:function(){return new e.samples.DotPlot}},t.histogram={name:"histogram",capabilities:e.samples.Histogram.capabilities,create:function(){return new e.samples.Histogram}},t.timeline={name:"timeline",capabilities:e.samples.Timeline.capabilities,create:function(){return new e.samples.Timeline}},t.forceGraph={name:"forceGraph",capabilities:e.samples.ForceGraph.capabilities,create:function(){return new e.samples.ForceGraph}},t.gantt={name:"gantt",capabilities:e.samples.Gantt.capabilities,create:function(){return new e.samples.Gantt}},t.streamGraph={name:"streamGraph",capabilities:e.samples.StreamGraph.capabilities,create:function(){return new e.samples.StreamGraph}},t.lineDotChart={name:"lineDotChart",capabilities:e.samples.LineDotChart.capabilities,create:function(){return new e.samples.LineDotChart}}}(t=e.plugins||(e.plugins={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a;!function(a){function i(){return new r}var r=function(i){function r(){i.call(this,{}),this.initCustomVisualPlugins()}return __extends(r,i),r.prototype.getVisuals=function(){var e=this.customVisualPlugins,t=Object.keys(e);return t.map(function(t){return e[t]})},r.prototype.getPlugin=function(e){if(!e)return null;var t=this.customVisualPlugins[e];return t?t:null},r.prototype.capabilities=function(e){var t=this.getPlugin(e);return t?t.capabilities:{}},r.prototype.initCustomVisualPlugins=function(){a.createPlugin(this.customVisualPlugins,e.visuals.plugins.asterPlot,function(){return new t.samples.AsterPlot}),a.createPlugin(this.customVisualPlugins,e.visuals.plugins.tornadoChart,function(){return new t.samples.TornadoChart({animator:new t.BaseAnimator})}),a.createPlugin(this.customVisualPlugins,e.visuals.plugins.sankeyDiagram,function(){return new t.samples.SankeyDiagram}),a.createPlugin(this.customVisualPlugins,e.visuals.plugins.mekkoChart,function(){return new t.samples.MekkoChart({chartType:0,isScrollable:!0,animator:new t.WebColumnChartAnimator,behavior:new t.CartesianChartBehavior([new t.ColumnChartWebBehavior])})}),a.createPlugin(this.customVisualPlugins,e.visuals.plugins.bulletChart,function(){return new t.samples.BulletChart}),a.createPlugin(this.customVisualPlugins,e.visuals.plugins.wordCloud,function(){return new t.samples.WordCloud({animator:new t.BaseAnimator})}),a.createPlugin(this.customVisualPlugins,e.visuals.plugins.chicletSlicer,function(){return new t.samples.ChicletSlicer({behavior:new t.samples.ChicletSlicerWebBehavior})}),a.createPlugin(this.customVisualPlugins,e.visuals.plugins.enhancedScatterChart,function(){return new t.samples.EnhancedScatterChart}),a.createPlugin(this.customVisualPlugins,e.visuals.plugins.radarChart,function(){return new t.samples.RadarChart({animator:new t.BaseAnimator})}),a.createPlugin(this.customVisualPlugins,e.visuals.plugins.dotPlot,function(){return new t.samples.DotPlot({animator:new t.BaseAnimator})}),a.createPlugin(this.customVisualPlugins,e.visuals.plugins.histogram,function(){return new t.samples.Histogram({animator:new t.BaseAnimator})}),a.createPlugin(this.customVisualPlugins,e.visuals.plugins.forceGraph,function(){return new t.samples.ForceGraph}),a.createPlugin(this.customVisualPlugins,e.visuals.plugins.gantt,function(){return new t.samples.Gantt}),a.createPlugin(this.customVisualPlugins,e.visuals.plugins.streamGraph,function(){return new t.samples.StreamGraph})},r}(a.VisualPluginService);a.CustomVisualPluginService=r,a.createCustomVisualPluginService=i}(a=t.visualPluginFactory||(t.visualPluginFactory={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));
//# sourceMappingURL=CustomVisuals.min.js.map
